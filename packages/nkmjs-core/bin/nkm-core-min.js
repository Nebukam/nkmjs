"use strict";function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,Wrapper)}function Wrapper(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,t)})(t)}function _construct(t,e,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function _construct(t,e,n){var i=[null];i.push.apply(i,e);var s,a=new(Function.bind.apply(t,i));return n&&_setPrototypeOf(a,n.prototype),a}).apply(null,arguments)}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function set(t,e,n,i){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function set(t,e,n,i){var s=_superPropBase(t,e),a;if(s){if((a=Object.getOwnPropertyDescriptor(s,e)).set)return a.set.call(i,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(i,e)){if(!a.writable)return!1;a.value=n,Object.defineProperty(i,e,a)}else _defineProperty(i,e,n);return!0})(t,e,n,i)}function _set(t,e,n,i,s){var a;if(!set(t,e,n,i||t)&&s)throw new Error("failed to set property");return n}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,e,n){var i=_superPropBase(t,e);if(i){var s=Object.getOwnPropertyDescriptor(i,e);return s.get?s.get.call(n):s.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function _createSuperInternal(){var n=_getPrototypeOf(t),i;if(e){var s=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(){function r(t,e,n){function o(s,a){if(!e[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=e[s]={exports:{}};t[s][0].call(u.exports,(function(e){var n;return o(t[s][1][e]||e)}),u,u.exports,r,t,e,n)}return e[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}return r}()({1:[function(t,e,n){e.exports={RELAY:t("./lib/relay"),Request:t("./lib/request"),ACTION_REQUEST:t("./lib/action-request"),Action:t("./lib/actions/action"),ActionGroup:t("./lib/actions/action-group"),ActionStack:t("./lib/actions/action-stack"),COMMAND_SIGNAL:t("./lib/commands/command-event"),Command:t("./lib/commands/command"),CommandFn:t("./lib/commands/command-fn"),CommandBox:t("./lib/commands/command-box"),CommandChain:t("./lib/commands/command-chain"),CommandAction:t("./lib/commands/command-action")}},{"./lib/action-request":2,"./lib/actions/action":5,"./lib/actions/action-group":3,"./lib/actions/action-stack":4,"./lib/commands/command":12,"./lib/commands/command-action":7,"./lib/commands/command-box":8,"./lib/commands/command-chain":9,"./lib/commands/command-event":10,"./lib/commands/command-fn":11,"./lib/relay":13,"./lib/request":14}],2:[function(t,e,n){var i=function ACTION_REQUEST(){_classCallCheck(this,ACTION_REQUEST)};_defineProperty(i,"EXIT","exit"),_defineProperty(i,"EDIT","edit"),_defineProperty(i,"PREVIEW","preview"),_defineProperty(i,"OPEN","open"),_defineProperty(i,"CLOSE","close"),_defineProperty(i,"CREATE","create"),_defineProperty(i,"SAVE","save"),_defineProperty(i,"DELETE","delete"),_defineProperty(i,"RENAME","rename"),_defineProperty(i,"APPLY","apply"),_defineProperty(i,"DIALOG","dialog"),e.exports=i},{}],3:[function(t,e,n){var i,s=function(t){_inherits(ActionGroup,t);var e=_createSuper(ActionGroup);function ActionGroup(){return _classCallCheck(this,ActionGroup),e.call(this)}return _createClass(ActionGroup,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ActionGroup.prototype),"_Init",this).call(this),this._actions=new Array(0),this._last=null}},{key:"last",get:function get(){return this._last}},{key:"_Register",value:function _Register(t){return this._actions.push(t),this._last=t,t}},{key:"Do",value:function Do(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"_InternalDo",value:function _InternalDo(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"_InternalUndo",value:function _InternalUndo(){for(var t=this._actions,e=t.length-1;e>=0;e--)t[e].Undo()}},{key:"_InternalRedo",value:function _InternalRedo(){for(var t=this._actions,e=0,n=t.length;e<n;e++)t[e].Redo()}},{key:"_CleanUp",value:function _CleanUp(){this._last=null;for(var t=this._actions;0!=t.length;)t.pop().Release();this._actions.length=0,_get(_getPrototypeOf(ActionGroup.prototype),"_CleanUp",this).call(this)}}],[{key:"mergeable",get:function get(){return!1}}]),ActionGroup}(t("./action"));e.exports=s},{"./action":5}],4:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").POOL,c=t("./action-group"),u=function(){function ActionStack(){_classCallCheck(this,ActionStack),this._Init(),this._PostInit()}return _createClass(ActionStack,[{key:"_Init",value:function _Init(){this._maxCount=-1,this._headIndex=-1,this._stack=new Array(0),this._isEnabled=!0,this._groupingActive=!1,this._group=null}},{key:"_PostInit",value:function _PostInit(){}},{key:"isEnabled",get:function get(){return this._isEnabled}},{key:"enabled",set:function set(t){t?this.Enable():this.Disable()}},{key:"Enable",value:function Enable(){return!this._isEnabled&&(this._isEnabled=!0,!0)}},{key:"Disable",value:function Disable(){return!!this._isEnabled&&(this._isEnabled=!1,!0)}},{key:"ToggleGrouping",value:function ToggleGrouping(t){this._groupingActive!==t&&(this._groupingActive=t,!t&&this._group&&(this._group=null))}},{key:"Do",value:function Do(t,e){return this._isEnabled?(this._groupingActive&&(this._group||(this._group=this._Register(l.Rent(c)))),n=this._group?this._group.last:this._stack.length>0?this._stack[this._stack.length-1]:null,t.mergeable&&s.isInstanceOf(n,t)&&n.CanMerge(e)?n.Do(e,!0):this._group?this._group._Register(l.Rent(t).Do(e,!1)):this._Register(l.Rent(t).Do(e,!1))):null;var n}},{key:"_Register",value:function _Register(t){var e=this._stack;if(this._headIndex!=e.length-1){for(var n=this._headIndex+1,i=n;i<e.length;i++)e[i].Release();e.length=n}return e.push(t),this._headIndex=e.length-1,t}},{key:"Undo",value:function Undo(){var t=this._stack;if(0!==t.length){var e=this._headIndex;if(-1!==e){var n=t[e];this._headIndex=e-1,n.Undo()}}}},{key:"Redo",value:function Redo(){if(0!==this._stack.length){var t=this._headIndex;if(!((t+=1)>=this._stack.length)){var e=this._stack[t];this._headIndex=t,e.Redo()}}}},{key:"Clear",value:function Clear(){this.ToggleGrouping(!1);for(var t=this._stack;0!=t.length;)t.pop().Release();t.length=0,this._headIndex=-1,this._groupingActive=!1}}]),ActionStack}();e.exports=u},{"./action-group":3,"@nkmjs/common":27,"@nkmjs/utils":271}],5:[function(t,e,n){var i,s,a=function(t){_inherits(Action,t);var e=_createSuper(Action);function Action(){return _classCallCheck(this,Action),e.call(this)}return _createClass(Action,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Action.prototype),"_Init",this).call(this),this._operation=null,this._undoed=!1}},{key:"operation",get:function get(){return this._operation}},{key:"CanMerge",value:function CanMerge(t){return!1}},{key:"Do",value:function Do(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e||(this._operation=t),this._InternalDo(t,e),this}},{key:"Undo",value:function Undo(){this._undoed=!0,this._InternalUndo()}},{key:"Redo",value:function Redo(){this._undoed=!1,this._InternalRedo()}},{key:"_InternalDo",value:function _InternalDo(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"_InternalUndo",value:function _InternalUndo(){}},{key:"_InternalRedo",value:function _InternalRedo(){}},{key:"_CleanUp",value:function _CleanUp(){this._operation=null,this._undoed=!1,_get(_getPrototypeOf(Action.prototype),"_CleanUp",this).call(this)}}],[{key:"mergeable",get:function get(){return!1}}]),Action}(t("@nkmjs/common").DisposableObject);e.exports=a},{"@nkmjs/common":27}],6:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.POOL,u=a.DisposableObjectEx,h=t("./command-event"),d=function(t){_inherits(Command,t);var e=_createSuper(Command);function Command(){return _classCallCheck(this,Command),e.call(this)}return _createClass(Command,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Command.prototype),"_Init",this).call(this),this._icon="",this._name=s.CamelSplit(this.constructor.name),this._isEnabled=!0,this._context=null,this._emitter=null,this._order=0,this._running=!1}},{key:"running",get:function get(){return this._running}},{key:"order",get:function get(){return this._order},set:function set(t){this._order=t}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._icon=t}},{key:"name",get:function get(){return this._name},set:function set(t){this._name=t}},{key:"emitter",get:function get(){return this._emitter},set:function set(t){if(this._emitter!==t){var e=this._emitter;this._emitter=t,e&&e.Unwatch(l.RELEASED,this._OnEmitterReleased,this),t&&t.Watch(l.RELEASED,this._OnEmitterReleased,this)}}},{key:"_OnEmitterReleased",value:function _OnEmitterReleased(t){this.emitter=null}},{key:"isEnabled",get:function get(){return this._isEnabled}},{key:"enabled",set:function set(t){t?this.Enable():this.Disable()}},{key:"Enable",value:function Enable(){return!this._isEnabled&&(this._isEnabled=!0,this._Broadcast(l.UPDATED,this),!0)}},{key:"Disable",value:function Disable(){return!!this._isEnabled&&(this._isEnabled=!1,this._Broadcast(l.UPDATED,this),!0)}},{key:"context",get:function get(){return this._context},set:function set(t){var e=this._SanitizeContext(t);this._context!==e&&(this._context=e,this._OnContextChanged(),this.enabled=this.CanExecute(this._context))}},{key:"_SanitizeContext",value:function _SanitizeContext(t){return t}},{key:"_OnContextChanged",value:function _OnContextChanged(){}},{key:"CanExecute",value:function CanExecute(t){return!0}},{key:"Execute",value:function Execute(t){this._running||(this.context=s.Default(t,this._context),this._isEnabled&&(this._Start(),this._InternalExecute()))}},{key:"_InternalExecute",value:function _InternalExecute(){}},{key:"_InternalCancel",value:function _InternalCancel(){}},{key:"_Start",value:function _Start(){this._running||(this._running=!0,this._Broadcast(h.START,this),this._Broadcast(l.UPDATED,this))}},{key:"_Success",value:function _Success(){this._Broadcast(h.SUCCESS,this),this._End()}},{key:"_Fail",value:function _Fail(t){console.error("".concat(this," failed : ").concat(t)),this._Broadcast(h.FAIL,this,t),this._End()}},{key:"Cancel",value:function Cancel(){this._running&&this._Cancel()}},{key:"_Cancel",value:function _Cancel(){this._InternalCancel(),this._Broadcast(h.CANCEL,this),this._End()}},{key:"_End",value:function _End(){this._running=!1,this._Broadcast(h.END,this),this._Broadcast(l.UPDATED,this)}},{key:"_CleanUp",value:function _CleanUp(){this.Cancel(),this._icon="",this._isEnabled=!0,this.context=null,this.emitter=null,this.order=0,_get(_getPrototypeOf(Command.prototype),"_CleanUp",this).call(this)}},{key:"toString",value:function toString(){return"[>>".concat(this.constructor.name,"]")}}],[{key:"Rent",value:function Rent(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=c.Rent(t);return i.name=s.isEmpty(e)?s.CamelSplit(t.name):e,i.icon=s.isEmpty(n)?"%ICON%/icon_cmd.svg":n,i}}]),Command}(u);e.exports=d},{"./command-event":10,"@nkmjs/common":27,"@nkmjs/utils":271}],7:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").POOL,c=t("./command-event"),u,h=null,d=function(t){_inherits(CommandAction,t);var e=_createSuper(CommandAction);function CommandAction(){return _classCallCheck(this,CommandAction),e.call(this)}return _createClass(CommandAction,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CommandAction.prototype),"_Init",this).call(this),this._actionClass=null}},{key:"actionClass",get:function get(){return this._actionClass},set:function set(t){this._actionClass=t}},{key:"CanExecute",value:function CanExecute(t){return!(!t||!this._actionClass)}},{key:"_InternalExecute",value:function _InternalExecute(){var t=null;if(this._emitter&&!(t=this._emitter.editor))for(var e=l.GetClass("Editor"),n=this._emitter;!t&&n;)s.isInstanceOf(n,e)&&(t=n),n=n.parent;t?t.Do(this._actionClass,this._context):l.Rent(this._actionClass).Do(this._context,!1).Release(),this._Success()}},{key:"_CleanUp",value:function _CleanUp(){this._actionClass=null,_get(_getPrototypeOf(CommandAction.prototype),"_CleanUp",this).call(this)}}],[{key:"Do",value:function Do(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=this._COMMAND_ACTION;i||(i=this._COMMAND_ACTION=new CommandAction),i.emitter=t,i.actionClass=e,i.Execute(n)}}]),CommandAction}(t("./command"));e.exports=d},{"./command":12,"./command-event":10,"@nkmjs/common":27,"@nkmjs/utils":271}],8:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/collections"),l=a.List,c=a.Dictionary,u=t("./command"),h=function(){function CommandBox(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,CommandBox),this._context=null,this._commandList=new l(0),this._commandHooks=new c,this._onRegisterCmd=t}return _createClass(CommandBox,[{key:"list",get:function get(){return this._commandList}},{key:"context",get:function get(){return this._context},set:function set(t){this._context=t;for(var e=this._commandList,n=0,i=e.count;n<i;n++)e.At(n).context=t}},{key:"Create",value:function Create(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=u.Rent(t,e,n);return this._Register(s,i),s}},{key:"_Register",value:function _Register(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._commandList.Add(t)){if(e){this._commandHooks.Set(t,e);for(var n=0,i=e.length;n<i;n++){var a=e[n];t.Watch(a.evt,a.fn,s.Default(a.thisArg,null))}}this._OnCommandRegistered(t)}}},{key:"_OnCommandRegistered",value:function _OnCommandRegistered(t){t.context=this._context,this._onRegisterCmd&&this._onRegisterCmd.call(null,t)}},{key:"RemoveCommand",value:function RemoveCommand(t){if(this._commandList.Remove(t)){var e;if(this._commandHooks.Get(t)){this._commandHooks.Remove(t);for(var n=0,i=p_hooks.length;n<i;n++){var a=p_hooks[n];t.Unwatch(a.evt,a.fn,s.Default(a.thisArg,null))}}this._OnCommandRemoved(t)}}},{key:"_OnCommandRemoved",value:function _OnCommandRemoved(t){t.context=null}}]),CommandBox}();e.exports=h},{"./command":12,"@nkmjs/collections":21,"@nkmjs/utils":271}],9:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.Observer,u=t("./command-event"),h,d=function(t){_inherits(CommandChain,t);var e=_createSuper(CommandChain);function CommandChain(){return _classCallCheck(this,CommandChain),e.call(this)}return _createClass(CommandChain,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CommandChain.prototype),"_Init",this).call(this),this._nodes=new Array(0),this._currentIndex=0,this._cmdObserver=new c,this._cmdObserver.Hook(u.START,this._NodeStart,this),this._cmdObserver.Hook(u.END,this._NodeEnd,this),this._cmdObserver.Hook(u.SUCCESS,this._NodeSuccess,this),this._cmdObserver.Hook(u.FAIL,this._NodeFail,this)}},{key:"_OnContextChanged",value:function _OnContextChanged(){_get(_getPrototypeOf(CommandChain.prototype),"_OnContextChanged",this).call(this);for(var t=0,e=this._nodes.length;t<e;t++)this._nodes[t].context=this._context}},{key:"CanExecute",value:function CanExecute(t){var e;if(!_get(_getPrototypeOf(CommandChain.prototype),"CanExecute",this).call(this,t))return!1;for(var n=0,i=this._nodes.length;n<i;n++)if(!this._nodes[n].CanExecute(t))return!1;return!0}},{key:"Execute",value:function Execute(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._running||(this.context=s.Default(t,this._context),this._isEnabled&&(this._Start(),this._InternalExecute()))}},{key:"_InternalExecute",value:function _InternalExecute(){this._currentIndex=-1,this._ExecuteNextIndex()}},{key:"_ExecuteNextIndex",value:function _ExecuteNextIndex(){this._currentIndex+=1;var t=this._nodes.length;if(this._currentIndex>=t)this._Success();else{var e=this._nodes[this._currentIndex];this._cmdObserver.ObserveOnly(e),e.Execute(this._context)}}},{key:"_InternalCancel",value:function _InternalCancel(){}},{key:"_NodeStart",value:function _NodeStart(t){}},{key:"_NodeSuccess",value:function _NodeSuccess(t){this._ExecuteNextIndex()}},{key:"_NodeFail",value:function _NodeFail(t,e){this._Fail(e)}},{key:"_NodeEnd",value:function _NodeEnd(t){}},{key:"_Start",value:function _Start(){this._running||(this._running=!0,this._Broadcast(u.START,this),this._Broadcast(l.UPDATED,this))}},{key:"_Success",value:function _Success(){this._Broadcast(u.SUCCESS,this),this._End()}},{key:"_Fail",value:function _Fail(t){this._Broadcast(u.FAIL,this,t),this._End()}},{key:"Cancel",value:function Cancel(){this._running&&this._Cancel()}},{key:"_Cancel",value:function _Cancel(){this._InternalCancel(),this._Broadcast(u.CANCEL,this),this._End()}},{key:"_End",value:function _End(){this._running=!1,this._Broadcast(u.END,this),this._Broadcast(l.UPDATED,this)}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(CommandChain.prototype),"_CleanUp",this).call(this)}},{key:"toString",value:function toString(){return"[>>".concat(this.constructor.name,"]")}}]),CommandChain}(t("./command"));e.exports=d},{"./command":12,"./command-event":10,"@nkmjs/common":27,"@nkmjs/utils":271}],10:[function(t,e,n){var i=function COMMAND_SIGNAL(){_classCallCheck(this,COMMAND_SIGNAL)};_defineProperty(i,"SUCCESS",Symbol("success")),_defineProperty(i,"FAIL",Symbol("fail")),_defineProperty(i,"CANCEL",Symbol("cancel")),_defineProperty(i,"START",Symbol("start")),_defineProperty(i,"END",Symbol("end")),e.exports=i},{}],11:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.POOL,u=t("./command-event"),h,d=function(t){_inherits(CommandFn,t);var e=_createSuper(CommandFn);function CommandFn(){return _classCallCheck(this,CommandFn),e.call(this)}return _createClass(CommandFn,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CommandFn.prototype),"_Init",this).call(this),this._fn=null,this._thisArg=null,this._options=null}},{key:"thisArg",get:function get(){return this._thisArg},set:function set(t){this._thisArg=t}},{key:"fn",get:function get(){return this._fn},set:function set(t){this._fn=t}},{key:"options",get:function get(){return this._options},set:function set(t){if(this._options=t,this.fn=s.Get(t,"fn",null),!this._fn)throw new Error("CommandFn options have no function defined.");this.thisArg=s.Get(t,"thisArg",null),this.name=s.Get(t,"name",s.CamelSplit(this._fn.name)),this.icon=s.Get(t,"icon","%ICON%/icon_cmd.svg"),this.order=s.Get(t,"order",0)}},{key:"_InternalExecute",value:function _InternalExecute(){try{this._context?this._fn.call(this._thisArg,this._context):this._fn.call(this._thisArg),this._Success()}catch(t){this._Fail(t.message)}}}],[{key:"RentFn",value:function RentFn(t){var e;if(!s.Get(t,"fn",null))throw new Error("Cannot create CommandFn with empty function");var n=c.Rent(CommandFn);return n.options=t,n}}]),CommandFn}(t("./Command"));e.exports=d},{"./Command":6,"./command-event":10,"@nkmjs/common":27,"@nkmjs/utils":271}],12:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{"./command-event":10,"@nkmjs/common":27,"@nkmjs/utils":271,dup:6}],13:[function(t,e,n){var i,s=t("@nkmjs/utils").LOG,a,l=t("@nkmjs/collections").List,c,u,h=function(t){_inherits(RELAY,t);var e=_createSuper(RELAY);function RELAY(){return _classCallCheck(this,RELAY),e.call(this)}return _createClass(RELAY,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(RELAY.prototype),"_Init",this).call(this),this._requests=new l}},{key:"HandleRequest",value:function HandleRequest(t){this._requests.Add(t),this._Broadcast(t.requestType,t),this._tick.Schedule()}},{key:"_Tick",value:function _Tick(t){_get(_getPrototypeOf(RELAY.prototype),"_Tick",this).call(this,t);for(var e=this._requests,n=0;n<e.count;n++){var i=!0,s=e.At(n);s.handled||(s.life>=s.timeout?s.HandleFail("timeout"):(s.life+=t,i=!1)),i&&(s.Release(),e.RemoveAt(n),n--)}}},{key:"_ipcOn",value:function _ipcOn(t,e){}},{key:"_ipcSend",value:function _ipcSend(t){}},{key:"_ShowOpenDialog",value:function _ShowOpenDialog(t){return null}}],[{key:"HandleRequest",value:function HandleRequest(t){s._("⚡ ".concat(t),"color: #bebebe"),this.instance.HandleRequest(t)}},{key:"Broadcast",value:function Broadcast(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(e=this.instance)._Broadcast.apply(e,[t].concat(i))}},{key:"Watch",value:function Watch(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.instance.Watch(t,e,n)}},{key:"Unwatch",value:function Unwatch(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.instance.Unwatch(t,e,n)}},{key:"ipcOn",value:function ipcOn(t,e){this.instance._ipcOn(t,e)}},{key:"ipcSend",value:function ipcSend(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(e=this.instance)._ipcSend.apply(e,[t].concat(i))}},{key:"ShowOpenDialog",value:function ShowOpenDialog(t){return this.instance._ShowOpenDialog(t)}}]),RELAY}(t("@nkmjs/services").ServiceBase);e.exports=h},{"@nkmjs/collections":21,"@nkmjs/services":153,"@nkmjs/utils":271}],14:[function(t,e,n){var i=t("@nkmjs/common"),s=i.POOL,a=i.DisposableObject,l=t("./relay"),c=function(t){_inherits(Request,t);var e=_createSuper(Request);function Request(){return _classCallCheck(this,Request),e.call(this)}return _createClass(Request,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Request.prototype),"_Init",this).call(this),this._emitter=null,this._requestType=null,this._options=null,this._handled=!1,this._handler=null,this._onFail=null,this._onSuccess=null,this._timeout=0,this._life=0,this._failReason=""}},{key:"requestType",get:function get(){return this._requestType},set:function set(t){this._requestType=t}},{key:"emitter",get:function get(){return this._emitter},set:function set(t){this._emitter=t}},{key:"onSuccess",get:function get(){return this._onSuccess},set:function set(t){this._onSuccess=t}},{key:"onFail",get:function get(){return this._onFail},set:function set(t){this._onFail=t}},{key:"_Success",value:function _Success(){this._onSuccess&&this._onSuccess.call(this._emitter,this)}},{key:"_Fail",value:function _Fail(t){this._failReason=t||"undocumented",this._onFail&&this._onFail.call(this._emitter,this)}},{key:"timeout",get:function get(){return this._timeout},set:function set(t){this._timeout=t}},{key:"life",get:function get(){return this._life},set:function set(t){this._life=t}},{key:"options",get:function get(){return this._options},set:function set(t){this._options=t}},{key:"failReason",get:function get(){return this._failReason}},{key:"GetOption",value:function GetOption(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._options;return n&&n.hasOwnProperty(t)?n[t]:e}},{key:"handled",get:function get(){return this._handled}},{key:"HandleSuccess",value:function HandleSuccess(t){if(this._handled)throw new Error("A request may not be handled twice.");this._handled=!0,this._handler=t,this._Success()}},{key:"HandleFail",value:function HandleFail(t){this._Fail(t)}},{key:"_CleanUp",value:function _CleanUp(){this._emitter=null,this._requestType=null,this._options=null,this._handled=!1,this._handler=null,this._onFail=null,this._onSuccess=null,this._timeout=0,this._life=0,_get(_getPrototypeOf(Request.prototype),"_CleanUp",this).call(this)}},{key:"toString",value:function toString(){return"!".concat(this.constructor.name,":").concat(this._requestType,",").concat(this._emitter)}}],[{key:"Emit",value:function Emit(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Request,h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],d=s.Rent(u);return d.requestType=t,d.emitter=n,d.onFail=a,d.onSuccess=i,d.timeout=c,d.options=e,h&&l.HandleRequest(d),d}}]),Request}(a);e.exports=c},{"./relay":13,"@nkmjs/common":27}],15:[function(t,e,n){e.exports={APP_MESSAGES:t("./lib/app-messages"),AppBase:t("./lib/app-base"),AutoUpdateDialogBox:t("./lib/dialogs/dialog-box-auto-update")}},{"./lib/app-base":16,"./lib/app-messages":17,"./lib/dialogs/dialog-box-auto-update":18}],16:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=i.PATH,c=i.LOG,u=t("@nkmjs/common"),h=u.SIGNAL,d=u.TIME,p=u.SingletonEx,f=u.POOL,g=t("@nkmjs/environment"),m=g.ENV,y=g.ENV_SIGNAL,v=t("@nkmjs/actions"),k=v.ACTION_REQUEST,C=v.RELAY,O=v.CommandBox,E,S=t("@nkmjs/io-core").RESOURCES,I=t("@nkmjs/ui-core"),b=I.UI,D=I.LayerContainer,A,P=t("@nkmjs/dialog").DIALOG,R,T=t("@nkmjs/data-core").Metadata,x,w=t("@nkmjs/ui-workspace").DialogHandler,L,U=t("./dialogs").AutoUpdateDialogBox,N=t("./app-messages"),M=t("./helpers/user-preferences"),B,G=t("@nkmjs/style").STYLE,F=function(t){_inherits(AppBase,t);var e=_createSuper(AppBase);function AppBase(){return _classCallCheck(this,AppBase),e.call(this)}return _createClass(AppBase,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(AppBase.prototype),"_Init",this).call(this),this._APPID="".concat(this.constructor.name),this._darkPaletteBuilder=null,this._lightPaletteBuilder=null,this._userPreferences=f.Rent(M),this._defaultUserPreferences={},this._mainWrapperClass=D,this._mainWrapper=null,this._layers=null,this._dialogHandlerClass=w,this._dialogHandler=null,this._commands=new O,this._ipcBindings=[{evt:N.NODE_MESSAGE,fn:this._Bind(this._onNodeMessage)},{evt:N.NODE_ERROR,fn:this._Bind(this._onNodeError)},{evt:N.NODE_WARNING,fn:this._Bind(this._onNodeWarning)}],m.FEATURES.Watch(y.COLORSCHEME_CHANGED,this._OnColorschemeChange,this)}},{key:"_PostInit",value:function _PostInit(){if(_get(_getPrototypeOf(AppBase.prototype),"_PostInit",this).call(this),m.instance.RegisterServices(C,S,P),!this._mainWrapperClass)throw new Error("No app wrapper constructor defined.");if(!s.isInstanceOf(this._mainWrapperClass,D))throw new Error("App wrapper constructor (".concat(this._mainWrapperClass.name,") must implement LayerContainer."))}},{key:"mainWrapper",get:function get(){return this._mainWrapper}},{key:"userPreferences",get:function get(){return this._userPreferences}},{key:"SetUp",value:function SetUp(){if(c._("".concat(this._APPID," : SETUP"),"#339a6e","#212121"),m.FEATURES.isNodeEnabled&&this._RegisterIPCBindings(),this._mainWrapper=b.Rent(this._mainWrapperClass),this._mainWrapper.setAttribute("id","app"),a.AttachFirst(a.New("link",{href:G.instance.current.GetCSSLink("@/main.css"),rel:"stylesheet"}),this._mainWrapper._host),this._layers)for(var t=0,e=this._layers.length;t<e;t++){var n=this._layers[t],i=this._mainWrapper.Add(n.cl);n.id&&(this[n.id]=i)}this._dialogHandler=this._mainWrapper.Add(this._dialogHandlerClass),C.Watch(k.DIALOG,this._HandleDialogRequest,this)}},{key:"_RegisterIPCBindings",value:function _RegisterIPCBindings(){for(var t,e=0,n=this._ipcBindings.length;e<n;e++)t=this._ipcBindings[e],C.ipcOn(t.evt,t.fn)}},{key:"Start",value:function Start(){c._("".concat(this._APPID," : START"),"#339a6e","#212121"),a.New("link",{href:G.instance.current.GetCSSLink("@/main.css"),rel:"stylesheet"},document.head),a.Attach(this._mainWrapper,document.body),this._userPreferences.Load("".concat(this._APPID,"Preferences"),this._defaultUserPreferences,this._Bind(this._InitUserPreferences),this._Bind(this._OnAppReadyInternal))}},{key:"_InitUserPreferences",value:function _InitUserPreferences(t){}},{key:"_OnAppReadyInternal",value:function _OnAppReadyInternal(t){C.instance.Watch(k.EDIT,this._OnEditRequest,this),m.FEATURES.isNodeEnabled,this.AppReady(),c._("".concat(this._APPID," : READY"),"#030107","#339a6e")}},{key:"AppReady",value:function AppReady(t){}},{key:"_HandleDialogRequest",value:function _HandleDialogRequest(t){this._dialogHandler.HandleDialogRequest(t)}},{key:"_OnEditRequest",value:function _OnEditRequest(t){}},{key:"_OnColorschemeChange",value:function _OnColorschemeChange(){}},{key:"ReloadApp",value:function ReloadApp(){C.ipcSend(N.DO_RELOAD_APP)}},{key:"OpenWindow",value:function OpenWindow(t){C.ipcSend(N.DO_OPEN_WINDOW,t)}},{key:"CloseWindow",value:function CloseWindow(t){C.ipcSend(N.DO_CLOSE_WINDOW,t)}},{key:"Print",value:function Print(t){C.ipcSend(N.DO_PRINT_WINDOW,t)}},{key:"LoadAndPrint",value:function LoadAndPrint(t){C.ipcSend(N.DO_OPEN_AND_PRINT_WINDOW,t)}},{key:"_onNodeError",value:function _onNodeError(t,e){var n;console.error(e.error),P.Push((_defineProperty(n={},COM_ID.TITLE,e.message),_defineProperty(n,COM_ID.ICON,"% ICON % /icon_error.svg"),_defineProperty(n,COM_ID.MESSAGE,"".concat(e.error.message)),_defineProperty(n,"actions",[{text:"Close"}]),n))}},{key:"_onNodeWarning",value:function _onNodeWarning(t,e){var n;console.warning(e.message),P.Push((_defineProperty(n={},COM_ID.TITLE,"Attention !"),_defineProperty(n,COM_ID.ICON,"%ICON%/icon_warning.svg"),_defineProperty(n,COM_ID.MESSAGE,"".concat(e.message)),_defineProperty(n,"actions",[{text:"Close"}]),n))}},{key:"_onNodeMessage",value:function _onNodeMessage(t,e){console.log(e.message)}}]),AppBase}(p);e.exports=F},{"./app-messages":17,"./dialogs":19,"./helpers/user-preferences":20,"@nkmjs/actions":1,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/dialog":84,"@nkmjs/environment":95,"@nkmjs/io-core":101,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/ui-workspace":237,"@nkmjs/utils":271}],17:[function(t,e,n){var i=function APP_MESSAGES(){_classCallCheck(this,APP_MESSAGES)};_defineProperty(i,"ERROR","node-error"),_defineProperty(i,"WARNING","node-warning"),_defineProperty(i,"MESSAGE","node-message"),_defineProperty(i,"AU_CHECK_REQUEST","au-check-request"),_defineProperty(i,"AU_CHECK_REQUEST_HANDLED","au-check-request-handled"),_defineProperty(i,"AU_NO_SERVER","au-no-server"),_defineProperty(i,"AU_ATTEMPT_CHECK","au-attempt-check"),_defineProperty(i,"AU_CHECKING_FOR_UPDATE","au-checking-for-update"),_defineProperty(i,"AU_UPDATE_AVAILABLE","au-udpate-available"),_defineProperty(i,"AU_UPDATE_NOT_AVAILABLE","au-update-not-available"),_defineProperty(i,"AU_UPDATE_DOWNLOADED","au-update-downloaded"),_defineProperty(i,"NODE_MESSAGE","node-message"),_defineProperty(i,"NODE_ERROR","node-error"),_defineProperty(i,"NODE_WARNING","node-warning"),_defineProperty(i,"DO_RELOAD_APP","do-reload-app"),_defineProperty(i,"DO_OPEN_WINDOW","request-window-open"),_defineProperty(i,"DO_RELOAD_WINDOW","request-window-reload"),_defineProperty(i,"DO_CLOSE_WINDOW","request-window-close"),_defineProperty(i,"DO_PRINT_WINDOW","request-window-print"),_defineProperty(i,"DO_OPEN_AND_PRINT_WINDOW","request-window-and-print"),e.exports=i},{}],18:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/environment").ENV,c,u=t("@nkmjs/style").CSS,h,d=t("@nkmjs/ui-core").UI,p,f=t("@nkmjs/ui-workspace").DialogBox,g=t("../app-messages.js"),m=function(t){_inherits(AutoUpdateDialogBox,t);var e=_createSuper(AutoUpdateDialogBox);function AutoUpdateDialogBox(){return _classCallCheck(this,AutoUpdateDialogBox),e.call(this)}return _createClass(AutoUpdateDialogBox,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(AutoUpdateDialogBox.prototype),"_Init",this).call(this)}},{key:"_OnDataChanged",value:function _OnDataChanged(t){_get(_getPrototypeOf(AutoUpdateDialogBox.prototype),"_OnDataChanged",this).call(this,t);var e=this._data;RELAY.ipcOn(g.AU_ERROR,this._Bind(this._OnAUError)),RELAY.ipcOn(g.AU_CHECKING_FOR_UPDATE,this._Bind(this._OnAUCheckingForUpdate)),RELAY.ipcOn(g.AU_UPDATE_AVAILABLE,this._Bind(this._OnAUUpdateAvailable)),RELAY.ipcOn(g.AU_UPDATE_NOT_AVAILABLE,this._Bind(this._OnAUUpdateNotAvailable)),RELAY.ipcOn(g.AU_UPDATE_DOWNLOADED,this._Bind(this._OnAUUpdateDownloaded)),RELAY.ipcOn(g.AU_CHECK_REQUEST_HANDLED,this._Bind(this._OnAURequestHandled)),RELAY.ipcSend(g.AU_CHECK_REQUEST)}},{key:"_OnAURequestHandled",value:function _OnAURequestHandled(t,e,n){e!==g.AU_NO_SERVER||this._Close()}},{key:"_OnAUError",value:function _OnAUError(t,e){this._title.text="Oops !",this._bodyContent.text="Encountered a bumper while auto-updating : ".concat(e),this._ClearHandles(),this.CreateHandle({text:"Well then.",trigger:{fn:this._Close}})}},{key:"_OnAUCheckingForUpdate",value:function _OnAUCheckingForUpdate(t,e){this._title.text="Checking for update",this._bodyContent.text="Stand still."}},{key:"_OnAUUpdateAvailable",value:function _OnAUUpdateAvailable(t,e){this._title.text="Great !",this._bodyContent.text="An update was found, it is already downloading in the background.\nYou can either wait for the download to finish or carry on.",this.CreateHandle({text:"Install now !",trigger:{fn:this._Close}}),this.CreateHandle({text:"Continue working.",trigger:{fn:this._Close}})}},{key:"_OnAUUpdateNotAvailable",value:function _OnAUUpdateNotAvailable(t,e){this._title.text="You're all set !",this._bodyContent.text="No need for update.",this._ClearHandles(),this.CreateHandle({text:"Well then.",trigger:{fn:this._Close}})}},{key:"_OnAUUpdateDownloaded",value:function _OnAUUpdateDownloaded(t,e){this._title.text="Ray-day",this._bodyContent.text="Update has been downloaded and is ready to be installed.",this._ClearHandles(),this.CreateHandle({text:"Install now !",trigger:{fn:this._Close}}),this.CreateHandle({text:"Later.",trigger:{fn:this._Close}})}},{key:"_Clear",value:function _Clear(){_get(_getPrototypeOf(AutoUpdateDialogBox.prototype),"_Clear",this).call(this)}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(AutoUpdateDialogBox.prototype),"_CleanUp",this).call(this)}}]),AutoUpdateDialogBox}(f);e.exports=m,d.Register("nkmjs-auto-update-dialog-box",m)},{"../app-messages.js":17,"@nkmjs/environment":95,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/ui-workspace":237,"@nkmjs/utils":271}],19:[function(t,e,n){e.exports={AutoUpdateDialogBox:t("./dialog-box-auto-update")}},{"./dialog-box-auto-update":18}],20:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=t("@nkmjs/common"),c=l.DisposableObjectEx,u=l.SIGNAL,h=l.DelayedCall,d=t("@nkmjs/data-core"),p=d.Metadata,f=d.DATA_SIGNAL,g,m=t("@nkmjs/documents").DOCUMENTS,y=function(t){_inherits(UserPreferences,t);var e=_createSuper(UserPreferences);function UserPreferences(){return _classCallCheck(this,UserPreferences),e.call(this)}return _createClass(UserPreferences,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(UserPreferences.prototype),"_Init",this).call(this),this._document=null,this._waitForThen=!1,this._initFn=null,this._thenFn=null,this._Bind(this._OnDocumentLoadSuccess),this._Bind(this._OnDocumentLoadError),this._Bind(this._OnDocumentSaveSuccess),this._Bind(this._OnDocumentSaveError),this._delayedSave=new h(this._Bind(this.Save))}},{key:"Load",value:function Load(t,e,n,i){this._initFn=n,this._thenFn=i,this._defaults=e,this._waitForThen=!0,this._document=m.Get({path:"".concat(a.USER_DATA,"/").concat(t,".json"),data:p}),this._document.Watch(f.DIRTY,this._OnDocumentDirty,this),this._document.Load({success:this._OnDocumentLoadSuccess,error:this._OnDocumentLoadError})}},{key:"_OnDocumentLoadSuccess",value:function _OnDocumentLoadSuccess(){this.Init(),this._Then()}},{key:"_OnDocumentLoadError",value:function _OnDocumentLoadError(){this.Init()}},{key:"Init",value:function Init(){this._defaults&&s.SetMissing(this._document.currentData._data,this._defaults),this._initFn(this._document.currentData),this._document.Dirty()}},{key:"Save",value:function Save(){this._document.Save({success:this._OnDocumentSaveSuccess,error:this._OnDocumentSaveError})}},{key:"_OnDocumentSaveSuccess",value:function _OnDocumentSaveSuccess(){this._Then()}},{key:"_OnDocumentSaveError",value:function _OnDocumentSaveError(t){throw t}},{key:"_Then",value:function _Then(){this._waitForThen&&this._thenFn(this._document.currentData),this._waitForThen=!1}},{key:"_OnDocumentDirty",value:function _OnDocumentDirty(){this._delayedSave.Schedule()}}]),UserPreferences}(c);e.exports=y},{"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/documents":89,"@nkmjs/utils":271}],21:[function(t,e,n){e.exports={List:t("./lib/list"),Dictionary:t("./lib/dictionary"),KDictionary:t("./lib/k-dictionary"),DictionaryList:t("./lib/dictionary-list")}},{"./lib/dictionary":23,"./lib/dictionary-list":22,"./lib/k-dictionary":25,"./lib/list":26}],22:[function(t,e,n){var i=function(){function DictionaryList(){_classCallCheck(this,DictionaryList),this._map=new Map}return _createClass(DictionaryList,[{key:"internalMap",get:function get(){return this._map}},{key:"count",get:function get(){return this._map.size}},{key:"isEmpty",get:function get(){return this._map.size<=0}},{key:"keys",get:function get(){return Array.from(this._map.keys())}},{key:"Contains",value:function Contains(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return!!this._map.has(t)&&(void 0===e||this._map.get(t).includes(e))}},{key:"Count",value:function Count(t){return this._map.has(t)?this._map.get(t).length:0}},{key:"Set",value:function Set(t,e){var n=null;this._map.has(t)?n=this._map.get(t):(n=new Array(0),this._map.set(t,n)),n.includes(e)||n.push(e)}},{key:"Get",value:function Get(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(this._map.has(t)){var n=this._map.get(t);if(-1===e)return n;if(n.length<e)return n[e];throw new Error("index is out of bounds")}}},{key:"Remove",value:function Remove(t,e){if(!e||!t)return!1;var n=this._map.get(t);if(!n)return!1;var i=n.indexOf(e);return-1!=i&&(n.splice(i,1),0===n.length&&this._map.delete(t),!0)}},{key:"RemoveMultiple",value:function RemoveMultiple(t){throw new Error("RemoveMultiple not implemented")}},{key:"Pop",value:function Pop(t){if(this._map.has(t)){var e=this._map.get(t),n=e.pop();return 0===e.length&&this._map.delete(t),n}}},{key:"Clear",value:function Clear(){this._map.forEach(this._Clear,this),this._map.clear()}},{key:"_Clear",value:function _Clear(t,e,n){t.length=0}}]),DictionaryList}();e.exports=i},{}],23:[function(t,e,n){var i=t("./helpers/isVoid"),s=function(){function Dictionary(){_classCallCheck(this,Dictionary),this._map=new Map}return _createClass(Dictionary,[{key:"internalMap",get:function get(){return this._map}},{key:"count",get:function get(){return this._map.size}},{key:"isEmpty",get:function get(){return this._map.size<=0}},{key:"keys",get:function get(){return Array.from(this._map.keys())}},{key:"Contains",value:function Contains(t){return this._map.has(t)}},{key:"Set",value:function Set(t,e){this._map.set(t,e)}},{key:"Get",value:function Get(t){return this._map.get(t)}},{key:"GetValueKeys",value:function GetValueKeys(t){if(i(t))return null;for(var e=null,n=this.keys,s=0,a=n.length;s<a;s++){var l=n[s];this._map.get(l)===t&&(null===e&&(e=new Array(1)),e.push(l))}return e}},{key:"Remove",value:function Remove(t){return this._map.delete(t)}},{key:"ForEach",value:function ForEach(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.from(this._map.keys());if(n)for(var s=i.length-1;s>=0;s--){var a=i[s];t.call(e,a,this._map.get(a))}else for(var l=0,c=i.length;l<c;l++){var u=i[l];t.call(e,u,this._map.get(u))}}},{key:"Clear",value:function Clear(){this._map.clear()}}]),Dictionary}();e.exports=s},{"./helpers/isVoid":24}],24:[function(t,e,n){e.exports=function isVoid(t){return null==t}},{}],25:[function(t,e,n){var i=function(){function KDictionary(){_classCallCheck(this,KDictionary),this._rootMap=new Map}return _createClass(KDictionary,[{key:"rootMap",get:function get(){return this._rootMap}},{key:"Contains",value:function Contains(){for(var t=this._rootMap,e=0,n=arguments.length;e<n;e++)if(!(t=t.get(e<0||arguments.length<=e?void 0:arguments[e])))return!1;return!0}},{key:"Set",value:function Set(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=e.pop(),s=e.pop(),a=this._rootMap,l=a,c=0,u=e.length;c<u;c++){var h=e[c];(a=a.get(h))||(a=new Map,l.set(h,a)),l=a}l.set(s,i)}},{key:"Get",value:function Get(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=e.pop(),s=this._rootMap,a=0,l=e.length;a<l;a++)if(!(s=s.get(e[a])))return null;return s.get(i)}},{key:"Remove",value:function Remove(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=e.pop(),s=this._rootMap,a=0,l=e.length;a<l;a++)if(!(s=s.get(e[a])))return null;var c=s.get(i);"undefined"!=typeof p_value&&null!==p_value&&(("function"==typeof c?c.prototype:c)instanceof Map&&c.clear(),s.remove(i))}},{key:"Clear",value:function Clear(){this._rootMap.clear()}}]),KDictionary}();e.exports=i},{}],26:[function(t,e,n){var i=t("./helpers/isVoid"),s=function(){function List(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;_classCallCheck(this,List),this._array=new Array(t)}return _createClass(List,[{key:"internalArray",get:function get(){return this._array}},{key:"isEmpty",get:function get(){return 0===this._array.length}},{key:"count",get:function get(){return this._array.length}},{key:"first",get:function get(){return this._array[0]}},{key:"last",get:function get(){return this._array[this._array.length-1]}},{key:"Contains",value:function Contains(t){return this._array.includes(t)}},{key:"IndexOf",value:function IndexOf(t){return this._array.indexOf(t)}},{key:"Add",value:function Add(t){return!i(t)&&(!this._array.includes(t)&&(this._array.push(t),!0))}},{key:"Remove",value:function Remove(t){return!i(t)&&this.RemoveAt(this._array.indexOf(t))}},{key:"RemoveAt",value:function RemoveAt(t){return!(t<0||t>=this._array.length)&&this._array.splice(t,1)}},{key:"Insert",value:function Insert(t,e){return!i(t)&&(-1==this._array.indexOf(t)?e>=this._array.length?(this._array.push(t),t):(this._array.splice(e,0,t),t):void 0);var n}},{key:"At",value:function At(t){return this._array[t]}},{key:"Pop",value:function Pop(){return this._array.pop()}},{key:"Shift",value:function Shift(){return this._array.shift()}},{key:"ForEach",value:function ForEach(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._array.length;if(n)for(var s=i-1;s>=0;s--)t.call(e,this._array[s],s);else for(var a=0;a<i;a++)t.call(e,this._array[a],a)}},{key:"Clear",value:function Clear(){this._array.length=0}}]),List}();e.exports=s},{"./helpers/isVoid":24}],27:[function(t,e,n){e.exports={SIGNAL:t("./lib/signal"),COMMON_FLAG:t("./lib/common-flag"),COM_ID:t("./lib/common-id"),NFOS:t("./lib/nfos"),Singleton:t("./lib/helpers/singleton"),SingletonEx:t("./lib/helpers/singleton-ex"),StateBase:t("./lib/helpers/state-base"),StateMachine:t("./lib/helpers/state-machine"),TIME:t("./lib/time/time"),BINDINGS:t("./lib/bindings"),BindingKit:t("./lib/helpers/binding-kit"),POOL:t("./lib/pool/pool"),DisposableObject:t("./lib/pool/disposable-object"),DisposableObjectEx:t("./lib/pool/disposable-object-ex"),SignalBroadcaster:t("./lib/signals/signal-broadcaster"),SignalBox:t("./lib/signals/signal-box"),Observer:t("./lib/signals/observer"),DelayedCall:t("./lib/time/delayed-call"),Callbacks:t("./lib/helpers/callbacks"),CallList:t("./lib/helpers/call-list"),OptionsHandler:t("./lib/helpers/options-handler"),CSYMBOL:t("./lib/helpers/class-symbol"),OptionObject:t("./lib/helpers/options-object")}},{"./lib/bindings":28,"./lib/common-flag":29,"./lib/common-id":30,"./lib/helpers/binding-kit":31,"./lib/helpers/call-list":32,"./lib/helpers/callbacks":33,"./lib/helpers/class-symbol":34,"./lib/helpers/options-handler":35,"./lib/helpers/options-object":36,"./lib/helpers/singleton":38,"./lib/helpers/singleton-ex":37,"./lib/helpers/state-base":39,"./lib/helpers/state-machine":40,"./lib/nfos":41,"./lib/pool/disposable-object":43,"./lib/pool/disposable-object-ex":42,"./lib/pool/pool":44,"./lib/signal":45,"./lib/signals/observer":46,"./lib/signals/signal-box":47,"./lib/signals/signal-broadcaster":48,"./lib/time/delayed-call":49,"./lib/time/time":50}],28:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/collections"),l=a.DictionaryList,c=a.KDictionary,u=a.Dictionary,h=t("./helpers/singleton-ex"),d=t("./nfos"),p=function(t){_inherits(BINDINGS,t);var e=_createSuper(BINDINGS);function BINDINGS(){return _classCallCheck(this,BINDINGS),e.call(this)}return _createClass(BINDINGS,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(BINDINGS.prototype),"_Init",this).call(this),this._classLookup=new u,this._classReverseLookup=new u,this._squashedAssocs=new c,this._contextMap=new c,this._contextKeyLists=new l,this._distanceMap=new c}},{key:"_SetClass",value:function _SetClass(t,e){this._classLookup.Set(t,e),this._classReverseLookup.Set(e,t)}},{key:"_GetClass",value:function _GetClass(t){return this._classLookup.Get(t)}},{key:"_GetClassKey",value:function _GetClassKey(t){var e=this._classReverseLookup.Get(t);if(!e){if(!(e=s.Get(d.Get(t),"uid",null)))throw new Error("No valid NFO found for ".concat(t));this._SetClass(e,t)}return e}},{key:"_RemoveClass",value:function _RemoveClass(t){this._classLookup.Remove(t)}},{key:"_Set",value:function _Set(t,e,n){this._contextMap.Set(t,e,n),this._contextKeyLists.Set(t,e)}},{key:"_Get",value:function _Get(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this._contextMap.Get(t,e);if(!a&&n){var l=this._contextKeyLists.Get(t);if(!l)return null;for(var c=-1,u=Number.MAX_SAFE_INTEGER,h=0,d=l.length;h<d;h++){var p=l[h];if(c=this._distanceMap.Get(e,p),s.isVoid(c)&&(c=s.InheritanceDistance(e,p),this._distanceMap.Set(e,p,c)),-1!==c&&c<u){var f=this._contextMap.Get(t,p);f&&(u=c,a=f)}}}return a}},{key:"_Remove",value:function _Remove(t,e,n){this._contextMap.Remove(t,e,n),this._contextKeyLists.Remove(t,e)}}],[{key:"Expand",value:function Expand(t){s.isFunc(t)&&(t=new t),t.Deploy()}},{key:"SetClass",value:function SetClass(t,e){this.instance._SetClass(t,e)}},{key:"GetClass",value:function GetClass(t){return this.instance._GetClass(t)}},{key:"GetClassKey",value:function GetClassKey(t){return this.instance._GetClassKey(t)}},{key:"RemoveClass",value:function RemoveClass(t){this.instance._RemoveClass(t)}},{key:"Set",value:function Set(t,e,n){this.instance._Set(t,e,n)}},{key:"Get",value:function Get(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e=s.isFunc(e)?e:e.constructor,!s.isFunc(e))throw new Error("p_key must be a constructor or have an accessible constructor.");var a=this.instance._Get(t,e,i);return a||n}},{key:"Remove",value:function Remove(t,e,n){this.instance._Remove(t,e,n)}}]),BINDINGS}(h);e.exports=p},{"./helpers/singleton-ex":37,"./nfos":41,"@nkmjs/collections":21,"@nkmjs/utils":271}],29:[function(t,e,n){var i=function COMMON_FLAG(){_classCallCheck(this,COMMON_FLAG)};_defineProperty(i,"INFOS","infos"),_defineProperty(i,"WARNING","warning"),_defineProperty(i,"ERROR","error"),_defineProperty(i,"READY","ready"),_defineProperty(i,"DIRTY","dirty"),_defineProperty(i,"LOADING","loading"),_defineProperty(i,"PROCESSING","processing"),_defineProperty(i,"WAITING","waiting"),_defineProperty(i,"ACTIVE","active"),e.exports=i},{}],30:[function(t,e,n){var i=function COM_ID(){_classCallCheck(this,COM_ID)};_defineProperty(i,"METAPREFIX","META@"),_defineProperty(i,"UID","uid"),_defineProperty(i,"NAME","name"),_defineProperty(i,"TITLE","title"),_defineProperty(i,"MESSAGE","message"),_defineProperty(i,"ICON","icon"),_defineProperty(i,"PATH","path"),_defineProperty(i,"DATA","data"),_defineProperty(i,"CMD_PRIMARY","primaryCommand"),_defineProperty(i,"CMD_SECONDARY","secondaryCommand"),_defineProperty(i,"CMD_LIST","commandList"),_defineProperty(i,"OWNER","owner"),e.exports=i},{}],31:[function(t,e,n){var i,s=t("@nkmjs/collections").Dictionary,a=t("@nkmjs/utils"),l=a.U,c=a.LOG,u=t("../nfos"),h=t("../pool/disposable-object-ex"),d=t("../bindings"),p=function(t){_inherits(BindingKit,t);var e=_createSuper(BindingKit);function BindingKit(){return _classCallCheck(this,BindingKit),e.call(this)}return _createClass(BindingKit,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(BindingKit.prototype),"_Init",this).call(this),this._deployed=!1,this._KVPS=new Array(0),this._CLASSES=new Array(0),this._classDict=new s}},{key:"Add",value:function Add(){if(this._deployed)throw new Error("Cannot add binding to kit while it is deployed.");for(var t=0,e=arguments.length;t<e;t++)this._KVPS.push(t<0||arguments.length<=t?void 0:arguments[t])}},{key:"AddClasses",value:function AddClasses(){if(this._deployed)throw new Error("Cannot add binding to kit while it is deployed.");for(var t=0,e=arguments.length;t<e;t++)this._CLASSES.push(t<0||arguments.length<=t?void 0:arguments[t])}},{key:"Deploy",value:function Deploy(){if(!this._deployed){for(var t=d.instance,e=0,n=this._KVPS.length;e<n;e++)for(var i=this._KVPS[e],s=i.context,a=i.kvps,h=0,p=a.length;h<p;h++){var f=a[h];t._Set(s,f.key,f.binding);var g=l.isFunc(s)?s.name:s,m=l.isFunc(f.key)?f.key.name:f.key,y=l.isFunc(f.binding)?f.binding.name:f.binding;c._("┅ ".concat(g," ⟼ ").concat(m," ⤞ ").concat(y),"#7f7f7f")}for(var v=0,k=this._CLASSES.length;v<k;v++){var C=this._CLASSES[v],O=l.Get(u.Get(C),"uid",null);if(!O)throw new Error("No valid NFO found for ".concat(this._CLASSES[v]));this._classDict.Set(C,O),t._SetClass(O,C),c._("⧉ ".concat(O," ⤞ ").concat(C.name),"#7f7f7f")}this._deployed=!0}}},{key:"Conceal",value:function Conceal(){if(this._deployed){for(var t=d.instance,e=0,n=this._KVPS.length;e<n;e++)for(var i=this._KVPS[e],s=i.context,a=i.kvps,l=0,c=a.length;l<c;l++){var u=a[l];t._Remove(s,u.key,u.binding)}for(var h=this._classDict.keys,p=0,f=h.length;p<f;p++)t._RemoveClass(this._classDict.Get(h[p]));this._deployed=!1}}},{key:"_CleanUp",value:function _CleanUp(){this.Conceal(),_get(_getPrototypeOf(BindingKit.prototype),"_CleanUp",this).call(this)}}]),BindingKit}(h);e.exports=p},{"../bindings":28,"../nfos":41,"../pool/disposable-object-ex":42,"@nkmjs/collections":21,"@nkmjs/utils":271}],32:[function(t,e,n){var i,s=t("@nkmjs/collections").List,a,l=t("@nkmjs/utils").U,c=function(){function CallList(){_classCallCheck(this,CallList),this._list=new s(0)}return _createClass(CallList,[{key:"count",get:function get(){return this._list.count}},{key:"Add",value:function Add(t){if(!l.isFunc(t))throw new Error("p_fn is not a Function.");this._list.Add(t)}},{key:"Remove",value:function Remove(t){this._list.Remove(t)}},{key:"Notify",value:function Notify(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,s=this._list.count;i<s;i++)this._list.At(i).apply(null,e)}},{key:"NotifyFlush",value:function NotifyFlush(){this.Notify.apply(this,arguments),this.Clear()}},{key:"Clear",value:function Clear(){this._list.Clear()}}]),CallList}();e.exports=c},{"@nkmjs/collections":21,"@nkmjs/utils":271}],33:[function(t,e,n){var i,s=t("@nkmjs/collections").List,a=function(){function Callbacks(){_classCallCheck(this,Callbacks),this._dispatching=!1,this._onSuccessList=new s(0),this._onErrorList=new s(0),this._onAnyList=new s(0)}return _createClass(Callbacks,[{key:"onSuccess",set:function set(t){this._dispatching||this._onSuccessList.Add(t)}},{key:"onError",set:function set(t){this._dispatching||this._onErrorList.Add(t)}},{key:"onAny",set:function set(t){this._dispatching||this._onAnyList.Add(t)}},{key:"Add",value:function Add(t){t&&!this._dispatching&&(t.success&&this._onSuccessList.Add(t.success),t.error&&this._onErrorList.Add(t.error),t.any&&this._onAnyList.Add(t.any))}},{key:"then",value:function then(t){return this.onSuccess=t,this}},{key:"catch",value:function _catch(t){return this.onError=t,this}},{key:"finally",value:function _finally(t){return this.onAny=t,this}},{key:"OnSuccess",value:function OnSuccess(){if(!this._dispatching){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._Dispatch.apply(this,[this._onSuccessList].concat(e)),this._Dispatch.apply(this,[this._onAnyList].concat(e))}}},{key:"OnError",value:function OnError(){if(!this._dispatching){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._Dispatch.apply(this,[this._onErrorList].concat(e)),this._Dispatch.apply(this,[this._onAnyList].concat(e))}}},{key:"OnSuccessFlush",value:function OnSuccessFlush(){this._dispatching||(this.OnSuccess.apply(this,arguments),this.Clear())}},{key:"OnErrorFlush",value:function OnErrorFlush(){this._dispatching||(this.OnError.apply(this,arguments),this.Clear())}},{key:"_Dispatch",value:function _Dispatch(t){if(!this._dispatching){this._dispatching=!0;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var s=0,a=t.count;s<a;s++)t.At(s).apply(null,n);this._dispatching=!1}}},{key:"Clear",value:function Clear(){this._dispatching||(this._onSuccessList.Clear(),this._onErrorList.Clear(),this._onAnyList.Clear())}}]),Callbacks}();e.exports=a},{"@nkmjs/collections":21}],34:[function(t,e,n){var i=function CSYMBOL(){_classCallCheck(this,CSYMBOL)};e.exports=i},{}],35:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").DictionaryList,c=Symbol("direct"),u=function(){function OptionsHandler(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,OptionsHandler),this._hooks=new l,this._defaults=n,this._beginFn=e,this._wrapUpFn=t}return _createClass(OptionsHandler,[{key:"defaults",get:function get(){return this._defaults},set:function set(t){this._defaults=t}},{key:"beginFn",get:function get(){return this._beginFn},set:function set(t){this._beginFn=t}},{key:"wrapUpFn",get:function get(){return this._wrapUpFn},set:function set(t){this._wrapUpFn=t}},{key:"Hook",value:function Hook(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;null===e&&(e=c),this._hooks.Set(t,e),null!=n&&(this._defaults||(this._defaults={}),this._defaults[t]=n)}},{key:"UnHook",value:function UnHook(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===e&&(e=c),this._hooks.Remove(t,e)}},{key:"Process",value:function Process(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._beginFn&&this._beginFn(e,n),this._defaults)for(var i in this._defaults)i in e||(e[i]=this._defaults[i]);for(var a in n||(n=e),e){var l=this._hooks.Get(a),u=e[a];if(l)for(var h=0,d=l.length;h<d;h++){var p=l[h];p!==c?s.isString(p)?t[p]=u:p(u,n):t[a]=u}}this._wrapUpFn&&this._wrapUpFn.call(null,n)}},{key:"ProcessSingle",value:function ProcessSingle(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=this._hooks.Get(e);if(l!==c){if(l){for(var u=0,h=l.count;u<h;u++){var d=l.At(u);s.isString(d)?t[d]=n:d(n,i)}a&&this._wrapUpFn&&this._wrapUpFn.call(null,i)}}else t[e]=n}},{key:"WrapUp",value:function WrapUp(t){this._wrapUpFn&&this._wrapUpFn.call(null,t)}},{key:"Clear",value:function Clear(){this._hooks.Clear(),this._defaults=null}}]),OptionsHandler}();e.exports=u},{"@nkmjs/collections":21,"@nkmjs/utils":271}],36:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("../pool/disposable-object-ex"),l=t("./options-handler"),c=function(t){_inherits(OptionObject,t);var e=_createSuper(OptionObject);function OptionObject(){return _classCallCheck(this,OptionObject),e.call(this)}return _createClass(OptionObject,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(OptionObject.prototype),"_Init",this).call(this),this._options={},this._optionHandler=new l}},{key:"optionHandler",get:function get(){return this._optionHandler}},{key:"options",get:function get(){return this._options},set:function set(t){this._options=t,this._optionHandler.Process(this,t)}},{key:"AppendOptions",value:function AppendOptions(t){for(var e in this._options||(this._options={}),t){var n=t[e];this._options[e]=n}this._optionHandler.Process(this,t,this._options)}},{key:"GetOption",value:function GetOption(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._options.hasOwnProperty(t)?this._options[t]:e}},{key:"GetOrSetOption",value:function GetOrSetOption(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._options.hasOwnProperty(t)?this._options[t]:(this.SetOption(t,e),e)}},{key:"SetOption",value:function SetOption(t,e){this._options||(this._options={}),t in this._options&&this._options[t]===e||(this._optionHandler.ProcessSingle(this,t,e,this._options,!0),this._options[t]=e)}},{key:"_CleanUp",value:function _CleanUp(){this._options={},_get(_getPrototypeOf(OptionObject.prototype),"_CleanUp",this).call(this)}}]),OptionObject}(a);e.exports=c},{"../pool/disposable-object-ex":42,"./options-handler":35,"@nkmjs/utils":271}],37:[function(t,e,n){var i=t("./singleton"),s=t("../signals/signal-box"),a=function(t){_inherits(SingletonEx,t);var e=_createSuper(SingletonEx);function SingletonEx(){return _classCallCheck(this,SingletonEx),e.call(this)}return _createClass(SingletonEx,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(SingletonEx.prototype),"_Init",this).call(this),this._signals=new s}},{key:"_Broadcast",value:function _Broadcast(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(e=this._signals).Broadcast.apply(e,[t].concat(i))}},{key:"Watch",value:function Watch(t,e,n){this._signals.Add(t,e,n)}},{key:"WatchOnce",value:function WatchOnce(t,e,n){this._signals.AddOnce(t,e,n)}},{key:"Unwatch",value:function Unwatch(t,e,n){this._signals.Remove(t,e,n)}}],[{key:"Watch",value:function Watch(t,e,n){this.instance._signals.Add(t,e,n)}},{key:"WatchOnce",value:function WatchOnce(t,e,n){this.instance._signals.AddOnce(t,e,n)}},{key:"Unwatch",value:function Unwatch(t,e,n){this.instance._signals.Remove(t,e,n)}}]),SingletonEx}(i);e.exports=a},{"../signals/signal-box":47,"./singleton":38}],38:[function(t,e,n){var i=function(){function Singleton(){if(_classCallCheck(this,Singleton),this.constructor.__instance)throw new Error("Cannot create multiple instance of a singleton.");this.constructor.__instance=this;try{var t=window;this._isBrowser=!0}catch(t){this._isBrowser=!1}this._Init(),this._PostInit()}return _createClass(Singleton,[{key:"isBrowser",get:function get(){return this._isBrowser}},{key:"_Bind",value:function _Bind(t){return this[t.name]=t.bind(this)}},{key:"_Init",value:function _Init(){}},{key:"_PostInit",value:function _PostInit(){}}],[{key:"instance",get:function get(){return this.__instance||new this,this.__instance}}]),Singleton}();_defineProperty(i,"__instance",null),e.exports=i},{}],39:[function(t,e,n){var i,s=t("@nkmjs/collections").Dictionary,a,l=t("@nkmjs/utils").U,c=function(){function StateBase(){_classCallCheck(this,StateBase),this._id="",this._data=null}return _createClass(StateBase,[{key:"id",get:function get(){return this._id}},{key:"data",get:function get(){return this._data}},{key:"toString",value:function toString(){return this._id}}],[{key:"GetOrCreate",value:function GetOrCreate(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;l.isVoid(this._stateMap)&&(this._stateMap=new s);var n=this._stateMap.Get(t);return l.isVoid(n)&&((n=new this)._id=t,n._data=e,this._stateMap.Set(t,n)),n}}]),StateBase}();e.exports=c},{"@nkmjs/collections":21,"@nkmjs/utils":271}],40:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("../signal"),l=t("../pool/disposable-object-ex"),c=t("../signals/signal-box"),u=t("./state-base"),h=function(t){_inherits(StateMachine,t);var e=_createSuper(StateMachine);function StateMachine(){var t;return _classCallCheck(this,StateMachine),(t=e.call(this))._currentState=null,t._owner=_assertThisInitialized(t),t._signals=new c,t}return _createClass(StateMachine,[{key:"owner",get:function get(){return this._owner},set:function set(t){s.isVoid(t)&&(t=this),this._owner=t}},{key:"currentState",get:function get(){return this._currentState},set:function set(t){if(this._currentState!==t){var e=this._currentState;this._currentState=t,this._OnCurrentStateChanged(e),this._Broadcast(a.STATE_CHANGED,this._owner,t,e),this._owner===this?this._signals.Broadcast(t,this._owner):this._owner._Broadcast(t,this._owner)}}},{key:"Is",value:function Is(t){return this._currentState===t}},{key:"IsAny",value:function IsAny(){for(var t=0,e=arguments.length;t<e;t++)if(this._currentState===(t<0||arguments.length<=t?void 0:arguments[t]))return!0;return!1}},{key:"IsNot",value:function IsNot(t){return this._currentState!=t}},{key:"IsNotAny",value:function IsNotAny(){for(var t=0,e=arguments.length;t<e;t++)if(this._currentState===(t<0||arguments.length<=t?void 0:arguments[t]))return!1;return!0}},{key:"_OnCurrentStateChanged",value:function _OnCurrentStateChanged(t){}},{key:"_CleanUp",value:function _CleanUp(){this._currentState=null,this._owner=null,this._signals.RemoveAll(),_get(_getPrototypeOf(StateMachine.prototype),"_CleanUp",this).call(this)}}]),StateMachine}(l);e.exports=h},{"../pool/disposable-object-ex":42,"../signal":45,"../signals/signal-box":47,"./state-base":39,"@nkmjs/utils":271}],41:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a="__NFO__",l=function(){function NFOS(){_classCallCheck(this,NFOS)}return _createClass(NFOS,null,[{key:"Get",value:function Get(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(s.isObject(t)){if(a in t)return t.__NFO__;if(a in t.constructor)return t.constructor.__NFO__}else if(s.isFunc(t)&&a in t)return t.__NFO__;return e}},{key:"Ext",value:function Ext(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.__NFO__;for(var a in i){var l=i[a];if(t.hasOwnProperty(a)){var c=t[a];if(s.isArray(c)){if(s.isArray(l)&&n&&n.includes(a))for(var u=0,h=l.length;u<h;u++)c.includes(l[u])||c.push(l[u])}else s.isObject(c)&&UTILS.isObject(l)&&this.Ext(c,l,n)}else s.isArray(l)?t[a]=_toConsumableArray(l):s.isObject()?t[a]=this.Ext({},l):t[a]=l}return t}}]),NFOS}();_defineProperty(l,"KEY",a),e.exports=l},{"@nkmjs/utils":271}],42:[function(t,e,n){var i=t("./disposable-object"),s=t("../signals/signal-box"),a=t("../signal"),l=function(t){_inherits(DisposableObjectEx,t);var e=_createSuper(DisposableObjectEx);function DisposableObjectEx(){return _classCallCheck(this,DisposableObjectEx),e.call(this)}return _createClass(DisposableObjectEx,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DisposableObjectEx.prototype),"_Init",this).call(this),this._releasePrevented=!1,this._signals=new s}},{key:"_Broadcast",value:function _Broadcast(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(e=this._signals).Broadcast.apply(e,[t].concat(i))}},{key:"Watch",value:function Watch(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._signals.Add(t,e,n)}},{key:"WatchOnce",value:function WatchOnce(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._signals.AddOnce(t,e,n)}},{key:"Unwatch",value:function Unwatch(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._signals.Remove(t,e,n)}},{key:"PreventRelease",value:function PreventRelease(){this._releasePrevented=!0}},{key:"Release",value:function Release(){if(!this._isReleasing){if(this._signals.silent=!1,this._isReleasing=!0,this._releasePrevented=!1,this._Broadcast(a.RELEASING,this),this._releasePrevented)return this._isReleasing=!1,void(this._releasePrevented=!1);this._Broadcast(a.RELEASED,this),this._CleanUp(),null!=this._returnFn&&this._returnFn(this),this._isReleasing=!1}}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(DisposableObjectEx.prototype),"_CleanUp",this).call(this),this._releasePrevented=!1,this._signals.Clear()}}]),DisposableObjectEx}(i);e.exports=l},{"../signal":45,"../signals/signal-box":47,"./disposable-object":43}],43:[function(t,e,n){var i=function(){function DisposableObject(){_classCallCheck(this,DisposableObject),this._Init(),this._PostInit()}return _createClass(DisposableObject,[{key:"_Init",value:function _Init(){this._isReleasing=!1,this._returnFn=null}},{key:"isReleasing",get:function get(){return this._isReleasing}},{key:"_PostInit",value:function _PostInit(){}},{key:"_Bind",value:function _Bind(t){return this[t.name]=t.bind(this)}},{key:"Release",value:function Release(){this._isReleasing||(this._isReleasing=!0,this._CleanUp(),null!=this._returnFn&&this._returnFn(this),this._isReleasing=!1)}},{key:"_CleanUp",value:function _CleanUp(){}}]),DisposableObject}();e.exports=i},{}],44:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/collections"),l=a.Dictionary,c=a.DictionaryList,u=t("../helpers/singleton"),h=t("./disposable-object"),d=function(t){_inherits(POOL,t);var e=_createSuper(POOL);function POOL(){return _classCallCheck(this,POOL),e.call(this)}return _createClass(POOL,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(POOL.prototype),"_Init",this).call(this),this._globalTypes=new l,this._globalPool=new c,this._Bind(this._Return)}},{key:"_Register",value:function _Register(t){if(!s.isFunc(t))throw new Error("Register used with invalid constructor : ".concat(t));this._globalTypes.Set(t.name,t)}},{key:"_GetClass",value:function _GetClass(t){return this._globalTypes.Get(t)}},{key:"_Return",value:function _Return(t){if(!s.isObject(t)||!s.isInstanceOf(t,h))throw new Error("Return used with invalid object : "+t);var e=t.constructor.name;if(!this._globalTypes.Contains(e))throw new Error("Return used with a never-registered object type : "+e);this._globalPool.Set(e,t)}},{key:"_Rent",value:function _Rent(t){var e=null;if(s.isString(t))e=t;else{if("function"!=typeof t)throw new Error("Rent requires either a string or a constructor.");e=t.name}if(!this._globalTypes.Contains(e)){if("function"!=typeof t||!s.isInstanceOf(t.prototype,h))throw new Error("Could not find any constructor association for : ".concat(e));this._Register(t)}t=this._globalTypes.Get(e);var n=this._globalPool.Pop(e);return n||((n=new t)._returnFn=this._Return),"Wake"in n&&n.Wake(),n}}],[{key:"Register",value:function Register(t){this.instance._Register(t)}},{key:"GetClass",value:function GetClass(t){return this.instance._GetClass(t)}},{key:"Rent",value:function Rent(t){return this.instance._Rent(t)}}]),POOL}(u);e.exports=d},{"../helpers/singleton":38,"./disposable-object":43,"@nkmjs/collections":21,"@nkmjs/utils":271}],45:[function(t,e,n){var i=function SIGNAL(){_classCallCheck(this,SIGNAL)};_defineProperty(i,"RELEASING",Symbol("releasing")),_defineProperty(i,"RELEASED",Symbol("released")),_defineProperty(i,"UPDATED",Symbol("updated")),_defineProperty(i,"RENAMING",Symbol("renaming")),_defineProperty(i,"RENAMED",Symbol("renamed")),_defineProperty(i,"STATE_CHANGING",Symbol("stateChanging")),_defineProperty(i,"STATE_CHANGED",Symbol("stateChanged")),_defineProperty(i,"STARTED",Symbol("started")),_defineProperty(i,"STOPPED",Symbol("stopped")),_defineProperty(i,"PROGRESS",Symbol("progress")),_defineProperty(i,"COMPLETE",Symbol("complete")),_defineProperty(i,"FAIL",Symbol("fail")),_defineProperty(i,"CANCELED",Symbol("canceled")),_defineProperty(i,"READY",Symbol("ready")),_defineProperty(i,"TICK",Symbol("tick")),_defineProperty(i,"ITEM_ADDED",Symbol("itemAdded")),_defineProperty(i,"ITEM_REMOVED",Symbol("itemRemoved")),_defineProperty(i,"ITEM_UPDATED",Symbol("itemUpdated")),e.exports=i},{}],46:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=function(t){_inherits(Observer,t);var e=_createSuper(Observer);function Observer(){return _classCallCheck(this,Observer),e.call(this)}return _createClass(Observer,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Observer.prototype),"_Init",this).call(this),this._hooks=new Array(0),this._targets=new Array(0),this._isEnabled=!0}},{key:"isEnabled",get:function get(){return this._isEnabled}},{key:"enabled",set:function set(t){t?this.Enable():this.Disable()}},{key:"Enable",value:function Enable(){if(this._isEnabled)return!1;this._isEnabled=!0;for(var t=0,e=this._targets.length;t<e;t++)this._WatchAll(this._targets[t]);return!0}},{key:"Disable",value:function Disable(){if(this._isEnabled)return!1;this._isEnabled=!1;for(var t=0,e=this._targets.length;t<e;t++)this._UnwatchAll(this._targets[t]);return!0}},{key:"Hook",value:function Hook(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._hooks.push({evt:t,thisArg:n,fn:e}),this._isEnabled)for(var i=0,s=this._targets.length;i<s;i++)this._targets[i].Watch(t,e,n)}},{key:"Unhook",value:function Unhook(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=0,s=this._hooks.length;i<s;i++){var a=this._hooks[i];if(a.evt===t&&a.thisArg===n&&a.fn===e&&(this._hooks.splice(i,1),i--,s--,this._isEnabled))for(var l=0,c=this._targets.length;l<c;l++)this._targets[l].Unwatch(t,e,n)}}},{key:"targets",get:function get(){return this._targets}},{key:"targetCount",get:function get(){return this._targets.length}},{key:"Observe",value:function Observe(t){if(!t)throw new Error("Target cannot be null.");return this._targets.includes(t)||(this._targets.push(t),this._isEnabled&&this._WatchAll(t)),t}},{key:"ObserveOnly",value:function ObserveOnly(t){return this._targets.includes(t)||(this.Flush(),t&&(this._targets.push(t),this._isEnabled&&this._WatchAll(t))),t}},{key:"Unobserve",value:function Unobserve(t){if(!t)throw new Error("Target cannot be null.");var e=this._targets.indexOf(t);return-1===e||(this._targets.splice(e,1),this._isEnabled&&this._UnwatchAll(t)),t}},{key:"_WatchAll",value:function _WatchAll(t){for(var e=0,n=this._hooks.length;e<n;e++){var i=this._hooks[e];t.Watch(i.evt,i.fn,i.thisArg)}}},{key:"_UnwatchAll",value:function _UnwatchAll(t){if(!t.isReleasing)for(var e=0,n=this._hooks.length;e<n;e++){var i=this._hooks[e];t.Unwatch(i.evt,i.fn,i.thisArg)}}},{key:"Flush",value:function Flush(){if(this._isEnabled)for(var t=0,e=this._targets.length;t<e;t++)this._UnwatchAll(this._targets[t]);this._targets.length=0}},{key:"_CleanUp",value:function _CleanUp(){this.Flush(),this._hooks.length=0,this._isEnabled=!0,_get(_getPrototypeOf(Observer.prototype),"_CleanUp",this).call(this)}}]),Observer}(t("../pool/disposable-object-ex"));e.exports=l},{"../pool/disposable-object-ex":42,"@nkmjs/utils":271}],47:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").Dictionary,c=t("../pool/disposable-object"),u=t("../pool/pool"),h=t("./signal-broadcaster"),d=function(t){_inherits(SignalBox,t);var e=_createSuper(SignalBox);function SignalBox(){var t;return _classCallCheck(this,SignalBox),(t=e.call(this))._signals=new l,t._silent=!1,t}return _createClass(SignalBox,[{key:"silent",get:function get(){return this._silent},set:function set(t){this._silent=t}},{key:"hasWatchers",get:function get(){return this._signals.count>0}},{key:"isEmpty",value:function isEmpty(t){var e=this._signals;return!e.Contains(t)||e.Get(t).isEmpty}},{key:"Broadcast",value:function Broadcast(t){if(!this._silent&&!this._signals.isEmpty){var e=this._signals.Get(t);if(!s.isVoid(e)){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];e.Broadcast.apply(e,i)}}}},{key:"Add",value:function Add(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this._signals.Get(t);s.isVoid(i)&&(i=u.Rent(h),this._signals.Set(t,i)),i.Add(e,n)}},{key:"AddOnce",value:function AddOnce(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this._signals.Get(t);s.isVoid(i)&&(i=u.Rent(h),this._signals.Set(t,i)),i.AddOnce(e,n)}},{key:"Remove",value:function Remove(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this._signals.Get(t);s.isVoid(i)||(i.Remove(e,n),i.isEmpty&&(this._signals.Remove(t),i.Release()))}},{key:"RemoveAll",value:function RemoveAll(t){var e=this._signals.Get(t);s.isVoid(e)||(this._signals.Remove(t),e.Release())}},{key:"Clear",value:function Clear(){for(var t=this._signals,e=t.keys,n=0,i=e.length;n<i;n++)t.Get(e[n]).Release();t.Clear()}}]),SignalBox}(c);e.exports=d},{"../pool/disposable-object":43,"../pool/pool":44,"./signal-broadcaster":48,"@nkmjs/collections":21,"@nkmjs/utils":271}],48:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").DictionaryList,c,u=function(t){_inherits(SignalBroadcaster,t);var e=_createSuper(SignalBroadcaster);function SignalBroadcaster(){return _classCallCheck(this,SignalBroadcaster),e.call(this)}return _createClass(SignalBroadcaster,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(SignalBroadcaster.prototype),"_Init",this).call(this),this._broadcasting=!1,this._removeAll=!1,this._slots=new l,this._onceSlots=new l,this._deprecatedKVP=new Array(0),this._queuedBroadcasts=new Array(0)}},{key:"isEmpty",get:function get(){return 0===this._slots.count}},{key:"count",get:function get(){return this._slots.count}},{key:"Add",value:function Add(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!s.isFunc(t))throw new Error("p_fn is not a function");s.isVoid(e)&&(e=SignalBroadcaster.BLANK),this._slots.Set(e,t),this._onceSlots.Remove(e,t)}},{key:"AddOnce",value:function AddOnce(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!s.isFunc(t))throw new Error("p_fn is not a function");s.isVoid(e)&&(e=SignalBroadcaster.BLANK),this._slots.Set(e,t),this._onceSlots.Set(e,t)}},{key:"Remove",value:function Remove(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!s.isFunc(t))throw new Error("p_fn is not a function");s.isVoid(e)&&(e=SignalBroadcaster.BLANK),this._slots.Contains(e)&&(this._broadcasting?this._deprecatedKVP.push([e,t]):this._slots.Remove(e,t)),this._onceSlots.Contains(e)&&(this._broadcasting?this._deprecatedKVP.push([e,t]):this._onceSlots.Remove(e,t))}},{key:"RemoveAll",value:function RemoveAll(){this._broadcasting?this._removeAll=!0:(this._queuedBroadcasts.length=0,this._slots.Clear(),this._onceSlots.Clear(),this._deprecatedKVP.length=0,this._removeAll=!1)}},{key:"Broadcast",value:function Broadcast(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(this._broadcasting)return this._queuedBroadcasts.push(e),void console.warn("Dispatching signal while already dispatching. Queueing.");this._broadcasting=!0,this._args=e,null==e?this._slots.internalMap.forEach(this.__BroadcastWithoutArgs,this):this._slots.internalMap.forEach(this.__BroadcastWithArgs,this),this._PostDispatch()}},{key:"_PostDispatch",value:function _PostDispatch(){if(this._broadcasting=!1,this._onceSlots.Clear(),this._removeAll)this.RemoveAll();else for(var t=0,e=this._deprecatedKVP.length;t<e;t++){var n=this._deprecatedKVP[t];this._slots.Remove(n[0],n[1])}this._deprecatedKVP.length=0,0!=this._queuedBroadcasts.length&&this.Broadcast.apply(this,this._queuedBroadcasts.shift())}},{key:"__BroadcastWithoutArgs",value:function __BroadcastWithoutArgs(t,e,n){var i=this._onceSlots.Get(e);if(e===SignalBroadcaster.BLANK)if(i)for(var s=0,a=t.length;s<a;s++){var l=t[s];l.apply(null),i.includes(l)&&this._deprecatedKVP.push([e,l])}else for(var c=0,u=t.length;c<u;c++)t[c].apply(null);else if(i)for(var h=0,d=t.length;h<d;h++){var p=t[h];p.apply(e),i.includes(p)&&this._deprecatedKVP.push([e,p])}else for(var f=0,g=t.length;f<g;f++)t[f].apply(e)}},{key:"__BroadcastWithArgs",value:function __BroadcastWithArgs(t,e,n){var i=this._onceSlots.Get(e);if(e===SignalBroadcaster.BLANK)if(i)for(var s=0,a=t.length;s<a;s++){var l=t[s];l.apply(null,this._args),i.includes(l)&&this._deprecatedKVP.push([e,l])}else for(var c=0,u=t.length;c<u;c++)t[c].apply(null,this._args);else if(i)for(var h=0,d=t.length;h<d;h++){var p=t[h];p.apply(e,this._args),i.includes(p)&&this._deprecatedKVP.push([e,p])}else for(var f=0,g=t.length;f<g;f++)t[f].apply(e,this._args)}},{key:"_CleanUp",value:function _CleanUp(){this.RemoveAll(),_get(_getPrototypeOf(SignalBroadcaster.prototype),"_CleanUp",this).call(this)}}]),SignalBroadcaster}(t("../pool/disposable-object"));_defineProperty(u,"BLANK",Symbol("none")),e.exports=u},{"../pool/disposable-object":43,"@nkmjs/collections":21,"@nkmjs/utils":271}],49:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("./time"),l=function(){function DelayedCall(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;_classCallCheck(this,DelayedCall),this.Clear(),this._Call=this._Call.bind(this),this.Schedule=this.Schedule.bind(this),this._delay=e,this._elapsed=0,t&&(this._callback=t)}return _createClass(DelayedCall,[{key:"scheduled",get:function get(){return this._scheduled}},{key:"callback",get:function get(){return this._callback},set:function set(t){var e=this._scheduled;this.Cancel(),this._callback=t,e&&this.Schedule()}},{key:"Schedule",value:function Schedule(){this._scheduled||s.isVoid(this._callback)||(this._scheduled=!0,a.instance.NextTickAdd(this._Call))}},{key:"Cancel",value:function Cancel(){this._scheduled&&!s.isVoid(this._callback)&&(a.instance.NextTickRemove(this._Call),this._elapsed=0)}},{key:"_Call",value:function _Call(t){this._delay>0&&(this._elapsed+=t,this._elapsed<this._delay)?a.instance.NextTickAdd(this._Call):(this._scheduled=!1,this._elapsed=0,this._callback(t))}},{key:"Clear",value:function Clear(){this.Cancel(),this._scheduled=!1,this._callback=null}}]),DelayedCall}();e.exports=l},{"./time":50,"@nkmjs/utils":271}],50:[function(t,e,n){(function(n){(function(){var i,s=t("@nkmjs/utils").U,a=t("../signal"),l=t("../helpers/singleton-ex"),c=t("../helpers/call-list"),u=function(t){_inherits(TIME,t);var e=_createSuper(TIME);function TIME(){return _classCallCheck(this,TIME),e.call(this)}return _createClass(TIME,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(TIME.prototype),"_Init",this).call(this),this._lastTick=null,this._deltaTime=0,this._timeScale=1,this._clA=new c,this._clB=new c,this._nextTick=this._clA,this._nextTickScheduled=!1,this._Bind(this._Tick)}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(TIME.prototype),"_PostInit",this).call(this),this._isBrowser&&window.requestAnimationFrame(this._Tick)}},{key:"deltaTime",get:function get(){return this._deltaTime}},{key:"timeScale",get:function get(){return this._timeScale},set:function set(t){this._timeScale=t}},{key:"NextTickAdd",value:function NextTickAdd(t){if(!s.isFunc(t))throw new Error("p_fn is not a function");this._nextTick.Add(t),this._ScheduleNextTick()}},{key:"NextTickRemove",value:function NextTickRemove(t){if(!s.isFunc(t))throw new Error("p_fn is not a function");this._nextTick.Remove(t)}},{key:"_ScheduleNextTick",value:function _ScheduleNextTick(){this._isBrowser||this._nextTickScheduled||(this._nextTickScheduled=!0,n.nextTick(this._Tick))}},{key:"_Tick",value:function _Tick(t){null===this._lastTick&&(this._lastTick=t),this._deltaTime=(t-this._lastTick)*this._timeScale,this._lastTick=t;var e=this._nextTick;this._nextTick=e===this._clA?this._clB:this._clA,e.NotifyFlush(this._deltaTime),this._Broadcast(a.TICK,this._deltaTime),this._isBrowser?window.requestAnimationFrame(this._Tick):(this._nextTickScheduled=!1,this._nextTick.count>0&&this._ScheduleNextTick())}}],[{key:"NEXT_TICK",set:function set(t){TIME.instance.NextTickAdd(t)}}]),TIME}(l);e.exports=u}).call(this)}).call(this,t("_process"))},{"../helpers/call-list":32,"../helpers/singleton-ex":37,"../signal":45,"@nkmjs/utils":271,_process:53}],51:[function(t,e,n){e.exports={actions:t("@nkmjs/actions"),app:t("@nkmjs/app-core"),collections:t("@nkmjs/collections"),common:t("@nkmjs/common"),data:t("@nkmjs/data-core"),dialog:t("@nkmjs/dialog"),document:t("@nkmjs/documents"),env:t("@nkmjs/environment"),io:t("@nkmjs/io-core"),services:t("@nkmjs/services"),style:t("@nkmjs/style"),ui:t("@nkmjs/ui-core"),inputs:t("@nkmjs/ui-inputs"),workspace:t("@nkmjs/ui-workspace"),utils:t("@nkmjs/utils")}},{"@nkmjs/actions":1,"@nkmjs/app-core":15,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/dialog":84,"@nkmjs/documents":89,"@nkmjs/environment":95,"@nkmjs/io-core":101,"@nkmjs/services":153,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/ui-inputs":221,"@nkmjs/ui-workspace":237,"@nkmjs/utils":271}],52:[function(t,e,n){window.nkmjs=[],window.nkmjs[0]=t("./lib.js")},{"./lib.js":51}],53:[function(t,e,n){var i=e.exports={},s,a;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(s===setTimeout)return setTimeout(t,0);if((s===defaultSetTimout||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}function runClearTimeout(t){if(a===clearTimeout)return clearTimeout(t);if((a===defaultClearTimeout||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(t);try{return a(t)}catch(e){try{return a.call(null,t)}catch(e){return a.call(this,t)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){s=defaultSetTimout}try{a="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){a=defaultClearTimeout}}();var l=[],c=!1,u,h=-1;function cleanUpNextTick(){c&&u&&(c=!1,u.length?l=u.concat(l):h=-1,l.length&&drainQueue())}function drainQueue(){if(!c){var t=runTimeout(cleanUpNextTick);c=!0;for(var e=l.length;e;){for(u=l,l=[];++h<e;)u&&u[h].run();h=-1,e=l.length}u=null,c=!1,runClearTimeout(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new Item(t,e)),1!==l.length||c||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=noop,i.addListener=noop,i.once=noop,i.off=noop,i.removeListener=noop,i.removeAllListeners=noop,i.emit=noop,i.prependListener=noop,i.prependOnceListener=noop,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],54:[function(t,e,n){var i,s=t("@nkmjs/common").BindingKit,a=t("./lib/data"),l=a.Metadata,c=a.DataBlock,u=t("./lib/serialization"),h=u.TEXTSerializer,d=u.JSONSerializer,p=u.SERIALIZATION_CONTEXT,f=t("./lib/serialization/json"),g=f.MetadataJSONSerializer,m=f.DataBlockJSONSerializer,y=function(t){_inherits(Bindings,t);var e=_createSuper(Bindings);function Bindings(){return _classCallCheck(this,Bindings),e.call(this)}return _createClass(Bindings,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Bindings.prototype),"_Init",this).call(this),this.AddClasses(l,c),this.Add({context:p.SERIALIZER,kvps:[{key:p.JSON,binding:d},{key:p.TEXT,binding:h}]},{context:p.JSON,kvps:[{key:l,binding:g},{key:c,binding:m}]})}}]),Bindings}(s);e.exports=y},{"./lib/data":68,"./lib/serialization":76,"./lib/serialization/json":78,"@nkmjs/common":27}],55:[function(t,e,n){e.exports={DATA_SIGNAL:t("./lib/data-signal"),Metadata:t("./lib/data/metadata"),MetadataObserver:t("./lib/helpers/observer-metadata"),ID:t("./lib/id/id"),Repertoire:t("./lib/data/repertoire"),DataBlock:t("./lib/data/data-block"),DataFactory:t("./lib/data/data-factory"),CATALOG_SIGNAL:t("./lib/catalog/catalog-signal"),CATALOG_SORTING:t("./lib/catalog/catalog-sorting"),CatalogItem:t("./lib/catalog/catalog-item"),Catalog:t("./lib/catalog/catalog"),CatalogSelection:t("./lib/catalog/catalog-selection"),CatalogSearch:t("./lib/catalog/catalog-search"),CatalogWatcher:t("./lib/catalog/catalog-watcher"),CatalogHandler:t("./lib/catalog/catalog-handler"),DataObserver:t("./lib/helpers/observer-data"),BaseSerializer:t("./lib/serialization/serializer-base"),JSONSerializer:t("./lib/serialization/serializer-json"),TEXTSerializer:t("./lib/serialization/serializer-text"),SERIALIZATION_CONTEXT:t("./lib/serialization/serialization-context"),JSONSerializers:t("./lib/serialization/json")},t("@nkmjs/common").BINDINGS.Expand(t("./bindings"))},{"./bindings":54,"./lib/catalog/catalog":63,"./lib/catalog/catalog-handler":56,"./lib/catalog/catalog-item":57,"./lib/catalog/catalog-search":58,"./lib/catalog/catalog-selection":59,"./lib/catalog/catalog-signal":60,"./lib/catalog/catalog-sorting":61,"./lib/catalog/catalog-watcher":62,"./lib/data-signal":65,"./lib/data/data-block":66,"./lib/data/data-factory":67,"./lib/data/metadata":69,"./lib/data/repertoire":70,"./lib/helpers/observer-data":71,"./lib/helpers/observer-metadata":72,"./lib/id/id":74,"./lib/serialization/json":78,"./lib/serialization/serialization-context":80,"./lib/serialization/serializer-base":81,"./lib/serialization/serializer-json":82,"./lib/serialization/serializer-text":83,"@nkmjs/common":27}],56:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").Dictionary,c=t("@nkmjs/common"),u=c.SIGNAL,h=c.DisposableObjectEx,d=c.Observer,p=t("./catalog-signal"),f=t("./catalog-item"),g=t("./catalog"),m,y=function(t){_inherits(CatalogHandler,t);var e=_createSuper(CatalogHandler);function CatalogHandler(){return _classCallCheck(this,CatalogHandler),e.call(this)}return _createClass(CatalogHandler,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CatalogHandler.prototype),"_Init",this).call(this)}},{key:"_OnCatalogItemAdded",value:function _OnCatalogItemAdded(t,e){return!!_get(_getPrototypeOf(CatalogHandler.prototype),"_OnCatalogItemAdded",this).call(this,t,e)&&(this._Broadcast(u.ITEM_ADDED,this,e,null),!0)}},{key:"_OnCatalogItemRemoved",value:function _OnCatalogItemRemoved(t,e){var n=_get(_getPrototypeOf(CatalogHandler.prototype),"_OnCatalogItemRemoved",this).call(this,t,e);return!1!==n&&(this._Broadcast(u.ITEM_REMOVED,this,e,n),n)}}]),CatalogHandler}(t("./catalog-watcher"));e.exports=y},{"./catalog":63,"./catalog-item":57,"./catalog-signal":60,"./catalog-watcher":62,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],57:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.COM_ID,c=a.SIGNAL,u=a.OptionObject,h,d=t("@nkmjs/common").DelayedCall,p=t("../data-id"),f=t("./catalog-signal"),g=function(t){_inherits(CatalogItem,t);var e=_createSuper(CatalogItem);function CatalogItem(){return _classCallCheck(this,CatalogItem),e.call(this)}return _createClass(CatalogItem,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CatalogItem.prototype),"_Init",this).call(this),this._parent=null,this._isDir=!1,this._rootCatalog=null,this._rootDistance=-1,this._autoRelease=!0,this._delayedUpdate=new d(this._Bind(this._OnUpdate)),this._optionHandler.wrapUpFn=this._Bind(this._OnOptionsUpdated),this._optionHandler.Hook(l.DATA),this._optionHandler.Hook(p.BOUND)}},{key:"isDir",get:function get(){return this._isDir}},{key:"rootCatalog",get:function get(){return this._rootCatalog},set:function set(t){this._rootCatalog=t}},{key:"rootDistance",get:function get(){return this._rootDistance},set:function set(t){this._rootDistance=t}},{key:"autoRelease",get:function get(){return this._autoRelease},set:function set(t){this._autoRelease=t}},{key:"parent",get:function get(){return this._parent},set:function set(t){if(this._parent!==t){var e=this._parent;this._parent=t,e&&e.Remove(this),t&&t.Add(this)}}},{key:"_OnOptionsUpdated",value:function _OnOptionsUpdated(t){this._delayedUpdate.Schedule()}},{key:"name",get:function get(){return this._options[l.NAME]},set:function set(t){this.SetOption(l.NAME,t)}},{key:"path",get:function get(){return this._options[l.PATH]},set:function set(t){this.SetOption(l.PATH,t)}},{key:"dataBound",get:function get(){return this._options[p.BOUND]},set:function set(t){this.SetOption(p.BOUND,t)}},{key:"data",get:function get(){return this._options[l.DATA]},set:function set(t){var e=this._options[l.DATA];this._options[l.DATA]=t,this._OnDataChanged(t,e)}},{key:"primaryCommand",get:function get(){return this._options[l.CMD_PRIMARY]},set:function set(t){this.SetOption(l.CMD_PRIMARY,t)}},{key:"secondaryCommand",get:function get(){return this._options[l.CMD_SECONDARY]},set:function set(t){this.SetOption(l.CMD_SECONDARY,t)}},{key:"commandList",get:function get(){return this._options[l.CMD_LIST]},set:function set(t){this.SetOption(l.CMD_LIST,t)}},{key:"_OnDataChanged",value:function _OnDataChanged(t,e){e&&"Unwatch"in e&&e.Unwatch(c.RELEASED,this._OnDataReleased,this),t&&"Watch"in t&&t.Watch(c.RELEASED,this._OnDataReleased,this),this._Broadcast(f.ITEM_DATA_CHANGED,this,t,e),this._delayedUpdate.Schedule()}},{key:"_OnDataReleased",value:function _OnDataReleased(t){this._Broadcast(f.ITEM_DATA_RELEASED,this,t),this._options[p.BOUND]&&this.Release()}},{key:"AddCommand",value:function AddCommand(t){var e=this.GetOrSetOption(l.CMD_LIST,[],!1);e.includes(t)||(e.push(t),this._delayedUpdate.Schedule())}},{key:"_CleanUp",value:function _CleanUp(){this._parent&&this._parent.Remove(this),this._autoRelease=!0,this._parent=null,this._rootCatalog=null,this._rootDistance=-1,this.data=null,_get(_getPrototypeOf(CatalogItem.prototype),"_CleanUp",this).call(this)}},{key:"_OnUpdate",value:function _OnUpdate(){this._Broadcast(c.UPDATED,this)}},{key:"toString",value:function toString(){return"".concat(this._options[l.NAME]," (").concat(this.constructor.name,")")}}]),CatalogItem}(u);e.exports=g},{"../data-id":64,"./catalog-signal":60,"@nkmjs/common":27,"@nkmjs/utils":271}],58:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.POOL,u,h=function(t){_inherits(CatalogSearch,t);var e=_createSuper(CatalogSearch);function CatalogSearch(){return _classCallCheck(this,CatalogSearch),e.call(this)}return _createClass(CatalogSearch,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CatalogSearch.prototype),"_Init",this).call(this),this._searchResult=new CatalogSearch,this._sourceCatalog=null}}]),CatalogSearch}(a.DisposableObjectEx);e.exports=h},{"@nkmjs/common":27,"@nkmjs/utils":271}],59:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").SIGNAL,c,u=function(t){_inherits(CatalogSelection,t);var e=_createSuper(CatalogSelection);function CatalogSelection(){return _classCallCheck(this,CatalogSelection),e.call(this)}return _createClass(CatalogSelection,[{key:"GetOrCreateCatalog",value:function GetOrCreateCatalog(t){throw new Error("CatalogSelection does not support item creation.")}},{key:"Register",value:function Register(t){throw new Error("CatalogSelection does not support item creation.")}},{key:"_OnItemAdded",value:function _OnItemAdded(t){this._Broadcast(l.ITEM_ADDED,this,t),t.Watch(l.RELEASED,this._OnItemReleased,this),this._autoSort&&this._delayedSort.Schedule()}},{key:"_OnItemRemoved",value:function _OnItemRemoved(t){this._Broadcast(l.ITEM_REMOVED,this,t),t.Unwatch(l.RELEASED,this._OnItemReleased,this)}},{key:"Clear",value:function Clear(){for(var t=this._items,e=t.length;0!=e;)this.Remove(t[e-1]),e=t.length;t.length=0,this._delayedSort.Cancel()}}]),CatalogSelection}(t("./catalog"));e.exports=u},{"./catalog":63,"@nkmjs/common":27,"@nkmjs/utils":271}],60:[function(t,e,n){var i=function CATALOG_SIGNAL(){_classCallCheck(this,CATALOG_SIGNAL)};_defineProperty(i,"ROOT_ITEM_ADDED",Symbol("rootItemAdded")),_defineProperty(i,"ROOT_ITEM_REMOVED",Symbol("rootItemRemoved")),_defineProperty(i,"ITEM_DATA_CHANGED",Symbol("dataItemAdded")),_defineProperty(i,"ITEM_DATA_RELEASED",Symbol("dataItemRemoved")),_defineProperty(i,"ITEM_DATA_UPDATED",Symbol("dataItemUpdated")),_defineProperty(i,"SORTED",Symbol("sorted")),e.exports=i},{}],61:[function(t,e,n){var i="",s=null,a=function(){function CATALOG_SORTING(){_classCallCheck(this,CATALOG_SORTING)}return _createClass(CATALOG_SORTING,null,[{key:"NAME_ASC",value:function NAME_ASC(t,e){var n=t._isDir,i=e._isDir;return n&&i||!n&&!i?t.name.localeCompare(e.name):n?-1:1}},{key:"NAME_DSC",value:function NAME_DSC(t,e){var n=t._isDir,i=e._isDir;return n&&i||!n&&!i?-1*t.name.localeCompare(e.name):n?-1:1}},{key:"NUMERIC_ASC",value:function NUMERIC_ASC(t,e){return t-e}},{key:"NUMERIC_DSC",value:function NUMERIC_DSC(t,e){return e-t}},{key:"STRING_ASC",value:function STRING_ASC(t,e){return t.localeCompare(e)}},{key:"STRING_DSC",value:function STRING_DSC(t,e){return-1*t.localeCompare(e)}},{key:"OPTION",value:function OPTION(t,e){var n=t._isDir,a=e._isDir;return n&&a||!n&&!a?s(t.GetOption(i),e.GetOption(i)):n?-1:1}},{key:"SortByOption",value:function SortByOption(t,e,n){i=e,s=n,t._items.sort(CATALOG_SORTING.OPTION)}}]),CATALOG_SORTING}();e.exports=a},{}],62:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").Dictionary,c=t("@nkmjs/common"),u=c.BINDINGS,h=c.SIGNAL,d=c.Observer,p=c.DisposableObjectEx,f=t("./catalog-signal"),g=t("../catalog/catalog"),m=t("./catalog-item"),y=function(t){_inherits(CatalogWatcher,t);var e=_createSuper(CatalogWatcher);function CatalogWatcher(){return _classCallCheck(this,CatalogWatcher),e.call(this)}return _createClass(CatalogWatcher,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CatalogWatcher.prototype),"_Init",this).call(this),this._owner=null,this._catalog=null,this._map=new Map,this._filters=null,this._itemCount=0,this._isEnabled=!0,this._isDeepWatchEnabled=!1,this._catalogObserver=new d,this._catalogObserver.Hook(h.ITEM_ADDED,this._OnCatalogItemAdded,this),this._catalogObserver.Hook(h.ITEM_REMOVED,this._OnCatalogItemRemoved,this),this._catalogObserver.Hook(f.SORTED,this._OnCatalogSorted,this)}},{key:"count",get:function get(){return this._map.size}},{key:"owner",get:function get(){return this._owner},set:function set(t){this._owner=t}},{key:"catalog",get:function get(){return this._catalog},set:function set(t){if(this._catalog!==t){var e=this._catalog;this._catalog=t,e&&this._catalogObserver.Unobserve(e),t&&this._catalogObserver.Observe(t),this._OnCatalogChanged(e)}}},{key:"isEnabled",get:function get(){return this._isEnabled}},{key:"enabled",set:function set(t){t?this.Enable():this.Disable()}},{key:"Enable",value:function Enable(){return!this._isEnabled&&(this._isEnabled=!0,this._catalogObserver.Enable(),this._catalog&&this._AddCatalogContent(this._catalog,this._isDeepWatchEnabled),!0)}},{key:"Disable",value:function Disable(){return!!this._isEnabled&&(this._isEnabled=!1,this._catalogObserver.Disable(),this._catalog&&this._RemoveCatalogContent(this._catalog,this._isDeepWatchEnabled),!0)}},{key:"isDeepWatchEnabled",get:function get(){return this._isDeepWatchEnabled}},{key:"deepWatch",set:function set(t){this._isDeepWatchEnabled!==t&&(this._isDeepWatchEnabled=t,this._isDeepWatchEnabled?(this._catalogObserver.Unhook(h.ITEM_ADDED,this._OnCatalogItemAdded,this),this._catalogObserver.Unhook(h.ITEM_REMOVED,this._OnCatalogItemRemoved,this),this._catalogObserver.Unhook(f.SORTED,this._OnCatalogSorted,this),this._catalogObserver.Hook(f.ROOT_ITEM_ADDED,this._OnCatalogItemAdded,this),this._catalogObserver.Hook(f.ROOT_ITEM_REMOVED,this._OnCatalogItemRemoved,this),this._isEnabled&&this._catalog&&(this._RemoveCatalogContent(this._catalog),this._AddCatalogContent(this._catalog,!0))):(this._catalogObserver.Unhook(f.ROOT_ITEM_ADDED,this._OnCatalogItemAdded,this),this._catalogObserver.Unhook(f.ROOT_ITEM_REMOVED,this._OnCatalogItemRemoved,this),this._catalogObserver.Hook(h.ITEM_ADDED,this._OnCatalogItemAdded,this),this._catalogObserver.Hook(h.ITEM_REMOVED,this._OnCatalogItemRemoved,this),this._catalogObserver.Hook(f.SORTED,this._OnCatalogSorted,this),this._isEnabled&&this._catalog&&(this._RemoveCatalogContent(this._catalog,!0),this._AddCatalogContent(this._catalog))))}},{key:"_AddCatalogContent",value:function _AddCatalogContent(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t._items;if(e)for(var i=0,s=n.length;i<s;i++){var a=n[i];a.isDir?this._AddCatalogContent(a,e):this._OnCatalogItemAdded(t,a)}else for(var l=0,c=n.length;l<c;l++){var u=n[l];this._OnCatalogItemAdded(t,u)}}},{key:"_RemoveCatalogContent",value:function _RemoveCatalogContent(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t._items;if(e)for(var i=0,s=n.length;i<s;i++){var a=n[i];a.isDir?this._RemoveCatalogContent(a,e):this._OnCatalogItemRemoved(t,a)}else for(var l=0,c=n.length;l<c;l++){var u=n[l];this._OnCatalogItemRemoved(t,u)}}},{key:"_OnCatalogChanged",value:function _OnCatalogChanged(t){return!!this._isEnabled&&(t&&this._RemoveCatalogContent(t,this._isDeepWatchEnabled),this._catalog&&this._AddCatalogContent(this._catalog,this._isDeepWatchEnabled),!0)}},{key:"_OnCatalogItemAdded",value:function _OnCatalogItemAdded(t,e){return(!this._isDeepWatchEnabled||!(e.isDir||e.rootDistance<=this._catalog.rootDistance))&&(this._itemCount++,!(this._filters&&!this._filters.Check(e))&&(e.Watch(f.ITEM_DATA_RELEASED,this._OnItemDataReleased,this),!0))}},{key:"_OnCatalogItemRemoved",value:function _OnCatalogItemRemoved(t,e){if(this._isDeepWatchEnabled&&(e.isDir||e.rootDistance<=this._catalog.rootDistance))return!1;this._itemCount--,e.isReleasing||e.Unwatch(f.ITEM_DATA_RELEASED,this._OnItemDataReleased,this);var n=this._map.get(e);return n&&this._map.delete(e),n}},{key:"_OnItemDataReleased",value:function _OnItemDataReleased(t,e){}},{key:"_OnCatalogSorted",value:function _OnCatalogSorted(t){this._Broadcast(f.SORTED,this)}},{key:"Set",value:function Set(t,e){return this._map.set(t,e),e}},{key:"Get",value:function Get(t){return this._map.get(t)}},{key:"GetAt",value:function GetAt(t){return this._map.get(this._catalog._items[t])}},{key:"GetValueKeys",value:function GetValueKeys(t){for(var e=this._map.keys,n=null,i=0,s=e.length;i<s;i++){var a=e[i],l;this._map.Get(a)===t&&(n||(n=new Array(1)),n.push(a))}return n}},{key:"_CleanUp",value:function _CleanUp(){this.flattened=!1,this.catalog=null,this._owner=null,this._isEnabled=!0,this._itemCount=0,_get(_getPrototypeOf(CatalogWatcher.prototype),"_CleanUp",this).call(this)}}]),CatalogWatcher}(p);e.exports=y},{"../catalog/catalog":63,"./catalog-item":57,"./catalog-signal":60,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],63:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.BINDINGS,c=a.SIGNAL,u=a.POOL,h=a.COM_ID,d,p=t("@nkmjs/common").DelayedCall,f=t("./catalog-signal"),g=t("./catalog-sorting"),m=t("./catalog-item"),y=function(t){_inherits(Catalog,t);var e=_createSuper(Catalog);function Catalog(){var t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return _classCallCheck(this,Catalog),(t=e.call(this)).autoSort=n,t}return _createClass(Catalog,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Catalog.prototype),"_Init",this).call(this),this._optionHandler.beginFn=this._Bind(this._OnOptionsWillUpdate),this._optionHandler.Hook("autoSort","autoSort"),this._isDir=!0,this._expanded=!1,this._items=new Array(0),this._rootCatalog=this,this._sortPending=!1,this._autoSort=!0,this._defaultSortFunc=null,this._delayedSort=new p(this._Bind(this.Sort))}},{key:"expanded",get:function get(){return this._expanded},set:function set(t){this._expanded=t}},{key:"count",get:function get(){return this._items.length}},{key:"rootCatalog",set:function set(t){if(this._rootCatalog!==t){this._rootCatalog=t;for(var e=this._rootDistance+1,n=0,i=this._items.length;n<i;n++){var s=this._items[n];s.rootCatalog=this._rootCatalog,s.rootDistance=e}}}},{key:"_OnOptionsWillUpdate",value:function _OnOptionsWillUpdate(t){this.autoSort=s.Get(t,"autoSort",this._parent?this._parent.autoSort:this._autoSort)}},{key:"At",value:function At(t){if(this._items.length<=t)throw new Error("Argument error : Catalog index outside boundaries.");return this._items[t]}},{key:"ForEach",value:function ForEach(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._items.length;if(e)if(n)for(var s=i-1;s>=0;s--)t.call(e,this._items[s],s);else for(var a=0;a<i;a++)t.call(e,this._items[a],a);else if(n)for(var l=i-1;l>=0;l--)t.call(null,this._items[l],l);else for(var c=0;c<i;c++)t.call(null,this._items[c],c)}},{key:"GetOrCreateCatalog",value:function GetOrCreateCatalog(t){for(var e,n=s.isString(t)?t:t[h.NAME],i=this._items,a=null,l=0,c=i.length;l<c;l++)if(a=i[l],s.isInstanceOf(a,Catalog)&&a.name===n)return a;return(a=u.Rent(Catalog.GetItemClass(t,!0))).options=s.Ensure(s.isObject(t)?t:{},(_defineProperty(e={},h.NAME,n),_defineProperty(e,h.ICON,"%ICON%/icon_directory.svg"),e)),this.Add(a)}},{key:"Register",value:function Register(t){if(!t)throw new Error("Cannot register item with null infos");var e=Catalog.PathInfos(t.path);if(!e.valid||!e.path){var n,i=u.Rent(Catalog.GetItemClass(t));return i.options=s.EnsureMultiple(t,(_defineProperty(n={},h.NAME,e.name),_defineProperty(n,h.icon,"%ICON%/icon_document.svg"),n)),this.Add(i)}if(this._rootCatalog!=this)return this._rootCatalog.Register(t);for(var a=e.path,l=null,c=0,d=a.length,p;c<d;c++)l=(0===c?this:l).GetOrCreateCatalog(a[c]);if(e.isDir)return l.options=s.EnsureMultiple(t,(_defineProperty(p={},h.NAME,e.name),_defineProperty(p,h.icon,"%ICON%/icon_directory.svg"),p)),l;var f,g=u.Rent(Catalog.GetItemClass(t));return g.options=s.EnsureMultiple(t,(_defineProperty(f={},h.NAME,e.name),_defineProperty(f,h.icon,"%ICON%/icon_document.svg"),f)),l.Add(g)}},{key:"Add",value:function Add(t){if(!s.isInstanceOf(t,m))throw new Error("Cannot Add a non-CatalogItem (".concat(t,") to Catalog."));return this._items.includes(t)?null:(this._items.push(t),this._OnItemAdded(t),t)}},{key:"_OnItemAdded",value:function _OnItemAdded(t){t.parent=this,t.rootCatalog=this._rootCatalog,t.rootDistance=this._rootDistance+1,t.Watch(c.RELEASED,this._OnItemReleased,this),this._rootCatalog&&this._rootCatalog._Broadcast(f.ROOT_ITEM_ADDED,this._rootCatalog,t),this._Broadcast(c.ITEM_ADDED,this,t),this._autoSort&&this._delayedSort.Schedule()}},{key:"_OnItemReleased",value:function _OnItemReleased(t){this.Remove(t)}},{key:"Remove",value:function Remove(t){if(s.isInstanceOf(t,m)){var e=this._items.indexOf(t);-1!==e&&(this._items.splice(e,1),this._OnItemRemoved(t))}}},{key:"_OnItemRemoved",value:function _OnItemRemoved(t){this._Broadcast(c.ITEM_REMOVED,this,t),this._rootCatalog&&this._rootCatalog._Broadcast(f.ROOT_ITEM_REMOVED,this._rootCatalog,t),t.Unwatch(c.RELEASED,this._OnItemReleased,this),t.parent===this&&(t.parent=null,t.autoRelease&&t.Release())}},{key:"Resolve",value:function Resolve(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},{key:"FindDataHolders",value:function FindDataHolders(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e||(e=new Array(0));for(var n=0,i=this._items.length;n<i;n++){var a=this._items[n];a.data===t&&(e.includes(a)||e.push(a)),s.isInstanceOf(a,Catalog)&&a.FindDataHolders(t,e)}return e}},{key:"FindFirstDataHolder",value:function FindFirstDataHolder(t){for(var e=0,n=this._items.length;e<n;e++){var i=this._items[e];if(i.data===t)return i;if(s.isInstanceOf(i,Catalog)&&(i=i.FindDataHolders(t)))return i}return null}},{key:"FindFirstDataByStringID",value:function FindFirstDataByStringID(t){for(var e=0,n=this._items.length;e<n;e++){var i=this._items[e],s=i.data;if(s&&s.id&&s.id.name===t)return i}return null}},{key:"FindFirstByOptionValue",value:function FindFirstByOptionValue(t,e){for(var n=0,i=this._items.length;n<i;n++){var s=this._items[n],a=s._options[t];if(a&&a===e)return s}return null}},{key:"autoSort",get:function get(){return this._autoSort},set:function set(t){this._autoSort!==t&&(this._autoSort=t,t?this._delayedSort.Schedule():this._delayedSort.Cancel())}},{key:"defaultSortFunc",get:function get(){return this._defaultSortFunc},set:function set(t){this._defaultSortFunc=t}},{key:"Sort",value:function Sort(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!1;t?t.id?(g.SortByOption(this,t.id,t.fn),e=!0):t.fn&&(this._items.sort(t.fn),e=!0):(this._items.sort(this._defaultSortFunc?this._defaultSortFunc:g.NAME_ASC),e=!0),e&&this._Broadcast(f.SORTED,this)}},{key:"Clear",value:function Clear(){for(var t=this._items.length-1;t>0;)this._items[t].Release(),t--;this._items.length=0,this._delayedSort.Cancel()}},{key:"_CleanUp",value:function _CleanUp(){this.Clear(),this._autoSort=!0,this._defaultSortFunc=null,_get(_getPrototypeOf(Catalog.prototype),"_CleanUp",this).call(this),this._rootCatalog=this,this._rootDistance=-1}},{key:"StructToString",value:function StructToString(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t||(t=""),s.isVoid(e)&&(e=-1),e++;for(var n="\t",i="",a=0;a<e;a++)i+=n;t+="".concat(i,"/").concat(this._name," \n");for(var l=0,c=this._items.length;l<c;l++){var u=this._items[l];s.isInstanceOf(u,Catalog)?t=u.StructToString(t,e):t+="".concat(i).concat(n,"· ").concat(u.name,"\n")}return t}},{key:"toString",value:function toString(){return"!".concat(this._name," (").concat(this._items.length,")")}}],[{key:"PathInfos",value:function PathInfos(t){var e={path:null,isDir:!1,name:null,valid:!1};if(!t)return e;e.valid=!0;var n=t.split("/"),i=!1,a="";if(1===n.length)a=n[0];else{for(var l=new Array,c=0,u=n.length;c<u;c++){var h=n.shift();s.isEmpty(h)?c===u-1&&(i=!0):l.push(h)}a=i?l[l.length-1]:l.pop(),e.path=l}return e.isDir=i,e.name=a,e}},{key:"CreateFrom",value:function CreateFrom(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e&&!t)throw new Error("Cannot create Catalog from null options nor struct.");var i=u.Rent(this.GetItemClass(t,!0));if(i.options=t,n&&(i.parent=n),e)for(var s=0,a=e.length;s<a;s++){var l=e[s];l.hasOwnProperty("content")?Catalog.CreateFrom(l,l.content,i):i.Register(l)}return i}},{key:"GetItemClass",value:function GetItemClass(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if(s.isObject(t)){var i=s.Get(t,"data",null);i&&(n=l.Get(Catalog,i,null)),n||(n=e||s.isArray(s.Get(t,"content",null))?this.__default_catalogClass:this.__default_itemClass)}else n=e?this.__default_catalogClass:this.__default_itemClass;return n}}]),Catalog}(m);_defineProperty(y,"__default_catalogClass",y),_defineProperty(y,"__default_itemClass",m),e.exports=y},{"./catalog-item":57,"./catalog-signal":60,"./catalog-sorting":61,"@nkmjs/common":27,"@nkmjs/utils":271}],64:[function(t,e,n){var i=function DATA_ID(){_classCallCheck(this,DATA_ID)};_defineProperty(i,"AUTO_RELEASE","autoRelease"),_defineProperty(i,"BOUND","dataBound"),e.exports=i},{}],65:[function(t,e,n){var i=function DATA_SIGNAL(){_classCallCheck(this,DATA_SIGNAL)};_defineProperty(i,"ITEM_REGISTERED",Symbol("itemRegistered")),_defineProperty(i,"ITEM_UNREGISTERED",Symbol("itemUnregistered")),_defineProperty(i,"ITEM_UPDATED",Symbol("itemUpdated")),_defineProperty(i,"META_ADDED",Symbol("metaAdded")),_defineProperty(i,"META_REMOVED",Symbol("metaRemoved")),_defineProperty(i,"META_UPDATED",Symbol("metaUpdated")),_defineProperty(i,"META_MID_UPDATE",Symbol("metaMidUpdate")),_defineProperty(i,"DIRTY",Symbol("dirty")),_defineProperty(i,"DIRTY_CLEARED",Symbol("dirty-cleared")),_defineProperty(i,"VALUE_CHANGED",Symbol("valueChanged")),e.exports=i},{}],66:[function(t,e,n){var i,s=t("@nkmjs/common"),a=s.COM_ID,l=s.SIGNAL,c=s.DisposableObjectEx,u=t("../data-signal"),h=t("./metadata"),d=t("../id/id"),p=function(t){_inherits(DataBlock,t);var e=_createSuper(DataBlock);function DataBlock(){return _classCallCheck(this,DataBlock),e.call(this)}return _createClass(DataBlock,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DataBlock.prototype),"_Init",this).call(this),this._id=null,this._isTemp=!1,this._metadirty=!1,this._isDirty=!1,this._ecosystem=null,this._metadata=new h,this._metadata.owner=this,this._metadata.Watch(u.DIRTY,this.Dirty,this),this._metadata.Watch(u.DIRTY_CLEARED,this._OnMetadataCleaned,this),this._ready=!0}},{key:"ready",get:function get(){return this._ready}},{key:"metadata",get:function get(){return this._metadata}},{key:"uri",get:function get(){"".concat(this._id.name)}},{key:"isDirty",get:function get(){return this._isDirty}},{key:"Dirty",value:function Dirty(){this._isDirty||(this._isDirty=!0,this._Broadcast(u.DIRTY,this))}},{key:"ClearDirty",value:function ClearDirty(){this._isDirty&&(this._isDirty=!1,this._Broadcast(u.DIRTY_CLEARED,this))}},{key:"id",get:function get(){return this._id},set:function set(t){if(this._id!==t){var e=this._id;this._id=t,e&&e.Unwatch(l.RENAMED,this.Dirty,this),t&&t.Watch(l.RENAMED,this.Dirty,this)}}},{key:"name",get:function get(){return this._id?this._id.name:""}},{key:"isTemp",get:function get(){return this._isTemp}},{key:"CommitUpdate",value:function CommitUpdate(){this.Dirty(),this._Broadcast(l.UPDATED,this)}},{key:"Pack",value:function Pack(){return{"!!!warning!!!":"you must re-implement the DataBlock.Pack() method in your data objects !"}}},{key:"Unpack",value:function Unpack(t){}},{key:"_CleanUp",value:function _CleanUp(){this._id&&(this._id.Release(),this._id=null),this._metadata._dirty=!1,this._metadirty=!1,this._isDirty=!1,this._ready=!0,this._isTemp=!1,this._metadata.Clear(),_get(_getPrototypeOf(DataBlock.prototype),"_CleanUp",this).call(this)}},{key:"_OnMetadataCleaned",value:function _OnMetadataCleaned(){}},{key:"toString",value:function toString(){return this._id?"[".concat(this.constructor.name,"::").concat(this._id.name,"]"):"[".concat(this.constructor.name,"::]")}}]),DataBlock}(c);_defineProperty(p,"__NFO__",(_defineProperty(i={},a.ICON,"%ICON%/icon_data_block.svg"),_defineProperty(i,a.UID,"@nkmjs/data-core:data-block"),i)),e.exports=p},{"../data-signal":65,"../id/id":74,"./metadata":69,"@nkmjs/common":27}],67:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").List,c=t("@nkmjs/common"),u=c.SIGNAL,h=c.POOL,d=c.DisposableObjectEx,p=t("../data-signal"),f=t("./data-block"),g=t("./repertoire"),m=function(t){_inherits(DataFactory,t);var e=_createSuper(DataFactory);function DataFactory(){return _classCallCheck(this,DataFactory),e.call(this)}return _createClass(DataFactory,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DataFactory.prototype),"_Init",this).call(this),this._id=null,this._tempItemList=new l(0),this._itemRep=new g,this._itemRep.Watch(p.ITEM_REGISTERED,this._OnItemRegistered,this),this._itemRep.Watch(p.ITEM_UNREGISTERED,this._OnItemUnregistered,this),this._itemClass=null}},{key:"id",get:function get(){return this._id},set:function set(t){_set(_getPrototypeOf(DataFactory.prototype),"_id",t,this,!0)}},{key:"itemClass",get:function get(){return this._itemClass},set:function set(t){if(!s.isInstanceOf(t,f))throw new Error("itemClass must inherit DataBlock");this._itemClass=t}},{key:"itemList",get:function get(){return this._itemRep.itemList}},{key:"count",get:function get(){return this._itemRep.itemList.length}},{key:"IsIDAvailable",value:function IsIDAvailable(t){return this._itemRep.IsIDAvailable(t)}},{key:"CreateTemp",value:function CreateTemp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this._itemClass;if(!s.isVoid(t)){if(!s.isInstanceOf(t,e))throw new Error("CreateTemp custom constructor (".concat(t,") does not extends factory constructor (").concat(this._itemClass.name,")"));e=t}if(s.isVoid(e))throw new Error("Cannot create temp item with no itemClass set.");var n=h.Rent(e);return n._isTemp=!0,this._tempItemList.Add(n),n.Watch(u.RELEASED,this._OnItemReleased,this),n}},{key:"Register",value:function Register(t,e){if(!this._tempItemList.Contains(t))throw new Error("Cannot register an item that hasn't been created by this factory.");return this._tempItemList.Remove(t),t._isTemp=!1,this._itemRep.Register(t,e),t}},{key:"_OnItemRegistered",value:function _OnItemRegistered(t,e){this._Broadcast(p.ITEM_REGISTERED,this,e)}},{key:"Unregister",value:function Unregister(t){this._itemRep.Unregister(t),t.Release()}},{key:"_OnItemUnregistered",value:function _OnItemUnregistered(t,e){this._Broadcast(p.ITEM_UNREGISTERED,this,e)}},{key:"_OnItemReleased",value:function _OnItemReleased(t){this._tempItemList.Remove(t)}},{key:"Get",value:function Get(t){return this._itemRep.Get(t)}},{key:"_CleanUp",value:function _CleanUp(){throw new Error("CleanUp Not implemented in ".concat(this.constructor.name))}}]),DataFactory}(d);e.exports=m},{"../data-signal":65,"./data-block":66,"./repertoire":70,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],68:[function(t,e,n){e.exports={Metadata:t("./metadata"),DataBlock:t("./data-block"),Repertoire:t("./repertoire"),DataFactory:t("./data-factory")}},{"./data-block":66,"./data-factory":67,"./metadata":69,"./repertoire":70}],69:[function(t,e,n){var i,s,a=t("@nkmjs/utils").U,l=t("@nkmjs/common"),c=l.COM_ID,u=l.SIGNAL,h=l.POOL,d=l.DisposableObjectEx,p=t("../data-signal"),f=function(t){_inherits(Metadata,t);var e=_createSuper(Metadata);function Metadata(){var t;return _classCallCheck(this,Metadata),(t=e.call(this))._owner=null,t._data={},t._dirty=!1,t}return _createClass(Metadata,[{key:"owner",get:function get(){return this._owner},set:function set(t){this._owner=t}},{key:"isDirty",get:function get(){return this._isDirty}},{key:"Dirty",value:function Dirty(){this._isDirty||(this._isDirty=!0,this._Broadcast(p.DIRTY,this))}},{key:"ClearDirty",value:function ClearDirty(){this._isDirty&&(this._isDirty=!1,this._Broadcast(p.DIRTY_CLEARED,this))}},{key:"Set",value:function Set(t,e){var n=null;if(Array.isArray(t))n=t;else{if("string"!=typeof t)throw new Error("Path ".concat(t," is invalid."));n=t.split(".")}for(var i=this._data,s=i,l=0,c=n.length,h=c-1,d=!1,f=!1,g=null;l<c;){var m=n[l];if(l===h){var y=s[m];if(a.isVoid(y)&&(f=!0),y===e)return e;d=!0,g=y,s[m]=e,s=e}else i=s[m],a.isVoid(i)&&(i={},s[m]=i),s=i;l++}if(d){f&&this._Broadcast(p.META_ADDED,this,t,s),c-=1;for(var v=0;v<c;v++)this._Broadcast(p.META_MID_UPDATE,this,a.Join(n,".",0,v));this._Broadcast(p.META_UPDATED,this,t,s,g),this._Broadcast(u.UPDATED,this),this.Dirty()}return s}},{key:"Get",value:function Get(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null;if(Array.isArray(t))n=t;else{if(!a.isString(t))throw new Error("Path ".concat(t," is invalid."));n=t.split(".")}var i=null;if(a.isVoid(e)){for(i=this._data;!a.isVoid(i)&&0!=n.length;)i=i[n.shift()];return n.length=0,i}for(var s=i=this._data;0!=n.length;){if(i=s[n.shift()],a.isVoid(i))return n.length=0,this._signals.silent=!0,i=this.Set(t,e),this._signals.silent=!1,i;s=i}return i}},{key:"Clear",value:function Clear(){this._data=a.DeepClear(this._data,!0)}},{key:"Clone",value:function Clone(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return Metadata.Copy(this);if(a.isInstanceOf(t,Metadata))this._data=a.Clone(t._data);else{if(!a.isObject(t))return;this._data=a.Clone(t)}e?this.ClearDirty():this.Dirty()}},{key:"toString",value:function toString(){return"{Metadata}"}}],[{key:"Copy",value:function Copy(t){var e=h.Rent(Metadata);return e._data=a.Clone(t._data),e}}]),Metadata}(d);_defineProperty(f,"__NFO__",(_defineProperty(i={},c.ICON,"%ICON%/icon_data_block.svg"),_defineProperty(i,c.UID,"@nkmjs/data-core:metadata"),i)),e.exports=f},{"../data-signal":65,"@nkmjs/common":27,"@nkmjs/utils":271}],70:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").Dictionary,c=t("@nkmjs/common"),u=c.SIGNAL,h=c.POOL,d=c.DisposableObjectEx,p=t("../id"),f=p.ID,g=p.IDDispenser,m=t("../data-signal"),y=t("./data-block"),v=function(t){_inherits(Repertoire,t);var e=_createSuper(Repertoire);function Repertoire(){return _classCallCheck(this,Repertoire),e.call(this)}return _createClass(Repertoire,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Repertoire.prototype),"_Init",this).call(this),this._idDispenser=new g,this._itemList=new List(0),this._itemMap=new l}},{key:"idDispenser",get:function get(){return this._idDispenser}},{key:"itemList",get:function get(){return this._itemList}},{key:"itemMap",get:function get(){return this._itemMap}},{key:"count",get:function get(){return this._itemList.count}},{key:"IndexOf",value:function IndexOf(t){return this._itemList.IndexOf(t)}},{key:"IsIDAvailable",value:function IsIDAvailable(t){return this._idDispenser.IsAvailable(t)}},{key:"ContainsID",value:function ContainsID(t){return this._idDispenser.ContainsID(t)}},{key:"GetID",value:function GetID(t){return this._idDispenser.Get(t)}},{key:"ReserveID",value:function ReserveID(t){if(!this._idDispenser.IsIDAvailable(t))throw new Error("Cannot create an ID that already exists.");var e=this._idDispenser.Create(t);return e.Watch(u.RELEASED,this._OnIDReleased,this),e.Watch(u.RENAMED,this._OnIDRenamed,this),e}},{key:"_OnIDRenamed",value:function _OnIDRenamed(t,e){this._Broadcast(u.RENAMED,t,e)}},{key:"_OnIDReleased",value:function _OnIDReleased(t){var e=this._itemMap.Get(t);e&&(console.warn("An ID (".concat(t.name,") has been released. Removing existing item from repertoire.")),this.Unregister(e))}},{key:"Register",value:function Register(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(s.isVoid(t))throw new Error("Cannot register a null item.");if(!s.isInstanceOf(t,y))throw new Error("Cannot register a non-DataBlock item.");if(!s.isVoid(t.id))throw new Error("Cannot register an item with an ID already set.");if(this._itemList.Contains(t))throw new Error("Cannot re-register an item.");var n=null;if(s.isVoid(e))n=this.ReserveID(s.unsafeUID);else{var i=e;if(s.isInstanceOf(e,f)){if(this._idDispenser.GetID(e.name)!==e)throw new Error("Cannot register an item with an ID(".concat(e.name,") that hasn't been provided by this repertoire."));if(this._itemMap.Contains(e))throw new Error("ID(".concat(e,") already in use."));i=e}else{if(!s.isString(e))throw new Error("Cannot register an item with an ID that isn't an ID object nor a string.");if(s.isEmpty(e))throw new Error("Cannot use empty string as ID. Use null or undefined instead to generate a random one.");var a=this._idDispenser.Get(e);if(s.isVoid(a))i=this.ReserveID(e);else{if(this._itemMap.Contains(a))throw new Error("ID(".concat(e,") already in use."));i=a}}}this._itemList.Add(t),this._itemMap.Set(n,t),t.id=n,this._OnItemRegistered(t),this._Broadcast(m.ITEM_REGISTERED,this,t)}},{key:"_OnItemRegistered",value:function _OnItemRegistered(t){t.Watch(u.RELEASED,this._OnItemReleased,this)}},{key:"Unregister",value:function Unregister(t){if(s.isVoid(t))throw new Error("Cannot unregister a null item.");var e=t.id;if(s.isVoid(e))throw new Error("Cannot unregister a item with no ID.");if(s.isVoid(this._itemList.Remove(t)))throw new Error("Cannot unregister an item that is not in the repertoire.");this._itemMap.Remove(e),this._OnItemUnregistered(t),this._Broadcast(m.ITEM_UNREGISTERED,this,t),t.id=null,e.Release()}},{key:"_OnItemUnregistered",value:function _OnItemUnregistered(t){t.Unwatch(u.RELEASED,this._OnItemReleased,this)}},{key:"_OnItemReleased",value:function _OnItemReleased(t){this.Unregister(t)}},{key:"Get",value:function Get(t){if(s.isVoid(t))throw new Error("p_id cannot be null or undefined");if(s.isString(t)){var e=this._idDispenser.Get(t);if(s.isVoid(e))return null}else if(!s.isInstanceOf(t,f))throw new Error("p_id must be either of type string or ID.");return this._itemMap.Get(t)}},{key:"At",value:function At(t){return this._itemList.At(t)}},{key:"Clear",value:function Clear(){}},{key:"_CleanUp",value:function _CleanUp(){this.Clear(),_get(_getPrototypeOf(Repertoire.prototype),"_CleanUp",this).call(this)}}]),Repertoire}(d);e.exports=v},{"../data-signal":65,"../id":75,"./data-block":66,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],71:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.COM_ID,c=a.Observer,u=t("../data/data-block"),h=function(t){_inherits(DataObserver,t);var e=_createSuper(DataObserver);function DataObserver(){return _classCallCheck(this,DataObserver),e.call(this)}return _createClass(DataObserver,[{key:"Observe",value:function Observe(t){return _get(_getPrototypeOf(DataObserver.prototype),"Observe",this).call(this,this._ExtractNestedData(t))}},{key:"ObserveOnly",value:function ObserveOnly(t){return _get(_getPrototypeOf(DataObserver.prototype),"ObserveOnly",this).call(this,this._ExtractNestedData(t))}},{key:"Unobserve",value:function Unobserve(t){return _get(_getPrototypeOf(DataObserver.prototype),"Unobserve",this).call(this,this._ExtractNestedData(t))}},{key:"_ExtractNestedData",value:function _ExtractNestedData(t){return t&&!s.isInstanceOf(t,u)&&(t=s.isInstanceOf(t[l.DATA],u)?t[l.DATA]:null),t}}]),DataObserver}(c);e.exports=h},{"../data/data-block":66,"@nkmjs/common":27,"@nkmjs/utils":271}],72:[function(t,e,n){var i=t("../data-signal"),s=t("@nkmjs/common"),a=s.DisposableObjectEx,l=s.Observer,c="ADD",u="REM",h="UPD",d="IPD",p=function(t){_inherits(MetadataObserver,t);var e=_createSuper(MetadataObserver);function MetadataObserver(){return _classCallCheck(this,MetadataObserver),e.call(this)}return _createClass(MetadataObserver,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(MetadataObserver.prototype),"_Init",this).call(this),this._observer=new l,this._observer.Hook(i.META_ADDED,this._OnMetaAdded,this),this._observer.Hook(i.META_REMOVED,this._OnMetaRemoved,this),this._observer.Hook(i.META_UPDATED,this._OnMetaUpdated,this),this._observer.Hook(i.META_MID_UPDATE,this._OnMetaMidUpdate,this)}},{key:"target",get:function get(){return this._observer._target},set:function set(t){this._observer.target=t}},{key:"_GetPrefix",value:function _GetPrefix(t){switch(t){case i.META_ADDED:return c;case i.META_REMOVED:return u;case i.META_UPDATED:return h;case i.META_MID_UPDATE:return d}throw new Error("Cannot hook to a signal that isn't META_ADDED, META_REMOVED or META_UPDATED")}},{key:"Hook",value:function Hook(t,e,n,i){var s="".concat(this._GetPrefix(t),"@").concat(e);this.Watch(s,n,i)}},{key:"Unhook",value:function Unhook(t,e,n,i){var s="".concat(this._GetPrefix(t),"@").concat(e);this.Unwatch(s,n,i)}},{key:"_OnMetaAdded",value:function _OnMetaAdded(t,e,n){var i="".concat(c,"@").concat(e);this._Broadcast(i,t,e,n)}},{key:"_OnMetaRemoved",value:function _OnMetaRemoved(t,e){var n="".concat(u,"@").concat(e);this._Broadcast(n,t,e,p_value,p_oldValue)}},{key:"_OnMetaUpdated",value:function _OnMetaUpdated(t,e,n,i){var s="".concat(h,"@").concat(e);this._Broadcast(s,t,e,n,i)}},{key:"_OnMetaMidUpdate",value:function _OnMetaMidUpdate(t,e){var n="".concat(d,"@").concat(e);this._Broadcast(n,t,e)}},{key:"_CleanUp",value:function _CleanUp(){this.target=null,_get(_getPrototypeOf(MetadataObserver.prototype),"_CleanUp",this).call(this)}}]),MetadataObserver}(a);e.exports=p},{"../data-signal":65,"@nkmjs/common":27}],73:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/collections"),l=a.Dictionary,c=a.List,u=t("@nkmjs/common"),h=u.SIGNAL,d=u.POOL,p=u.DisposableObjectEx,f=t("./id"),g=function(t){_inherits(IDDispenser,t);var e=_createSuper(IDDispenser);function IDDispenser(){return _classCallCheck(this,IDDispenser),e.call(this)}return _createClass(IDDispenser,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(IDDispenser.prototype),"_Init",this).call(this),this._idMap=new l,this._idList=new c}},{key:"idList",get:function get(){return this._idList}},{key:"IsAvailable",value:function IsAvailable(t){return!this._idMap.Contains(t)}},{key:"Contains",value:function Contains(t){if(s.isString(t))return this._idMap.Contains(t);if(s.isInstanceOf(t,f))return this._idList.Contains(t);throw new Error("p_id must be either string or ID.")}},{key:"Get",value:function Get(t){return this._idMap.Get(t)}},{key:"Create",value:function Create(t){if(!this.IsAvailable(t))throw new Error("ID ".concat(t," is not available."));var e=d.Rent(f);return e.name=t,this._idMap.Set(t,e),this._idList.Add(e),e.Watch(h.RENAMING,this._OnIDRenaming,this),e.Watch(h.RENAMED,this._OnIDRenamed,this),e.Watch(h.RELEASED,this._OnIDReleased,this),e}},{key:"Remove",value:function Remove(t){return!!this._idMap.Remove(t.name)&&(t.Release(),this._idList.Remove(t),!0)}},{key:"_OnIDRenaming",value:function _OnIDRenaming(t,e){this._idMap.Contains(e)&&t.PreventRenaming()}},{key:"_OnIDRenamed",value:function _OnIDRenamed(t,e,n){this._idMap.Remove(n),this._idMap.Set(e,t)}},{key:"_OnIDReleased",value:function _OnIDReleased(t){this.Remove(t)}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(IDDispenser.prototype),"_CleanUp",this).call(this)}}]),IDDispenser}(p);e.exports=g},{"./id":74,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],74:[function(t,e,n){var i=t("@nkmjs/common"),s=i.SIGNAL,a=i.POOL,l,c=function(t){_inherits(ID,t);var e=_createSuper(ID);function ID(){return _classCallCheck(this,ID),e.call(this)}return _createClass(ID,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ID.prototype),"_Init",this).call(this),this._renamingPrevented=!1,this._name=""}},{key:"PreventRenaming",value:function PreventRenaming(){this._renamingPrevented=!0}},{key:"name",get:function get(){return this._name},set:function set(t){if(this._name!==t)if(this._Broadcast(s.RENAMING,this,t),this._renamingPrevented)this._renamingPrevented=!1;else{var e=this._name;this._name=t,this._renamingPrevented=!1,this._Broadcast(s.RENAMED,this,e)}}},{key:"_CleanUp",value:function _CleanUp(){this._name="",_get(_getPrototypeOf(ID.prototype),"_CleanUp",this).call(this)}},{key:"toString",value:function toString(){return"[ID::".concat(this.name,"]")}}],[{key:"New",value:function New(t){var e=a.Rent(ID);return e.name=t,e}}]),ID}(i.DisposableObjectEx);e.exports=c},{"@nkmjs/common":27}],75:[function(t,e,n){e.exports={ID:t("./id"),IDDispenser:t("./id-dispenser")}},{"./id":74,"./id-dispenser":73}],76:[function(t,e,n){e.exports={BaseSerializer:t("./serializer-base"),JSONSerializer:t("./serializer-json"),TEXTSerializer:t("./serializer-text"),SERIALIZATION_CONTEXT:t("./serialization-context"),COREJSONSerializers:t("./json")}},{"./json":78,"./serialization-context":80,"./serializer-base":81,"./serializer-json":82,"./serializer-text":83}],77:[function(t,e,n){var i,s=t("@nkmjs/common").BINDINGS,a=t("../../data/data-block"),l=t("../serialization-context"),c=t("../serializer-base"),u="metadata",h="data",d=function(t){_inherits(DataBlockJSONSerializer,t);var e=_createSuper(DataBlockJSONSerializer);function DataBlockJSONSerializer(){return _classCallCheck(this,DataBlockJSONSerializer),e.call(this)}return _createClass(DataBlockJSONSerializer,null,[{key:"Serialize",value:function Serialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t.metadata,i=s.Get(l.JSON,n),a=t.Pack();return a.metadata=i.Serialize(n,e),a}},{key:"Deserialize",value:function Deserialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("Cannot unpack null data.");if(!e)throw new Error("Cannot unpack to null target.");var i=e.metadata,a=s.Get(l.JSON,i);return u in t&&a.Deserialize(t.metadata,i,n),e.Unpack(t),e}}]),DataBlockJSONSerializer}(c);e.exports=d},{"../../data/data-block":66,"../serialization-context":80,"../serializer-base":81,"@nkmjs/common":27}],78:[function(t,e,n){e.exports={MetadataJSONSerializer:t("./metadata-json-serializer"),DataBlockJSONSerializer:t("./data-block-json-serializer")}},{"./data-block-json-serializer":77,"./metadata-json-serializer":79}],79:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("../../data/metadata"),l,c=function(t){_inherits(MetadataJSONSerializer,t);var e=_createSuper(MetadataJSONSerializer);function MetadataJSONSerializer(){return _classCallCheck(this,MetadataJSONSerializer),e.call(this)}return _createClass(MetadataJSONSerializer,null,[{key:"Serialize",value:function Serialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t._data}},{key:"Deserialize",value:function Deserialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("Cannot unpack null data.");if(!e)throw new Error("Cannot unpack metadata with a null target");return s.SetOverwrite(e._data,t),e}}]),MetadataJSONSerializer}(t("../serializer-base"));e.exports=c},{"../../data/metadata":69,"../serializer-base":81,"@nkmjs/utils":271}],80:[function(t,e,n){var i,s=t("@nkmjs/common").CSYMBOL,a=function(t){_inherits(SERIALIZER,t);var e=_createSuper(SERIALIZER);function SERIALIZER(){return _classCallCheck(this,SERIALIZER),e.call(this)}return SERIALIZER}(s),l=function(t){_inherits(NONE,t);var e=_createSuper(NONE);function NONE(){return _classCallCheck(this,NONE),e.call(this)}return NONE}(s),c=function(t){_inherits(TEXT,t);var e=_createSuper(TEXT);function TEXT(){return _classCallCheck(this,TEXT),e.call(this)}return TEXT}(s),u=function(t){_inherits(JSON,t);var e=_createSuper(JSON);function JSON(){return _classCallCheck(this,JSON),e.call(this)}return JSON}(s);_defineProperty(u,"META_KEY","meta"),_defineProperty(u,"DATA_KEY","data"),_defineProperty(u,"ERRORS_KEY","errors"),_defineProperty(u,"CLASS","class"),e.exports={SERIALIZER:a,NONE:l,TEXT:c,JSON:u}},{"@nkmjs/common":27}],81:[function(t,e,n){var i=function(){function BaseSerializer(){_classCallCheck(this,BaseSerializer)}return _createClass(BaseSerializer,null,[{key:"Serialize",value:function Serialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;throw new Error("not implemented")}},{key:"Deserialize",value:function Deserialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;throw new Error("not implemented")}}]),BaseSerializer}();e.exports=i},{}],82:[function(t,e,n){var i=t("@nkmjs/common"),s=i.POOL,a=i.NFOS,l=i.BINDINGS,c=t("../data/data-block"),u=t("./serializer-base"),h=t("./serialization-context"),d=h.JSON,p=function(t){_inherits(JSONSerializer,t);var e=_createSuper(JSONSerializer);function JSONSerializer(){return _classCallCheck(this,JSONSerializer),e.call(this)}return _createClass(JSONSerializer,null,[{key:"Serialize",value:function Serialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=l.Get(h.JSON,t.constructor,null);if(!n)throw new Error("Could not find suitable serializer for target=".concat(t));var i=n.Serialize(t);if(!(d.DATA_KEY in i)){var s={};s[d.DATA_KEY]=i,i=s}var a=null;return d.META_KEY in i?a=i[d.META_KEY]:(a={},i[d.META_KEY]=a),a[d.CLASS]=l.GetClassKey(t.constructor),i}},{key:"Deserialize",value:function Deserialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=null;if(null!=e)i=e.constructor;else{var a=t[d.META_KEY];if(!a)throw new Error("Cannot unserialize without nfos");if(!(i=l.GetClass(a[d.CLASS])))throw new Error("Could not find constructor ".concat(a.instanceOf));e=s.Rent(i)}var c=null;if(!(d.DATA_KEY in t))return e;c=t[d.DATA_KEY];var u=l.Get(h.JSON,i,null);if(!u)throw new Error("Could not find suitable de-serializer for target=".concat(e));return u.Deserialize(c,e,n)}}]),JSONSerializer}(u);e.exports=p},{"../data/data-block":66,"./serialization-context":80,"./serializer-base":81,"@nkmjs/common":27}],83:[function(t,e,n){var i=t("./serializer-json"),s=function(t){_inherits(TEXTSerializer,t);var e=_createSuper(TEXTSerializer);function TEXTSerializer(){return _classCallCheck(this,TEXTSerializer),e.call(this)}return _createClass(TEXTSerializer,null,[{key:"Serialize",value:function Serialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return JSON.stringify(i.Serialize(t,e))}},{key:"Deserialize",value:function Deserialize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return JSON.parse(i.Deserialize(t,e,n))}}]),TEXTSerializer}(i);e.exports=s},{"./serializer-json":82}],84:[function(t,e,n){e.exports={DIALOG:t("./lib/dialog"),DIALOG_SIGNAL:t("./lib/dialog-signal"),DialogInfos:t("./lib/dialog-infos")}},{"./lib/dialog":87,"./lib/dialog-infos":85,"./lib/dialog-signal":86}],85:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.COM_ID,c=a.SIGNAL,u=a.COMMON_FLAG,h=a.DisposableObjectEx,d=a.OptionsHandler,p=t("./dialog-signal"),f=function(t){_inherits(DialogInfos,t);var e=_createSuper(DialogInfos);function DialogInfos(){var t;return _classCallCheck(this,DialogInfos),_defineProperty(_assertThisInitialized(t=e.call(this)),"F",void 0),t}return _createClass(DialogInfos,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DialogInfos.prototype),"_Init",this).call(this),this._actions=new Array(0),this._content=new Array(0),this._optionsHandler=new d,this._optionsHandler.Hook("origin","_origin"),this._optionsHandler.Hook(l.TITLE,"_title"),this._optionsHandler.Hook(l.MESSAGE,"_message"),this._optionsHandler.Hook("type","_type"),this._optionsHandler.Hook("dialogClass","_dialogClass"),this._optionsHandler.Hook("primary","_primary"),this._optionsHandler.Hook("secondary","_secondary"),this._optionsHandler.Hook("content"),this._optionsHandler.Hook("actions"),this._Reset()}},{key:"_Reset",value:function _Reset(){this._origin=null,this._title="",this._message="",this._type="",this._dialogClass=null,this._primary=null,this._secondary=null,this._consumed=!1,this._inputClass=null,this._actions.length=0,this._content.length=0}},{key:"origin",get:function get(){return this._origin},set:function set(t){this._origin=t}},{key:"title",get:function get(){return this._title},set:function set(t){this._title=t}},{key:"message",get:function get(){return this._message},set:function set(t){this._message=t}},{key:"type",get:function get(){return this._type},set:function set(t){this._type=t}},{key:"dialogClass",get:function get(){return this._dialogClass},set:function set(t){this._dialogClass=t}},{key:"primary",get:function get(){return this._primary},set:function set(t){this._primary=t}},{key:"secondary",get:function get(){return this._secondary},set:function set(t){this._secondary=t}},{key:"content",get:function get(){return this._content},set:function set(t){if(this._content!==t)if(t)for(var e=0,n=t.length;e<n;e++)this._content.push(t[e]);else this._content.length=0}},{key:"actions",get:function get(){return this._actions},set:function set(t){if(this._actions!==t)if(t){this._primary=null,this._secondary=null;for(var e=0,n=t.length;e<n;e++){var i=t[e];this._actions.push(i),0===e?this._primary=i:1===e&&(this._secondary=i)}}else this._actions.length=0}},{key:"options",get:function get(){return this._options},set:function set(t){this._options=t,this._optionsHandler.Process(this,t),this._Broadcast(c.UPDATED,this)}},{key:"GetOption",value:function GetOption(t,e){return s.Get(this._options,t,e)}},{key:"Consume",value:function Consume(){this._consumed||(this._consumed=!0,this._Broadcast(p.CONSUMED,this))}},{key:"_CleanUp",value:function _CleanUp(){this._Reset(),_get(_getPrototypeOf(DialogInfos.prototype),"_CleanUp",this).call(this)}},{key:"toString",value:function toString(){return"<? ".concat(this._title," : ").concat(this._message," />")}}]),DialogInfos}(h);e.exports=f},{"./dialog-signal":86,"@nkmjs/common":27,"@nkmjs/utils":271}],86:[function(t,e,n){var i=function DIALOG_SIGNAL(){_classCallCheck(this,DIALOG_SIGNAL)};_defineProperty(i,"CONSUMED",Symbol("consumed")),e.exports=i},{}],87:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/collections"),l=a.List,c=a.Dictionary,u,h=t("@nkmjs/common").POOL,d,p=t("@nkmjs/services").ServiceBase,f=t("@nkmjs/actions"),g=f.ACTION_REQUEST,m=f.Request,y=t("./dialog-infos"),v=function(t){_inherits(DIALOG,t);var e=_createSuper(DIALOG);function DIALOG(){return _classCallCheck(this,DIALOG),e.call(this)}return _createClass(DIALOG,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DIALOG.prototype),"_Init",this).call(this),this._dialogs=new l,this._ownedDialogData=new c,this._Bind(this._ProcessNext),this._inDialog=!1}},{key:"_Start",value:function _Start(){return!!_get(_getPrototypeOf(DIALOG.prototype),"Start",this).call(this)&&(this._ProcessNext(),!0)}},{key:"_Push",value:function _Push(t){var e=null;if(s.isInstanceOf(t,y)?e=t:((e=h.Rent(y)).options=t,this._ownedDialogData.Set(e,!0)),e.origin,!this._dialogs.Add(e))throw Error("DialogInfos already exists in stack. Are you trying to push the same dialogInfo multiple times ?");return this._started&&this._ProcessNext(),e}},{key:"_ProcessNext",value:function _ProcessNext(){if(this._inDialog)return null;var t=this._dialogs.Shift();if(!t)return this._inDialog=!1,null;this._inDialog=!0,t.Watch(y.CONSUMED,this._OnDialogConsumed,this),m.Emit(g.DIALOG,{data:t},this,this._OnRequestSuccess,this._OnRequestFail)}},{key:"_OnRequestFail",value:function _OnRequestFail(t){var e=t.options.infos;throw new Error("Unhandled dialog : ".concat(e))}},{key:"_OnRequestSuccess",value:function _OnRequestSuccess(t){}},{key:"_OnDialogConsumed",value:function _OnDialogConsumed(t){var e=t.data;this._dialogs.Remove(t),t.Release(),this._ownedDialogData.Get(e)&&(this._ownedDialogData.Remove(e),e.Release()),this._inDialog=!1,this._ProcessNext()}}],[{key:"Push",value:function Push(t){this.instance._Push(t)}}]),DIALOG}(p);e.exports=v},{"./dialog-infos":85,"@nkmjs/actions":1,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/services":153,"@nkmjs/utils":271}],88:[function(t,e,n){var i,s=t("@nkmjs/common").BindingKit,a,l=t("@nkmjs/data-core").Metadata,c=t("./lib/document-context"),u,h=t("./lib/documents").MetaDocument,d=function(t){_inherits(Bindings,t);var e=_createSuper(Bindings);function Bindings(){return _classCallCheck(this,Bindings),e.call(this)}return _createClass(Bindings,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Bindings.prototype),"_Init",this).call(this),this.Add({context:c.DOCUMENT,kvps:[{key:l,binding:h}]})}}]),Bindings}(s);e.exports=d},{"./lib/document-context":90,"./lib/documents":94,"@nkmjs/common":27,"@nkmjs/data-core":55}],89:[function(t,e,n){e.exports={DOCUMENTS:t("./lib/documents-manager"),Document:t("./lib/document"),MetaDocument:t("./lib/documents/document-meta")},t("@nkmjs/common").BINDINGS.Expand(t("./bindings"))},{"./bindings":88,"./lib/document":91,"./lib/documents-manager":92,"./lib/documents/document-meta":93,"@nkmjs/common":27}],90:[function(t,e,n){var i=function DOCUMENT(){_classCallCheck(this,DOCUMENT)};e.exports={DOCUMENT:i}},{}],91:[function(t,e,n){var i,s=t("@nkmjs/utils"),a=s.U,l=s.PATH,c=t("@nkmjs/common"),u=c.COM_ID,h=c.NFOS,d=c.BINDINGS,p=c.SIGNAL,f=c.DisposableObjectEx,g=c.Observer,m=c.Callbacks,y=t("@nkmjs/data-core"),v=y.SERIALIZATION_CONTEXT,k=y.DATA_SIGNAL,C=t("@nkmjs/io-core"),O=C.IO_SIGNAL,E=C.ENCODING,S=C.RESOURCES,I=C.Resource,b=C.IO_TYPE,D=function(t){_inherits(Document,t);var e=_createSuper(Document);function Document(){return _classCallCheck(this,Document),e.call(this)}return _createClass(Document,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Document.prototype),"_Init",this).call(this),this._currentPath=null,this._currentRsc=null,this._callbacks=new m,this._resourceObserver=new g,this._resourceObserver.Hook(p.RELEASED,this._OnRscReleased,this),this._resourceObserver.Hook(O.READ_COMPLETE,this._OnReadComplete,this),this._resourceObserver.Hook(O.WRITE_START,this._OnWriteStart,this),this._dataObserver=new g,this._dataObserver.Hook(p.RELEASED,this._OnDataReleased,this),this._dataObserver.Hook(k.DIRTY,this._OnDataDirty,this),this._dataObserver.Hook(k.DIRTY_CLEARED,this._OnDataCleaned,this),this._Bind(this._OnLoadError),this._Bind(this._OnSaveError),this._Bind(this._OnSaveSuccess)}},{key:"currentPath",get:function get(){},set:function set(t){t=l.SHORT(t),this._currentPath!==t&&(this._currentPath=t,!a.isEmpty(t)&&this._currentRsc&&this._currentRsc.path!=t&&(this._currentRsc=null))}},{key:"currentRsc",get:function get(){return this._currentRsc},set:function set(t){if(this._currentRsc!==t){var e=this._currentRsc;this._currentRsc=t,e&&this._resourceObserver.Unobserve(e),t&&(this._resourceObserver.Observe(t),this.currentPath=t.path)}}},{key:"currentData",get:function get(){return this._currentData},set:function set(t){if(this._currentData!==t){var e=this._currentData;this._currentData=t,e&&this._dataObserver.Unobserve(e),t&&(this._dataObserver.Observe(t),t.isDirty?this.Dirty():this.ClearDirty())}else t&&(t.isDirty?this.Dirty():this.ClearDirty())}},{key:"isDirty",get:function get(){return this._isDirty}},{key:"Dirty",value:function Dirty(){this._isDirty||(this._isDirty=!0,this._Broadcast(k.DIRTY,this))}},{key:"ClearDirty",value:function ClearDirty(){this._isDirty&&(this._isDirty=!1,this._Broadcast(k.DIRTY_CLEARED,this))}},{key:"_GetRsc",value:function _GetRsc(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&(this.currentPath=t),!this._currentRsc){if(a.isEmpty(this._currentPath))throw new Error("Empty path.");this.currentRsc=S.Get(this._currentPath,e)}return this._currentRsc}},{key:"_OnRscReleased",value:function _OnRscReleased(t){this.currentRsc=null}},{key:"_OnDataReleased",value:function _OnDataReleased(t){this.data=null}},{key:"_OnDataDirty",value:function _OnDataDirty(t){this.Dirty()}},{key:"_OnDataCleaned",value:function _OnDataCleaned(t){this.ClearDirty()}},{key:"Load",value:function Load(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=h.Get(this),n=this._GetRsc(a.Get(t,"path",null),{cl:e.resource,encoding:e.encoding});if(!n)throw new Error("No resource set.");return!!n.Read({io:a.Get(t,"io",e.defaultIOType),error:this._OnLoadError})&&(this._callbacks.Add(t),!0)}},{key:"_OnLoadError",value:function _OnLoadError(t){t.document=this,this._callbacks.OnErrorFlush(t)}},{key:"_OnReadComplete",value:function _OnReadComplete(t){this.currentData=this._Unpack(t.content,this._currentData),this._callbacks.OnSuccessFlush(this)}},{key:"_Unpack",value:function _Unpack(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=d.Get(v.SERIALIZER,h.Get(this).serializationContext),i=n.Deserialize(t,e,null);return this.Dirty(),i}},{key:"Save",value:function Save(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._currentData)throw new Error("No data.");var e=h.Get(this),n=this._GetRsc(a.Get(t,"path",null),{cl:e.resource,encoding:e.encoding});if(!n)throw new Error("No resource set.");return!!n.Write({io:a.Get(t,"io",e.defaultIOType),error:this._OnSaveError,success:this._OnSaveSuccess})&&(this._callbacks.Add(t),!0)}},{key:"_OnWriteStart",value:function _OnWriteStart(t){t.content=this._Pack(this._currentData)}},{key:"_OnSaveSuccess",value:function _OnSaveSuccess(){this._callbacks.OnSuccessFlush(this)}},{key:"_OnSaveError",value:function _OnSaveError(t){t.document=this,this._callbacks.OnErrorFlush(t)}},{key:"_Pack",value:function _Pack(t){var e;return d.Get(v.SERIALIZER,h.Get(this).serializationContext).Serialize(t,null)}},{key:"Delete",value:function Delete(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}},{key:"_CleanUp",value:function _CleanUp(){this.currentRsc=null,this._currentPath=null,_get(_getPrototypeOf(Document.prototype),"_CleanUp",this).call(this)}}]),Document}(f);_defineProperty(D,"__NFO__",(_defineProperty(i={},u.ICON,"%ICON%/icon_document.svg"),_defineProperty(i,"resource",I),_defineProperty(i,"encoding",E.UTF8),_defineProperty(i,"serializationContext",v.NONE),_defineProperty(i,"defaultIOType",b.DEFAULT),i)),e.exports=D},{"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/io-core":101,"@nkmjs/utils":271}],92:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.BINDINGS,c=a.POOL,u=a.SingletonEx,h,d=t("@nkmjs/data-core").DataBlock,p=t("./document-context"),f=function(t){_inherits(DOCUMENTS,t);var e=_createSuper(DOCUMENTS);function DOCUMENTS(){return _classCallCheck(this,DOCUMENTS),e.call(this)}return _createClass(DOCUMENTS,[{key:"_Init",value:function _Init(){}},{key:"_Get",value:function _Get(t){var e,n,i;if(n=s.Get(t,"data",null),e=s.Get(t,"document",null),i=s.Get(t,"path",null),n&&!e&&(e=l.Get(p.DOCUMENT,n,null)),!e)throw new Error("Not enough options set to create a new document.");return e=c.Rent(e),i&&(e.currentPath=i),n&&(s.isFunc(n)&&(n=c.Rent(n)),e.currentData=n),e}}],[{key:"Get",value:function Get(t){return this.instance._Get(t)}}]),DOCUMENTS}(u);e.exports=f},{"./document-context":90,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/utils":271}],93:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").NFOS,c,u=t("@nkmjs/environment").ENV,h,d=t("@nkmjs/data-core").SERIALIZATION_CONTEXT,p=t("@nkmjs/io-core"),f=p.IO_TYPE,g=p.JSONResource,m=t("../document"),y=function(t){_inherits(MetaDocument,t);var e=_createSuper(MetaDocument);function MetaDocument(){return _classCallCheck(this,MetaDocument),e.call(this)}return _createClass(MetaDocument,[{key:"_CheckOptions",value:function _CheckOptions(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(t=t||{}).io=u.IF_NODE(f.FILE_SYSTEM,f.LOCAL_STORAGE),t}},{key:"Load",value:function Load(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return _get(_getPrototypeOf(MetaDocument.prototype),"Load",this).call(this,this._CheckOptions(t))}},{key:"Save",value:function Save(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return _get(_getPrototypeOf(MetaDocument.prototype),"Save",this).call(this,this._CheckOptions(t))}},{key:"Delete",value:function Delete(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return _get(_getPrototypeOf(MetaDocument.prototype),"Delete",this).call(this,this._CheckOptions(t))}}]),MetaDocument}(m);_defineProperty(y,"__NFO__",l.Ext({resource:g,serializationContext:d.JSON},m.__NFO__)),e.exports=y},{"../document":91,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/environment":95,"@nkmjs/io-core":101,"@nkmjs/utils":271}],94:[function(t,e,n){e.exports={MetaDocument:t("./document-meta")}},{"./document-meta":93}],95:[function(t,e,n){e.exports={ENV_STATE:t("./lib/dom-state"),ENV_DISPLAY:t("./lib/env-display"),ENV_SIGNAL:t("./lib/env-signal"),ENV:t("./lib/environment")}},{"./lib/dom-state":96,"./lib/env-display":97,"./lib/env-signal":98,"./lib/environment":99}],96:[function(t,e,n){var i=function DOM_STATE(){_classCallCheck(this,DOM_STATE)};_defineProperty(i,"NONE","none"),_defineProperty(i,"LOADING","loading"),_defineProperty(i,"INTERACTIVE","interactive"),_defineProperty(i,"COMPLETE","complete"),e.exports=i},{}],97:[function(t,e,n){var i=function ENV_DISPLAY(){_classCallCheck(this,ENV_DISPLAY)};_defineProperty(i,"NONE","none"),_defineProperty(i,"DEFAULT","browser"),_defineProperty(i,"FULLSCREEN","fullscreen"),_defineProperty(i,"MINIMAL","minimal-ui"),_defineProperty(i,"STANDALONE","standalone"),_defineProperty(i,"displayModes",[i.DEFAULT,i.FULLSCREEN,i.MINIMAL,i.STANDALONE]),_defineProperty(i,"COLORSCHEME_DARK","dark"),_defineProperty(i,"COLORSCHEME_LIGHT","light"),_defineProperty(i,"COLORSCHEME_NO_PREFERENCES","no-preferences"),_defineProperty(i,"colorSchemes",[i.COLORSCHEME_DARK,i.COLORSCHEME_LIGHT,i.COLORSCHEME_NO_PREFERENCES]),_defineProperty(i,"MOBILE","mobile"),_defineProperty(i,"TABLET","tablet"),_defineProperty(i,"DESKTOP","desktop"),_defineProperty(i,"displayTypes",[i.DESKTOP,i.TABLET,i.MOBILE]),_defineProperty(i,"displayTypes_width",[1280,1024,760]),e.exports=i},{}],98:[function(t,e,n){var i=function ENV_SIGNAL(){_classCallCheck(this,ENV_SIGNAL)};_defineProperty(i,"START",Symbol("environment-start")),_defineProperty(i,"DOMSTATE_CHANGED",Symbol("displaymode-changed")),_defineProperty(i,"DISPLAY_MODE_CHANGED",Symbol("color-scheme-changed")),_defineProperty(i,"COLOR_SCHEME_CHANGED",Symbol("domstate-changed")),_defineProperty(i,"DISPLAY_TYPE_CHANGED",Symbol("device-changed")),_defineProperty(i,"ONLINE",Symbol("online")),_defineProperty(i,"OFFLINE",Symbol("offline")),e.exports=i},{}],99:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=i.LOG,c,u=t("@nkmjs/collections").List,h=t("@nkmjs/common"),d=h.SingletonEx,p=h.CallList,f=t("@nkmjs/services"),g=f.ServicesManager,m=f.ServiceBase,y=t("./env-signal"),v=t("./helpers/features"),k=t("./dom-state"),C=function(t){_inherits(ENV,t);var e=_createSuper(ENV);function ENV(){return _classCallCheck(this,ENV),e.call(this)}return _createClass(ENV,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ENV.prototype),"_Init",this).call(this),this._features=new v,this._features.Watch(y.ONLINE,this._OnEnvOnline,this),this._features.Watch(y.OFFLINE,this._OnEnvOffline,this),this._app=null,this._config=null,this._started=!1,this._running=!1,this._services=new u,this._Bind(this._BootService),this._onStart=new p}},{key:"features",get:function get(){return this._features}},{key:"app",get:function get(){return this._app}},{key:"paths",get:function get(){return this._config.paths}},{key:"config",get:function get(){return this._config}},{key:"RegisterServices",value:function RegisterServices(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(this._running)return console.warn("RegisterServices called post-Start. Be sure this is intended."),void n.forEach(this._BootService);for(var s=0,a=n.length;s<a;s++)this._services.Add(n[s])}},{key:"Start",value:function Start(t){if(this._started)throw new Error("Cannot ENV.Start more than once.");this._started=!0,l._("ENV : START","#33979b","#212121"),ENV.instance._features.List(),this._config=t;var e=s.Get(this._config,"service_worker",!1);!1!==e?"serviceWorker"in navigator&&navigator.serviceWorker.register(e).then(this._Bind(this._InternalStart)).catch(this._Bind(this._OnServiceWorkerRegistrationError)):this._InternalStart()}},{key:"_OnServiceWorkerRegistrationError",value:function _OnServiceWorkerRegistrationError(t){console.warn("Error whilst registering service worker",t),this._InternalStart()}},{key:"_InternalStart",value:function _InternalStart(){var t=this._config.paths;if(t)for(var e in t)a.SET(e,t[e]);a.SET("%ICON%","img/icons"),a.SET("%PATTERN%","img/patterns");var n=s.Get(this._config,"renderer",null);if(n){l._("ENV : App found (".concat(n.name,")"),"#33979b","#212121");var i=new n;this._app=i}else l._("ENV : App not found","#fff","#980700");if(g.instance.Boot(),this._services.ForEach(this._BootService),this._features.isBrowser)switch(this._features.domState){case k.NONE:case k.LOADING:case k.INTERACTIVE:this._features.Watch(y.DOMSTATE_CHANGED,this._OnDOMStateChanged,this);break;case k.COMPLETE:this._app&&this._app.SetUp(),this._OnStart()}else this._OnStart()}},{key:"_OnDOMStateChanged",value:function _OnDOMStateChanged(t){switch(this._features.domState){case k.LOADING:break;case k.INTERACTIVE:this._app&&this._app.SetUp();break;case k.COMPLETE:this._features.Unwatch(y.DOMSTATE_CHANGED,this._OnDOMStateChanged,this),this._OnStart()}}},{key:"_OnStart",value:function _OnStart(){this._running||(this._running=!0,this._app&&this._app.Start(),this._onStart.NotifyFlush(this),this._Broadcast(y.START,this))}},{key:"_BootService",value:function _BootService(t){if(!s.isInstanceOf(t,m))throw new Error("".concat(t," is not a service."));t.instance.InitializeAndStart()}},{key:"_OnEnvOnline",value:function _OnEnvOnline(){this._Broadcast(y.ONLINE)}},{key:"_OnEnvOffline",value:function _OnEnvOffline(){this._Broadcast(y.OFFLINE)}}],[{key:"FEATURES",get:function get(){return this.instance._features}},{key:"APP",get:function get(){return this.instance._app}},{key:"onStart",value:function onStart(t){this.instance._onStart.Add(t)}},{key:"IF_NODE",value:function IF_NODE(t,e){return this.instance.features.isNodeEnabled?t:e}}]),ENV}(d);e.exports=C},{"./dom-state":96,"./env-signal":98,"./helpers/features":100,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/services":153,"@nkmjs/utils":271}],100:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.LOG,l,c=t("@nkmjs/common").DisposableObjectEx,u=t("../env-display"),h=t("../dom-state"),d=t("../env-signal"),p=function(t){_inherits(Features,t);var e=_createSuper(Features);function Features(){var t;_classCallCheck(this,Features),(t=e.call(this))._isNodeEnabled=!1,t._isBrowser=!1,t._displayType=u.DESKTOP,t._isExtension=!1,t._isMobile=!1,t._isTouchEnabled=!1,t._isOnline=!1,t._context=null,t._hasStorageArea=!1,t._storageArea=null,t._prefersColorScheme=u.COLORSCHEME_NO_PREFERENCES,t._displayMode=u.NONE,t._domState=h.NONE,t._isCORSEnabled=!1,t._Bind(t._OnDisplayModeMdqChange),t._Bind(t._OnColorSchemeMdqChange),t._Bind(t._OnDisplayTypeMdqChange),t._mdqMap=new Map;try{if(t._context=chrome,t._isExtension=!0,!chrome.extension)throw new Error}catch(e){try{if(t._context=browser,t._isExtension=!0,!browser.extension)throw new Error}catch(e){t._isExtension=!1,t._context=null}}try{if(t._storageArea=chrome.storage,t._hasStorageArea=!s.isVoid(t._storageArea),!t._hasStorageArea)throw new Error}catch(e){try{t._storageArea=browser.storage,t._hasStorageArea=!s.isVoid(t._storageArea)}catch(e){t._storageArea=null,t._hasStorageArea=!1}}try{var n=window;t._isBrowser=!0,t._isOnline=navigator.onLine,window.addEventListener("online",t._Bind(t._OnEnvironmentOnline)),window.addEventListener("offline",t._Bind(t._OnEnvironmentOffline)),t._isMobile=/Mobi|Android/i.test(navigator.userAgent),t._isTouchEnabled="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;var i=document.readyState,a=!0;i!==h.COMPLETE&&i!==h.INTERACTIVE||(i===h.COMPLETE&&(t._InitMediaQueries(),a=!1),t.domState=i),a&&document.addEventListener("readystatechange",t._Bind(t._OnDOMStateChange));try{var l=new XMLHttpRequest;s.isVoid(l.withCredentials)?t._isCORSEnabled=!1:t._isCORSEnabled=!0}catch(e){t._isCORSEnabled=!1,console.warn(e)}}catch(e){t._isBrowser=!1}return t}return _createClass(Features,[{key:"isBrowser",get:function get(){return this._isBrowser}},{key:"isOnline",get:function get(){return this._isOnline}},{key:"isTouchEnabled",get:function get(){return this._isTouchEnabled}},{key:"isMobile",get:function get(){return this._isMobile}},{key:"hasStorage",get:function get(){return this._hasStorageArea}},{key:"storageArea",get:function get(){return this._storageArea}},{key:"isExtension",get:function get(){return this._isExtension}},{key:"context",get:function get(){return this._context}},{key:"isCORSEnabled",get:function get(){return this._isCORSEnabled}},{key:"isNodeEnabled",get:function get(){return this._isNodeEnabled}},{key:"domState",get:function get(){return this._domState},set:function set(t){if(this._domState!==t){var e=this._domState;switch(this._domState=t,a._U("domState",this._domState,e,"#f7d801"),this._domState){case h.LOADING:break;case h.INTERACTIVE:this._InitMediaQueries();break;case h.COMPLETE:}this._Broadcast(d.DOMSTATE_CHANGED,this._domState)}}},{key:"_OnDOMStateChange",value:function _OnDOMStateChange(){document.readyState===h.COMPLETE&&document.removeEventListener("DOMContentLoaded",this._OnDOMStateChange),this.domState=document.readyState}},{key:"_InitMediaQueries",value:function _InitMediaQueries(){var t=u.DEFAULT;navigator.standalone&&(t=u.STANDALONE);for(var e=0,n=u.displayModes.length;e<n;e++){var i=u.displayModes[e],s=window.matchMedia("(display-mode: ".concat(i,")"));this._mdqMap.set(i,s),s.matches&&(t=i),s.addEventListener("change",this._OnDisplayModeMdqChange)}this._displayMode=t,t=u.COLORSCHEME_NO_PREFERENCES;for(var a=0,l=u.colorSchemes.length;a<l;a++){var c=u.colorSchemes[a],h=window.matchMedia("(prefers-color-scheme: ".concat(c,")"));this._mdqMap.set(c,h),h.matches&&(t=c),h.addEventListener("change",this._OnColorSchemeMdqChange)}this._prefersColorScheme=t,t=u.DESKTOP;for(var d=0,p=u.displayTypes_width.length;d<p;d++){var f=u.displayTypes[d],g=window.matchMedia("(max-width: ".concat(u.displayTypes_width[d],"px)"));this._mdqMap.set(f,g),g.matches&&(t=f),g.addEventListener("change",this._OnDisplayTypeMdqChange)}this._displayType=t}},{key:"displayMode",get:function get(){return this._displayMode},set:function set(t){if(this._displayMode!==t){var e=this._displayMode;this._displayMode=t,a._U("displayMode",this._displayMode,e,"#f7d801"),this._Broadcast(d.DISPLAY_MODE_CHANGED,this._displayMode,e)}}},{key:"_OnDisplayModeMdqChange",value:function _OnDisplayModeMdqChange(t){this._UpdateMDQ(u.displayModes,"displayMode")}},{key:"prefersColorScheme",get:function get(){return this._prefersColorScheme},set:function set(t){if(this._prefersColorScheme!==t){var e=this._prefersColorScheme;this._prefersColorScheme=t,a._U("prefersColorScheme",this._prefersColorScheme,e,"#f7d801"),this._Broadcast(d.COLOR_SCHEME_CHANGED,this._prefersColorScheme,e)}}},{key:"_OnColorSchemeMdqChange",value:function _OnColorSchemeMdqChange(t){this._UpdateMDQ(u.colorSchemes,"prefersColorScheme")}},{key:"displayType",get:function get(){return this._displayType},set:function set(t){if(this._displayType!==t){var e=this._displayType;this._displayType=t,a._U("device",this._displayType,e,"#f7d801"),this._Broadcast(d.DISPLAY_TYPE_CHANGED,this._displayType,e)}}},{key:"_OnDisplayTypeMdqChange",value:function _OnDisplayTypeMdqChange(t){this._UpdateMDQ(u.displayTypes,"displayType")}},{key:"_UpdateMDQ",value:function _UpdateMDQ(t,e){for(var n=this["_".concat(e)],i=0,s=t.length;i<s;i++){var a=t[i],l;this._mdqMap.get(a).matches&&(n=a)}this[e]=n}},{key:"_OnEnvironmentOnline",value:function _OnEnvironmentOnline(t){console.warn("online yo"),this._isOnline||(this._isOnline=!0,this._Broadcast(d.ONLINE))}},{key:"_OnEnvironmentOffline",value:function _OnEnvironmentOffline(t){this._isOnline&&(this._isOnline=!1,this._Broadcast(d.OFFLINE))}},{key:"List",value:function List(){var t="✔",e="🞫",n="889000",i="d86100",s="#171717";a._("".concat(this._isBrowser?t:e," isBrowser"),"#".concat(this._isBrowser?n:i),s),a._("".concat(this._isMobile?t:e," isMobile"),"#".concat(this._isMobile?n:i),s),a._("".concat(this._isExtension?t:e," isExtension"),"#".concat(this._isExtension?n:i),s),a._("".concat(this._isTouchEnabled?t:e," isToucheEnabled"),"#".concat(this._isTouchEnabled?n:i),s),a._("".concat(this._hasStorageArea?t:e," hasStorageArea"),"#".concat(this._hasStorageArea?n:i),s),a._("".concat(this._isCORSEnabled?t:e," isCORSEnabled"),"#".concat(this._isCORSEnabled?n:i),s),a._("▢ displayMode : ".concat(this._displayMode),"#889000",s),a._("◐ prefersColorScheme : ".concat(this._prefersColorScheme),"#889000",s),a._("⎚ displayType : ".concat(this._displayType),"#889000",s),a._("".concat(this._isNodeEnabled?t:e," isNodeEnabled"),"#".concat(this._isNodeEnabled?"182000":"fff"),"#".concat(this._isNodeEnabled?"7ca500":"980700"))}}]),Features}(c);e.exports=p},{"../dom-state":96,"../env-display":97,"../env-signal":98,"@nkmjs/common":27,"@nkmjs/utils":271}],101:[function(t,e,n){e.exports={ENCODING:t("./lib/encoding"),RESPONSE_TYPE:t("./lib/response-type"),IO_TYPE:t("./lib/io-type"),IO_SIGNAL:t("./lib/io-signal"),RESOURCES:t("./lib/resources-manager"),RESSOURCE_STATE:t("./lib/resource-state"),Resource:t("./lib/resource"),Directory:t("./lib/directory"),IOProcess:t("./lib/io-process"),ResourceOperation:t("./lib/resource-operation"),BinaryResource:t("./lib/resources/resource-binary"),BlobResource:t("./lib/resources/resource-blob"),TextResource:t("./lib/resources/resource-text"),JSONResource:t("./lib/resources/resource-json")}},{"./lib/directory":102,"./lib/encoding":103,"./lib/io-process":104,"./lib/io-signal":115,"./lib/io-type":116,"./lib/resource":119,"./lib/resource-operation":117,"./lib/resource-state":118,"./lib/resources-manager":120,"./lib/resources/resource-binary":121,"./lib/resources/resource-blob":122,"./lib/resources/resource-json":123,"./lib/resources/resource-text":124,"./lib/response-type":125}],102:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").SIGNAL,c,u=t("@nkmjs/collections").List,h,d=function(t){_inherits(Directory,t);var e=_createSuper(Directory);function Directory(){return _classCallCheck(this,Directory),e.call(this)}return _createClass(Directory,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Directory.prototype),"_Init",this).call(this),this._requestRsc=null,this._directories=new u,this._resources=new u}},{key:"isDir",get:function get(){return!0}},{key:"_OnPathUpdated",value:function _OnPathUpdated(t){}},{key:"_Encode",value:function _Encode(){return null}},{key:"_Decode",value:function _Decode(){for(var t=PATH.FULL(this._path),e=0,n=this._raw.length;e<n;e++)var i=this._requestRsc("".concat(t,"/").concat(this._raw[e]))}},{key:"Add",value:function Add(t){var e=!1;(e=t.isDir?this._directories.Add(t):this._resources.Add(t))&&(t.Watch(l.RELEASED,this._OnRscReleased,this),t.directory=this)}},{key:"Remove",value:function Remove(t){var e=!1;(e=t.isDir?this._directories.Remove(t):this._resources.Remove(t))&&(t.directory===this&&(t.directory=null),t.Unwatch(l.RELEASED,this._OnRscReleased,this))}},{key:"ReleaseContent",value:function ReleaseContent(){for(var t=this._resources.internalArray,e=0,n=t.length;e<n;e++)t[t.length-1].Release();for(var i=0,s=(t=this._directories.internalArray).length;i<s;i++){var a=t[t.length-1];a.ReleaseContent(),a.Release()}}},{key:"ReleaseWithContent",value:function ReleaseWithContent(){this.ReleaseContent(),this.Release()}},{key:"_OnRscReleased",value:function _OnRscReleased(t){this.Remove(t)}}]),Directory}(t("./resource"));e.exports=d},{"./resource":119,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],103:[function(t,e,n){var i=function ENCODING(){_classCallCheck(this,ENCODING)};_defineProperty(i,"UTF8","utf8"),_defineProperty(i,"UCS2","ucs2"),_defineProperty(i,"UTF16le","utf16le"),_defineProperty(i,"LATIN1","latin1"),_defineProperty(i,"BINARY","binary"),_defineProperty(i,"BASE64","base64"),_defineProperty(i,"ASCII","ascii"),_defineProperty(i,"HEX","hex"),e.exports=i},{}],104:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=t("@nkmjs/common"),c=l.SIGNAL,u,h=function(t){_inherits(IOProcess,t);var e=_createSuper(IOProcess);function IOProcess(){return _classCallCheck(this,IOProcess),e.call(this)}return _createClass(IOProcess,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(IOProcess.prototype),"_Init",this).call(this),this._operation=null,this._running=!1,this._globalResourceMap=null}},{key:"running",get:function get(){return this._running}},{key:"rsc",get:function get(){return this._operation.rsc}},{key:"encoding",get:function get(){this._operation.rsc.encoding}},{key:"operation",get:function get(){return this._operation},set:function set(t){this._operation=t}},{key:"Validate",value:function Validate(){return!s.isEmpty(this._operation.rsc.path)||(this._OnError(new Error("Resource path is empty.")),!1)}},{key:"Process",value:function Process(){throw new Error("Process not implemented in io-process")}},{key:"_OnStart",value:function _OnStart(){this._running=!0,this._operation.OnStart()}},{key:"_OnProgress",value:function _OnProgress(t){this._operation.OnProgress(t)}},{key:"_OnError",value:function _OnError(t){this._operation.OnError(t),this._OnComplete()}},{key:"_OnSuccess",value:function _OnSuccess(){this._operation.OnSuccess(),this._OnComplete()}},{key:"_OnComplete",value:function _OnComplete(){this._running=!1,this._Broadcast(c.COMPLETE,this),this.Release()}},{key:"_CleanUp",value:function _CleanUp(){this._operation=null,this._running=!1,this._globalResourceMap=null,_get(_getPrototypeOf(IOProcess.prototype),"_CleanUp",this).call(this)}},{key:"toString",value:function toString(){return"[".concat(this.constructor.name,"::").concat(this._operation?this._operation.fullPath:"NO_OPERATION_SET","]")}}]),IOProcess}(l.DisposableObjectEx);e.exports=h},{"@nkmjs/common":27,"@nkmjs/utils":271}],105:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u,h=function(t){_inherits(HTTPIORename,t);var e=_createSuper(HTTPIORename);function HTTPIORename(){return _classCallCheck(this,HTTPIORename),e.call(this)}return _createClass(HTTPIORename,[{key:"Process",value:function Process(){this._OnStart(),this._OnProgress(0),this._OnError(new Error("HTTP delete not supported."))}}]),HTTPIORename}(t("../io-process"));e.exports=h},{"../io-process":104,"@nkmjs/common":27,"@nkmjs/utils":271}],106:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u=t("axios"),h=t("../io-process"),d=t("../encoding"),p=function(t){_inherits(HTTPIOReader,t);var e=_createSuper(HTTPIOReader);function HTTPIOReader(){return _classCallCheck(this,HTTPIOReader),e.call(this)}return _createClass(HTTPIOReader,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(HTTPIOReader.prototype),"_Init",this).call(this),this._Bind(this._OnProgress),this._Bind(this._OnRequestSuccess),this._Bind(this._OnError)}},{key:"Process",value:function Process(){this._OnStart();var t={onDownloadProgress:this._OnProgress,responseType:this.rsc.type};this.rsc.mime&&(t.headers={"Content-Type":this.rsc.mime}),_get(_getPrototypeOf(HTTPIOReader.prototype),"_OnProgress",this).call(this,0),u.get(this._operation.fullPath,t).then(this._OnRequestSuccess).catch(this._OnError)}},{key:"_OnProgress",value:function _OnProgress(t){var e=t.lengthComputable?t.total:t.target.getResponseHeader("content-length")||t.target.getResponseHeader("x-decompressed-content-length");console.log("onDownloadProgress",t.loaded,e);var n=1;null!==e&&(n=t.loaded/e),_get(_getPrototypeOf(HTTPIOReader.prototype),"_OnProgress",this).call(this,n)}},{key:"_OnRequestSuccess",value:function _OnRequestSuccess(t){this.rsc.raw=t.data,this._OnSuccess()}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(HTTPIOReader.prototype),"_CleanUp",this).call(this)}}]),HTTPIOReader}(h);e.exports=p},{"../encoding":103,"../io-process":104,"@nkmjs/common":27,"@nkmjs/utils":271,axios:126}],107:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u,h=function(t){_inherits(HTTPIORename,t);var e=_createSuper(HTTPIORename);function HTTPIORename(){return _classCallCheck(this,HTTPIORename),e.call(this)}return _createClass(HTTPIORename,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(HTTPIORename.prototype),"_Init",this).call(this),this._targetPath=null}},{key:"targetPath",get:function get(){return this._targetPath},set:function set(t){this._targetPath=a.FULL(t)}},{key:"Validate",value:function Validate(){if(!_get(_getPrototypeOf(HTTPIORename.prototype),"Validate",this).call(this))return!1;var t=this._resources.Get(a.SHORT(this._targetPath));return!t||t==this.rsc||(this._OnError(new Error("Cannot rename resource from '".concat(this.rsc.path,"' to '").concat(this._targetPath,"' : destination already exists"))),!1)}},{key:"Process",value:function Process(){this._OnStart(),this._OnProgress(0),this._OnError(new Error("HTTP rename not supported."))}},{key:"_CleanUp",value:function _CleanUp(){this._targetPath=null,_get(_getPrototypeOf(HTTPIORename.prototype),"_CleanUp",this).call(this)}}]),HTTPIORename}(t("../io-process"));e.exports=h},{"../io-process":104,"@nkmjs/common":27,"@nkmjs/utils":271}],108:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=i.MIME,c,u=t("@nkmjs/common").SIGNAL,h=t("../io-process"),d=t("../resources/resource-blob"),p=function(t){_inherits(HTTPIOWriter,t);var e=_createSuper(HTTPIOWriter);function HTTPIOWriter(){return _classCallCheck(this,HTTPIOWriter),e.call(this)}return _createClass(HTTPIOWriter,[{key:"Process",value:function Process(){this._OnStart(),this._OnProgress(0);try{var t=HTTPIOWriter.dlLink;t.download="".concat(a.name(this._operation.fullPath)).concat(ext),t.href=window.URL.createObjectURL(s.isInstanceOf(this.rsc.content,Blob)?this.rsc.content:new Blob([this.rsc.content],{type:"".concat(this.rsc.mime?this.rsc.mime.type:"text/plain")})),t.click(),this._OnSuccess()}catch(t){this._OnError(t)}}}],[{key:"dlLink",get:function get(){return this.__a||(this.__a=document.createElement("a"),this.__a.style.display="none"),this.__a}}]),HTTPIOWriter}(h);e.exports=p},{"../io-process":104,"../resources/resource-blob":122,"@nkmjs/common":27,"@nkmjs/utils":271}],109:[function(t,e,n){e.exports={HTTPIOReader:t("./http-io-reader"),HTTPIOWriter:t("./http-io-writer"),HTTPIORename:t("./http-io-rename"),HTTPIODelete:t("./http-io-delete"),StorageIOReader:t("./storage-io-reader"),StorageIOWriter:t("./storage-io-writer"),StorageIORename:t("./storage-io-rename"),StorageIODelete:t("./storage-io-delete")}},{"./http-io-delete":105,"./http-io-reader":106,"./http-io-rename":107,"./http-io-writer":108,"./storage-io-delete":110,"./storage-io-reader":111,"./storage-io-rename":112,"./storage-io-writer":113}],110:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u,h=t("@nkmjs/environment").ENV,d=t("axios"),p=t("../io-process"),f=t("../encoding"),g=function(t){_inherits(StorageIODelete,t);var e=_createSuper(StorageIODelete);function StorageIODelete(){return _classCallCheck(this,StorageIODelete),e.call(this)}return _createClass(StorageIODelete,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(StorageIODelete.prototype),"_Init",this).call(this),this._Bind(this._OnStorageRemoved)}},{key:"Process",value:function Process(){var t;if(this._OnStart(),this._OnProgress(0),h.FEATURES.hasStorage)h.FEATURES.storageArea.sync.remove(this._operation.fullPath,this._OnStorageRemoved);else try{localStorage.removeItem(this._operation.fullPath),this._OnProgress(1),this._OnSuccess()}catch(t){this._OnError(new Error("Key '".concat(this._operation.fullPath,"' is not set.")))}}},{key:"_OnStorageRemoved",value:function _OnStorageRemoved(t){this._OnProgress(1),this._OnSuccess()}}]),StorageIODelete}(p);e.exports=g},{"../encoding":103,"../io-process":104,"@nkmjs/common":27,"@nkmjs/environment":95,"@nkmjs/utils":271,axios:126}],111:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u,h=t("@nkmjs/environment").ENV,d=t("axios"),p=t("../io-process"),f=t("../encoding"),g=function(t){_inherits(StorageIOReader,t);var e=_createSuper(StorageIOReader);function StorageIOReader(){return _classCallCheck(this,StorageIOReader),e.call(this)}return _createClass(StorageIOReader,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(StorageIOReader.prototype),"_Init",this).call(this),this._Bind(this._OnStorageRead)}},{key:"Process",value:function Process(){if(this._OnStart(),this._OnProgress(0),h.FEATURES.hasStorage){var t;h.FEATURES.storageArea.sync.get(this._operation.fullPath,this._OnStorageRead)}else{var e=localStorage.getItem(this._operation.fullPath);e?(this._OnProgress(1),this.rsc.raw=e,this._OnSuccess()):this._OnError(new Error("Key '".concat(this._operation.fullPath,"' is not set.")))}}},{key:"_OnStorageRead",value:function _OnStorageRead(t){var e=p_data[this._operation.fullPath];s.isVoid(e)?this._OnError(new Error("Key '".concat(this._operation.fullPath,"' is not set."))):(this._OnProgress(1),this.rsc.raw=e,this._OnSuccess())}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(StorageIOReader.prototype),"_CleanUp",this).call(this)}}]),StorageIOReader}(p);e.exports=g},{"../encoding":103,"../io-process":104,"@nkmjs/common":27,"@nkmjs/environment":95,"@nkmjs/utils":271,axios:126}],112:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u,h=t("@nkmjs/environment").ENV,d,p=function(t){_inherits(StorageIORename,t);var e=_createSuper(StorageIORename);function StorageIORename(){return _classCallCheck(this,StorageIORename),e.call(this)}return _createClass(StorageIORename,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(StorageIORename.prototype),"_Init",this).call(this),this._targetPath=null,this._oldPath=null}},{key:"targetPath",get:function get(){return this._targetPath},set:function set(t){this._targetPath=t}},{key:"Validate",value:function Validate(){if(!_get(_getPrototypeOf(StorageIORename.prototype),"Validate",this).call(this))return!1;var t=this._resources.Get(a.SHORT(this._targetPath));return!t||t==this.rsc||(this._OnError(new Error("Cannot rename resource from '".concat(this._operation.fullPath,"' to '").concat(this._targetPath,"' : destination already exists"))),!1)}},{key:"Process",value:function Process(){var t,e;(this._OnStart(),this._OnProgress(0),this._oldPath=this._operation.fullPath,h.FEATURES.hasStorage)?h.FEATURES.storageArea.sync.get(this._targetPath,this._OnRenameExistsCheck):localStorage.getItem(this._targetPath)?this._OnError(new Error("Can't rename '".concat(this._oldPath,"' to '").concat(this._targetPath,"' : data is already present."))):(localStorage.setItem(this._targetPath,localStorage.getItem(this._oldPath)),localStorage.removeItem(this._oldPath),this._OnProgress(1),this._UpdatePath(this._targetPath),this._OnSuccess())}},{key:"_OnRenameExistsCheck",value:function _OnRenameExistsCheck(t){var e=t[this._oldPath];if(s.isVoid(e)){var n=h.FEATURES.storageArea,i={};i[this._targetPath]=e,n.sync.set(i,this._OnRenameStorageWritten)}else this._OnError(new Error("Can't rename '".concat(this._oldPath,"' to '").concat(this._targetPath,"' : data is already present.")))}},{key:"_OnRenameStorageWritten",value:function _OnRenameStorageWritten(t){t?(this._OnProgress(.5),storage.sync.remove(this._oldPath,this._OnRenameStorageOldDeleted)):this._OnError(runtime.lastError)}},{key:"_OnRenameStorageOldDeleted",value:function _OnRenameStorageOldDeleted(t){t?(this._OnProgress(1),this._UpdatePath(this._targetPath),this._OnSuccess()):this._OnError(runtime.lastError)}},{key:"_CleanUp",value:function _CleanUp(){this._targetPath=null,this._oldPath=null,_get(_getPrototypeOf(StorageIORename.prototype),"_CleanUp",this).call(this)}}]),StorageIORename}(t("../io-process"));e.exports=p},{"../io-process":104,"@nkmjs/common":27,"@nkmjs/environment":95,"@nkmjs/utils":271}],113:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=i.MIME,c,u=t("@nkmjs/common").SIGNAL,h,d=t("@nkmjs/environment").ENV,p,f=function(t){_inherits(StorageIOWriter,t);var e=_createSuper(StorageIOWriter);function StorageIOWriter(){return _classCallCheck(this,StorageIOWriter),e.call(this)}return _createClass(StorageIOWriter,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(StorageIOWriter.prototype),"_Init",this).call(this)}},{key:"Process",value:function Process(){if(this._OnStart(),this._OnProgress(0),d.FEATURES.hasStorage){var t=d.FEATURES.storageArea,e={};e[this._operation.fullPath]=this.rsc.raw,t.sync.set(e,this._OnStorageWritten)}else this._OnProgress(1),localStorage.setItem(this._operation.fullPath,this.rsc.raw),this._OnSuccess()}},{key:"_OnStorageWritten",value:function _OnStorageWritten(t){t?(this._OnProgress(1),this._OnSuccess()):this._OnError(runtime.lastError)}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(StorageIOWriter.prototype),"_CleanUp",this).call(this)}}]),StorageIOWriter}(t("../io-process"));e.exports=f},{"../io-process":104,"@nkmjs/common":27,"@nkmjs/environment":95,"@nkmjs/utils":271}],114:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=t("@nkmjs/common"),c=l.SIGNAL,u=l.Observer,h=l.DisposableObjectEx,d,p=t("@nkmjs/collections").List,f=function(t){_inherits(IOQueue,t);var e=_createSuper(IOQueue);function IOQueue(){return _classCallCheck(this,IOQueue),e.call(this)}return _createClass(IOQueue,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(IOQueue.prototype),"_Init",this).call(this),this._queue=new p,this._currentItem=null,this._running=!1,this._itemObserver=new u,this._itemObserver.Hook(c.FAIL,this._OnCurrentRscProcessingFailed,this),this._itemObserver.Hook(c.COMPLETE,this._OnCurrentRscProcessingComplete,this)}},{key:"running",get:function get(){return this._running}},{key:"isEmpty",get:function get(){return this._queue.isEmpty}},{key:"currentItem",get:function get(){return this._currentItem},set:function set(t){if(this._currentItem!==t){var e=this._currentItem;this._currentItem=t,e&&this._itemObserver.Unobserve(e),t&&this._itemObserver.Observe(t)}}},{key:"Add",value:function Add(t){t!==this._currentItem&&this._queue.Add(t)}},{key:"Remove",value:function Remove(t){t!==this._currentItem&&this._queue.Remove(t)}},{key:"ProcessNext",value:function ProcessNext(){this._running||(this._running=!0,this._currentItem=this._queue.Shift(),this._currentItem?(this._currentItem.Watch(c.COMPLETE,this._OnCurrentItemComplete,this),this._currentItem.Validate()&&this._currentItem.Process()):this._running=!1)}},{key:"_OnCurrentItemComplete",value:function _OnCurrentItemComplete(t){this._running=!1,this.ProcessNext()}},{key:"_CleanUp",value:function _CleanUp(){this._queue.Clear(),_get(_getPrototypeOf(IOQueue.prototype),"_CleanUp",this).call(this)}}]),IOQueue}(h);e.exports=f},{"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],115:[function(t,e,n){var i=function IO_SIGNAL(){_classCallCheck(this,IO_SIGNAL)};_defineProperty(i,"RSC_REGISTERED",Symbol("rscRegistered")),_defineProperty(i,"RSC_UNREGISTERED",Symbol("rscUnregistered")),_defineProperty(i,"READ_START",Symbol("readStart")),_defineProperty(i,"READ_ERROR",Symbol("readError")),_defineProperty(i,"READ_PROGRESS",Symbol("readProgress")),_defineProperty(i,"READ_COMPLETE",Symbol("readComplete")),_defineProperty(i,"WRITE_STAR",Symbol("writeStart")),_defineProperty(i,"WRITE_ERROR",Symbol("writeError")),_defineProperty(i,"WRITE_PROGRESS",Symbol("writeProgress")),_defineProperty(i,"WRITE_COMPLETE",Symbol("writeComplete")),_defineProperty(i,"RENAME_START",Symbol("renameStart")),_defineProperty(i,"RENAME_ERROR",Symbol("renameError")),_defineProperty(i,"RENAME_PROGRESS",Symbol("renameProgress")),_defineProperty(i,"RENAME_COMPLETE",Symbol("renameComplete")),_defineProperty(i,"DELETE_START",Symbol("deleteStart")),_defineProperty(i,"DELETE_ERROR",Symbol("deleteError")),_defineProperty(i,"DELETE_PROGRESS",Symbol("deleteProgress")),_defineProperty(i,"DELETE_COMPLETE",Symbol("deleteComplete")),_defineProperty(i,"RENAMED",Symbol("renamed")),e.exports=i},{}],116:[function(t,e,n){var i=function IO_TYPE(){_classCallCheck(this,IO_TYPE)};_defineProperty(i,"DEFAULT","default"),_defineProperty(i,"REMOTE","remote"),_defineProperty(i,"LOCAL_STORAGE","local-storage"),_defineProperty(i,"FILE_SYSTEM","file-system"),e.exports=i},{}],117:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=t("@nkmjs/common"),c=l.SIGNAL,u=l.DisposableObjectEx,h=l.SignalBox,d=l.Callbacks,p=function(t){_inherits(ResourceOperation,t);var e=_createSuper(ResourceOperation);function ResourceOperation(){return _classCallCheck(this,ResourceOperation),e.call(this)}return _createClass(ResourceOperation,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ResourceOperation.prototype),"_Init",this).call(this),this._callbacks=new d,this._originalState=null,this._ioType=null,this._cancelled=!1,this._fullPath=null,this._Reset()}},{key:"rsc",get:function get(){return this._rsc},set:function set(t){s.isVoid(t)&&(t=this),this._rsc=t}},{key:"ioType",get:function get(){return this._ioType}},{key:"fullPath",get:function get(){return this._fullPath}},{key:"_Reset",value:function _Reset(){this._rsc=null,this._originalState=null,this._callbacks.Clear(),this._states=null,this._ioType=null,this._fullPath=null}},{key:"Prepare",value:function Prepare(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];this._cancelled=!1,this._rsc=t,this._fullPath=a.FULL(t.path),this._ioType=s.Get(i,"io",null),this._callbacks.Add(i),this._states=n,this._originalState=this._rsc._state.currentState,this._rsc._state.currentState=this._states.prepare.state,l.unshift(this),e.apply(null,l)}},{key:"Cancel",value:function Cancel(){this._cancelled=!0,this._rsc._state.currentState=this._originalState,this.OnEnd()}},{key:"OnStart",value:function OnStart(){this._rsc._state.currentState=this._states.start,this._rsc._Broadcast(this._states.start.evt,this._rsc),this._states.start.fn&&this._states.start.fn()}},{key:"OnError",value:function OnError(t){this._states.error.fn&&this._states.error.fn(),this._rsc._state.currentState=this._states.error.state,t.rsc=this._rsc,this._callbacks.OnErrorFlush(t),this._rsc._Broadcast(this._states.error.evt,this._rsc,t),this.OnEnd()}},{key:"OnProgress",value:function OnProgress(t){this._states.progress.fn&&this._states.progress.fn(),this._rsc._state.currentState=this._states.progress.state,this._rsc._Broadcast(this._states.progress.evt,this._rsc,t)}},{key:"OnSuccess",value:function OnSuccess(){this._states.success.fn&&this._states.success.fn(),this._rsc._state.currentState=this._states.success.state,this._callbacks.OnSuccessFlush(this._rsc),this._rsc._Broadcast(this._states.success.evt,this._rsc),this.OnEnd()}},{key:"OnEnd",value:function OnEnd(){this._rsc._operation===this&&(this._rsc._operation=null),this.Release()}},{key:"_CleanUp",value:function _CleanUp(){this._Reset(),_get(_getPrototypeOf(ResourceOperation.prototype),"_CleanUp",this).call(this)}}]),ResourceOperation}(u);e.exports=p},{"@nkmjs/common":27,"@nkmjs/utils":271}],118:[function(t,e,n){var i,s,a=function(t){_inherits(RESSOURCE_STATE,t);var e=_createSuper(RESSOURCE_STATE);function RESSOURCE_STATE(){return _classCallCheck(this,RESSOURCE_STATE),e.call(this)}return _createClass(RESSOURCE_STATE,null,[{key:"NONE",get:function get(){return RESSOURCE_STATE.GetOrCreate("none")}},{key:"READ_PENDING",get:function get(){return RESSOURCE_STATE.GetOrCreate("read-pending")}},{key:"READING",get:function get(){return RESSOURCE_STATE.GetOrCreate("reading")}},{key:"WRITE_PENDING",get:function get(){return RESSOURCE_STATE.GetOrCreate("write-pending")}},{key:"WRITING",get:function get(){return RESSOURCE_STATE.GetOrCreate("writing")}},{key:"RENAME_PENDING",get:function get(){return RESSOURCE_STATE.GetOrCreate("rename-pending")}},{key:"RENAMING",get:function get(){return RESSOURCE_STATE.GetOrCreate("renaming")}},{key:"DELETE_PENDING",get:function get(){return RESSOURCE_STATE.GetOrCreate("delete-pending")}},{key:"DELETING",get:function get(){return RESSOURCE_STATE.GetOrCreate("deleting")}},{key:"READY",get:function get(){return RESSOURCE_STATE.GetOrCreate("ready")}}]),RESSOURCE_STATE}(t("@nkmjs/common").StateBase);e.exports=a},{"@nkmjs/common":27}],119:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=i.MIME,c=t("@nkmjs/common"),u=c.SIGNAL,h=c.POOL,d=c.DisposableObjectEx,p=c.StateMachine,f=c.DisposableObject,g=c.Callbacks,m=t("./io-signal.js"),y=t("./resource-state"),v=t("./resource-operation"),k=t("./response-type.js"),C=function(t){_inherits(Resource,t);var e=_createSuper(Resource);function Resource(){return _classCallCheck(this,Resource),e.call(this)}return _createClass(Resource,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Resource.prototype),"_Init",this).call(this),this._name=null,this._path=null,this._mime=null,this._type=this.constructor.defaultType,this._encoding=null,this._stats=null,this._exists=!1,this._loaded=!1,this._raw=null,this._content=null,this._directory=null,this._readFn=null,this._writeFn=null,this._deleteFn=null,this._renameFn=null,this._commitRnFn=null,this._deserializeFn=null,this._serializeFn=null,this._state=new p,this._state.currentState=y.NONE,this._state.owner=this,this._operation=null,this._releaseOnDeleteSuccess=!1,this._readOperationConfig={prepare:{state:y.READ_PENDING},start:{state:y.READING,evt:m.READ_START},progress:{state:y.READING,evt:m.READ_PROGRESS},error:{state:y.NONE,evt:m.READ_ERROR},success:{state:y.READY,evt:m.READ_COMPLETE,fn:this._Bind(this._OnReadSuccess)}},this._writeOperationConfig={prepare:{state:y.WRITE_PENDING},start:{state:y.WRITING,evt:m.WRITE_START,fn:this._Bind(this._OnWriteStart)},progress:{state:y.WRITING,evt:m.WRITE_PROGRESS},error:{state:y.NONE,evt:m.WRITE_ERROR},success:{state:y.READY,evt:m.WRITE_COMPLETE}},this._renameOperationConfig={prepare:{state:y.RENAME_PENDING},start:{state:y.RENAMING,evt:m.RENAME_START},progress:{state:y.RENAMING,evt:m.RENAME_PROGRESS},error:{state:y.NONE,evt:m.RENAME_ERROR},success:{state:y.READY,evt:m.RENAME_COMPLETE}},this._deleteOperationConfig={prepare:{state:y.DELETE_PENDING},start:{state:y.DELETING,evt:m.DELETE_START},progress:{state:y.DELETING,evt:m.DELETE_PROGRESS},error:{state:y.NONE,evt:m.DELETE_ERROR},success:{state:y.READY,evt:m.DELETE_COMPLETE,fn:this._Bind(this._OnDeleteSuccess)}}}},{key:"loaded",get:function get(){return this._loaded}},{key:"directory",get:function get(){return this._directory},set:function set(t){if(this._directory!==t){var e=this._directory;this._directory=t,this._OnDirectoryChanged(e)}}},{key:"_OnDirectoryChanged",value:function _OnDirectoryChanged(t){t&&t.Remove(this),this._directory&&this._directory.Add(this)}},{key:"isDir",get:function get(){return!1}},{key:"name",get:function get(){return this._name}},{key:"path",get:function get(){return this._path},set:function set(t){if(this._path)throw new Error("Attempting to change the already set path of an rsc. Use Rename instead.");this._path=t,this._UpdatePathInfos()}},{key:"mime",get:function get(){return this._mime},set:function set(t){this._mime=t}},{key:"type",get:function get(){return this._type},set:function set(t){this._type=t}},{key:"encoding",get:function get(){return this._encoding},set:function set(t){this._encoding=t}},{key:"state",get:function get(){return this._state.currentState}},{key:"stats",get:function get(){return this._stats},set:function set(t){this._stats=t}},{key:"exists",get:function get(){return this._exists},set:function set(t){this._exists=t}},{key:"_UpdatePath",value:function _UpdatePath(t){var e=this._path;this._path=t,this._UpdatePathInfos(),this._commitRnFn(this,e),this._OnPathUpdated(e),this._Broadcast(m.RENAMED,this,e)}},{key:"_OnPathUpdated",value:function _OnPathUpdated(t){}},{key:"_UpdatePathInfos",value:function _UpdatePathInfos(){try{this._name=a.name(new URL(a.FULL(this._path)).pathname)}catch(t){this._name=a.name(this._path)}this._mime||(this._mime=l.Get(a.ext(this._path)))}},{key:"raw",get:function get(){return this._raw},set:function set(t){this._raw=t}},{key:"content",get:function get(){return this._content},set:function set(t){this._content=t}},{key:"_PrepareOperation",value:function _PrepareOperation(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._state.IsNotAny(y.NONE,y.READY))return console.warn("Resource ".concat(this," not in a state allowing operation")),!1;this._operation=h.Rent(v);for(var i=arguments.length,s=new Array(i>3?i-3:0),a=3;a<i;a++)s[a-3]=arguments[a];return this._operation.Prepare(this,t,e,n,s),!0}},{key:"CancelOperation",value:function CancelOperation(){this._operation&&this._operation.Cancel()}},{key:"Read",value:function Read(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._PrepareOperation(this._readFn,this._readOperationConfig,t)}},{key:"_OnReadSuccess",value:function _OnReadSuccess(){this._loaded=!0,this._content=this._Decode()}},{key:"_Decode",value:function _Decode(){if(!this._deserializeFn)throw new Error("Deserialize not implemented in resource. If you don't use a serializer, make sure to set Resource._deserializeFn.");return this._deserializeFn(this._raw,this)}},{key:"Write",value:function Write(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._PrepareOperation(this._writeFn,this._writeOperationConfig,t)}},{key:"_OnWriteStart",value:function _OnWriteStart(){this._raw=this._Encode()}},{key:"_Encode",value:function _Encode(){if(!this._serializeFn)throw new Error("Serialize not implemented in resource. If you don't use a serializer, make sure to set Resource._serializeFn.");return this._serializeFn(this._content,this)}},{key:"Rename",value:function Rename(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._PrepareOperation(this._renameFn,this._renameOperationConfig,e,t)}},{key:"Delete",value:function Delete(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._PrepareOperation(this._deleteFn,this._deleteOperationConfig,t)}},{key:"DeleteAndRelease",value:function DeleteAndRelease(){return this._releaseOnDeleteSuccess=!0,this._PrepareOperation(this._deleteFn,this._deleteOperationConfig,p_options)}},{key:"_OnDeleteSuccess",value:function _OnDeleteSuccess(){s.isInstanceOf(this._content,f)&&this._content.Release(),this._content=null,this._raw=null,this._loaded=!1,this._releaseOnDeleteSuccess&&this.Release()}},{key:"_CleanUp",value:function _CleanUp(){this._operation&&this.CancelOperation(),this._operation=null,this._name=null,this._path=null,this._mime=null,this._type=this.constructor.defaultType,this._encoding=null,this._stats=null,this._exists=!1,this._loaded=!1,this._raw=null,this._content=null,this._readFn=null,this._writeFn=null,this._readFn=null,this._writeFn=null,this._deleteFn=null,this._renameFn=null,this._commitRnFn=null,this._deserializeFn=null,this._serializeFn=null,this._releaseOnDeleteSuccess=!1,this._state.currentState=y.NONE,_get(_getPrototypeOf(Resource.prototype),"_CleanUp",this).call(this)}},{key:"toString",value:function toString(){return"[".concat(this.constructor.name,"::").concat(this.path,"]")}}]),Resource}(d);_defineProperty(C,"defaultType",k.TEXT),e.exports=C},{"./io-signal.js":115,"./resource-operation":117,"./resource-state":118,"./response-type.js":125,"@nkmjs/common":27,"@nkmjs/utils":271}],120:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=t("@nkmjs/common"),c=l.SIGNAL,u=l.POOL,h,d=t("@nkmjs/collections").Dictionary,p,f=t("@nkmjs/services").ServiceBase,g=t("./io-signal"),m=t("./encoding"),y=t("./response-type"),v=t("./resource"),k=t("./directory"),C=t("./io-queue"),O=t("./io-processes"),E=O.StorageIOReader,S=O.StorageIOWriter,I=O.StorageIORename,b=O.StorageIODelete,D=O.HTTPIOReader,A=O.HTTPIOWriter,P=O.HTTPIORename,R=O.HTTPIODelete,T=t("./io-type"),x=t("./resource-operation"),w=t("./io-process"),L=function(t){_inherits(RESOURCES,t);var e=_createSuper(RESOURCES);function RESOURCES(){return _classCallCheck(this,RESOURCES),e.call(this)}return _createClass(RESOURCES,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(RESOURCES.prototype),"_Init",this).call(this),this._resources=new d,this._IOStatCheck=this._GetStats,this._io={},this._io[T.DEFAULT]={read:D,write:A,rename:P,delete:R},this._io[T.REMOTE]={read:D,write:A,rename:P,delete:R},this._io[T.LOCAL_STORAGE]={read:E,write:S,rename:I,delete:b},this._IOQueue=new C,this._Bind(this._RequestRead),this._Bind(this._RequestWrite),this._Bind(this._RequestDelete),this._Bind(this._RequestRename),this._Bind(this._CommitRename),this._Bind(this._RequestRsc)}},{key:"_GetStats",value:function _GetStats(t,e){return null}},{key:"_TryGet",value:function _TryGet(t){return this._resources.Get(a.SHORT(t))}},{key:"_Get",value:function _Get(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=a.SHORT(t),i=this._resources.Get(n);if(i){if(l&&!s.isInstanceOf(i,l))throw new Error("Attempting to get an existing resource (".concat(i.constructor.name,") with a mismatching type(").concat(l.name,")"));return i}var l=s.Get(e,"cl",null),c=null,h=a.FULL(t);try{c=this._GetStats(h)}catch(t){c=null}if(c)if(c.isDirectory()){if(l&&!s.isInstanceOf(l,k))throw new Error("Directory cannot be assigned Resource constructor (".concat(l.name,")"));l||(l=k)}else l||(l=v);else l||(l=v);return(i=u.Rent(l)).path=n,i.encoding=s.Get(e,"encoding",m.UTF8),i.type=s.Get(e,"type",y.TEXT),i.stats=c,i.exists=null!=c,this._RegisterRsc(i),i}},{key:"_RegisterRsc",value:function _RegisterRsc(t){t._readFn=this._RequestRead,t._writeFn=this._RequestWrite,t._deleteFn=this._RequestDelete,t._renameFn=this._RequestRename,t._commitRnFn=this._CommitRename,t.isDir&&(t._requestRsc=this._RequestRsc),t.Watch(c.RELEASED,this._OnRscReleased,this),this._resources.Set(t.path,t);var e=a.dir(t.path),n=this._resources.Get(e);n&&n!=t&&n.Add(t),this._Broadcast(g.RSC_REGISTERED,t)}},{key:"_IOID",value:function _IOID(t,e){return s.isEmpty(t)||!(t in this._io)?T.DEFAULT:t}},{key:"_RequestRead",value:function _RequestRead(t){var e=u.Rent(this._io[this._IOID(t.ioType,t)].read);e.operation=t,this._PushIOProcess(e)}},{key:"_RequestWrite",value:function _RequestWrite(t){var e=u.Rent(this._io[this._IOID(t.ioType,t)].write);e.operation=t,this._PushIOProcess(e)}},{key:"_RequestDelete",value:function _RequestDelete(t){var e=u.Rent(this._io[this._IOID(t.ioType,t)].delete);e.operation=t,this._PushIOProcess(e)}},{key:"_RequestRename",value:function _RequestRename(t,e){var n=u.Rent(this._io[this._IOID(t.ioType,t)].rename);n.operation=t,n.targetPath=e,this._PushIOProcess(n)}},{key:"_PushIOProcess",value:function _PushIOProcess(t){t._globalResourceMap=this._resources,this._IOQueue.Add(t),this._tick.Schedule()}},{key:"_CommitRename",value:function _CommitRename(t,e){this._resources.Remove(e);var n=t.path;this._resources.Set(n,t);var i=a.dir(n),s=this._resources.Get(i);s?t.directory=s:t.directory&&(t.directory=null)}},{key:"_RequestRsc",value:function _RequestRsc(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._Get(t,e,n)}},{key:"_OnRscReleased",value:function _OnRscReleased(t){this._resources.Remove(t.path),this._Broadcast(g.RSC_UNREGISTERED,t)}},{key:"_Tick",value:function _Tick(t){_get(_getPrototypeOf(RESOURCES.prototype),"_Tick",this).call(this,t),this._UpdateQueue(this._IOQueue)}},{key:"_UpdateQueue",value:function _UpdateQueue(t){t.isEmpty||this._tick.Schedule(),t.running||t.isEmpty||t.ProcessNext()}}],[{key:"Get",value:function Get(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.instance._Get(t,e)}},{key:"TryGet",value:function TryGet(t){return this.instance._TryGet(t)}},{key:"GetDir",value:function GetDir(t){return this.instance._Get(t,{cl:k})}}]),RESOURCES}(f);e.exports=L},{"./directory":102,"./encoding":103,"./io-process":104,"./io-processes":109,"./io-queue":114,"./io-signal":115,"./io-type":116,"./resource":119,"./resource-operation":117,"./response-type":125,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/services":153,"@nkmjs/utils":271}],121:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u=t("../resource"),h=t("../response-type"),d=function(t){_inherits(BinaryResource,t);var e=_createSuper(BinaryResource);function BinaryResource(){return _classCallCheck(this,BinaryResource),e.call(this)}return BinaryResource}(u);_defineProperty(d,"defaultType",h.ARRAYBUFFER),e.exports=d},{"../resource":119,"../response-type":125,"@nkmjs/common":27,"@nkmjs/utils":271}],122:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u=t("./resource-text"),h=t("../response-type"),d=function(t){_inherits(BlobResource,t);var e=_createSuper(BlobResource);function BlobResource(){return _classCallCheck(this,BlobResource),e.call(this)}return _createClass(BlobResource,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(BlobResource.prototype),"_Init",this).call(this),this._objectURL=null}},{key:"objectURL",get:function get(){if(this._objectURL)return this._objectURL;this._objectURL=URL.createObjectURL(this._content)}},{key:"_Encode",value:function _Encode(){return s.isInstanceOf(this._content,Blob)?this._content:this._mime?new Blob([this._content],{type:this._mime.type}):new Blob([this._content])}},{key:"_Decode",value:function _Decode(){return this._objectURL=null,s.isInstanceOf(this._raw,Blob)?this._raw:this._mime?new Blob([this._raw],{type:this._mime.type}):new Blob([this._raw])}},{key:"_CleanUp",value:function _CleanUp(){this._objectURL&&(URL.revokeObjectURL(this._objectURL),this._objectURL=null),_get(_getPrototypeOf(BlobResource.prototype),"_CleanUp",this).call(this)}}]),BlobResource}(u);_defineProperty(d,"defaultType",h.BLOB),e.exports=d},{"../response-type":125,"./resource-text":124,"@nkmjs/common":27,"@nkmjs/utils":271}],123:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u=t("./resource-text"),h=t("../response-type"),d=function(t){_inherits(JSONResource,t);var e=_createSuper(JSONResource);function JSONResource(){return _classCallCheck(this,JSONResource),e.call(this)}return _createClass(JSONResource,[{key:"_Encode",value:function _Encode(){return s.isObject(this._content)?JSON.stringify(this._content,null,"     "):"{}"}},{key:"_Decode",value:function _Decode(){return JSON.parse(_get(_getPrototypeOf(JSONResource.prototype),"_Decode",this).call(this))}}]),JSONResource}(u);_defineProperty(d,"defaultType",h.JSON),e.exports=d},{"../response-type":125,"./resource-text":124,"@nkmjs/common":27,"@nkmjs/utils":271}],124:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").SIGNAL,u=t("../resource"),h=t("../response-type"),d=function(t){_inherits(TextResource,t);var e=_createSuper(TextResource);function TextResource(){return _classCallCheck(this,TextResource),e.call(this)}return _createClass(TextResource,[{key:"_Encode",value:function _Encode(){return this._content?this._content:""}},{key:"_Decode",value:function _Decode(){if(s.isString(this._raw))return this._raw;var t;if(s.isArrayBuffer(this._raw))return new TextDecoder(this._encoding).decode(ArrayBuffer.isView(this._raw)?this._raw:new DataView(this._raw,0));try{var e=new FileReaderSync;return s.isInstanceOf(this._raw,Blob)?e.readAsString(this._raw,this._encoding):""}catch(t){return""}}}]),TextResource}(u);_defineProperty(d,"defaultType",h.TEXT),e.exports=d},{"../resource":119,"../response-type":125,"@nkmjs/common":27,"@nkmjs/utils":271}],125:[function(t,e,n){var i=function RESPONSE_TYPE(){_classCallCheck(this,RESPONSE_TYPE)};_defineProperty(i,"TEXT","text"),_defineProperty(i,"ARRAYBUFFER","arraybuffer"),_defineProperty(i,"BLOB","blob"),_defineProperty(i,"DOCUMENT","document"),_defineProperty(i,"JSON","json"),e.exports=i},{}],126:[function(t,e,n){e.exports=t("./lib/axios")},{"./lib/axios":128}],127:[function(t,e,n){var i=t("./../utils"),s=t("./../core/settle"),a=t("./../helpers/cookies"),l=t("./../helpers/buildURL"),c=t("../core/buildFullPath"),u=t("./../helpers/parseHeaders"),h=t("./../helpers/isURLSameOrigin"),d=t("../core/createError");e.exports=function xhrAdapter(t){return new Promise((function dispatchXhrRequest(e,n){var p=t.data,f=t.headers;i.isFormData(p)&&delete f["Content-Type"];var g=new XMLHttpRequest;if(t.auth){var m=t.auth.username||"",y=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";f.Authorization="Basic "+btoa(m+":"+y)}var v=c(t.baseURL,t.url);if(g.open(t.method.toUpperCase(),l(v,t.params,t.paramsSerializer),!0),g.timeout=t.timeout,g.onreadystatechange=function handleLoad(){if(g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))){var i="getAllResponseHeaders"in g?u(g.getAllResponseHeaders()):null,a,l={data:t.responseType&&"text"!==t.responseType?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:i,config:t,request:g};s(e,n,l),g=null}},g.onabort=function handleAbort(){g&&(n(d("Request aborted",t,"ECONNABORTED",g)),g=null)},g.onerror=function handleError(){n(d("Network Error",t,null,g)),g=null},g.ontimeout=function handleTimeout(){var e="timeout of "+t.timeout+"ms exceeded";t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),n(d(e,t,"ECONNABORTED",g)),g=null},i.isStandardBrowserEnv()){var k=(t.withCredentials||h(v))&&t.xsrfCookieName?a.read(t.xsrfCookieName):void 0;k&&(f[t.xsrfHeaderName]=k)}if("setRequestHeader"in g&&i.forEach(f,(function setRequestHeader(t,e){void 0===p&&"content-type"===e.toLowerCase()?delete f[e]:g.setRequestHeader(e,t)})),i.isUndefined(t.withCredentials)||(g.withCredentials=!!t.withCredentials),t.responseType)try{g.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&g.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&g.upload&&g.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function onCanceled(t){g&&(g.abort(),n(t),g=null)})),p||(p=null),g.send(p)}))}},{"../core/buildFullPath":134,"../core/createError":135,"./../core/settle":139,"./../helpers/buildURL":143,"./../helpers/cookies":145,"./../helpers/isURLSameOrigin":148,"./../helpers/parseHeaders":150,"./../utils":152}],128:[function(t,e,n){var i=t("./utils"),s=t("./helpers/bind"),a=t("./core/Axios"),l=t("./core/mergeConfig"),c;function createInstance(t){var e=new a(t),n=s(a.prototype.request,e);return i.extend(n,a.prototype,e),i.extend(n,e),n}var u=createInstance(t("./defaults"));u.Axios=a,u.create=function create(t){return createInstance(l(u.defaults,t))},u.Cancel=t("./cancel/Cancel"),u.CancelToken=t("./cancel/CancelToken"),u.isCancel=t("./cancel/isCancel"),u.all=function all(t){return Promise.all(t)},u.spread=t("./helpers/spread"),u.isAxiosError=t("./helpers/isAxiosError"),e.exports=u,e.exports.default=u},{"./cancel/Cancel":129,"./cancel/CancelToken":130,"./cancel/isCancel":131,"./core/Axios":132,"./core/mergeConfig":138,"./defaults":141,"./helpers/bind":142,"./helpers/isAxiosError":147,"./helpers/spread":151,"./utils":152}],129:[function(t,e,n){function Cancel(t){this.message=t}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0,e.exports=Cancel},{}],130:[function(t,e,n){var i=t("./Cancel");function CancelToken(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function promiseExecutor(t){e=t}));var n=this;t((function cancel(t){n.reason||(n.reason=new i(t),e(n.reason))}))}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var t,e;return{token:new CancelToken((function executor(e){t=e})),cancel:t}},e.exports=CancelToken},{"./Cancel":129}],131:[function(t,e,n){e.exports=function isCancel(t){return!(!t||!t.__CANCEL__)}},{}],132:[function(t,e,n){var i=t("./../utils"),s=t("../helpers/buildURL"),a=t("./InterceptorManager"),l=t("./dispatchRequest"),c=t("./mergeConfig");function Axios(t){this.defaults=t,this.interceptors={request:new a,response:new a}}Axios.prototype.request=function request(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=c(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=[l,void 0],n=Promise.resolve(t);for(this.interceptors.request.forEach((function unshiftRequestInterceptors(t){e.unshift(t.fulfilled,t.rejected)})),this.interceptors.response.forEach((function pushResponseInterceptors(t){e.push(t.fulfilled,t.rejected)}));e.length;)n=n.then(e.shift(),e.shift());return n},Axios.prototype.getUri=function getUri(t){return t=c(this.defaults,t),s(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function forEachMethodNoData(t){Axios.prototype[t]=function(e,n){return this.request(c(n||{},{method:t,url:e,data:(n||{}).data}))}})),i.forEach(["post","put","patch"],(function forEachMethodWithData(t){Axios.prototype[t]=function(e,n,i){return this.request(c(i||{},{method:t,url:e,data:n}))}})),e.exports=Axios},{"../helpers/buildURL":143,"./../utils":152,"./InterceptorManager":133,"./dispatchRequest":136,"./mergeConfig":138}],133:[function(t,e,n){var i=t("./../utils");function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(t){this.handlers[t]&&(this.handlers[t]=null)},InterceptorManager.prototype.forEach=function forEach(t){i.forEach(this.handlers,(function forEachHandler(e){null!==e&&t(e)}))},e.exports=InterceptorManager},{"./../utils":152}],134:[function(t,e,n){var i=t("../helpers/isAbsoluteURL"),s=t("../helpers/combineURLs");e.exports=function buildFullPath(t,e){return t&&!i(e)?s(t,e):e}},{"../helpers/combineURLs":144,"../helpers/isAbsoluteURL":146}],135:[function(t,e,n){var i=t("./enhanceError");e.exports=function createError(t,e,n,s,a){var l=new Error(t);return i(l,e,n,s,a)}},{"./enhanceError":137}],136:[function(t,e,n){var i=t("./../utils"),s=t("./transformData"),a=t("../cancel/isCancel"),l=t("../defaults");function throwIfCancellationRequested(t){t.cancelToken&&t.cancelToken.throwIfRequested()}e.exports=function dispatchRequest(t){var e;return throwIfCancellationRequested(t),t.headers=t.headers||{},t.data=s(t.data,t.headers,t.transformRequest),t.headers=i.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function cleanHeaderConfig(e){delete t.headers[e]})),(t.adapter||l.adapter)(t).then((function onAdapterResolution(e){return throwIfCancellationRequested(t),e.data=s(e.data,e.headers,t.transformResponse),e}),(function onAdapterRejection(e){return a(e)||(throwIfCancellationRequested(t),e&&e.response&&(e.response.data=s(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},{"../cancel/isCancel":131,"../defaults":141,"./../utils":152,"./transformData":140}],137:[function(t,e,n){e.exports=function enhanceError(t,e,n,i,s){return t.config=e,n&&(t.code=n),t.request=i,t.response=s,t.isAxiosError=!0,t.toJSON=function toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},t}},{}],138:[function(t,e,n){var i=t("../utils");e.exports=function mergeConfig(t,e){e=e||{};var n={},s=["url","method","data"],a=["headers","auth","proxy","params"],l=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],c=["validateStatus"];function getMergedValue(t,e){return i.isPlainObject(t)&&i.isPlainObject(e)?i.merge(t,e):i.isPlainObject(e)?i.merge({},e):i.isArray(e)?e.slice():e}function mergeDeepProperties(s){i.isUndefined(e[s])?i.isUndefined(t[s])||(n[s]=getMergedValue(void 0,t[s])):n[s]=getMergedValue(t[s],e[s])}i.forEach(s,(function valueFromConfig2(t){i.isUndefined(e[t])||(n[t]=getMergedValue(void 0,e[t]))})),i.forEach(a,mergeDeepProperties),i.forEach(l,(function defaultToConfig2(s){i.isUndefined(e[s])?i.isUndefined(t[s])||(n[s]=getMergedValue(void 0,t[s])):n[s]=getMergedValue(void 0,e[s])})),i.forEach(c,(function merge(i){i in e?n[i]=getMergedValue(t[i],e[i]):i in t&&(n[i]=getMergedValue(void 0,t[i]))}));var u=s.concat(a).concat(l).concat(c),h=Object.keys(t).concat(Object.keys(e)).filter((function filterAxiosKeys(t){return-1===u.indexOf(t)}));return i.forEach(h,mergeDeepProperties),n}},{"../utils":152}],139:[function(t,e,n){var i=t("./createError");e.exports=function settle(t,e,n){var s=n.config.validateStatus;n.status&&s&&!s(n.status)?e(i("Request failed with status code "+n.status,n.config,null,n.request,n)):t(n)}},{"./createError":135}],140:[function(t,e,n){var i=t("./../utils");e.exports=function transformData(t,e,n){return i.forEach(n,(function transform(n){t=n(t,e)})),t}},{"./../utils":152}],141:[function(t,e,n){(function(n){(function(){var i=t("./utils"),s=t("./helpers/normalizeHeaderName"),a={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(t,e){!i.isUndefined(t)&&i.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function getDefaultAdapter(){var e;return"undefined"!=typeof XMLHttpRequest?e=t("./adapters/xhr"):void 0!==n&&"[object process]"===Object.prototype.toString.call(n)&&(e=t("./adapters/http")),e}var l={adapter:getDefaultAdapter(),transformRequest:[function transformRequest(t,e){return s(e,"Accept"),s(e,"Content-Type"),i.isFormData(t)||i.isArrayBuffer(t)||i.isBuffer(t)||i.isStream(t)||i.isFile(t)||i.isBlob(t)?t:i.isArrayBufferView(t)?t.buffer:i.isURLSearchParams(t)?(setContentTypeIfUnset(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):i.isObject(t)?(setContentTypeIfUnset(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function transformResponse(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function validateStatus(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],(function forEachMethodNoData(t){l.headers[t]={}})),i.forEach(["post","put","patch"],(function forEachMethodWithData(t){l.headers[t]=i.merge(a)})),e.exports=l}).call(this)}).call(this,t("_process"))},{"./adapters/http":127,"./adapters/xhr":127,"./helpers/normalizeHeaderName":149,"./utils":152,_process:53}],142:[function(t,e,n){e.exports=function bind(t,e){return function wrap(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return t.apply(e,n)}}},{}],143:[function(t,e,n){var i=t("./../utils");function encode(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function buildURL(t,e,n){if(!e)return t;var s;if(n)s=n(e);else if(i.isURLSearchParams(e))s=e.toString();else{var a=[];i.forEach(e,(function serialize(t,e){null!=t&&(i.isArray(t)?e+="[]":t=[t],i.forEach(t,(function parseValue(t){i.isDate(t)?t=t.toISOString():i.isObject(t)&&(t=JSON.stringify(t)),a.push(encode(e)+"="+encode(t))})))})),s=a.join("&")}if(s){var l=t.indexOf("#");-1!==l&&(t=t.slice(0,l)),t+=(-1===t.indexOf("?")?"?":"&")+s}return t}},{"./../utils":152}],144:[function(t,e,n){e.exports=function combineURLs(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},{}],145:[function(t,e,n){var i=t("./../utils");e.exports=i.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(t,e,n,s,a,l){var c=[];c.push(t+"="+encodeURIComponent(e)),i.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),i.isString(s)&&c.push("path="+s),i.isString(a)&&c.push("domain="+a),!0===l&&c.push("secure"),document.cookie=c.join("; ")},read:function read(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function remove(t){this.write(t,"",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}}},{"./../utils":152}],146:[function(t,e,n){e.exports=function isAbsoluteURL(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},{}],147:[function(t,e,n){e.exports=function isAxiosError(t){return"object"===_typeof(t)&&!0===t.isAxiosError}},{}],148:[function(t,e,n){var i=t("./../utils");e.exports=i.isStandardBrowserEnv()?function standardBrowserEnv(){var t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a"),n;function resolveURL(n){var i=n;return t&&(e.setAttribute("href",i),i=e.href),e.setAttribute("href",i),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:"/"===e.pathname.charAt(0)?e.pathname:"/"+e.pathname}}return n=resolveURL(window.location.href),function isURLSameOrigin(t){var e=i.isString(t)?resolveURL(t):t;return e.protocol===n.protocol&&e.host===n.host}}():function isURLSameOrigin(){return!0}},{"./../utils":152}],149:[function(t,e,n){var i=t("../utils");e.exports=function normalizeHeaderName(t,e){i.forEach(t,(function processHeader(n,i){i!==e&&i.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[i])}))}},{"../utils":152}],150:[function(t,e,n){var i=t("./../utils"),s=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function parseHeaders(t){var e={},n,a,l;return t?(i.forEach(t.split("\n"),(function parser(t){if(l=t.indexOf(":"),n=i.trim(t.substr(0,l)).toLowerCase(),a=i.trim(t.substr(l+1)),n){if(e[n]&&s.indexOf(n)>=0)return;e[n]="set-cookie"===n?(e[n]?e[n]:[]).concat([a]):e[n]?e[n]+", "+a:a}})),e):e}},{"./../utils":152}],151:[function(t,e,n){e.exports=function spread(t){return function wrap(e){return t.apply(null,e)}}},{}],152:[function(t,e,n){var i=t("./helpers/bind"),s=Object.prototype.toString;function isArray(t){return"[object Array]"===s.call(t)}function isUndefined(t){return void 0===t}function isBuffer(t){return null!==t&&!isUndefined(t)&&null!==t.constructor&&!isUndefined(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function isArrayBuffer(t){return"[object ArrayBuffer]"===s.call(t)}function isFormData(t){return"undefined"!=typeof FormData&&t instanceof FormData}function isArrayBufferView(t){var e;return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer}function isString(t){return"string"==typeof t}function isNumber(t){return"number"==typeof t}function isObject(t){return null!==t&&"object"===_typeof(t)}function isPlainObject(t){if("[object Object]"!==s.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function isDate(t){return"[object Date]"===s.call(t)}function isFile(t){return"[object File]"===s.call(t)}function isBlob(t){return"[object Blob]"===s.call(t)}function isFunction(t){return"[object Function]"===s.call(t)}function isStream(t){return isObject(t)&&isFunction(t.pipe)}function isURLSearchParams(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}function trim(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(t,e){if(null!=t)if("object"!==_typeof(t)&&(t=[t]),isArray(t))for(var n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.call(null,t[s],s,t)}function merge(){var t={};function assignValue(e,n){isPlainObject(t[n])&&isPlainObject(e)?t[n]=merge(t[n],e):isPlainObject(e)?t[n]=merge({},e):isArray(e)?t[n]=e.slice():t[n]=e}for(var e=0,n=arguments.length;e<n;e++)forEach(arguments[e],assignValue);return t}function extend(t,e,n){return forEach(e,(function assignValue(e,s){t[s]=n&&"function"==typeof e?i(e,n):e})),t}function stripBOM(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}e.exports={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM}},{"./helpers/bind":142}],153:[function(t,e,n){e.exports={SERVICE_SIGNAL:t("./lib/service-signal"),SERVICE_STATE:t("./lib/service-state"),ServiceBase:t("./lib/service-base"),ServicesManager:t("./lib/services-manager")}},{"./lib/service-base":154,"./lib/service-signal":155,"./lib/service-state":156,"./lib/services-manager":157}],154:[function(t,e,n){var i,s=t("@nkmjs/utils").LOG,a=t("@nkmjs/common"),l=a.SingletonEx,c=a.DelayedCall,u=t("./services-manager"),h=function(t){_inherits(ServiceBase,t);var e=_createSuper(ServiceBase);function ServiceBase(){return _classCallCheck(this,ServiceBase),e.call(this)}return _createClass(ServiceBase,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ServiceBase.prototype),"_Init",this).call(this),this._initialized=!1,this._started=!1,this._running=!1,this._tick=new c(this._Bind(this._Tick))}},{key:"Initialize",value:function Initialize(){this._initialized||(u.instance.Register(this),this._initialized=!0)}},{key:"InitializeAndStart",value:function InitializeAndStart(){this.Initialize(),this.Start()}},{key:"started",get:function get(){return this._started}},{key:"running",get:function get(){return this._running}},{key:"Start",value:function Start(){return this._initialized?!this._started&&(this._started=!0,s._("STARTED :· ".concat(this.constructor.name),"#add800","#2e3a00"),!0):(console.error("Attempting to start a service (".concat(this.constructor.name,") that hasn't been initialized yet.")),!1)}},{key:"Stop",value:function Stop(){this._started&&(this._started=!1,s._("STOPPED :: ".concat(this.constructor.name),"#ef8700","#492900"))}},{key:"Restart",value:function Restart(){}},{key:"_Tick",value:function _Tick(t){}}]),ServiceBase}(l);e.exports=h},{"./services-manager":157,"@nkmjs/common":27,"@nkmjs/utils":271}],155:[function(t,e,n){var i=t("./service-state"),s=function(){function SERVICE_SIGNAL(){_classCallCheck(this,SERVICE_SIGNAL)}return _createClass(SERVICE_SIGNAL,null,[{key:"UNINITIALIZED",get:function get(){return i.UNINITIALIZED}},{key:"INITIALIZING",get:function get(){return i.INITIALIZING}},{key:"INITIALIZED",get:function get(){return i.INITIALIZED}},{key:"STARTING",get:function get(){return i.STARTING}},{key:"STARTED",get:function get(){return i.STARTED}},{key:"STOPPING",get:function get(){return i.STOPPING}},{key:"STOPPED",get:function get(){return i.STOPPED}}]),SERVICE_SIGNAL}();e.exports=s},{"./service-state":156}],156:[function(t,e,n){var i,s,a=function(t){_inherits(SERVICE_STATE,t);var e=_createSuper(SERVICE_STATE);function SERVICE_STATE(){return _classCallCheck(this,SERVICE_STATE),e.call(this)}return _createClass(SERVICE_STATE,null,[{key:"UNINITIALIZED",get:function get(){return SERVICE_STATE.GetOrCreate("uninitialized")}},{key:"INITIALIZING",get:function get(){return SERVICE_STATE.GetOrCreate("initializing")}},{key:"INITIALIZED",get:function get(){return SERVICE_STATE.GetOrCreate("initialized")}},{key:"STARTING",get:function get(){return SERVICE_STATE.GetOrCreate("starting")}},{key:"STARTED",get:function get(){return SERVICE_STATE.GetOrCreate("started")}},{key:"STOPPING",get:function get(){return SERVICE_STATE.GetOrCreate("stopping")}},{key:"STOPPED",get:function get(){return SERVICE_STATE.GetOrCreate("stopped")}}]),SERVICE_STATE}(t("@nkmjs/common").StateBase);e.exports=a},{"@nkmjs/common":27}],157:[function(t,e,n){var i,s=t("@nkmjs/collections").List,a=t("@nkmjs/common"),l=a.TIME,c,u=function(t){_inherits(ServicesManager,t);var e=_createSuper(ServicesManager);function ServicesManager(){return _classCallCheck(this,ServicesManager),e.call(this)}return _createClass(ServicesManager,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ServicesManager.prototype),"_Init",this).call(this),this._services=new s}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(ServicesManager.prototype),"_PostInit",this).call(this)}},{key:"Boot",value:function Boot(){}},{key:"Register",value:function Register(t){this._services.Add(t.constructor)}}]),ServicesManager}(a.SingletonEx);e.exports=u},{"@nkmjs/collections":21,"@nkmjs/common":27}],158:[function(t,e,n){e.exports={FONT_FLAG:t("./lib/font-flag"),ColorBase:t("./lib/colors/color-base"),RGBA:t("./lib/colors/rgba"),HSLA:t("./lib/colors/hsla"),COLOR:t("./lib/colors/color"),CSS:t("./lib/css"),STYLE:t("./lib/style"),Palette:t("./lib/palette"),PaletteBuilder:t("./lib/palette-builder")}},{"./lib/colors/color":160,"./lib/colors/color-base":159,"./lib/colors/hsla":161,"./lib/colors/rgba":162,"./lib/css":163,"./lib/font-flag":165,"./lib/palette":167,"./lib/palette-builder":166,"./lib/style":168}],159:[function(t,e,n){var i=function ColorBase(){_classCallCheck(this,ColorBase)};e.exports=i},{}],160:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("./hsla"),l=t("./rgba"),c=function(){function COLOR(){_classCallCheck(this,COLOR)}return _createClass(COLOR,null,[{key:"HSLA",value:function HSLA(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:360,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new a(t,e,n,i)}},{key:"RGBA",value:function RGBA(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new l(t,e,n,i)}},{key:"RGBAtoHSLA",value:function RGBAtoHSLA(t){var e=t.r,n=t.g,i=t.b,s=Math.min(e,n,i),l=Math.max(e,n,i),c=l-s,u=0,h=0,d=0;return u=0===c?0:l===e?(n-i)/c%6:l===n?(i-e)/c+2:(e-n)/c+4,(u=Math.round(60*u))<0&&(u+=360),d=(l+s)/2,h=+(100*(h=0===c?0:c/(1-Math.abs(2*d-1)))).toFixed(1),d=+(100*d).toFixed(1),new a(u,h,d,t.a)}},{key:"HSLAtoRGBA",value:function HSLAtoRGBA(t){var e=t.h,n=t.s,i=t.l,s=(1-Math.abs(2*i-1))*n,a=s*(1-Math.abs(e/60%2-1)),c=i-s/2,u=0,h=0,d=0;return 0<=e&&e<60?(u=s,h=a,d=0):60<=e&&e<120?(u=a,h=s,d=0):120<=e&&e<180?(u=0,h=s,d=a):180<=e&&e<240?(u=0,h=a,d=s):240<=e&&e<300?(u=a,h=0,d=s):300<=e&&e<360&&(u=s,h=0,d=a),u=Math.round(255*(u+c)),h=Math.round(255*(h+c)),d=Math.round(255*(d+c)),new l(u,h,d,t.a)}}]),COLOR}();e.exports=c},{"./hsla":161,"./rgba":162,"@nkmjs/utils":271}],161:[function(t,e,n){var i,s=function(t){_inherits(HSLA,t);var e=_createSuper(HSLA);function HSLA(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return _classCallCheck(this,HSLA),(t=e.call(this))._H=n,t._S=i,t._L=s,t._a=a,t}return _createClass(HSLA,[{key:"Set",value:function Set(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this._H=t,this._S=e,this._L=n,this._a=i,this}},{key:"H",get:function get(){return this._H},set:function set(t){this._H=t}},{key:"h",get:function get(){return this._H/360},set:function set(t){this._H=360*t}},{key:"S",get:function get(){return this._S},set:function set(t){this._S=t}},{key:"s",get:function get(){return this._S/100},set:function set(t){this._S=100*t}},{key:"L",get:function get(){return this._L},set:function set(t){this._L=t}},{key:"l",get:function get(){return this._L/100},set:function set(t){this._L=100*t}},{key:"A",get:function get(){return 255*this._a},set:function set(t){this._a=t/255}},{key:"a",get:function get(){return this._a},set:function set(t){this._a=t}},{key:"hsl",get:function get(){return"hsl(".concat(this._H,",").concat(this._S,"%,").concat(this._L,"%)")}},{key:"hsla",get:function get(){return"hsla(".concat(this._H,",").concat(this._S,"%,").concat(this._L,"%,").concat(this._a,")")}},{key:"toString",value:function toString(){return this.hsla}}],[{key:"hex",value:function hex(t){var e=new HSLA;return e.hex=t,e}},{key:"Get",value:function Get(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=new HSLA;return s.R=t,s.G=e,s.B=n,s.a=i,s}}]),HSLA}(t("./color-base"));e.exports=s},{"./color-base":159}],162:[function(t,e,n){var i,s=function(t){_inherits(RGBA,t);var e=_createSuper(RGBA);function RGBA(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return _classCallCheck(this,RGBA),(t=e.call(this))._R=n,t._G=i,t._B=s,t._a=a,t}return _createClass(RGBA,[{key:"Set",value:function Set(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this._R=t,this._G=e,this._B=n,this._a=i,this}},{key:"R",get:function get(){return this._R},set:function set(t){this._R=t}},{key:"r",get:function get(){return this._R/255},set:function set(t){this._R=255*t}},{key:"G",get:function get(){return this._G},set:function set(t){this._G=t}},{key:"g",get:function get(){return this._G/255},set:function set(t){this._G=255*t}},{key:"B",get:function get(){return this._B},set:function set(t){this._B=t}},{key:"b",get:function get(){return this._B/255},set:function set(t){this._B=255*t}},{key:"A",get:function get(){return 255*this._a},set:function set(t){this._a=t/255}},{key:"a",get:function get(){return this._a},set:function set(t){this._a=t}},{key:"hex",get:function get(){var t=this._R.toString(16);t=1===t.length?"0"+t:t;var e=this._G.toString(16);e=1===e.length?"0"+e:e;var n=this._B.toString(16);return n=1===n.length?"0"+n:n,"#".concat(t).concat(e).concat(n)},set:function set(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);e?(this._R=parseInt(e[1],16),this._G=parseInt(e[2],16),this._B=parseInt(e[3],16)):(this._R=0,this._G=0,this._B=0)}},{key:"hexa",get:function get(){var t=this._R.toString(16);t=1===t.length?"0"+t:t;var e=this._G.toString(16);e=1===e.length?"0"+e:e;var n=this._B.toString(16);n=1===n.length?"0"+n:n;var i=this.A.toString(16);return i=1===i.length?"0"+i:i,"#".concat(t).concat(e).concat(n).concat(i)},set:function set(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);e?(this._R=parseInt(e[1],16),this._G=parseInt(e[2],16),this._B=parseInt(e[3],16),this._a=parseInt(e[4],16)/255):(this._R=0,this._G=0,this._B=0,this._a=0)}},{key:"rgb",get:function get(){return"rgb(".concat(this._R,",").concat(this._G,",").concat(this._B,")")}},{key:"rgba",get:function get(){return"rgba(".concat(this._R,",").concat(this._G,",").concat(this._B,",").concat(this._a,")")}},{key:"toString",value:function toString(){return this.rgba}}],[{key:"hex",value:function hex(t){var e=new RGBA;return e.hex=t,e}},{key:"Get",value:function Get(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=new RGBA;return s.R=t,s.G=e,s.B=n,s.a=i,s}}]),RGBA}(t("./color-base"));e.exports=s},{"./color-base":159}],163:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").Singleton,u="@media ",h=function(t){_inherits(CSS,t);var e=_createSuper(CSS);function CSS(){return _classCallCheck(this,CSS),e.call(this)}return _createClass(CSS,null,[{key:"CSSImport",value:function CSSImport(t){var e=a.New("style",{type:"text/css"});return e.innerText='@import url("'.concat(t,'")'),e}},{key:"Style",value:function Style(t){var e=a.New("style"),n=null;if(s.IsString(t))n=t;else if(n="",null!=t&&null!=t)for(var i in t)n+=h.CSS(i,t[i]);return e.innerText=n,e}},{key:"CSS",value:function CSS(t,e){if(!s.isObject(e))return"";if(0===t.indexOf(u)){var n="";for(var i in e)n+=h.CSS(i,e[i]);return"".concat(t,"{").concat(n,"}")}return"".concat(t,"{").concat(h.InlineCSS(e),"}")}},{key:"InlineCSS",value:function InlineCSS(t){if(!s.isObject(t))return"";var e="";if(null!=t&&null!=t)for(var n in t)e+="".concat(n,":").concat(t[n],";");return e}},{key:"Merge",value:function Merge(t,e){if(!t)return JSON.parse(JSON.stringify(e));for(var n in e){var i=t[n],a=e[n];if(n in t)if(s.isArray(a))if(null===a[0]){var l=_toConsumableArray(a);l.unshift(),t[n]=l}else if(s.isArray(i))for(var c=0,u=a.length;c<u;c++){var h=a[c];i.includes(h)||i.push(h)}else t[n]=_toConsumableArray(a);else s.isObject(a)?this.Merge(i,a):t[n]=a;else s.isArray(a)?t[n]=_toConsumableArray(a):s.isObject(a)?t[n]=JSON.parse(JSON.stringify(a)):t[n]=a}return t}},{key:"Compose",value:function Compose(t,e){if(!t)return JSON.parse(JSON.stringify(e));for(var n in e){var i=t[n],a=e[n];if(n in t)if(s.isArray(a)){if(s.isArray(i)){if(null===i[0])continue;for(var l=0,c=a.length;l<c;l++){var u=a[l];i.includes(u)||i.unshift(u)}}}else s.isObject(a)?this.Compose(i,a):t[n]=a;else s.isArray(a)?t[n]=_toConsumableArray(a):s.isObject(a)?t[n]=JSON.parse(JSON.stringify(a)):t[n]=a}return t}},{key:"Extends",value:function Extends(t,e){if(!t)return JSON.parse(JSON.stringify(e));for(var n in e){var i=t[n],a=e[n];if(n in t)if(s.isArray(a)){if(s.isArray(i)){if(null===i[0])continue;for(var l=0,c=a.length;l<c;l++){var u=a[l];i.includes(u)||i.unshift(u)}}}else s.isObject(a)&&this.Extends(i,a);else s.isArray(a)?t[n]=_toConsumableArray(a):s.isObject(a)?t[n]=JSON.parse(JSON.stringify(a)):t[n]=a}return t}}]),CSS}(c);e.exports=h},{"@nkmjs/common":27,"@nkmjs/utils":271}],164:[function(t,e,n){var i,s=t("@nkmjs/common").COMMON_FLAG,a=t("./colors/color"),l,c=function(t){_inherits(DefaultStylesheet,t);var e=_createSuper(DefaultStylesheet);function DefaultStylesheet(){return _classCallCheck(this,DefaultStylesheet),e.call(this)}return _createClass(DefaultStylesheet,[{key:"Build",value:function Build(t){var e={};e[s.INFOS]=a.RGBA(102,175,204),e[s.WARNING]=a.RGBA(255,206,0),e[s.ERROR]=a.RGBA(226,5,0),e[s.READY]=a.RGBA(120,164,0),e[s.DIRTY]=a.RGBA(164,100,0),e[s.LOADING]=a.RGBA(102,119,204),e[s.PROCESSING]=a.RGBA(102,119,204),e[s.WAITING]=a.RGBA(102,119,204),e[s.ACTIVE]=a.RGBA(62,193,136),t.AddColors(e),t.AddDocumentRulesets({"html, body":{margin:0,padding:0,"font-family":"'Regular', sans-serif","font-size":"0.85rem","font-weight":400,"line-height":1.5,color:"#dedede","text-align":"left","background-color":"#1e1e1e",overflow:"hidden"}}),t.AddVariables({"margin-medium":"10px","padding-medium":"5px","scroll-size-small":"2px","scroll-size":"4px","color-warning":a.RGBA().rgba,"size-xs":"16px","size-s":"24px","size-m":"32px","size-l":"50px","size-xl":"108px"}),t.AddSuffixes({"small-scroll":{"::-webkit-scrollbar-track":{"background-color":"|color-warning|"},"::-webkit-scrollbar":{width:"|scroll-size-small|",height:"|scroll-size-small|","background-color":"|color-warning|"},"::-webkit-scrollbar-thumb":{"background-color":"|color-warning|"},":hover::-webkit-scrollbar":{width:"|scroll-size|",height:"|scroll-size|"},":hover::-webkit-scrollbar-thumb":{"background-color":"|color-warning|"}}}),t.AddSuffixes({"interactive-shadow":{"":{filter:"drop-shadow(0px 2px 1px rgba(0,0,0,0.1))"},"(.focused)":{cursor:"pointer","z-index":99999,filter:"drop-shadow(0px 2px 5px rgba(0,0,0,1))"},"(.selected)":{filter:"drop-shadow(0px 2px 2px rgba(0,0,0,0.2))"},"(.selected.focused)":{filter:"drop-shadow(0px 2px 5px rgba(0,0,0,1))"},"(.disabled)":{}},"interactive-area":{"":{"background-color":"#000","border-radius":"5px"},"(.selected)":{},"(.selected.focused)":{},"(.disabled)":{}}}),t.AddRulesets({h4:{"margin-block-start":0,"margin-block-end":0}}),t.AddProperties({layer:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","box-sizing":"border-box"},"invisible-fill":{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","box-sizing":"border-box",opacity:"0"},cover:{"background-size":"cover","background-position":"center"}}),t.AddProperties({"icon-small":{width:"20px",height:"20px","@":["cover"]}}),t.AddProperties({"drop-shadow":{filter:"drop-shadow(0px 5px 5px rgba(0,0,0,0.2))"}})}}]),DefaultStylesheet}(t("./palette-builder"));e.exports=c},{"./colors/color":160,"./palette-builder":166,"@nkmjs/common":27}],165:[function(t,e,n){var i=function FONT_FLAG(){_classCallCheck(this,FONT_FLAG)};_defineProperty(i,"TITLE","title"),_defineProperty(i,"LABEL","label"),_defineProperty(i,"TEXT","text"),_defineProperty(i,"TAG","font-tag"),_defineProperty(i,"SMALL","font-small"),_defineProperty(i,"MEDIUM","font-medium"),_defineProperty(i,"LARGE","font-large"),_defineProperty(i,"XLARGE","font-xlarge"),e.exports=i},{}],166:[function(t,e,n){var i=function(){function PaletteBuilder(){_classCallCheck(this,PaletteBuilder)}return _createClass(PaletteBuilder,[{key:"Build",value:function Build(t){}}]),PaletteBuilder}();e.exports=i},{}],167:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=i.UDOM,c,u=t("@nkmjs/collections").Dictionary,h=t("@nkmjs/common"),d=h.NFOS,p=h.DisposableObject,f=t("./css"),g="|",m="@",y=function(t){_inherits(Palette,t);var e=_createSuper(Palette);function Palette(){return _classCallCheck(this,Palette),e.call(this)}return _createClass(Palette,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Palette.prototype),"_Init",this).call(this),this._STYLE=null,this._fonts={},this._colors={},this._variables={},this._rulesets={},this._suffixes={},this._properties={},this._documentRulesets={},this._externalCSSMap={},this._themeId="default",this._cache=new u}},{key:"InitFrom",value:function InitFrom(t){this._fonts=JSON.parse(JSON.stringify(t._fonts)),this._colors=f.Merge(this._colors,t._colors),this._variables=JSON.parse(JSON.stringify(t._variables)),this._rulesets=JSON.parse(JSON.stringify(t._rulesets)),this._suffixes=JSON.parse(JSON.stringify(t._suffixes)),this._properties=JSON.parse(JSON.stringify(t._properties)),this._documentRulesets=JSON.parse(JSON.stringify(t._documentRulesets)),this._externalCSSMap=JSON.parse(JSON.stringify(t._externalCSSMap))}},{key:"AddCSSLink",value:function AddCSSLink(t,e){this._externalCSSMap[t]=e}},{key:"GetCSSLink",value:function GetCSSLink(t){return t in this._externalCSSMap&&(t=this._externalCSSMap[t]),t=t[0]===m?"".concat(a.FULL(a.STYLE),"/").concat(this._themeId).concat(t.substring(1)):a.FULL(t)}},{key:"AddFontFace",value:function AddFontFace(t,e){this._fonts[t]=a.FULL(e)}},{key:"AddColors",value:function AddColors(t){for(var e in t){var n=t[e];this._colors[e]=n,this._variables["".concat(g).concat(e).concat(g)]=n}}},{key:"AddDocumentRulesets",value:function AddDocumentRulesets(t){}},{key:"AddVariables",value:function AddVariables(t){for(var e in t)this._variables["".concat(g).concat(e).concat(g)]=t[e]}},{key:"AddSuffixes",value:function AddSuffixes(t){this._suffixes=f.Merge(this._suffixes,t)}},{key:"AddProperties",value:function AddProperties(t){this._properties=f.Merge(this._properties,t)}},{key:"AddRulesets",value:function AddRulesets(t){for(var e in t)this.AddSingleRuleset(e,t[e])}},{key:"AddSingleRuleset",value:function AddSingleRuleset(t,e){var n=this._rulesets;n[t]=t in n?f.Merge(n[t],e):e}},{key:"Get",value:function Get(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._cache.Get(t);if(!s.isVoid(i)&&!n)return i;i?i.length=0:i=new Array(0);var a=d.Get(t);if(a){if(a.css)for(var c=a.css.length-1;c>=0;c--)i.push(l.New("link",{href:this.GetCSSLink(a.css[c]),rel:"stylesheet"}));if(a.ignoreLocal)return this._cache.Set(t,i),i}var u=e();if(!s.isEmpty(u)){if(!s.isObject(u))throw new Error("Generator must return an object.");var h="";for(var p in u)this._ProcessSuffixes(p,u[p],u);for(var g in u)h+=f.CSS(g,this._ProcessSingleRuleset(g,u[g]));var m=l.New("style");m.innerText=h,i.push(m)}return this._cache.Set(t,i),i}},{key:"_ProcessSuffixes",value:function _ProcessSuffixes(t,e,n){var i=t[0]===m;if(s.isArray(e)){if(i&&s.isArray(e)){for(var a=t.substr(1,t.length-1),l=0,c=e.length;l<c;l++){var u=e[l];if(u in this._suffixes){var h=this._suffixes[u],d=void 0,p=void 0;for(var g in h)d="".concat(a).concat(g),p=h[g],n[d]=d in n?f.Compose(n[d],p):f.Compose(null,p)}}delete n[t]}}else if(i&&s.isObject(e)&&(0===t.indexOf("@media")||0===t.indexOf("@supports")))for(var y in e)this._ProcessSuffixes(y,e[y],e)}},{key:"_ProcessSingleRuleset",value:function _ProcessSingleRuleset(t,e){var n=s.isObject(e);if(t[0]===m&&n&&(0===t.indexOf("@media")||0===t.indexOf("@supports"))){for(var i in e)this._ProcessSingleRuleset(i,e[i]);return console.log(e),e}var a=this._rulesets,l=t in a;if(n){if(l&&f.Compose(e,a[t]),m in e){for(var c=e["@"],u=0,h=c.length;u<h;u++){var d=c[u];if(null!==d){if(!(d in this._properties))throw new Error("".concat(d," is not a valid property kit"));f.Compose(e,this._properties[d])}}delete e["@"]}}else l?(e=f.Compose(null,a[t]),n=!0):e="";if(n)for(var p in e){var y=e[p];s.isString(y)&&y.includes(g)&&(e[p]=this._ReplaceVars(y))}return e}},{key:"_ReplaceVars",value:function _ReplaceVars(t){for(var e in this._variables)t=t.replace(e,this._variables[e]);return t}}]),Palette}(p);e.exports=y},{"./css":163,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],168:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/common"),c=l.Singleton,u=l.POOL,h=l.COMMON_FLAG,d=t("./colors/color-base"),p=t("./colors/color"),f=t("./palette"),g=t("./css"),m=t("./default-stylesheet"),y=function(t){_inherits(STYLE,t);var e=_createSuper(STYLE);function STYLE(){return _classCallCheck(this,STYLE),e.call(this)}return _createClass(STYLE,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(STYLE.prototype),"_Init",this).call(this),this._defaultPalette=u.Rent(f),this._defaultPalette._STYLE=this,this._current=this._defaultPalette,this._headerStyle=null,this._cssPaths={},this._InitDefaults()}},{key:"_InitDefaults",value:function _InitDefaults(){var t;(new m).Build(this._defaultPalette)}},{key:"defaultPalette",get:function get(){return this._defaultPalette}},{key:"current",get:function get(){return this._current},set:function set(t){null===t&&(t=this._defaultPalette),this._current=t}}],[{key:"CreatePalette",value:function CreatePalette(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=u.Rent(f);return n._STYLE=this,t&&n.InitFrom(this.instance.defaultPalette),e&&(this.instance.current=n),n}},{key:"DeployCurrent",value:function DeployCurrent(){if(this._isBrowser){var t=this.instance.current,e="";for(var n in t._fonts)e+="@font-face { font-family: '".concat(n,"'; src: url('").concat(t._fonts[n],"');}\n");e+="\n";var i=t._documentRulesets,l;for(var c in i)t._ProcessSuffixes(c,i[c],i);for(var u in i)e+=g.CSS(u,t._ProcessSingleRuleset(u,i[u]));var h=this.instance.current._externalCSSMap;for(var d in h)this.instance.current.PrintCSSLink(d,document.head);s.isVoid(this._headerStyle)?(this._headerStyle=document.createElement("style"),this._headerStyle.innerText=e,a.Attach(this._headerStyle,document.head)):this._headerStyle.innerText=e}}},{key:"Get",value:function Get(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.instance.current.Get(t,e,n)}},{key:"TF",value:function TF(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"span";t=e.strong?"<strong>".concat(t,"</strong>"):t;var i="";if(e.style)i=" style='".concat(g.InlineCSS(this.instance.current._ProcessSingleRuleset("",e.style)),"' ");else if(e.color){var a=e.color;s.isString(a)&&a in this.instance.current._colors&&(a=this.instance.current._colors[a]),i=" style='color:".concat(a,";' ")}var l=e.class?" class='".concat(e.class,"'"):"";return"<".concat(n).concat(l).concat(i,">").concat(t,"</").concat(n,">")}}]),STYLE}(c);e.exports=y},{"./colors/color":160,"./colors/color-base":159,"./css":163,"./default-stylesheet":164,"./palette":167,"@nkmjs/common":27,"@nkmjs/utils":271}],169:[function(t,e,n){e.exports={UI_SIGNAL:t("./lib/ui-signal"),UI_FLAG:t("./lib/ui-flag"),UI_ID:t("./lib/ui-id"),UI:t("./lib/ui"),INPUT:t("./lib/input"),MOUSE:t("./lib/mouse"),KEYBOARD:t("./lib/keyboard"),DisposableHTMLElement:t("./lib/disposable-htmlelement"),DisplayObject:t("./lib/display-object"),DisplayObjectContainer:t("./lib/display-object-container"),Widget:t("./lib/widget"),OrientableWidget:t("./lib/widget-orientable"),CatalogWidget:t("./lib/widget-catalog"),CatalogBuilder:t("./lib/helpers/catalog-builder"),CatalogViewBuilder:t("./lib/helpers/catalog-view-builder"),FlagBox:t("./lib/helpers/flag-box"),FlagEnum:t("./lib/helpers/flag-enum"),WidgetSelection:t("./lib/helpers/widget-selection"),Frame:t("./lib/helpers/frame"),Toolbar:t("./lib/helpers/toolbar"),PopIn:t("./lib/helpers/pop-in"),TreeItem:t("./lib/tree/tree-item"),TreeItemGroup:t("./lib/tree/tree-item-group"),TreeRoot:t("./lib/tree/tree-root"),View:t("./lib/views/view"),Layer:t("./lib/views/layer"),LayerContainer:t("./lib/views/layer-container"),DrawerNav:t("./lib/views/drawer-nav"),Drawer:t("./lib/views/drawer"),BaseManipulator:t("./lib/manipulators/manipulator-base"),ImageManipulator:t("./lib/manipulators/manipulator-image"),TextManipulator:t("./lib/manipulators/manipulator-text"),ExtBase:t("./lib/extensions/ext-base"),ExtDrag:t("./lib/extensions/ext-drag"),ExtDrop:t("./lib/extensions/ext-drop"),ExtExpand:t("./lib/extensions/ext-expand"),ExtMouse:t("./lib/extensions/ext-mouse"),ExtMouseMove:t("./lib/extensions/ext-mouse-move"),ButtonBase:t("./lib/button-base"),ToolButton:t("./lib/buttons/button-tool"),ButtonEx:t("./lib/buttons/button-ex"),ButtonDragHandle:t("./lib/buttons/button-drag-handle"),DOMTemplate:t("./lib/dom-template"),TPLFacadeLabel:t("./lib/templates/tpl-facade-label"),TPLFacadeTitles:t("./lib/templates/tpl-facade-titles"),TPLHeaderBodyFooter:t("./lib/templates/tpl-header-body-footer"),TPLBodyExpand:t("./lib/templates/tpl-body-expand"),TPLBodyHeaderTitles:t("./lib/templates/tpl-body-header-titles"),TPLFacadeExpandLabel:t("./lib/templates/tpl-facade-expand-label"),TPLFacadeExpandTitle:t("./lib/templates/tpl-facade-expand-title")}},{"./lib/button-base":170,"./lib/buttons/button-drag-handle":171,"./lib/buttons/button-ex":172,"./lib/buttons/button-tool":173,"./lib/display-object":175,"./lib/display-object-container":174,"./lib/disposable-htmlelement":176,"./lib/dom-template":177,"./lib/extensions/ext-base":178,"./lib/extensions/ext-drag":179,"./lib/extensions/ext-drop":180,"./lib/extensions/ext-expand":181,"./lib/extensions/ext-mouse":183,"./lib/extensions/ext-mouse-move":182,"./lib/helpers/catalog-builder":184,"./lib/helpers/catalog-view-builder":185,"./lib/helpers/flag-box":186,"./lib/helpers/flag-enum":187,"./lib/helpers/frame":188,"./lib/helpers/pop-in":189,"./lib/helpers/toolbar":190,"./lib/helpers/widget-selection":191,"./lib/input":192,"./lib/keyboard":193,"./lib/manipulators/manipulator-base":195,"./lib/manipulators/manipulator-image":196,"./lib/manipulators/manipulator-text":197,"./lib/mouse":198,"./lib/templates/tpl-body-expand":199,"./lib/templates/tpl-body-header-titles":200,"./lib/templates/tpl-facade-expand-label":201,"./lib/templates/tpl-facade-expand-title":202,"./lib/templates/tpl-facade-label":203,"./lib/templates/tpl-facade-titles":204,"./lib/templates/tpl-header-body-footer":205,"./lib/tree/tree-item":207,"./lib/tree/tree-item-group":206,"./lib/tree/tree-root":208,"./lib/ui":212,"./lib/ui-flag":209,"./lib/ui-id":210,"./lib/ui-signal":211,"./lib/views/drawer":214,"./lib/views/drawer-nav":213,"./lib/views/layer":216,"./lib/views/layer-container":215,"./lib/views/view":217,"./lib/widget":220,"./lib/widget-catalog":218,"./lib/widget-orientable":219}],170:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.NFOS,c=a.SIGNAL,u=a.Observer,h=a.OptionsHandler,d,p=t("@nkmjs/actions").Request,f,g=t("@nkmjs/actions").Command,m=t("./ui"),y=t("./ui-signal"),v=t("./ui-flag"),k=t("./widget"),C=t("./helpers/flag-enum"),O=function(t){_inherits(ButtonBase,t);var e=_createSuper(ButtonBase);function ButtonBase(){return _classCallCheck(this,ButtonBase),e.call(this)}return _createClass(ButtonBase,[{key:"_Init",value:function _Init(){var t=this;_get(_getPrototypeOf(ButtonBase.prototype),"_Init",this).call(this),this._alwaysDisplayCommand=s.Default(this._alwaysDisplayCommand,!1),this._command=null,this._isCommandTrigger=!0,this._isCommandContext=!0,this._isToggled=!1,this._commandObserver=new u,this._commandObserver.Hook(c.UPDATED,this._OnCommandUpdated,this),this._flags.Add(this,v.TOGGLED),this._sizeEnum=new C(v.sizes),this._sizeEnum.Add(this),this._flavorEnum=new C(v.flavors),this._flavorEnum.Add(this),this._variantEnum=new C(v.variants),this._variantEnum.Add(this),this._optionsHandler=new h(null,this._Bind(this._OnOptionsWillUpdate)),this._optionsHandler.Hook("data"),this._optionsHandler.Hook("htitle"),this._optionsHandler.Hook("trigger"),this._optionsHandler.Hook("toggle"),this._optionsHandler.Hook("request"),this._optionsHandler.Hook("command"),this._optionsHandler.Hook("isCommandTrigger"),this._optionsHandler.Hook("isCommandContext"),this._optionsHandler.Hook("alwaysVisible","alwaysDisplayCommand"),this._optionsHandler.Hook("flagOn",(function(e){for(var n=0,i=e.length;n<i;n++)t._flags.Set(e[n],!0)})),this._optionsHandler.Hook("flagOff",(function(e){for(var n=0,i=e.length;n<i;n++)t._flags.Set(e[n],!1)})),this._optionsHandler.Hook("size",(function(e){t._sizeEnum.Set(e)})),this._optionsHandler.Hook("flavor",(function(e){t._flavorEnum.Set(e)})),this._optionsHandler.Hook("variant",(function(e){t._variantEnum.Set(e)}))}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(ButtonBase.prototype),"_PostInit",this).call(this),this._sizeEnum.Set(this.constructor.__default_size),this._flavorEnum.Set(this.constructor.__default_flavor),this._variantEnum.Set(this.constructor.__default_variant)}},{key:"size",get:function get(){return this._sizeEnum.currentFlag},set:function set(t){this._sizeEnum.Set(t)}},{key:"flavor",get:function get(){return this._flavorEnum.currentFlag},set:function set(t){this._flavorEnum.Set(t)}},{key:"variant",get:function get(){return this._variantEnum.currentFlag},set:function set(t){this._variantEnum.Set(t)}},{key:"isToggled",get:function get(){return this._isToggled}},{key:"isActivable",set:function set(t){_set(_getPrototypeOf(ButtonBase.prototype),"isActivable",t,this,!0),this._flags.Set(v.DISABLED,!this._isActivable)}},{key:"isCommandTrigger",get:function get(){return this._isCommandTrigger},set:function set(t){this._isCommandTrigger=t}},{key:"isCommandContext",get:function get(){return this._isCommandContext},set:function set(t){this._isCommandContext=t}},{key:"alwaysDisplayCommand",get:function get(){return this._alwaysDisplayCommand},set:function set(t){this._alwaysDisplayCommand=t,t&&this._command&&(this.visible=!0)}},{key:"_Render",value:function _Render(){this.focusArea=this}},{key:"options",set:function set(t){t&&(this._optionsHandler.Process(this,t),this._flags.Set(v.NO_SCALE,!!t.noscale&&t.noscale))}},{key:"_OnOptionsWillUpdate",value:function _OnOptionsWillUpdate(t){t&&(t.htitle=s.Get(t,"htitle",s.Default(t.label,"")))}},{key:"command",get:function get(){return this._command},set:function set(t){if(this._command!==t){var e=this._command;this._command=t,e&&this._commandObserver.Unobserve(t),t?(this._commandObserver.Observe(t),this._OnCommandUpdated(t),this.htitle=t.name,this.order=t.order):this.order=0}}},{key:"_OnCommandUpdated",value:function _OnCommandUpdated(t){this.visible=!!this._alwaysDisplayCommand||t.isEnabled}},{key:"trigger",get:function get(){return this._trigger},set:function set(t){this._trigger=t}},{key:"toggle",get:function get(){return this._toggle},set:function set(t){this._toggle=t}},{key:"request",get:function get(){return this._request},set:function set(t){this._request=t}},{key:"Activate",value:function Activate(t){if(!_get(_getPrototypeOf(ButtonBase.prototype),"Activate",this).call(this,t))return!1;if(this._isCommandTrigger&&this._command&&(this._command.emitter=this,this._isCommandContext?this._command.Execute(this):this._command.Execute()),this._trigger){var e=s.Get(this._trigger,"thisArg",null),n;if(this._trigger.argArray)(n=this._trigger.fn).call.apply(n,[e].concat(_toConsumableArray(this._trigger.argArray)));else this._trigger.arg?this._trigger.arg===v.SELF?this._trigger.fn.call(e,this):this._trigger.fn.call(e,this._trigger.arg):this._trigger.fn.call(e)}if(this._toggle)if(this._isToggled)this._toggle.yoyo&&this.Deactivate();else{this._isToggled=!0,this._flags.Set(v.TOGGLED,!0);var i=s.Get(this._toggle,"thisArg",null),a;if(this._toggle.argArray)(a=this._toggle.fn).call.apply(a,[i].concat(_toConsumableArray(this._toggle.argArray)));else this._toggle.arg?this._toggle.arg===v.SELF?this._toggle.fn.call(i,this):this._toggle.fn.call(i,this._toggle.arg):this._toggle.fn.call(i)}if(this._request){if(!this._request.type)throw new Error("Cannot generate request of type 'null'");var l=s.Get(this._request,"emitter",this),c=s.Get(this._request,"options"),u=s.Get(this._request,"proxy",null);if(u){var h=s.Get(u,"thisArg",null);c=u.argArray?u.fn.apply(h,u.argArray):u.arg?u.fn.call(h,u.arg):u.fn.call(h)}l._EmitLocalRequest(opts.type,c,s.Get(this._request,"onSuccess",null),s.Get(this._request,"onFail",null),s.Get(this._request,"timeout",0),s.Get(this._request,"cl",p))}return this._Broadcast(y.TRIGGERED,this),!0}},{key:"Deactivate",value:function Deactivate(){if(this._isToggled){if(this._isToggled=!1,this._flags.Set(v.TOGGLED,!1),this._toggle&&this._toggle.fnOff){var t=s.Get(this._toggle,"thisArg",null),e;if(this._toggle.argArray)(e=this._toggle.fnOff).call.apply(e,[t].concat(_toConsumableArray(this._toggle.argArray)));else this._toggle.arg?this._toggle.arg===v.SELF?this._toggle.fnOff.call(t,this):this._toggle.fnOff.call(t,this._toggle.arg):this._toggle.fnOff.call(t)}this._Broadcast(y.DEACTIVATED,this)}}},{key:"_CleanUp",value:function _CleanUp(){this.htitle="",this.command=null,this._isCommandTrigger=!0,this._isCommandContext=!0,this._isToggled=!1,this.toggle=null,this.trigger=null,this.request=null,this.isActivable=!0,this._flags.ApplyAll(!1),this._sizeEnum.Set(this.constructor.__default_size),this._flavorEnum.Set(this.constructor.__default_flavor),this._variantEnum.Set(this.constructor.__default_variant),_get(_getPrototypeOf(ButtonBase.prototype),"_CleanUp",this).call(this)}}]),ButtonBase}(k);_defineProperty(O,"__NFO__",l.Ext({css:["@/buttons/shared.css"]},k,["css"])),_defineProperty(O,"__default_size",null),_defineProperty(O,"__default_flavor",null),_defineProperty(O,"__default_variant",null),e.exports=O},{"./helpers/flag-enum":187,"./ui":212,"./ui-flag":209,"./ui-signal":211,"./widget":220,"@nkmjs/actions":1,"@nkmjs/common":27,"@nkmjs/utils":271}],171:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").NFOS,c,u=t("@nkmjs/style").CSS,h=t("../ui-flag"),d=t("../ui"),p=t("./button-tool"),f=function(t){_inherits(ButtonDragHandle,t);var e=_createSuper(ButtonDragHandle);function ButtonDragHandle(){return _classCallCheck(this,ButtonDragHandle),e.call(this)}return _createClass(ButtonDragHandle,[{key:"_Style",value:function _Style(){return u.Extends({":host":_defineProperty({cursor:"move"},"cursor","grab"),":host(.focused)":_defineProperty({cursor:"move"},"cursor","grab")},_get(_getPrototypeOf(ButtonDragHandle.prototype),"_Style",this).call(this))}}]),ButtonDragHandle}(p);_defineProperty(f,"__NFO__",l.Ext({css:["@/buttons/button-drag-handle.css"]},p,["css"])),e.exports=f,d.Register("nkmjs-button-drag-handle",f)},{"../ui":212,"../ui-flag":209,"./button-tool":173,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/utils":271}],172:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").NFOS,u=t("@nkmjs/style"),h=u.CSS,d=u.FONT_FLAG,p=t("../ui-flag"),f=t("../ui-id"),g=t("../ui.js"),m=t("../button-base"),y=t("../manipulators"),v=y.TextManipulator,k=y.ImageManipulator,C=function(t){_inherits(ButtonEx,t);var e=_createSuper(ButtonEx);function ButtonEx(){return _classCallCheck(this,ButtonEx),e.call(this)}return _createClass(ButtonEx,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ButtonEx.prototype),"_Init",this).call(this),this._optionsHandler.Hook(f.ICON,null,""),this._optionsHandler.Hook(f.LABEL,null,""),this._optionsHandler.Hook("uppercaseText"),this._icon=null,this._label=null,this._flags.Add(this,p.NO_ICON,p.NO_LABEL)}},{key:"_OnDataUpdated",value:function _OnDataUpdated(t){_get(_getPrototypeOf(ButtonEx.prototype),"_OnDataUpdated",this).call(this,t)}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._flags.Set(p.NO_ICON,!this._icon.Set(t))}},{key:"label",get:function get(){return this._label},set:function set(t){this._flags.Set(p.NO_LABEL,!this._label.Set(t))}},{key:"_Render",value:function _Render(){_get(_getPrototypeOf(ButtonEx.prototype),"_Render",this).call(this),this._icon=new k(a.New("span",{class:f.ICON},this._host)),this._label=new v(a.New("span",{class:f.LABEL},this._host))}},{key:"_CleanUp",value:function _CleanUp(){this._icon.Set(null),this._label.Set(null),_get(_getPrototypeOf(ButtonEx.prototype),"_CleanUp",this).call(this)}}]),ButtonEx}(m);_defineProperty(C,"__NFO__",c.Ext({css:["@/buttons/button-ex.css"]},m,["css"])),e.exports=C,g.Register("nkmjs-button-ex",C)},{"../button-base":170,"../manipulators":194,"../ui-flag":209,"../ui-id":210,"../ui.js":212,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/utils":271}],173:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").NFOS,u,h=t("@nkmjs/style").CSS,d=t("../ui-flag"),p=t("../ui-id"),f=t("../ui.js"),g=t("../button-base"),m=t("../manipulators/manipulator-image"),y=function(t){_inherits(ToolButton,t);var e=_createSuper(ToolButton);function ToolButton(){return _classCallCheck(this,ToolButton),e.call(this)}return _createClass(ToolButton,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ToolButton.prototype),"_Init",this).call(this),this._optionsHandler.Hook(p.ICON,null,""),this._icon=null}},{key:"_OnDataUpdated",value:function _OnDataUpdated(t){_get(_getPrototypeOf(ToolButton.prototype),"_OnDataUpdated",this).call(this,t)}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._icon.Set(t)}},{key:"_Render",value:function _Render(){_get(_getPrototypeOf(ToolButton.prototype),"_Render",this).call(this),this._icon=new m(a.New("span",{class:p.ICON},this._host),!1)}},{key:"_PostRender",value:function _PostRender(){this._icon.Set(null)}},{key:"_CleanUp",value:function _CleanUp(){this._icon.Set(null),_get(_getPrototypeOf(ToolButton.prototype),"_CleanUp",this).call(this)}}]),ToolButton}(g);_defineProperty(y,"__NFO__",c.Ext({css:["@/buttons/button-tool.css"]},g,["css"])),e.exports=y,f.Register("nkmjs-tool-button",y)},{"../button-base":170,"../manipulators/manipulator-image":196,"../ui-flag":209,"../ui-id":210,"../ui.js":212,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/utils":271}],174:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("./ui"),c=t("./ui-signal"),u=t("./display-object"),h=function(t){_inherits(DisplayObjectContainer,t);var e=_createSuper(DisplayObjectContainer);function DisplayObjectContainer(){return _classCallCheck(this,DisplayObjectContainer),e.call(this)}return _createClass(DisplayObjectContainer,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DisplayObjectContainer.prototype),"_Init",this).call(this),this._displayObjects=new Array(0)}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(DisplayObjectContainer.prototype),"_PostInit",this).call(this),this._wrapper||(this._wrapper=this._host)}},{key:"count",get:function get(){return this._displayObjects.length}},{key:"At",value:function At(t){return this._displayObjects[t]}},{key:"Add",value:function Add(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;if((i>=this._displayObjects.length||i<0)&&(i=-1),s.isFunc(t)&&s.isInstanceOf(t,u)&&(t=l.Rent(t)),!t)throw new Error("Cannot Add an empty display object.");if(this._displayObjects.includes(t))return-1===i||this.Move(t,i),t;if(n&&n!==this?s.isInstanceOf(n,DisplayObjectContainer)&&(n=n.wrapper):n=this._wrapper,-1===i){this._displayObjects.push(t),i=this._displayObjects.length-1;try{n.appendChild(t)}catch(t){throw t}}else this._displayObjects.splice(i,0,t),n.insertBefore(t,this._displayObjects[i]);if(t.parent=this,e)if(e.includes(" "))for(var a=e.split(" "),c=0,h=a.length;c<h;c++)t.classList.add(a[c]);else t.classList.add(e);return this._OnChildAdded(t,i),t}},{key:"Move",value:function Move(t,e){if(!this._displayObjects.includes(t))throw new Error("Provided display object is not a child of this container.");console.warning("DisplayObject.Move is not implemented."),this._OnChildMoved(t,e,e)}},{key:"Remove",value:function Remove(t){var e=this._displayObjects.indexOf(t);return-1===e?t:this.RemoveAt(e)}},{key:"RemoveAt",value:function RemoveAt(t){if(t<0||t>=this._displayObjects.length)return null;var e=this._displayObjects[t];return this._displayObjects.splice(t,1),e.parent===this&&(e.parent=null,a.Detach(e)),this._OnChildRemoved(e,t),e}},{key:"_OnChildAdded",value:function _OnChildAdded(t,e){this._Broadcast(c.CHILD_ADDED,this,t,e)}},{key:"_OnChildMoved",value:function _OnChildMoved(t,e,n){this._Broadcast(c.CHILD_MOVED,this,t,e,n)}},{key:"_OnChildRemoved",value:function _OnChildRemoved(t,e){this._Broadcast(c.CHILD_ADDED,this,t,e)}}]),DisplayObjectContainer}(u);e.exports=h},{"./display-object":175,"./ui":212,"./ui-signal":211,"@nkmjs/utils":271}],175:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=i.PATH,c=t("@nkmjs/collections"),u=c.Dictionary,h=c.List,d=c.DictionaryList,p=t("@nkmjs/actions"),f=p.RELAY,g=p.Request,m=t("@nkmjs/common"),y=m.SignalBox,v=m.NFOS,k=t("@nkmjs/style"),C=k.STYLE,O=k.CSS,E=t("./ui"),S=t("./ui-flag"),I=t("./disposable-htmlelement"),b=t("./helpers/flag-box"),D=function(t){_inherits(DisplayObject,t);var e=_createSuper(DisplayObject);function DisplayObject(){return _classCallCheck(this,DisplayObject),e.call(this)}return _createClass(DisplayObject,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DisplayObject.prototype),"_Init",this).call(this),this._isTransformDirty=!1,this._transforms={},this._wrapper=null,this._host=null,this._styles=null,this._shadowConfig={mode:"open"},this._visible=!0,this._flags=new b,this._requestSignalBox=null,this._order=null,this._parent=null}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(DisplayObject.prototype),"_PostInit",this).call(this),this._BuildHost(),this._wrapper=this._host,this._PrintStyle(),this._Render(),this._PostRender()}},{key:"order",get:function get(){return this._order},set:function set(t){this._order!==t&&(this._order=t,null===t?this.style.removeProperty("--order"):this.style.setProperty("--order",t))}},{key:"host",get:function get(){return this._host}},{key:"wrapper",get:function get(){return this._wrapper}},{key:"_BuildHost",value:function _BuildHost(){this._host=this.attachShadow(this._shadowConfig)}},{key:"_Style",value:function _Style(){}},{key:"_PrintStyle",value:function _PrintStyle(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._styles){for(var e=0,n=this._styles.length;e<n;e++)this._styles[e].remove();this._styles.length=0}this._styles=C.Get(this.constructor,this._Bind(this._Style),t);for(var i=0,s=this._styles.length;i<s;i++)a.Attach(this._styles[i].cloneNode(!0),this._host)}},{key:"_Render",value:function _Render(){}},{key:"_PostRender",value:function _PostRender(){}},{key:"BringToFront",value:function BringToFront(){a.ToFront(this)}},{key:"parent",get:function get(){return this._parent},set:function set(t){if(this._parent!==t){var e=this._parent;this._parent=t,e&&e.Remove(this),this._parent&&this._parent.Add(this),this._OnParentChanged(e)}}},{key:"_OnParentChanged",value:function _OnParentChanged(t){}},{key:"visible",get:function get(){return this._visible},set:function set(t){this._visible!==t&&(this._visible=t,t?this.style.removeProperty("display"):this.style.display="none")}},{key:"flags",get:function get(){return this._flags}},{key:"_EmitLocalRequest",value:function _EmitLocalRequest(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:g;this._HandleLocalRequest(g.Emit(t,e,this,n,i,s,a,!1))}},{key:"_HandleLocalRequest",value:function _HandleLocalRequest(t){t.emitter!=this&&this._requestSignalBox&&this._requestSignalBox.Broadcast(t.requestType,t),this._parent?this._parent._HandleLocalRequest(t):f.HandleRequest(t)}},{key:"_RegisterLocalRequestHandler",value:function _RegisterLocalRequestHandler(t,e){this._requestSignalBox||(this._requestSignalBox=new y),this._requestSignalBox.Add(t,e,this)}},{key:"_UnregisterLocalRequestHandler",value:function _UnregisterLocalRequestHandler(t,e){this._requestSignalBox&&this._requestSignalBox.Remove(t,e,this)}},{key:"transforms",get:function get(){return this._transforms},set:function set(t){this._transforms!==t&&(this._transforms=t,this._DirtyTransform())}},{key:"dirty",get:function get(){return this._isTransformDirty}},{key:"_DirtyTransform",value:function _DirtyTransform(){this._isTransformDirty||(this._isTransformDirty=!0,E.AddDirty(this))}},{key:"x",get:function get(){return s.Get(this._transforms,"x",0)},set:function set(t){this._transforms.x!=t&&(this._transforms.x=t,this._DirtyTransform())}},{key:"y",get:function get(){return s.Get(this._transforms,"y",0)},set:function set(t){this._transforms.y!=t&&(this._transforms.y=t,this._DirtyTransform())}},{key:"z",get:function get(){return s.Get(this._transforms,"z",0)},set:function set(t){this._transforms.z!=t&&(this._transforms.z=t,this._DirtyTransform())}},{key:"rotation",get:function get(){return s.Get(this._transforms,"rotation",0)},set:function set(t){this._transforms.rotation!=t&&(this._transforms.rotation=t,this._DirtyTransform())}},{key:"rotationX",get:function get(){return s.Get(this._transforms,"rotationX",0)},set:function set(t){this._transforms.rotationX!=t&&(this._transforms.rotationX=t,this._DirtyTransform())}},{key:"rotationY",get:function get(){return s.Get(this._transforms,"rotationY",0)},set:function set(t){this._transforms.rotationY!=t&&(this._transforms.rotationY=t,this._DirtyTransform())}},{key:"rotationZ",get:function get(){return s.Get(this._transforms,"rotationZ",0)},set:function set(t){this._transforms.rotationZ!=t&&(this._transforms.rotationZ=t,this._DirtyTransform())}},{key:"scale",get:function get(){return s.Get(this._transforms,"scale",0)},set:function set(t){this._transforms.scale!=t&&(this._transforms.scale=t,this._DirtyTransform())}},{key:"scaleX",get:function get(){return s.Get(this._transforms,"scaleX",0)},set:function set(t){this._transforms.scaleX!=t&&(this._transforms.scaleX=t,this._DirtyTransform())}},{key:"scaleY",get:function get(){return s.Get(this._transforms,"scaleY",0)},set:function set(t){this._transforms.scaleY!=t&&(this._transforms.scaleY=t,this._DirtyTransform())}},{key:"scaleZ",get:function get(){return s.Get(this._transforms,"scaleZ",0)},set:function set(t){this._transforms.scaleZ!=t&&(this._transforms.scaleZ=t,this._DirtyTransform())}},{key:"ApplyTransforms",value:function ApplyTransforms(){var t=this._transforms;if(t){var e=s.Get(t,"rotation",0),n=s.Get(t,"rotationX",0),i=s.Get(t,"rotationY",0),a=s.Get(t,"rotationZ",0),l="".concat(0===e?"":"rotate(".concat(e,"deg)")).concat(0===n?"":"rotateX(".concat(n,"deg)")).concat(0===i?"":"rotateX(".concat(i,"deg)")).concat(0===a?"":"rotateZ(".concat(a,"deg)")),c=s.Get(t,"x",0),u=s.Get(t,"y",0),h=s.Get(t,"z",0),d="".concat(0===c?"":"translateX(".concat(c,"px)")).concat(0===u?"":"translateY(".concat(u,"px)")).concat(0===h?"":"translateZ(".concat(h,"px)")),p=s.Get(t,"scale",1),f=s.Get(t,"scaleX",1),g=s.Get(t,"scaleY",1),m=s.Get(t,"scaleZ",1),y="".concat(1===p?"":"scale(".concat(p,",").concat(p,")")).concat(1===f?"":"scaleX(".concat(f,")")).concat(1===g?"":"scaleX(".concat(g,")")).concat(1===m?"":"scaleZ(".concat(m,")"));this.style.transform="".concat(d).concat(l).concat(y),this._isTransformDirty=!1}else this.style.removeProperty("transform")}},{key:"size",set:function set(t){this.width=t,this.height=t}},{key:"width",set:function set(t){this.style.width=s.isEmpty(t)?"":"".concat(t,"px")}},{key:"height",set:function set(t){this.style.height=s.isEmpty(t)?"":"".concat(t,"px")}},{key:"sizeRel",set:function set(t){this.widthRel=t,this.heightRel=t}},{key:"widthRel",set:function set(t){this.style.width=s.isEmpty(t)?"":"".concat(t,"%")}},{key:"heightRel",set:function set(t){this.style.height=s.isEmpty(t)?"":"".concat(t,"%")}},{key:"_CleanUp",value:function _CleanUp(){this.visible=!0,this.parent=null,this.order=null,this._transforms={},this.style.removeProperty("transform"),_get(_getPrototypeOf(DisplayObject.prototype),"_CleanUp",this).call(this),a.Detach(this)}},{key:"displayPath",get:function get(){for(var t=new Array(0),e=this._parent;null!=e;)t.push(e.constructor.name),e=e.parent;return t.reverse(),t.push(this.constructor.name),t.join(".")}}]),DisplayObject}(I);e.exports=D},{"./disposable-htmlelement":176,"./helpers/flag-box":186,"./ui":212,"./ui-flag":209,"@nkmjs/actions":1,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/utils":271}],176:[function(t,e,n){var i=t("@nkmjs/common"),s=i.SIGNAL,a=i.SignalBox,l,c=t("@nkmjs/utils").UDOM,u=t("./ui-signal"),h=0,d=function(t){_inherits(DisposableHTMLElement,t);var e=_createSuper(DisposableHTMLElement);function DisposableHTMLElement(){var t;return _classCallCheck(this,DisposableHTMLElement),(t=e.call(this))._Init(),t._PostInit(),t}return _createClass(DisposableHTMLElement,[{key:"_Init",value:function _Init(){this._uinc=h++,this._returnFn=null,this._releasing=!1,this._releasePrevented=!1,this._signals=new a,this._released=!1,this._isPainted=!1,this._isFirstPaint=!0}},{key:"_PostInit",value:function _PostInit(){}},{key:"_Bind",value:function _Bind(t){return this[t.name]=t.bind(this)}},{key:"isPainted",get:function get(){return this._isPainted}},{key:"_OnPaintChange",value:function _OnPaintChange(){this._isPainted?(this._isFirstPaint&&this._signals.Broadcast(u.FIRST_PAINT,this),this._signals.Broadcast(u.PAINTED,this)):this._signals.Broadcast(u.UNPAINTED,this)}},{key:"_Broadcast",value:function _Broadcast(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(e=this._signals).Broadcast.apply(e,[t].concat(i))}},{key:"Watch",value:function Watch(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._signals.Add(t,e,n)}},{key:"WatchOnce",value:function WatchOnce(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._signals.AddOnce(t,e,n)}},{key:"Unwatch",value:function Unwatch(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._signals.Remove(t,e,n)}},{key:"returnFunc",set:function set(t){this._returnFn=t}},{key:"returnContext",set:function set(t){this._returnContext=t}},{key:"PreventRelease",value:function PreventRelease(){this._releasePrevented=!0}},{key:"Release",value:function Release(){if(!this._releasing){if(this._releasing=!0,this._Broadcast(s.RELEASING,this),this._releasePrevented)return this._releasing=!1,void(this._releasePrevented=!1);this._released=!0,this._Broadcast(s.RELEASED,this),this._CleanUp(),c.Detach(this),null!=this._returnFn&&this._returnFn(this),this._releasing=!1}}},{key:"_CleanUp",value:function _CleanUp(){this._releasePrevented=!1,this._signals.Clear(),this._isFirstPaint=!0,this.constructor.__paintingObserver.unobserve(this)}},{key:"Wake",value:function Wake(){this._released=!1,this._Wake(),this._PostWake(),this.constructor.__paintingObserver.observe(this)}},{key:"_Wake",value:function _Wake(){}},{key:"_PostWake",value:function _PostWake(){}},{key:"toString",value:function toString(){return"<".concat(this.constructor.name,">")}}]),DisposableHTMLElement}(_wrapNativeSuper(HTMLElement));_defineProperty(d,"__usePaintCallback",!1),_defineProperty(d,"__paintingObserver",new IntersectionObserver((function(t,e){for(var n=0,i=t.length;n<i;n++){var s=t[n],a=s.target;if(s.isIntersecting){if(a._isPainted)continue;a._isPainted=!0,a.constructor.__usePaintCallback&&a._OnPaintChange(),a._isFirstPaint=!1}else{if(!a._isPainted)continue;a._isPainted=!1,a.constructor.__usePaintCallback&&a._OnPaintChange()}}}),{threshold:0})),e.exports=d},{"./ui-signal":211,"@nkmjs/common":27,"@nkmjs/utils":271}],177:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").COM_ID,u=function(){function DOMTemplate(){_classCallCheck(this,DOMTemplate)}return _createClass(DOMTemplate,[{key:"Render",value:function Render(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"_wrapper"in t&&(t=t._wrapper);var n=s.Get(e,c.OWNER,this);n||(n=this);var i=this.constructor.__HTMLtemplate;i||(this.constructor._CreateTemplate(),i=this.constructor.__HTMLtemplate);for(var a=0,l=i.length;a<l;a++){var u=i[a],h=u.node.cloneNode(!0);u.parent?n[u.parent].appendChild(h):t.appendChild(h),u.id&&(n[u.id]=h)}return n}}],[{key:"_CreateTemplate",value:function _CreateTemplate(){if(this.__HTMLtemplate)throw new Error("HTMLTemplate (".concat(this.name,") initialized more than once."));this.__HTMLtemplate=new Array(0)}},{key:"_Add",value:function _Add(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i={node:t};e&&(i.id=e),n&&(i.parent=n),this.__HTMLtemplate.push(i)}},{key:"Render",value:function Render(t,e,n){var i=new t;return i.Render(e,n),i}}]),DOMTemplate}();_defineProperty(u,"__HTMLtemplate",null),e.exports=u},{"@nkmjs/common":27,"@nkmjs/utils":271}],178:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.DisposableObjectEx,c=a.POOL,u=function(t){_inherits(ExtBase,t);var e=_createSuper(ExtBase);function ExtBase(){var t;return _classCallCheck(this,ExtBase),(t=e.call(this))._isEnabled=!1,t._childExtensions=null,t}return _createClass(ExtBase,[{key:"Add",value:function Add(t){return this._childExtensions||(this._childExtensions=new Array(0)),this._childExtensions.includes(t)||(s.isFunc(t)&&(t=c.Rent(t)),this._childExtensions.push(t),t.enabled=this._isEnabled),t}},{key:"Remove",value:function Remove(t){return!this._childExtensions||this._childExtensions.includes(t)?null:(this._childExtensions.push(t),t.Disable(),t)}},{key:"isEnabled",get:function get(){return this._isEnabled}},{key:"enabled",set:function set(t){t?this.Enable():this.Disable()}},{key:"Enable",value:function Enable(){if(this._isEnabled)return!1;if(this._isEnabled=!0,this._childExtensions)for(var t=0,e=this._childExtensions.length;t<e;t++)this._childExtensions[t].Enable();return!0}},{key:"Disable",value:function Disable(){if(!this._isEnabled)return!1;if(this._isEnabled=!1,this._childExtensions)for(var t=0,e=this._childExtensions.length;t<e;t++)this._childExtensions[t].Disable();return!0}},{key:"_CleanUp",value:function _CleanUp(){this.Disable(),this._childExtensions.length=0,this._childExtensions=null,_get(_getPrototypeOf(ExtBase.prototype),"_CleanUp",this).call(this)}}]),ExtBase}(l);e.exports=u},{"@nkmjs/common":27,"@nkmjs/utils":271}],179:[function(t,e,n){var i,s=t("@nkmjs/utils").UDOM,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.Observer,u=a.DisposableObjectEx,h=t("../ui"),d=t("../input"),p=t("../ui-flag"),f=t("../ui-signal"),g=t("./ext-base"),m=t("../mouse"),y=new Array(0),v=function(t){_inherits(ExtDrag,t);var e=_createSuper(ExtDrag);function ExtDrag(){return _classCallCheck(this,ExtDrag),e.call(this)}return _createClass(ExtDrag,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ExtDrag.prototype),"_Init",this).call(this),this._isEnabled=!0,this._target=null,this._activator=null,this._feedbackHost=null,this._grabDataCallback=null,this._ownerObserver=new c,this._ownerObserver.Hook(f.DRAG_STARTED,this._OnOwnerDragStarted,this),this._ownerObserver.Hook(f.DRAG_ENDED,this._OnOwnerDragEnded,this),this._ownerObserver.Hook(l.RELEASED,this._OnOwnerReleased,this),this._Bind(this._mUp),this._Bind(this._mDown),this._Bind(this._mDragStart),this._Bind(this._mDrag),this._Bind(this._mDragEnd),this._hintElement=null}},{key:"_OnOwnerReleased",value:function _OnOwnerReleased(t){this.owner=null}},{key:"grabDataCallback",get:function get(){return this._grabDataCallback},set:function set(t){this._grabDataCallback=t}},{key:"activator",get:function get(){return this._activator},set:function set(t){if(this._activator!==t){var e=this._activator;this._activator=t,this._isEnabled&&(e&&e.removeEventListener("mousedown",this._mDown),t&&t.addEventListener("mousedown",this._mDown))}}},{key:"owner",get:function get(){return this._owner},set:function set(t){this._owner!==t&&(this._owner=t,this._ownerObserver.ObserveOnly(t))}},{key:"Setup",value:function Setup(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this._target;this._target=t,this.activator=e||t,this._feedbackHost=n||t,i&&i.flags.Remove(i,p.DRAGGED),t&&t.flags.Add(t,p.DRAGGED)}},{key:"isEnabled",get:function get(){return this._isEnabled}},{key:"enabled",set:function set(t){t?this.Enable():this.Disable()}},{key:"Enable",value:function Enable(){return!!_get(_getPrototypeOf(ExtDrag.prototype),"Enable",this).call(this)&&(this._activator&&this._activator.addEventListener("mousedown",this._mDown),!0)}},{key:"Disable",value:function Disable(){return!!_get(_getPrototypeOf(ExtDrag.prototype),"Disable",this).call(this)&&(this._activator&&this._activator.removeEventListener("mousedown",this._mDown),!0)}},{key:"_mDown",value:function _mDown(t){this._isEnabled&&t.button===m.BTN_LEFT&&(this._target.setAttribute("draggable",!0),this._target.addEventListener("dragstart",this._mDragStart),m.Watch(m.MOUSE_UP,this._mUp))}},{key:"_mUp",value:function _mUp(t){this._isEnabled&&t.button===m.BTN_LEFT&&(m.Unwatch(m.MOUSE_UP,this._mUp),this._EndDrag())}},{key:"_mDragStart",value:function _mDragStart(t){this._feedbackHost&&(console.log(t),t.dataTransfer.setDragImage(this._feedbackHost,-10,-10)),m.Unwatch(m.MOUSE_UP,this._mUp),this._target.addEventListener("dragend",this._mDragEnd),this._target.addEventListener("drag",this._mDrag),y.length=0,this._OwnerBroadcast(f.DRAG_STARTED),h.DragStarted(y,this._target),this._ShowHint()}},{key:"_mDrag",value:function _mDrag(t){m.instance._mMove(t),this._OwnerBroadcast(f.DRAGGED)}},{key:"_mDragEnd",value:function _mDragEnd(t){this._EndDrag(),this._OwnerBroadcast(f.DRAG_ENDED),h.DragEnded()}},{key:"_GrabData",value:function _GrabData(){return this._grabDataCallback()}},{key:"_EndDrag",value:function _EndDrag(){this._target.removeAttribute("draggable"),this._target.removeEventListener("dragstart",this._mDragStart),this._target.removeEventListener("dragend",this._mDragEnd),this._target.removeEventListener("drag",this._mDrag),this._HideHint()}},{key:"_OwnerBroadcast",value:function _OwnerBroadcast(t){this._owner._Broadcast(t,this._owner)}},{key:"_OnOwnerDragStarted",value:function _OnOwnerDragStarted(t){this._isEnabled&&(y.push(this._GrabData()),this._target.flags.Set(p.DRAGGED,!0))}},{key:"_OnOwnerDragEnded",value:function _OnOwnerDragEnded(t){this._isEnabled&&this._target.flags.Set(p.DRAGGED,!1)}},{key:"_ShowHint",value:function _ShowHint(){this._feedbackHost&&(this._hintElement?s.Attach(this._hintElement,this._feedbackHost):this._hintElement=s.New("div",{class:"ext-overlay drag-overlay"},this._feedbackHost))}},{key:"_HideHint",value:function _HideHint(){this._hintElement&&s.Detach(this._hintElement)}},{key:"_CleanUp",value:function _CleanUp(){this._HideHint(),this._hintElement=null,this._EndDrag(),_get(_getPrototypeOf(ExtDrag.prototype),"_CleanUp",this).call(this)}}]),ExtDrag}(g);e.exports=v},{"../input":192,"../mouse":198,"../ui":212,"../ui-flag":209,"../ui-signal":211,"./ext-base":178,"@nkmjs/common":27,"@nkmjs/utils":271}],180:[function(t,e,n){var i,s=t("@nkmjs/utils").UDOM,a=t("../input"),l=t("../mouse"),c=t("../ui"),u=t("../ui-flag"),h=t("../ui-signal"),d=t("./ext-base"),p=null,f=function(t){_inherits(ExtDrop,t);var e=_createSuper(ExtDrop);function ExtDrop(){return _classCallCheck(this,ExtDrop),e.call(this)}return _createClass(ExtDrop,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ExtDrop.prototype),"_Init",this).call(this),this._target=null,this._feedbackHost=null,this._hooks=new Array(0),this._allowedHooks=new Array(0),this._onDragOverHooks=new Array(0),this._onLeaveHooks=new Array(0),this._isAcceptingCurrentData=!1,this._isActive=!1,this._Bind(this._mDragEnter),this._Bind(this._mDragLeave),this._Bind(this._mDragOver),this._Bind(this._mDrop),this._hintElement=null}},{key:"target",get:function get(){return this._target},set:function set(t){if(this._target!==t){var e=this._target;this._target=t,this._isEnabled&&(e&&e.removeEventListener("dragenter",this._mDragEnter),t&&t.addEventListener("dragenter",this._mDragEnter))}}},{key:"Setup",value:function Setup(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._target;this.target=t,this._feedbackHost=e||t,n&&n.flags.Remove(n,u.ALLOW_DROP),t&&t.flags.Add(t,u.ALLOW_DROP)}},{key:"Enable",value:function Enable(){return!!_get(_getPrototypeOf(ExtDrop.prototype),"Enable",this).call(this)&&(this._target&&this._target.addEventListener("dragenter",this._mDragEnter),!0)}},{key:"Disable",value:function Disable(){return!!_get(_getPrototypeOf(ExtDrop.prototype),"Disable",this).call(this)&&(this._target&&this._target.removeEventListener("dragenter",this._mDragEnter),!0)}},{key:"_mDragEnter",value:function _mDragEnter(t){this._allowedHooks.length=0,this._onDragOverHooks.length=0,this._onLeaveHooks.length=0;for(var e=c.DRAG_DATA,n=0,i=this._hooks.length;n<i;n++){var s=this._hooks[n],a=!1;t:for(var l=0,u=e.length;l<u;l++){var h=e[l];if(a=s.check.thisArg?s.check.fn.call(s.check.thisArg,h):s.check.fn(h))break t}a&&(this._allowedHooks.push(s),s.drag&&this._onDragOverHooks.push(s.drag),s.leave&&this._onLeaveHooks.push(s.leave))}0===this._allowedHooks.length?(this._isAcceptingCurrentData=!1,this._Clear()):(this._isAcceptingCurrentData=!0,this._target.addEventListener("dragleave",this._mDragLeave),this._target.addEventListener("dragover",this._mDragOver))}},{key:"_dragEnd",value:function _dragEnd(t){this._Clear()}},{key:"_mDragLeave",value:function _mDragLeave(t){this._Clear()}},{key:"_mDragOver",value:function _mDragOver(t){if(t.defaultPrevented)this._Activate(!1);else if(this._isAcceptingCurrentData){t.preventDefault(),this._Activate(!0);for(var e=c.DRAG_DATA,n=0,i=this._onDragOverHooks.length;n<i;n++){var s=this._onDragOverHooks[n];s.thisArg?s.fn.call(s.thisArg,e):s.fn(e)}}}},{key:"_mDrop",value:function _mDrop(t){for(var e=c.DRAG_DATA,n=!1,i=0,s=e.length;i<s;i++)for(var a=e[i],l=0,u=this._allowedHooks.length;l<u;l++){var d=this._allowedHooks[l];(n=d.check.thisArg?d.check.fn.call(d.check.thisArg,a):d.check.fn(a))&&(d.drop?d.drop.fn.call(d.drop.thisArg,a):d.drop.fn(a))}c.DRAG_TARGET._Broadcast(h.DROPPED,c.DRAG_TARGET),this._Clear()}},{key:"_Activate",value:function _Activate(t){if(this._isActive!==t){if(this._isActive=t,this._feedbackHost){this._feedbackHost.flags.Set(u.ALLOW_DROP,t);for(var e=0,n=this._allowedHooks.length;e<n;e++){var i,s=this._allowedHooks[e].flag;if(s)if(Array.isArray(s))for(var a=0,l=s.length;a<l;a++)this._feedbackHost.flags.Set(s[a],t);else this._feedbackHost.flags.Set(s,t)}}t?(ExtDrop.ACTIVE_TARGET=this,this._target.addEventListener("drop",this._mDrop),c.instance.Unwatch(h.DRAG_ENDED,this._dragEnd,this)):(ExtDrop.ACTIVE_TARGET===this&&(ExtDrop.ACTIVE_TARGET=null),this._target.removeEventListener("drop",this._mDrop),c.instance.Watch(h.DRAG_ENDED,this._dragEnd,this))}}},{key:"_Clear",value:function _Clear(){for(var t=c.DRAG_DATA,e=0,n=this._onLeaveHooks.length;e<n;e++){var i=this._onLeaveHooks[e];i.thisArg?i.fn.call(i.thisArg,t):i.fn(t)}this._target.removeEventListener("dragleave",this._mDragLeave),this._target.removeEventListener("dragover",this._mDragOver),this._Activate(!1)}},{key:"_ShowHint",value:function _ShowHint(){this._feedbackHost&&(this._hintElement?s.Attach(this._hintElement,this._feedbackHost):this._hintElement=s.New("div",{class:"ext-overlay drag-overlay"},this._feedbackHost))}},{key:"_HideHint",value:function _HideHint(){this._hintElement&&s.Detach(this._hintElement)}},{key:"Hook",value:function Hook(t){this._hooks.push(t)}},{key:"_CleanUp",value:function _CleanUp(){this._hooks.length=0,_get(_getPrototypeOf(ExtDrop.prototype),"_CleanUp",this).call(this)}}],[{key:"ACTIVE_TARGET",get:function get(){return p},set:function set(t){var e=p;p=t,e&&e._Activate(!1),p&&p._Activate(!0)}}]),ExtDrop}(d);e.exports=f},{"../input":192,"../mouse":198,"../ui":212,"../ui-flag":209,"../ui-signal":211,"./ext-base":178,"@nkmjs/utils":271}],181:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").DisposableObjectEx,c=t("../ui-flag"),u=t("../ui-signal"),h=t("../display-object"),d,p=function(t){_inherits(ExtExpand,t);var e=_createSuper(ExtExpand);function ExtExpand(){return _classCallCheck(this,ExtExpand),e.call(this)}return _createClass(ExtExpand,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ExtExpand.prototype),"_Init",this).call(this),this._target=null,this._wrapper=null,this._isExpanded=!1,this._activator=null,this._activateOnAlt=!1,this._Bind(this._mClick)}},{key:"isExpanded",get:function get(){return this._isExpanded}},{key:"activateOnAlt",get:function get(){return this._activateOnAlt},set:function set(t){this._activateOnAlt=t}},{key:"activator",get:function get(){return this._activator},set:function set(t){var e=this._activator;this._activator=t,this._isEnabled&&(e&&(s.isInstanceOf(e,h)?e.Unwatch(u.ACTIVATED,this._OnWidgetActivated,this):e.removeEventListener("click",this._mClick)),t&&(s.isInstanceOf(t,h)?t.Watch(u.ACTIVATED,this._OnWidgetActivated,this):t.addEventListener("click",this._mClick)))}},{key:"Setup",value:function Setup(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._target=t,this._wrapper=e,t&&(t.flags.Add(t,c.EXPANDED,c.COLLAPSED),e&&t.flags.Add(e,c.EXPANDED,c.COLLAPSED),this._UpdateFlags(),this._Broadcast(this._isExpanded?u.EXPANDED:u.COLLAPSED),n&&(this.activator=n,this._activateOnAlt=i))}},{key:"Enable",value:function Enable(){return!!_get(_getPrototypeOf(ExtExpand.prototype),"Enable",this).call(this)&&(this._activator&&(s.isInstanceOf(this._activator,h)?this._activator.Watch(u.ACTIVATED,this._OnWidgetActivated,this):this._activator.addEventListener("click",this._mClick)),!0)}},{key:"Disable",value:function Disable(){return!!_get(_getPrototypeOf(ExtExpand.prototype),"Disable",this).call(this)&&(this._activator&&(s.isInstanceOf(this._activator,h)?this._activator.Unwatch(u.ACTIVATED,this._OnWidgetActivated,this):this._activator.removeEventListener("click",this._mClick)),!0)}},{key:"_OnWidgetActivated",value:function _OnWidgetActivated(t,e){this.Toggle()}},{key:"_mClick",value:function _mClick(t){t.detail>1?this._activateOnAlt&&this.Toggle():this._activateOnAlt||this.Toggle()}},{key:"Toggle",value:function Toggle(){this._isExpanded?this.Collapse():this.Expand()}},{key:"Expand",value:function Expand(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isExpanded||(this._isExpanded=!0,this._UpdateFlags(),t&&this._target.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),this._Broadcast(u.EXPANDED))}},{key:"Collapse",value:function Collapse(){this._isExpanded&&(this._isExpanded=!1,this._UpdateFlags(),this._Broadcast(u.COLLAPSED))}},{key:"_UpdateFlags",value:function _UpdateFlags(){this._target&&(this._target.flags.Set(c.EXPANDED,this._isExpanded),this._target.flags.Set(c.COLLAPSED,!this._isExpanded))}},{key:"_CleanUp",value:function _CleanUp(){this._HideHint(),this._hintElement=null,this._target=null,_get(_getPrototypeOf(ExtExpand.prototype),"_CleanUp",this).call(this)}}]),ExtExpand}(t("./ext-base"));e.exports=p},{"../display-object":175,"../ui-flag":209,"../ui-signal":211,"./ext-base":178,"@nkmjs/common":27,"@nkmjs/utils":271}],182:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.DisposableObjectEx,u=t("../ui-flag"),h=t("../helpers/flag-enum"),d=t("../input"),p,f=function(t){_inherits(ExtMouseMove,t);var e=_createSuper(ExtMouseMove);function ExtMouseMove(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return _classCallCheck(this,ExtMouseMove),(t=e.call(this))._element=n,t._isMouseOver=!1,t._Bind(t._mOver),t._Bind(t._mOut),t._Bind(t._mMove),t._moveFn=null,t._startPos=null,t._currentPos=null,t._currentOffset=null,t}return _createClass(ExtMouseMove,[{key:"element",get:function get(){return this._element},set:function set(t){if(this._element!==t){var e=this._element;this._element=t,this._isEnabled&&(e&&e.removeEventListener("mouseenter",this._mOver),this._element&&this._element.addEventListener("mouseenter",this._mOver))}}},{key:"Enable",value:function Enable(){return!!_get(_getPrototypeOf(ExtMouseMove.prototype),"Enable",this).call(this)&&(this._element&&this._element.addEventListener("mouseenter",this._mOver),!0)}},{key:"Disable",value:function Disable(){return!!_get(_getPrototypeOf(ExtMouseMove.prototype),"Disable",this).call(this)&&(this._element&&this._element.removeEventListener("mouseenter",this._mOver),!0)}},{key:"isMouseOver",get:function get(){return this._isMouseOver}},{key:"startPos",get:function get(){return this._startPos}},{key:"currentPos",get:function get(){return this._currentPos}},{key:"currentOffset",get:function get(){return this._currentOffset}},{key:"PinStart",value:function PinStart(){this._startPos.x=this._currentPos.x,this._startPos.y=this._currentPos.y}},{key:"distanceToStart",get:function get(){var t=this._startPos.x-this._currentPos.x,e=this._startPos.y-this._currentPos.y;return Math.sqrt(t*t+e*e)}},{key:"distanceOffset",get:function get(){var t=this._currentOffset.x,e=this._currentOffset.y;return Math.sqrt(t*t+e*e)}},{key:"moveFn",set:function set(t){this._moveFn=t}},{key:"_mOver",value:function _mOver(t){this._isMouseOver||(this._isMouseOver=!0,this._startPos={x:t.clientX,y:t.clientY},this._currentPos={x:t.clientX,y:t.clientY},this._currentOffset={x:0,y:0},this._element.addEventListener("mousemove",this._mMove))}},{key:"_mOut",value:function _mOut(t){this._isMouseOver&&(this._isMouseOver=!1,this._element.removeEventListener("mousemove",this._mMove))}},{key:"_mMove",value:function _mMove(t){this._currentOffset.x=this._currentPos.x-t.clientX,this._currentOffset.y=this._currentPos.y-t.clientY,this._currentPos.x=t.clientX,this._currentPos.y=t.clientY,this._moveFn&&this._moveFn(this)}}]),ExtMouseMove}(t("./ext-base"));e.exports=f},{"../helpers/flag-enum":187,"../input":192,"../ui-flag":209,"./ext-base":178,"@nkmjs/common":27,"@nkmjs/utils":271}],183:[function(t,e,n){var i=t("../ui"),s=t("../mouse"),a=t("../ui-signal"),l,c=function(t){_inherits(ExtMouse,t);var e=_createSuper(ExtMouse);function ExtMouse(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return _classCallCheck(this,ExtMouse),(t=e.call(this))._element=n,t._hooks={},t._using={},t._buttons={},t._isMouseOver=!1,t._isAnyBtnDown=!1,t._Bind(t._mOver),t._Bind(t._mOut),t._Bind(t._mDown),t._Bind(t._mUp),t._Bind(t._mUpOutside),t._Bind(t._mWheel),t._focusFn=null,t}return _createClass(ExtMouse,[{key:"wheelFn",set:function set(t){this._wheelFn=t}},{key:"focusFn",set:function set(t){this._focusFn=t}},{key:"element",get:function get(){return this._element},set:function set(t){if(this._element!==t){var e=this._element;this._element=t,this._isEnabled&&(e&&e.removeEventListener("mouseenter",this._mOver),this._element&&this._element.addEventListener("mouseenter",this._mOver))}}},{key:"Enable",value:function Enable(){return!!_get(_getPrototypeOf(ExtMouse.prototype),"Enable",this).call(this)&&(this._element&&this._element.addEventListener("mouseenter",this._mOver),!0)}},{key:"Disable",value:function Disable(){return!!_get(_getPrototypeOf(ExtMouse.prototype),"Disable",this).call(this)&&(this._element&&this._element.removeEventListener("mouseenter",this._mOver),!0)}},{key:"isMouseOver",get:function get(){return this._isMouseOver}},{key:"isMouseDown",value:function isMouseDown(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===t){for(var e in this._buttons)if(this._buttons[e]===s.DOWN)return!0;return!1}return t in this._buttons&&this._buttons[t]===s.DOWN}},{key:"_mOver",value:function _mOver(t){this._isMouseOver=!0,this._element.addEventListener("mousedown",this._mDown),this._element.addEventListener("mouseup",this._mUp),this._element.addEventListener("mouseleave",this._mOut),this._isAnyBtnDown&&s.Unwatch(s.MOUSE_UP,this._mUpOutside),this._focusFn&&this._focusFn(!0),this._wheelFn&&this._element.addEventListener("wheel",this._mWheel)}},{key:"_mOut",value:function _mOut(t){this._isMouseOver=!1,this._element.removeEventListener("mousedown",this._mDown),this._element.removeEventListener("mouseup",this._mUp),this._element.removeEventListener("mouseleave",this._mOut),this._isAnyBtnDown?s.Watch(s.MOUSE_UP,this._mUpOutside):this._focusFn&&this._focusFn(!1),this._wheelFn&&this._element.removeEventListener("wheel",this._mWheel)}},{key:"_mDown",value:function _mDown(t){s.instance.StartUsing(this._using),this._isAnyBtnDown=!0;var e=t.button;this._buttons[e]=s.DOWN,this._Trigger("".concat(e,"_").concat(s.DOWN)),i.Watch(a.DRAG_ENDED,this._mUpOutside)}},{key:"_mUp",value:function _mUp(t){var e=t.button;this._buttons[e]===s.DOWN?(this._buttons[e]=s.UP,this._Trigger("".concat(e,"_").concat(s.UP)),1===t.detail?this._Trigger("".concat(e,"_").concat(s.RELEASE)):2===t.detail&&this._Trigger("".concat(e,"_").concat(s.RELEASE_TWICE))):(this._buttons[e]=s.UP,this._Trigger("".concat(e,"_").concat(s.UP))),delete this._buttons[e],this._isAnyBtnDown=this.isMouseDown(),this._isAnyBtnDown||(i.Unwatch(a.DRAG_ENDED,this._mUpOutside),s.instance.StopUsing(this._using))}},{key:"_mUpOutside",value:function _mUpOutside(t){if(t){var e=t.button;this._buttons[e]===s.DOWN&&this._Trigger("".concat(e,"_").concat(s.RELEASE_OUTSIDE)),delete this._buttons[e]}else{for(var n in this._buttons)this._Trigger("".concat(this._buttons[n],"_").concat(s.RELEASE_OUTSIDE));this._buttons={}}this._isAnyBtnDown=this.isMouseDown(),this._isAnyBtnDown||(this._focusFn&&this._focusFn(!1),s.Unwatch(s.MOUSE_UP,this._mUpOutside),i.Unwatch(a.DRAG_ENDED,this._mUpOutside),s.instance.StopUsing(this._using))}},{key:"_mWheel",value:function _mWheel(t){this._wheelFn&&this._wheelFn(t)}},{key:"Hook",value:function Hook(t,e,n){var i="".concat(t,"_").concat(e),s=this._hooks[i];this._using[t]?this._using[t]++:this._using[t]=1,(s=s?this._hooks[i]:this._hooks[i]=new Array(0)).includes(n)||s.push(n)}},{key:"Unhook",value:function Unhook(t,e,n){var i="".concat(t,"_").concat(e),s=this._hooks[i];if(s){this._using[t]&&(this._using[t]--,this._using[t]<=0&&delete this._using[t]);var a=s.indexOf(n);-1!==a&&s.splice(a,1)}}},{key:"_Trigger",value:function _Trigger(t,e){if(this._isEnabled){var n=this._hooks[t];if(n)for(var i=0,s=n.length;i<s;i++)n[i](e)}}}]),ExtMouse}(t("./ext-base"));e.exports=c},{"../mouse":198,"../ui":212,"../ui-signal":211,"./ext-base":178}],184:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.BINDINGS,c=a.SIGNAL,u=t("@nkmjs/data-core"),h=u.CatalogItem,d=u.Catalog,p,f=function(t){_inherits(CatalogBuilder,t);var e=_createSuper(CatalogBuilder);function CatalogBuilder(){return _classCallCheck(this,CatalogBuilder),e.call(this)}return _createClass(CatalogBuilder,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CatalogBuilder.prototype),"_Init",this).call(this),this._defaultItemClass=null,this._defaultGroupClass=null,this._host=null}},{key:"host",get:function get(){return this._host},set:function set(t){this._host=t}},{key:"_OnCatalogItemAdded",value:function _OnCatalogItemAdded(t,e){if(!_get(_getPrototypeOf(CatalogBuilder.prototype),"_OnCatalogItemAdded",this).call(this,t,e))return!1;var n=null;return n=s.isInstanceOf(e,d)?this._owner.Add(l.Get(this._owner,e,this._defaultGroupClass),"item group",this._host):this._owner.Add(l.Get(this._owner,e,this._defaultItemClass),"item",this._host),this._map.set(e,n),n.data=e,this._Broadcast(c.ITEM_ADDED,this,e,n),!0}},{key:"_OnCatalogItemRemoved",value:function _OnCatalogItemRemoved(t,e){var n=_get(_getPrototypeOf(CatalogBuilder.prototype),"_OnCatalogItemRemoved",this).call(this,t,e);return!1!==n&&(this._Broadcast(c.ITEM_REMOVED,this,e,n),n&&n.Release(),n)}},{key:"_OnCatalogSorted",value:function _OnCatalogSorted(t){for(var e,n=0,i=0,s=this._catalog._items.length;i<s;i++){var a=this._items[i],l=this._map.get(a);l&&(a.isDir?l.order=n:l.order=this._itemCount+n,n++)}_get(_getPrototypeOf(CatalogBuilder.prototype),"_OnCatalogSorted",this).call(this,t)}},{key:"_CleanUp",value:function _CleanUp(){this._defaultItemClass=null,this._defaultGroupClass=null,this._host=null,_get(_getPrototypeOf(CatalogBuilder.prototype),"_CleanUp",this).call(this)}}]),CatalogBuilder}(u.CatalogWatcher);e.exports=f},{"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/utils":271}],185:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").SIGNAL,c=t("@nkmjs/data-core"),u=c.CatalogItem,h=c.Catalog,d=c.CatalogWatcher,p=t("../ui"),f=t("../ui-id"),g=t("../views/view"),m=function(t){_inherits(CatalogViewBuilder,t);var e=_createSuper(CatalogViewBuilder);function CatalogViewBuilder(){return _classCallCheck(this,CatalogViewBuilder),e.call(this)}return _createClass(CatalogViewBuilder,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CatalogViewBuilder.prototype),"_Init",this).call(this),this._reverseMap=new Map}},{key:"_OnCatalogItemAdded",value:function _OnCatalogItemAdded(t,e){if(!_get(_getPrototypeOf(CatalogViewBuilder.prototype),"_OnCatalogItemAdded",this).call(this,t,e))return!1;var n=e.GetOption("view",null);if(n){if(!s.isInstanceOf(n,g))throw new Error("view is not of type View.")}else{var i=e.GetOption("viewType",null);if(!i)throw new Error("Drawer's item has neither a view or a viewType set.");if(!s.isInstanceOf(i,g))throw new Error("viewType (".concat(i.name,") is not of type View"));n=p.Rent(i),e.SetOption(f.VIEW,n)}return this._map.set(e,n),this._reverseMap.set(n,e),e.data?n.data=e.data:n.data=e,this._Broadcast(l.ITEM_ADDED,this,e,n),!0}},{key:"_OnCatalogItemRemoved",value:function _OnCatalogItemRemoved(t,e){var n=_get(_getPrototypeOf(CatalogViewBuilder.prototype),"_OnCatalogItemRemoved",this).call(this,t,e);return!1!==n&&(this._reverseMap.delete(n),this._Broadcast(l.ITEM_REMOVED,this,e,n),n.Release(),n)}}]),CatalogViewBuilder}(d);e.exports=m},{"../ui":212,"../ui-id":210,"../views/view":217,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/utils":271}],186:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/collections"),c=l.Dictionary,u=l.List,h=l.DictionaryList,d=t("@nkmjs/actions"),p=d.RELAY,f=d.Request,g,m=t("@nkmjs/common").SignalBox,y=t("@nkmjs/style"),v=y.STYLE,k=y.CSS,C=t("../ui"),O=t("../ui-flag"),E=Symbol("null"),S=function(){function FlagBox(){_classCallCheck(this,FlagBox),this._elements=null,this._flags=new c}return _createClass(FlagBox,[{key:"Set",value:function Set(t,e){return e?(this._flags.Set(t,!0),this.Apply(t,!0)):(this._flags.Set(t,!1),this.Apply(t,!1)),e}},{key:"IsSet",value:function IsSet(t){var e=this._flags.Get(t);return e||!1}},{key:"Toggle",value:function Toggle(t){this.Set(t,!this.IsSet(t))}},{key:"Add",value:function Add(t){this._elements||(this._elements=new h);for(var e=0,n=arguments.length<=1?0:arguments.length-1;e<n;e++)this._elements.Set(e+1<1||arguments.length<=e+1?void 0:arguments[e+1],t)}},{key:"Remove",value:function Remove(t){if(this._elements)for(var e=0,n=arguments.length<=1?0:arguments.length-1;e<n;e++)this._elements.Remove(e+1<1||arguments.length<=e+1?void 0:arguments[e+1],t)}},{key:"Apply",value:function Apply(t,e){if(this._elements){var n=this._elements.Get(t);if(n)if(e)for(var i=0,s=n.length;i<s;i++)n[i].classList.add(t);else for(var a=0,l=n.length;a<l;a++)n[a].classList.remove(t)}}},{key:"ApplyAll",value:function ApplyAll(t){if(this._elements)for(var e=this._elements.keys,n=0,i=e.length;n<i;n++)for(var s=e[n],a=this._elements.Get(s),l=0,c=a.length;l<c;l++)t?a[l].classList.add(s):a[l].classList.remove(s)}},{key:"Clear",value:function Clear(){this._flags.Clear(),this._elements&&this._elements.Clear()}}]),FlagBox}();e.exports=S},{"../ui":212,"../ui-flag":209,"@nkmjs/actions":1,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/utils":271}],187:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/collections"),c=l.Dictionary,u=l.List,h=l.DictionaryList,d=t("@nkmjs/actions"),p=d.RELAY,f=d.Request,g=t("@nkmjs/common"),m=g.SignalBox,y=g.SignalBroadcaster,v=g.POOL,k=t("@nkmjs/style"),C=k.STYLE,O=k.CSS,E=t("../ui"),S=t("../ui-flag"),I=function(){function FlagEnum(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,FlagEnum),this._elements=new Array(0),this._managed=new Array(0),this._enum=t||new Array(0),this._currentFlag=null,this._onFlagChanged=v.Rent(y)}return _createClass(FlagEnum,[{key:"currentFlag",get:function get(){return this._currentFlag}},{key:"onFlagChanged",get:function get(){return this._onFlagChanged}},{key:"AddEnum",value:function AddEnum(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];1===e.length&&s.isArray(e[0])&&(e=e[0]);for(var i=0,a=e.length;i<a;i++)this._enum.includes(e[i])||this._enum.push(e[i])}},{key:"RemoveEnum",value:function RemoveEnum(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i;1===e.length&&s.isArray(e[0])&&(e=e[0]);for(var a=0,l=e.length;a<l;a++)-1!=(i=this._enum.indexOf(e[a]))&&this._enum.slice(i,1)}},{key:"Add",value:function Add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,s=e.length;i<s;i++)this._elements.includes(e[i])||this._elements.push(e[i])}},{key:"Remove",value:function Remove(){for(var t=0,e=arguments.length;t<e;t++){var n=this._elements.indexOf(t<0||arguments.length<=t?void 0:arguments[t]);-1!=n&&this._elements.slice(n,1)}}},{key:"AddManaged",value:function AddManaged(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,s=e.length;i<s;i++)this._managed.includes(e[i])||this._managed.push(e[i])}},{key:"RemoveManaged",value:function RemoveManaged(){for(var t=0,e=arguments.length;t<e;t++){var n=this._managed.indexOf(t<0||arguments.length<=t?void 0:arguments[t]);-1!=n&&this._managed.slice(n,1)}}},{key:"Apply",value:function Apply(t,e){for(var n=0,i=e.length;n<i;n++){var s=e[n];t in s&&(s[t]=this._currentFlag)}}},{key:"Set",value:function Set(t){if(t&&!this._enum.includes(t))throw new Error("flag '".concat(t,"' not part of enum ").concat(this._enum));for(var e=0,n=this._managed.length;e<n;e++)this._managed[e].Set(t);if(this._currentFlag!==t){var i=this._currentFlag,s;if(this._currentFlag=t,!i&&t)for(var a=0,l=this._elements.length;a<l;a++)this._elements[a].classList.add(t);else if(i&&!t)for(var c=0,u=this._elements.length;c<u;c++)this._elements[c].classList.remove(i);else for(var h=0,d=this._elements.length;h<d;h++)(s=this._elements[h]).classList.add(t),s.classList.remove(i);this._onFlagChanged.Broadcast(t,i)}}},{key:"Bump",value:function Bump(t){var e=this._enum.indexOf(this._currentFlag),n;this._enum.indexOf(t)>e&&this.Set(t)}},{key:"Clear",value:function Clear(){this.Set(null),this._flags.Clear(),this._elements.length=0,this._enum.length=0}}]),FlagEnum}();e.exports=I},{"../ui":212,"../ui-flag":209,"@nkmjs/actions":1,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/utils":271}],188:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").NFOS,u=t("../ui"),h=t("../ui-flag"),d,p=t("../manipulators").ImageManipulator,f,g=function(t){_inherits(Frame,t);var e=_createSuper(Frame);function Frame(){return _classCallCheck(this,Frame),e.call(this)}return _createClass(Frame,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Frame.prototype),"_Init",this).call(this),this._imgManipulator=null}},{key:"_Style",value:function _Style(){return{":host":{transition:"all 0.15s ease",position:"relative","min-width":0,"@":["cover"]},":host(.focused)":{},":host(.focused) .toolbar":{},":host(.selected)":{},":host(.selected.focused)":{}}}},{key:"_Render",value:function _Render(){this._imgManipulator=new p(this,!1)}},{key:"Set",value:function Set(t){return this._imgManipulator.Set(t)}},{key:"_CleanUp",value:function _CleanUp(){this._imgManipulator.Set(null),_get(_getPrototypeOf(Frame.prototype),"_CleanUp",this).call(this)}}]),Frame}(t("../display-object"));e.exports=g,u.Register("nkmjs-frame",g)},{"../display-object":175,"../manipulators":194,"../ui":212,"../ui-flag":209,"@nkmjs/common":27,"@nkmjs/utils":271}],189:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/common"),c=l.TIME,u=l.SIGNAL,h=l.OptionsHandler,d=t("../ui"),p=t("../ui-flag"),f=t("../ui-signal"),g=t("../display-object-container"),m=t("./flag-enum"),y=function(t){_inherits(PopIn,t);var e=_createSuper(PopIn);function PopIn(){return _classCallCheck(this,PopIn),e.call(this)}return _createClass(PopIn,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(PopIn.prototype),"_Init",this).call(this),this._content=null,this._options=null,this._placement=null,this._placementEnum=new m(p.placements),this._placementEnum.Add(this),this._modeEnum=new m(PopIn.MODE_ANCHOR,PopIn.MODE_FLOAT_INSIDE,PopIn.MODE_FLOAT_OUTSIDE),this._modeEnum.Add(this),this._optionsHandler=new h(this._Bind(this._OnOptionsProcessed)),this._optionsHandler.Hook("mode"),this._optionsHandler.Hook("context",null,document.body),this._optionsHandler.Hook("anchor"),this._optionsHandler.Hook("placement",null,PopIn.CENTER),this._optionsHandler.Hook("origin",null,PopIn.CENTER),this._ownsContent=!1,this._Bind(this._UpdateAnchoredPosition)}},{key:"options",get:function get(){return this._options},set:function set(t){if(this._options=t,this.content=t.content,!this._content)throw new Error("PopIn options has no content set.");this._optionsHandler.Process(this,this._options)}},{key:"mode",get:function get(){return this._modeEnum.currentFlag},set:function set(t){this._modeEnum.Set(t)}},{key:"placement",get:function get(){return this._placement},set:function set(t){this._placement=t}},{key:"origin",get:function get(){return this._placement},set:function set(t){this._placement=t}},{key:"content",get:function get(){return this._content},set:function set(t){var e=this;this._content!==t&&(this._content&&(this._ownsContent&&this._content.Release(),this._content=null),t?(this._ownsContent=s.isFunc(t),this._content=this.Add(t,"content"),this._content.Watch(f.CLOSE_REQUESTED,(function(){e.Release()}))):this._ownsContent=!1)}},{key:"context",get:function get(){return this._context},set:function set(t){this._context!==t&&(this._context&&a.Detach(this),this._context=t,this._context&&a.Attach(this,this._context))}},{key:"anchor",get:function get(){return this._anchor},set:function set(t){this._anchor!==t&&(this._anchor=t,this._anchor?c.Watch(u.TICK,this._UpdateAnchoredPosition):c.Unwatch(u.TICK,this._UpdateAnchoredPosition))}},{key:"_OnOptionsProcessed",value:function _OnOptionsProcessed(t){}},{key:"_Style",value:function _Style(){return{":host":{position:"absolute",border:"2px solid #ff0000",display:"flex"},":host(.mode-float-inside)":{},":host(.mode-anchor)":{}}}},{key:"_UpdateAnchoredPosition",value:function _UpdateAnchoredPosition(){var t=a.Rect(this._anchor,this.parentElement),e=t.x+.5*t.width,n=t.y+.5*t.height,i=e+t.width*this._placement.x,s=n+t.height*this._placement.y;this._placement.x,this._placement.y,this.style.left="".concat(i,"px"),this.style.top="".concat(s,"px")}},{key:"_CleanUp",value:function _CleanUp(){this._ownsContent=!1,this.context=null,this.content=null,this.anchor=null,this.mode=null,this._options=null,_get(_getPrototypeOf(PopIn.prototype),"_CleanUp",this).call(this)}}],[{key:"Pop",value:function Pop(t){var e=d.Rent(PopIn);return e.options=t,e}}]),PopIn}(g);_defineProperty(y,"MODE_ANCHOR","mode-anchor"),_defineProperty(y,"MODE_FLOAT_INSIDE","mode-float-inside"),_defineProperty(y,"MODE_FLOAT_OUTSIDE","mode-float-outside"),_defineProperty(y,"LEFT",{x:-.5,y:0}),_defineProperty(y,"RIGHT",{x:.5,y:0}),_defineProperty(y,"TOP",{x:0,y:-.5}),_defineProperty(y,"BOTTOM",{x:0,y:.5}),_defineProperty(y,"TOP_LEFT",{x:-.5,y:-.5}),_defineProperty(y,"TOP_RIGHT",{x:.5,y:-.5}),_defineProperty(y,"BOTTOM_LEFT",{x:-.5,y:.5}),_defineProperty(y,"BOTTOM_RIGHT",{x:.5,y:.5}),_defineProperty(y,"CENTER",{x:0,y:0}),e.exports=y,d.Register("nkmjs-pop-in",y)},{"../display-object-container":174,"../ui":212,"../ui-flag":209,"../ui-signal":211,"./flag-enum":187,"@nkmjs/common":27,"@nkmjs/utils":271}],190:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/common"),c=l.NFOS,u=l.SIGNAL,h,d=t("@nkmjs/collections").Dictionary,p=t("../ui.js"),f=t("../ui-flag"),g=t("../widget-orientable"),m=t("../buttons/button-tool"),y=t("../button-base"),v=t("./flag-enum"),k=t("../ui-signal"),C="stretch",O="stretch-same",E=function(t){_inherits(Toolbar,t);var e=_createSuper(Toolbar);function Toolbar(){return _classCallCheck(this,Toolbar),e.call(this)}return _createClass(Toolbar,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Toolbar.prototype),"_Init",this).call(this),this._defaultButtonClass=m,this._optionsMap=new d,this._handles=new Array(0),this._groups={},this._radioMap={},this._flags.Add(this,Toolbar.FLAG_STRETCH,Toolbar.FLAG_STRETCH_SAME),this._stretchEnum=new v([C,O]),this._stretchEnum.Add(this),this._sizeEnum=new v(f.sizes),this._sizeEnum.Add(this),this._sizeEnum.onFlagChanged.Add(this._Bind(this._OnSizeChanged))}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(Toolbar.prototype),"_PostInit",this).call(this),this._sizeEnum.Set(this.constructor.__default_size)}},{key:"size",get:function get(){return this._sizeEnum.currentFlag},set:function set(t){this._sizeEnum.Set(t)}},{key:"_Style",value:function _Style(){return{":host":{position:"relative",display:"flex","justify-content":"flex-start","align-items":"center"},":host(.vertical)":{"flex-flow":"column nowrap"},":host(.horizontal)":{"flex-flow":"row nowrap"},".group":{position:"relative",flex:"0 0 auto",display:"flex","justify-content":"flex-start","align-items":"center"},".item":{position:"relative",flex:"0 0 auto","min-width":"0","min-height":"0"},":host(.stretch), :host(.stretch-same)":{"align-items":"stretch","align-content":"stretch",flex:"1 1 auto"}}}},{key:"stretch",set:function set(t){this._stretchEnum.Set(t)}},{key:"_Render",value:function _Render(){this.focusArea=this}},{key:"_OnSizeChanged",value:function _OnSizeChanged(t,e){this._sizeEnum.Apply("size",this._handles)}},{key:"CreateHandle",value:function CreateHandle(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=s.Default(e,t.cl,this._defaultButtonClass),i,a=s.Get(t,"group",null),l=a?s.Get(t,"toggle",null):null;return a?(a=this.GetGroup(a,!0),i=this.Add(n,"item",a.element),a.handles.push(i),l&&(i.Watch(k.ACTIVATED,this._OnRadioActivated,this),i.Watch(k.DEACTIVATED,this._OnRadioDeactivated,this))):i=this.Add(n,"item"),this._optionsMap.Set(i,t),i.Watch(u.RELEASED,this._OnHandleReleased,this),s.isInstanceOf(i,y)&&(i.options=t,i.size=this._sizeEnum.currentFlag),i.flags.Set(this._orientation,!0),this._handles.push(i),i}},{key:"GetGroup",value:function GetGroup(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t in this._groups)return this._groups[t];if(!e)return null;var n={element:a.New("span",{class:"group"},this),handles:[]};return this._groups[t]=n,n}},{key:"_OnRadioActivated",value:function _OnRadioActivated(t){var e,n=this._optionsMap.Get(t).radio,i;n in this._radioMap&&this._radioMap[n].Deactivate();this._radioMap[n]=t}},{key:"_OnRadioDeactivated",value:function _OnRadioDeactivated(t){var e,n=this._optionsMap.Get(t).radio,i;n in this._radioMap&&(this._radioMap[n]===t&&delete this._radioMap[n])}},{key:"_OnHandleReleased",value:function _OnHandleReleased(t){var e=this._optionsMap.Get(t),n=s.Get(e,"group",null);if(n){var i=this.GetGroup(n);i.handles.splice(i.handles.indexOf(t),1),0===i.handles.length&&(a.Detach(i.element),i.element=null,i.handles.length=0,delete this._groups[n])}t.classList.remove("item"),this._optionsMap.Remove(t);var l=this._handles.indexOf(t);-1!=l&&this._handles.splice(l,1)}},{key:"Clear",value:function Clear(){for(;0!=this._handles.length;)this._handles.pop().Release()}},{key:"_CleanUp",value:function _CleanUp(){this.Clear(),this._sizeEnum.Set(this.constructor.__default_size),_get(_getPrototypeOf(Toolbar.prototype),"_CleanUp",this).call(this)}}],[{key:"FLAG_STRETCH",get:function get(){return C}},{key:"FLAG_STRETCH_SAME",get:function get(){return O}}]),Toolbar}(g);_defineProperty(E,"__NFO__",c.Ext({css:["@/helpers/toolbar.css"]},g,["css"])),_defineProperty(E,"__default_size",f.SIZE_M),e.exports=E,p.Register("nkmjs-toolbar",E)},{"../button-base":170,"../buttons/button-tool":173,"../ui-flag":209,"../ui-signal":211,"../ui.js":212,"../widget-orientable":219,"./flag-enum":187,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],191:[function(t,e,n){var i=t("@nkmjs/common"),s=i.SIGNAL,a=i.DisposableObjectEx,l,c=t("@nkmjs/collections").List,u=t("../ui-signal"),h=t("../input"),d=function(t){_inherits(WidgetSelection,t);var e=_createSuper(WidgetSelection);function WidgetSelection(){return _classCallCheck(this,WidgetSelection),e.call(this)}return _createClass(WidgetSelection,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(WidgetSelection.prototype),"_Init",this).call(this),this._stack=new c,this._shareEvents=!0,this._allowMultiple=!0,this._clearing=!1,this._sharingEvent=!1}},{key:"shareEvents",get:function get(){return this._shareEvents},set:function set(t){this._shareEvents=t}},{key:"allowMultiple",get:function get(){return this._allowMultiple},set:function set(t){this._allowMultiple=t,t||this.Clear()}},{key:"Add",value:function Add(t){return this._stack.Contains(t)?(h.ctrl&&this.Remove(t),!1):(this._allowMultiple&&h.ctrl||this.Clear(),this._stack.Add(t),t.Watch(u.SELECTION_LOST,this._OnItemSelectionLost,this),t.Watch(u.DRAG_STARTED,this._OnItemDragStarted,this),t.Watch(u.DRAG_ENDED,this._OnItemDragEnded,this),t.Watch(s.RELEASED,this._OnItemReleased,this),t.Select(!0),this._Broadcast(s.ITEM_ADDED,t),!0)}},{key:"Remove",value:function Remove(t){this._stack.Remove(t)&&(t.Select(!1),t.Unwatch(u.SELECTION_LOST,this._OnItemSelectionLost,this),t.Unwatch(u.DRAG_STARTED,this._OnItemDragStarted,this),t.Unwatch(u.DRAG_ENDED,this._OnItemDragEnded,this),t.Unwatch(s.RELEASED,this._OnItemReleased,this),this._Broadcast(s.ITEM_REMOVED,t))}},{key:"_OnItemSelectionLost",value:function _OnItemSelectionLost(t){this.Remove(t)}},{key:"_OnItemReleased",value:function _OnItemReleased(t){this.Remove(t)}},{key:"_OnItemDragStarted",value:function _OnItemDragStarted(t){this._SpreadEvent(u.DRAG_STARTED,t)}},{key:"_OnItemDragEnded",value:function _OnItemDragEnded(t){this._SpreadEvent(u.DRAG_ENDED,t)}},{key:"_SpreadEvent",value:function _SpreadEvent(t,e){if(this._shareEvents&&!this._sharingEvent){this._sharingEvent=!0;for(var n=this._stack.internalArray,i=0,s=n.length;i<s;i++){var a=n[i];a!=e&&a._Broadcast(t,a)}this._sharingEvent=!1}}},{key:"Clear",value:function Clear(){for(var t=this._stack;!t.isEmpty;)this.Remove(t.last)}}]),WidgetSelection}(a);e.exports=d},{"../input":192,"../ui-signal":211,"@nkmjs/collections":21,"@nkmjs/common":27}],192:[function(t,e,n){var i,s=t("@nkmjs/collections").Dictionary,a,l=t("@nkmjs/common").SingletonEx,c=t("./mouse"),u=function(t){_inherits(INPUT,t);var e=_createSuper(INPUT);function INPUT(){return _classCallCheck(this,INPUT),e.call(this)}return _createClass(INPUT,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(INPUT.prototype),"_Init",this).call(this),this._running=!1,this._down=new s,this._Bind(this._KHandle),this._Bind(this._KBlur),this._shiftKey=!1,this._ctrlKey=!1,this._altKey=!1,this._currentKeyEvent=null,this._isBrowser&&(this._Start(),this._mouse=c.instance)}},{key:"_Start",value:function _Start(){this._running||(window.addEventListener("keydown",this._KHandle),window.addEventListener("keyup",this._KHandle),window.addEventListener("keypress",this._KHandle),window.addEventListener("blur",this._KBlur),this._running=!0)}},{key:"_Stop",value:function _Stop(){this._running&&(window.removeEventListener("keydown",this._KHandle),window.removeEventListener("keyup",this._KHandle),window.removeEventListener("keypress",this._KHandle),window.removeEventListener("blur",this._KBlur),this._running=!1)}},{key:"running",get:function get(){return this._running}},{key:"currentKeyEvent",get:function get(){return this._currentKeyEvent}},{key:"shiftKey",get:function get(){return this._shiftKey}},{key:"ctrlKey",get:function get(){return this._ctrlKey}},{key:"altKey",get:function get(){return this._altKey}},{key:"mouse",get:function get(){return this._mouse}},{key:"_KHandle",value:function _KHandle(t){this._currentKeyEvent=t,this._shiftKey=t.shiftKey,this._ctrlKey=t.ctrlKey,this._altKey=t.altKey;var e=t.type,n=t.key,i=t.code,s=t.which;"keydown"===e?t.repeat?(this._Broadcast(INPUT.KEY_REPEAT),this._Broadcast("R_".concat(s))):(this._down.Set(s,!0),this._Broadcast(INPUT.KEY_DOWN),this._Broadcast("D_".concat(s))):"keyup"===e&&(this._down.Remove(s),this._Broadcast(INPUT.KEY_UP,s),this._Broadcast("U_".concat(s))),this._currentKeyEvent=null}},{key:"_KBlur",value:function _KBlur(t){for(var e=this._down.keys,n=0,i=e.length;n<i;n++)this._Broadcast(INPUT.KEY_UP,null),this._Broadcast("U_".concat(e[n]),null);this._down.Clear()}}],[{key:"shift",get:function get(){return this.instance.shiftKey}},{key:"ctrl",get:function get(){return this.instance.ctrlKey}},{key:"alt",get:function get(){return this.instance.altKey}},{key:"ONKeyUp",value:function ONKeyUp(t,e){this.Watch("U_".concat(t),e)}},{key:"OFFKeyUp",value:function OFFKeyUp(t,e){this.Unwatch("U_".concat(t),e)}},{key:"ONKeyDown",value:function ONKeyDown(t,e){this.Watch("D_".concat(t),e)}},{key:"OFFKeyDown",value:function OFFKeyDown(t,e){this.Unwatch("D_".concat(t),e)}},{key:"ONKeyRepeat",value:function ONKeyRepeat(t,e){this.Watch("R_".concat(t),e)}},{key:"OFFKeyRepeat",value:function OFFKeyRepeat(t,e){this.Unwatch("R_".concat(t),e)}},{key:"MOUSE",get:function get(){return this.instance._mouse}}]),INPUT}(l);_defineProperty(u,"KEY_UP",Symbol("keyUp")),_defineProperty(u,"KEY_DOWN",Symbol("keyDown")),_defineProperty(u,"KEY_REPEAT",Symbol("keyRepeat")),e.exports=u},{"./mouse":198,"@nkmjs/collections":21,"@nkmjs/common":27}],193:[function(t,e,n){var i=function KEYBOARD(){_classCallCheck(this,KEYBOARD)};_defineProperty(i,"_backspace",8),_defineProperty(i,"_tab",9),_defineProperty(i,"_enter",13),_defineProperty(i,"_shift",16),_defineProperty(i,"_ctrl",17),_defineProperty(i,"_alt",18),_defineProperty(i,"_pause",19),_defineProperty(i,"_capsLock",20),_defineProperty(i,"_escape",27),_defineProperty(i,"_pageUp",33),_defineProperty(i,"_space",32),_defineProperty(i,"_pageDown",34),_defineProperty(i,"_end",35),_defineProperty(i,"_home",36),_defineProperty(i,"_arrowLeft",37),_defineProperty(i,"_arrowUp",38),_defineProperty(i,"_arrowRight",39),_defineProperty(i,"_arrowDown",40),_defineProperty(i,"_printScreen",44),_defineProperty(i,"_insert",45),_defineProperty(i,"_delete",46),_defineProperty(i,"_0",48),_defineProperty(i,"_1",49),_defineProperty(i,"_2",50),_defineProperty(i,"_3",51),_defineProperty(i,"_4",52),_defineProperty(i,"_5",53),_defineProperty(i,"_6",54),_defineProperty(i,"_7",55),_defineProperty(i,"_8",56),_defineProperty(i,"_9",57),_defineProperty(i,"_a",65),_defineProperty(i,"_b",66),_defineProperty(i,"_c",67),_defineProperty(i,"_d",68),_defineProperty(i,"_e",69),_defineProperty(i,"_f",70),_defineProperty(i,"_g",71),_defineProperty(i,"_h",72),_defineProperty(i,"_i",73),_defineProperty(i,"_j",74),_defineProperty(i,"_k",75),_defineProperty(i,"_l",76),_defineProperty(i,"_m",77),_defineProperty(i,"_n",78),_defineProperty(i,"_o",79),_defineProperty(i,"_p",80),_defineProperty(i,"_q",81),_defineProperty(i,"_r",82),_defineProperty(i,"_s",83),_defineProperty(i,"_t",84),_defineProperty(i,"_u",85),_defineProperty(i,"_v",86),_defineProperty(i,"_w",87),_defineProperty(i,"_x",88),_defineProperty(i,"_y",89),_defineProperty(i,"_z",90),_defineProperty(i,"_leftWindowKey",91),_defineProperty(i,"_rightWindowKey",92),_defineProperty(i,"_selectKey",93),_defineProperty(i,"_numpad0",96),_defineProperty(i,"_numpad1",97),_defineProperty(i,"_numpad2",98),_defineProperty(i,"_numpad3",99),_defineProperty(i,"_numpad4",100),_defineProperty(i,"_numpad5",101),_defineProperty(i,"_numpad6",102),_defineProperty(i,"_numpad7",103),_defineProperty(i,"_numpad8",104),_defineProperty(i,"_numpad9",105),_defineProperty(i,"_multiply",106),_defineProperty(i,"_add",107),_defineProperty(i,"_subtract",109),_defineProperty(i,"_decimalPoint",110),_defineProperty(i,"_divide",111),_defineProperty(i,"_f1",112),_defineProperty(i,"_f2",113),_defineProperty(i,"_f3",114),_defineProperty(i,"_f4",115),_defineProperty(i,"_f5",116),_defineProperty(i,"_f6",117),_defineProperty(i,"_f7",118),_defineProperty(i,"_f8",119),_defineProperty(i,"_f9",120),_defineProperty(i,"_f10",121),_defineProperty(i,"_f11",122),_defineProperty(i,"_f12",123),_defineProperty(i,"_numLock",144),_defineProperty(i,"_scrollLock",145),_defineProperty(i,"_myComputer",182),_defineProperty(i,"_myCalculator",183),_defineProperty(i,"_semiColon",186),_defineProperty(i,"_equalSign",187),_defineProperty(i,"_comma",188),_defineProperty(i,"_dash",189),_defineProperty(i,"_period",190),_defineProperty(i,"_forwardSlash",191),_defineProperty(i,"_openBracket",219),_defineProperty(i,"_backSlash",220),_defineProperty(i,"_closeBraket",221),_defineProperty(i,"_singleQuote",222),e.exports=i},{}],194:[function(t,e,n){e.exports={BaseManipulator:t("./manipulator-base"),ImageManipulator:t("./manipulator-image"),TextManipulator:t("./manipulator-text")}},{"./manipulator-base":195,"./manipulator-image":196,"./manipulator-text":197}],195:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.DisposableObjectEx,u=t("../ui-flag"),h=t("../helpers/flag-enum"),d=function(){function BaseManipulator(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,BaseManipulator),this._element=t,this._content=null,this._autoHide=e,this._isVisible=!0,this._sizeFlags=n?new h(u.sizes):null}return _createClass(BaseManipulator,[{key:"isVisible",get:function get(){return this._isVisible}},{key:"element",get:function get(){return this._element},set:function set(t){if(this._element!==t){var e=null;if(this._sizeFlags){var n=this._element;e=this._sizeFlags._currentFlag,this._sizeFlags.Set(null),n&&this._sizeFlags.Remove(n)}this._element=t,this._sizeFlags&&(this._element&&this._sizeFlags.Add(this._element),this._sizeFlags.Set(e))}}},{key:"order",get:function get(){return this._element.style.order},set:function set(t){this._element.style.order=t}},{key:"content",get:function get(){return this._content}},{key:"size",get:function get(){return this._sizeFlags}},{key:"Set",value:function Set(t){var e=this._Update(this._element,t),n=this._content;return n&&s.isInstanceOf(n,c)&&(n.Unwatch(l.UPDATED,this._OnContentUpdate,this),n.Unwatch(l.RENAMED,this._OnContentUpdate,this),n.Unwatch(l.RELEASED,this._OnContentReleased,this)),t&&s.isInstanceOf(this._content,c)?(this._content=t,this._content.Watch(l.UPDATED,this._OnContentUpdate,this),this._content.Watch(l.RENAMED,this._OnContentUpdate,this),this._content.Watch(l.RELEASED,this._OnContentReleased,this)):this._content=null,this._Toggle(e)}},{key:"_Update",value:function _Update(t,e){return!0}},{key:"_OnContentUpdate",value:function _OnContentUpdate(){this._Toggle(this._Update(this._element,this._content))}},{key:"_Toggle",value:function _Toggle(t){return this._isVisible!=t&&this._autoHide&&(this._isVisible=t,t?this._element.style.removeProperty("display"):this._element.style.setProperty("display","none")),t}},{key:"_OnContentReleased",value:function _OnContentReleased(t){this.content=null}}]),BaseManipulator}();e.exports=d},{"../helpers/flag-enum":187,"../ui-flag":209,"@nkmjs/common":27,"@nkmjs/utils":271}],196:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l=t("../ui-id"),c,u=function(t){_inherits(ImageManipulator,t);var e=_createSuper(ImageManipulator);function ImageManipulator(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return _classCallCheck(this,ImageManipulator),e.call(this,t,n,i)}return _createClass(ImageManipulator,[{key:"content",get:function get(){return this._element?this._element.style.backgroundImage:null}},{key:"_Update",value:function _Update(t,e){if(s.isVoid(e))return t.style.removeProperty("backgroundImage"),!1;var n="";return s.isString(e)?n=e:l.ICON in e?n=e[l.ICON]:l.PATH in e?n=e[l.PATH]:"img"in e?n=e.img:"objectURL"in e&&(n=e.objectURL),!(""===n||!s.isString(n))&&(n=a.FULL(n),t.style.backgroundImage="url(".concat(n,")"),!0)}}]),ImageManipulator}(t("./manipulator-base"));e.exports=u},{"../ui-id":210,"./manipulator-base":195,"@nkmjs/utils":271}],197:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/style/lib/colors/hsla"),l=t("@nkmjs/style/lib/colors/rgba"),c,u=function(t){_inherits(TextManipulator,t);var e=_createSuper(TextManipulator);function TextManipulator(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return _classCallCheck(this,TextManipulator),e.call(this,t,n,i)}return _createClass(TextManipulator,[{key:"content",get:function get(){return this._element?this._element.innerHTML:null}},{key:"uppercase",set:function set(t){t?this._element.style.setProperty("text-transform","uppercase"):this._element.style.removeProperty("text-transform")}},{key:"ellipsis",set:function set(t){t?(this._element.style.setProperty("white-space","nowrap"),this._element.style.setProperty("overflow","hidden"),this._element.style.setProperty("text-overflow","ellipsis")):(this._element.style.removeProperty("white-space"),this._element.style.removeProperty("overflow"),this._element.style.removeProperty("text-overflow"))}},{key:"selectable",set:function set(t){t?this._element.style.setProperty("user-select","text"):this._element.style.removeProperty("user-select")}},{key:"bold",set:function set(t){t?this._element.style.setProperty("font-weight","bolder"):this._element.style.removeProperty("font-weight")}},{key:"italic",set:function set(t){t?this._element.style.setProperty("font-style","italic"):this._element.style.removeProperty("font-style")}},{key:"color",set:function set(t){t?this._element.style.setProperty("color",t):this._element.style.removeProperty("color")}},{key:"_Update",value:function _Update(t,e){if(s.isVoid(e))return t.innerHTML="",!1;var n="";return s.isString(e)?n=e:"name"in e?n=e.name:"title"in e?n=e.title:"objectURL"in e&&(n=e.objectURL),""!==n&&(t.innerHTML=n,!0)}}]),TextManipulator}(t("./manipulator-base"));e.exports=u},{"./manipulator-base":195,"@nkmjs/style/lib/colors/hsla":161,"@nkmjs/style/lib/colors/rgba":162,"@nkmjs/utils":271}],198:[function(t,e,n){var i,s=t("@nkmjs/collections").Dictionary,a=t("@nkmjs/common"),l=a.SingletonEx,c=a.DelayedCall,u=t("./ui-signal"),h=function(t){_inherits(MOUSE,t);var e=_createSuper(MOUSE);function MOUSE(){return _classCallCheck(this,MOUSE),e.call(this)}return _createClass(MOUSE,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(MOUSE.prototype),"_Init",this).call(this),this._running=!1,this._using=new Array(0),this._usingDeprecated=new Array(0),this._position={x:0,y:0},this._clearUsing=new c(this._Bind(this._ClearUsing)),this._Bind(this._mDown),this._Bind(this._mUp),this._Bind(this._mMove),this._isBrowser&&this._Start()}},{key:"_Start",value:function _Start(){this._running||(document.addEventListener("mousedown",this._mDown),document.addEventListener("mouseup",this._mUp),this._running=!0)}},{key:"_Stop",value:function _Stop(){this._running&&(document.removeEventListener("mousedown",this._mDown),document.removeEventListener("mouseup",this._mUp),this._running=!1)}},{key:"running",get:function get(){return this._running}},{key:"position",get:function get(){return this._position}},{key:"StartUsing",value:function StartUsing(t){var e=this._usingDeprecated.indexOf(t);-1!=e&&this._usingDeprecated.splice(e,1),this._using.includes(t)||this._using.push(t)}},{key:"StopUsing",value:function StopUsing(t){this._usingDeprecated.includes(t)||(this._usingDeprecated.push(t),this._clearUsing.Schedule())}},{key:"_IsUsing",value:function _IsUsing(t){if(t===MOUSE.BTN_LEFT)return!1;for(var e=0,n=this._using.length;e<n;e++)if(t in this._using[e])return!0;return!1}},{key:"_ClearUsing",value:function _ClearUsing(){for(var t=0,e=this._usingDeprecated.length;t<e;t++){var n=this._usingDeprecated[t],i=this._using.indexOf(n);-1!=i&&this._using.splice(i,1)}}},{key:"_mDown",value:function _mDown(t){this._IsUsing(t.button)&&t.preventDefault(),this._Broadcast(MOUSE.MOUSE_DOWN,t)}},{key:"_mUp",value:function _mUp(t){this._IsUsing(t.button)&&t.preventDefault(),this._Broadcast(MOUSE.MOUSE_UP,t)}},{key:"_mMove",value:function _mMove(t){this._position.x=t.clientX,this._position.y=t.clientY}}],[{key:"MOUSE",get:function get(){return this.instance.mouse}},{key:"LocalMouse",value:function LocalMouse(t){var e=t.getBoundingClientRect(),n=this.instance._position,i=n.x-e.left,s=n.y-e.top;return{x:i,y:s,normalized:{x:i/e.width,y:s/e.height}}}}]),MOUSE}(l);_defineProperty(h,"BTN_LEFT",0),_defineProperty(h,"BTN_MIDDLE",1),_defineProperty(h,"BTN_RIGHT",2),_defineProperty(h,"BTN_PREV",3),_defineProperty(h,"BTN_NEXT",4),_defineProperty(h,"DOWN",0),_defineProperty(h,"UP",1),_defineProperty(h,"RELEASE",2),_defineProperty(h,"RELEASE_TWICE",3),_defineProperty(h,"RELEASE_OUTSIDE",4),_defineProperty(h,"WHEEL",5),_defineProperty(h,"MOUSE_UP",Symbol("mouseUp")),_defineProperty(h,"MOUSE_DOWN",Symbol("mouseDown")),e.exports=h},{"./ui-signal":211,"@nkmjs/collections":21,"@nkmjs/common":27}],199:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("../ui-id"),c=t("../dom-template"),u=t("../manipulators/manipulator-image"),h=t("../manipulators/manipulator-text"),d="_".concat(l.HEADER),p="_expandIcon",f="_".concat(l.ICON),g="_".concat(l.LABEL),m="_".concat(l.BODY),y=function(t){_inherits(TPLBodyExpand,t);var e=_createSuper(TPLBodyExpand);function TPLBodyExpand(){return _classCallCheck(this,TPLBodyExpand),e.call(this)}return _createClass(TPLBodyExpand,[{key:"Render",value:function Render(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=_get(_getPrototypeOf(TPLBodyExpand.prototype),"Render",this).call(this,t,e),i=s.Get(e,"expandIcon",null),a=s.Get(e,l.ICON,null),c=s.Get(e,l.TITLE,null),d=n._expandIcon=new u(n._expandIcon,!(!i||!("autoHide"in i))&&i.autoHide),p=n[f]=new u(n[f],!a||!("autoHide"in a)||a.autoHide),m=n[g]=new h(n[g],!(!c||!("autoHide"in c))&&c.autoHide);return i&&(d.Set(i.url),i.htitle&&(d.element.htitle=i.htitle),d[l.CSS_CL]&&d.element.classList.add(d[l.CSS_CL])),a&&(p.Set(a),a[l.CSS_CL]&&p.element.classList.add(a[l.CSS_CL])),c&&(m.Set(c),c[l.CSS_CL]&&m.element.classList.add(c[l.CSS_CL])),n}}],[{key:"_CreateTemplate",value:function _CreateTemplate(){_get(_getPrototypeOf(TPLBodyExpand),"_CreateTemplate",this).call(this),this._Add(a.New("div",{class:l.HEADER}),d),this._Add(a.New("span",{class:"".concat(l.ICON," expand")}),p,d),this._Add(a.New("span",{class:l.ICON}),f,d),this._Add(a.New("span",{class:l.LABEL}),g,d),this._Add(a.New("div",{class:l.BODY}),m)}}]),TPLBodyExpand}(c);e.exports=y},{"../dom-template":177,"../manipulators/manipulator-image":196,"../manipulators/manipulator-text":197,"../ui-id":210,"@nkmjs/utils":271}],200:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("../ui-id"),c=t("../dom-template"),u=t("../manipulators/manipulator-image"),h=t("../manipulators/manipulator-text"),d="_".concat(l.ICON),p="_".concat(l.TITLE),f="_".concat(l.SUBTITLE),g="_".concat(l.HEADER),m="_".concat(l.BODY),y="_titles",v=function(t){_inherits(TPLBodyHeaderTitles,t);var e=_createSuper(TPLBodyHeaderTitles);function TPLBodyHeaderTitles(){return _classCallCheck(this,TPLBodyHeaderTitles),e.call(this)}return _createClass(TPLBodyHeaderTitles,[{key:"Render",value:function Render(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=_get(_getPrototypeOf(TPLBodyHeaderTitles.prototype),"Render",this).call(this,t,e),i=s.Get(e,l.ICON,null),a=s.Get(e,l.TITLE,null),c=s.Get(e,l.SUBTITLE,null),g=n[d]=new u(n[d],!(!i||!("autoHide"in i))&&i.autoHide),m=n[p]=new h(n[p],!(!a||!("autoHide"in a))&&a.autoHide),y=n[f]=new h(n[f],!(!c||!("autoHide"in c))&&c.autoHide);return i&&(g.Set(i),i[l.CSS_CL]&&g.element.classList.add(i[l.CSS_CL])),a&&(m.Set(a),a[l.CSS_CL]&&m.element.classList.add(a[l.CSS_CL])),c&&(y.Set(c),c[l.CSS_CL]&&y.element.classList.add(c[l.CSS_CL])),n}}],[{key:"_CreateTemplate",value:function _CreateTemplate(){_get(_getPrototypeOf(TPLBodyHeaderTitles),"_CreateTemplate",this).call(this),this._Add(a.New("div",{class:l.HEADER}),g),this._Add(a.New("span",{class:l.ICON}),d,g),this._Add(a.New("span",{class:"titles"}),y,g),this._Add(a.New("span",{class:l.TITLE}),p,y),this._Add(a.New("span",{class:l.SUBTITLE}),f,y),this._Add(a.New("div",{class:l.BODY}),m)}}]),TPLBodyHeaderTitles}(c);e.exports=v},{"../dom-template":177,"../manipulators/manipulator-image":196,"../manipulators/manipulator-text":197,"../ui-id":210,"@nkmjs/utils":271}],201:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("../ui-id"),c=t("../dom-template"),u=t("../manipulators/manipulator-image"),h=t("../manipulators/manipulator-text"),d="_expandIcon",p="_".concat(l.ICON),f="_".concat(l.LABEL),g=function(t){_inherits(TPLFacadeExpandLabel,t);var e=_createSuper(TPLFacadeExpandLabel);function TPLFacadeExpandLabel(){return _classCallCheck(this,TPLFacadeExpandLabel),e.call(this)}return _createClass(TPLFacadeExpandLabel,[{key:"Render",value:function Render(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=_get(_getPrototypeOf(TPLFacadeExpandLabel.prototype),"Render",this).call(this,t,e),i=s.Get(e,"expandIcon",null),a=s.Get(e,l.ICON,null),c=s.Get(e,l.TITLE,null),d=n._expandIcon=new u(n._expandIcon,!(!i||!("autoHide"in i))&&i.autoHide),g=n[p]=new u(n[p],!a||!("autoHide"in a)||a.autoHide),m=n[f]=new h(n[f],!(!c||!("autoHide"in c))&&c.autoHide);return i&&(d.Set(i.url),i.htitle&&(d.element.htitle=i.htitle),d[l.CSS_CL]&&d.element.classList.add(d[l.CSS_CL])),a&&(g.Set(a),a[l.CSS_CL]&&g.element.classList.add(a[l.CSS_CL])),c&&(m.Set(c),c[l.CSS_CL]&&m.element.classList.add(c[l.CSS_CL])),n}}],[{key:"_CreateTemplate",value:function _CreateTemplate(){_get(_getPrototypeOf(TPLFacadeExpandLabel),"_CreateTemplate",this).call(this),this._Add(a.New("span",{class:"".concat(l.ICON," expand")}),d),this._Add(a.New("span",{class:l.ICON}),p),this._Add(a.New("span",{class:l.LABEL}),f)}}]),TPLFacadeExpandLabel}(c);e.exports=g},{"../dom-template":177,"../manipulators/manipulator-image":196,"../manipulators/manipulator-text":197,"../ui-id":210,"@nkmjs/utils":271}],202:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("../ui-id"),c=t("../dom-template"),u=t("../manipulators/manipulator-image"),h=t("../manipulators/manipulator-text"),d="_expandIcon",p="_".concat(l.ICON),f="_".concat(l.TITLE),g=function(t){_inherits(TPLFacadeExpandTitle,t);var e=_createSuper(TPLFacadeExpandTitle);function TPLFacadeExpandTitle(){var t;return _classCallCheck(this,TPLFacadeExpandTitle),t=e.call(this)}return _createClass(TPLFacadeExpandTitle,[{key:"Render",value:function Render(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=_get(_getPrototypeOf(TPLFacadeExpandTitle.prototype),"Render",this).call(this,t,e),i=s.Get(e,"expandIcon",null),a=s.Get(e,l.ICON,null),c=s.Get(e,l.TITLE,null),d=n._expandIcon=new u(n._expandIcon,!(!i||!("autoHide"in i))&&i.autoHide),g=n[p]=new u(n[p],!a||!("autoHide"in a)||a.autoHide),m=n[f]=new h(n[f],!(!c||!("autoHide"in c))&&c.autoHide);return i&&(d.Set(i.url),i.htitle&&(d.element.htitle=i.htitle),d[l.CSS_CL]&&d.element.classList.add(d[l.CSS_CL])),a&&(g.Set(a),a[l.CSS_CL]&&g.element.classList.add(a[l.CSS_CL])),c&&(m.Set(c),c[l.CSS_CL]&&m.element.classList.add(c[l.CSS_CL])),n}}],[{key:"_CreateTemplate",value:function _CreateTemplate(){_get(_getPrototypeOf(TPLFacadeExpandTitle),"_CreateTemplate",this).call(this),this._Add(a.New("span",{class:"".concat(l.ICON," expand")}),d),this._Add(a.New("span",{class:l.ICON}),p),this._Add(a.New("span",{class:l.TITLE}),f)}}]),TPLFacadeExpandTitle}(c);e.exports=g},{"../dom-template":177,"../manipulators/manipulator-image":196,"../manipulators/manipulator-text":197,"../ui-id":210,"@nkmjs/utils":271}],203:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("../ui-id"),c=t("../dom-template"),u=t("../manipulators/manipulator-image"),h=t("../manipulators/manipulator-text"),d="_".concat(l.ICON),p="_".concat(l.LABEL),f=function(t){_inherits(TPLFacadeLabel,t);var e=_createSuper(TPLFacadeLabel);function TPLFacadeLabel(){var t;return _classCallCheck(this,TPLFacadeLabel),t=e.call(this)}return _createClass(TPLFacadeLabel,[{key:"Render",value:function Render(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=_get(_getPrototypeOf(TPLFacadeLabel.prototype),"Render",this).call(this,t,e),i=s.Get(e,l.ICON,null),a=s.Get(e,l.LABEL,null),c=n[d]=new u(n[d],!i||!("autoHide"in i)||i.autoHide),f=n[p]=new h(n[p],!(!a||!("autoHide"in a))&&a.autoHide);return i&&(c.Set(i),i[l.CSS_CL]&&c.element.classList.add(i[l.CSS_CL])),a&&(f.Set(a),a[l.CSS_CL]&&f.element.classList.add(a[l.CSS_CL])),n}}],[{key:"_CreateTemplate",value:function _CreateTemplate(){_get(_getPrototypeOf(TPLFacadeLabel),"_CreateTemplate",this).call(this),this._Add(a.New("span",{class:l.ICON}),d),this._Add(a.New("span",{class:l.LABEL}),p)}}]),TPLFacadeLabel}(c);e.exports=f},{"../dom-template":177,"../manipulators/manipulator-image":196,"../manipulators/manipulator-text":197,"../ui-id":210,"@nkmjs/utils":271}],204:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("../ui-id"),c=t("../dom-template"),u=t("../manipulators/manipulator-image"),h=t("../manipulators/manipulator-text"),d="_".concat(l.ICON),p="_".concat(l.TITLE),f="_".concat(l.SUBTITLE),g=function(t){_inherits(TPLFacadeTitles,t);var e=_createSuper(TPLFacadeTitles);function TPLFacadeTitles(){return _classCallCheck(this,TPLFacadeTitles),e.call(this)}return _createClass(TPLFacadeTitles,[{key:"Render",value:function Render(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=_get(_getPrototypeOf(TPLFacadeTitles.prototype),"Render",this).call(this,t,e),i=s.Get(e,l.ICON,null),a=s.Get(e,l.TITLE,null),c=s.Get(e,l.SUBTITLE,null),g=n[d]=new u(n[d],!i||!("autoHide"in i)||i.autoHide),m=n[p]=new h(n[p],!(!a||!("autoHide"in a))&&a.autoHide),y=n[f]=new h(n[f],!(!c||!("autoHide"in c))&&c.autoHide);return i&&(g.Set(i),i[l.CSS_CL]&&g.element.classList.add(i[l.CSS_CL])),a&&(m.Set(a),a[l.CSS_CL]&&m.element.classList.add(a[l.CSS_CL])),c&&(y.Set(c),c[l.CSS_CL]&&y.element.classList.add(c[l.CSS_CL])),n}}],[{key:"_CreateTemplate",value:function _CreateTemplate(){_get(_getPrototypeOf(TPLFacadeTitles),"_CreateTemplate",this).call(this),this._Add(a.New("span",{class:l.ICON}),d),this._Add(a.New("span",{class:l.TITLE}),p),this._Add(a.New("span",{class:l.SUBTITLE}),f)}}]),TPLFacadeTitles}(c);e.exports=g},{"../dom-template":177,"../manipulators/manipulator-image":196,"../manipulators/manipulator-text":197,"../ui-id":210,"@nkmjs/utils":271}],205:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("../ui-id"),c=t("../dom-template"),u="_".concat(l.HEADER),h="_".concat(l.BODY),d="_".concat(l.FOOTER),p=function(t){_inherits(TPLHeaderBodyFooter,t);var e=_createSuper(TPLHeaderBodyFooter);function TPLHeaderBodyFooter(){return _classCallCheck(this,TPLHeaderBodyFooter),e.call(this)}return _createClass(TPLHeaderBodyFooter,null,[{key:"_CreateTemplate",value:function _CreateTemplate(){_get(_getPrototypeOf(TPLHeaderBodyFooter),"_CreateTemplate",this).call(this),this._Add(a.New("div",{class:l.HEADER}),u),this._Add(a.New("div",{class:l.BODY}),h),this._Add(a.New("div",{class:l.FOOTER}),d)}}]),TPLHeaderBodyFooter}(c);e.exports=p},{"../dom-template":177,"../ui-id":210,"@nkmjs/utils":271}],206:[function(t,e,n){var i=t("@nkmjs/common"),s=i.NFOS,a=i.SIGNAL,l=i.POOL,c=t("../ui"),u=t("../ui-id"),h=t("../ui-signal"),d=t("../extensions/ext-expand"),p=t("../helpers/catalog-builder"),f=t("./tree-item"),g=t("../templates/tpl-body-expand"),m=function(t){_inherits(TreeItemGroup,t);var e=_createSuper(TreeItemGroup);function TreeItemGroup(){return _classCallCheck(this,TreeItemGroup),e.call(this)}return _createClass(TreeItemGroup,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(TreeItemGroup.prototype),"_Init",this).call(this),this._tplClass=g,this._extExpand=this._interactions.Add(d),this._extExpand._toggled=!1,this._extExpand.Watch(h.EXPANDED,this._Expand,this),this._extExpand.Watch(h.COLLAPSED,this._Collapse,this),this._builder=null,this._expandIcon=null}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(TreeItemGroup.prototype),"_PostInit",this).call(this),this._SetupBuilder(),this._extExpand.Setup(this,this._body,this._expandIcon.element),this.order=0}},{key:"depth",set:function set(t){_set(_getPrototypeOf(TreeItemGroup.prototype),"depth",t,this,!0);for(var e=t+1,n=this._builder._map.keys,i=0,s=n.length;i<s;i++)this._builder._map.get(n[i]).depth=e}},{key:"_SetupBuilder",value:function _SetupBuilder(){this._builder=l.Rent(p),this._builder.owner=this,this._builder.host=this._body,this._builder._defaultItemClass=f,this._builder._defaultGroupClass=TreeItemGroup,this._builder.Watch(a.ITEM_ADDED,this._OnBuilderItemAdded,this),this._builder.Watch(a.ITEM_REMOVED,this._OnBuilderItemRemoved,this)}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._icon.Set(t)}},{key:"label",get:function get(){return this._label},set:function set(t){this._label.Set(t)}},{key:"_Style",value:function _Style(){return{":host":{position:"relative",display:"flex","flex-flow":"column nowrap","justify-content":"flex-start","align-items":"stretch"},":host(.expanded)":{height:"auto"},".header":{position:"relative",flex:"0 0 auto"},".body":{position:"relative",flex:"1 0 auto",display:"none","flex-flow":"column nowrap","justify-content":"flex-start","align-items":"stretch","min-width":0},":host(.expanded) .body":{display:"flex"},".item":{flex:"1 1 auto"}}}},{key:"_Render",value:function _Render(){var t;this._tplOptions=(_defineProperty(t={},u.OWNER,this),_defineProperty(t,u.ICON,{autoHide:!0}),_defineProperty(t,"expandIcon",{htitle:"Expand"}),t),_get(_getPrototypeOf(TreeItemGroup.prototype),"_Render",this).call(this),this._icon.autoHide=!0,this._toolbarCtnr=this._header,this.focusArea=this._header,this._dragActivator=this._header,this._dragFeedbackHost=this._header}},{key:"Activate",value:function Activate(t){this._toolbar&&this._toolbar.focused||_get(_getPrototypeOf(TreeItemGroup.prototype),"Activate",this).call(this,t)}},{key:"AltActivate",value:function AltActivate(t){if(!this._toolbar||!this._toolbar.focused)return!!_get(_getPrototypeOf(TreeItemGroup.prototype),"AltActivate",this).call(this,t)&&void this._extExpand.Toggle()}},{key:"Expand",value:function Expand(){this._extExpand.Expand()}},{key:"_Expand",value:function _Expand(){this._data&&(this._data.expanded=!0,this._builder.Enable()),this._expandIcon.rotation=90}},{key:"Collapse",value:function Collapse(){this._extExpand.Collapse()}},{key:"_Collapse",value:function _Collapse(){this._data&&(this._data.expanded=!1),this._builder.Disable(),this._expandIcon.rotation=0}},{key:"_OnDataChanged",value:function _OnDataChanged(t){_get(_getPrototypeOf(TreeItemGroup.prototype),"_OnDataChanged",this).call(this,t),this._builder.catalog=this._data,this._data?this._extExpand.isExpanded&&(this._data.expanded=!0):this._extExpand.Collapse()}},{key:"_OnBuilderItemAdded",value:function _OnBuilderItemAdded(t,e,n){n.classList.add("item"),n.depth=this._depth+1}},{key:"_OnBuilderItemRemoved",value:function _OnBuilderItemRemoved(t,e,n){n.classList.remove("item")}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(TreeItemGroup.prototype),"_CleanUp",this).call(this),this.Collapse()}}]),TreeItemGroup}(f);_defineProperty(m,"__NFO__",s.Ext({css:["@/tree/tree-group.css"]},f,["css"])),e.exports=m,c.Register("nkmjs-tree-item-group",m,"ul")},{"../extensions/ext-expand":181,"../helpers/catalog-builder":184,"../templates/tpl-body-expand":199,"../ui":212,"../ui-id":210,"../ui-signal":211,"./tree-item":207,"@nkmjs/common":27}],207:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/common"),c=l.NFOS,u=l.COMMON_FLAG,h,d=t("@nkmjs/style").CSS,p=t("../ui"),f=t("../ui-id"),g=t("../mouse"),m=t("../dom-template"),y=t("../helpers/toolbar"),v=t("../templates/tpl-facade-label"),k=t("../widget-catalog"),C=function(t){_inherits(TreeItem,t);var e=_createSuper(TreeItem);function TreeItem(){var t;return _classCallCheck(this,TreeItem),(t=e.call(this)).depth=0,t}return _createClass(TreeItem,[{key:"_Init",value:function _Init(){this.default_SelectOnActivation=s.Default(this.default_SelectOnActivation,!0),_get(_getPrototypeOf(TreeItem.prototype),"_Init",this).call(this),this._notifiesSelectionStack=!0,this._tplClass=v,this._toolbarClass=y,this._toolbar=null,this._toolbarCtnr=null,this._depth=0}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(TreeItem.prototype),"_PostInit",this).call(this),this.order=1}},{key:"depth",get:function get(){return this._depth},set:function set(t){this._depth=t,this.style.setProperty("--depth",this._depth)}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._icon.Set(t)}},{key:"label",get:function get(){return this._label},set:function set(t){this._label.Set(t)}},{key:"_Style",value:function _Style(){return d.Extends({":host":{position:"relative","min-width":0},".toolbar":{flex:"0 0 auto"}},_get(_getPrototypeOf(TreeItem.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){var t;this._tplOptions||(this._tplOptions=(_defineProperty(t={},f.OWNER,this),_defineProperty(t,f.ICON,{autoHide:!1}),t));m.Render(this._tplClass,this,this._tplOptions),this._toolbarCtnr=this,this.focusArea=this}},{key:"_UpdateInfos",value:function _UpdateInfos(){this._itemData?(this._flavorEnum.Set(this._itemData.isDirty?u.WARNING:null),this._label.Set(this._itemData)||this._label.Set(this._data.options),this._icon.Set(this._itemData)||this._icon.Set(this._data.options)):(this._flavorEnum.Set(null),this._label.Set(this._data.options),this._icon.Set(this._data.options))}},{key:"_BuildCommand",value:function _BuildCommand(t){this._toolbar||(this._toolbar=this.Add(this._toolbarClass,"toolbar",this._toolbarCtnr)),this._toolbar.CreateHandle({command:t,isCommandTrigger:!1,trigger:{thisArg:this,fn:this._ExecuteCommand,arg:t}})}},{key:"_ClearCommandHandles",value:function _ClearCommandHandles(){_get(_getPrototypeOf(TreeItem.prototype),"_ClearCommandHandles",this).call(this),this._toolbar&&(this._toolbar.Release(),this._toolbar=null)}},{key:"_CleanUp",value:function _CleanUp(){this._depth=0,_get(_getPrototypeOf(TreeItem.prototype),"_CleanUp",this).call(this)}}]),TreeItem}(k);_defineProperty(C,"__NFO__",c.Ext({css:["@/tree/tree-item.css"]},k,["css"])),e.exports=C,p.Register("nkmjs-tree-item",C,"li")},{"../dom-template":177,"../helpers/toolbar":190,"../mouse":198,"../templates/tpl-facade-label":203,"../ui":212,"../ui-id":210,"../widget-catalog":218,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/utils":271}],208:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").NFOS,c=t("../ui"),u=t("./tree-item-group"),h=function(t){_inherits(TreeRoot,t);var e=_createSuper(TreeRoot);function TreeRoot(){return _classCallCheck(this,TreeRoot),e.call(this)}return _createClass(TreeRoot,[{key:"_Init",value:function _Init(){this.default_SelectOnActivation=!1,_get(_getPrototypeOf(TreeRoot.prototype),"_Init",this).call(this),this._selectOnActivation=!1,this._searchBtn=null,this._InitSelectionStack()}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(TreeRoot.prototype),"_PostInit",this).call(this)}},{key:"_Render",value:function _Render(){_get(_getPrototypeOf(TreeRoot.prototype),"_Render",this).call(this),this.style.setProperty("--tree_size","var(--size_s)")}},{key:"_OpenFind",value:function _OpenFind(){}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(TreeRoot.prototype),"_CleanUp",this).call(this)}}]),TreeRoot}(u);_defineProperty(h,"__NFO__",l.Ext({css:["@/tree/tree-root.css"]},u,["css"])),e.exports=h,c.Register("nkmjs-tree-root",h)},{"../ui":212,"./tree-item-group":206,"@nkmjs/common":27,"@nkmjs/utils":271}],209:[function(t,e,n){var i,s=t("@nkmjs/common").COMMON_FLAG,a=function UI_FLAG(){_classCallCheck(this,UI_FLAG)};_defineProperty(a,"NONE","none"),_defineProperty(a,"SELF","self"),_defineProperty(a,"INSIDE","vertical"),_defineProperty(a,"OUTSIDE","horizontal"),_defineProperty(a,"VERTICAL","vertical"),_defineProperty(a,"HORIZONTAL","horizontal"),_defineProperty(a,"VERTICAL_AND_HORIZONTAL","vertical horizontal"),_defineProperty(a,"orientations",[a.VERTICAL,a.HORIZONTAL,a.VERTICAL_AND_HORIZONTAL]),_defineProperty(a,"EXPANDED","expanded"),_defineProperty(a,"COLLAPSED","collapsed"),_defineProperty(a,"DISABLED","disabled"),_defineProperty(a,"IDLE","idle"),_defineProperty(a,"FOCUSED","focused"),_defineProperty(a,"istates",[a.DISABLED,a.IDLE,a.FOCUSED]),_defineProperty(a,"ACTIVATED","activated"),_defineProperty(a,"SELECTED","selected"),_defineProperty(a,"TOGGLED","toggled"),_defineProperty(a,"DRAGGED","dragged"),_defineProperty(a,"ALLOW_DROP","allow-drop"),_defineProperty(a,"LEFT","left"),_defineProperty(a,"RIGHT","right"),_defineProperty(a,"TOP","top"),_defineProperty(a,"BOTTOM","bottom"),_defineProperty(a,"TOP_LEFT","".concat(a.TOP," ").concat(a.LEFT)),_defineProperty(a,"TOP_RIGHT","".concat(a.TOP," ").concat(a.RIGHT)),_defineProperty(a,"BOTTOM_LEFT","".concat(a.BOTTOM," ").concat(a.LEFT)),_defineProperty(a,"BOTTOM_RIGHT","".concat(a.BOTTOM," ").concat(a.RIGHT)),_defineProperty(a,"placement",[a.LEFT,a.RIGHT,a.TOP,a.BOTTOM,a.TOP_LEFT,a.TOP_RIGHT,a.BOTTOM_LEFT,a.BOTTOM_RIGHT]),_defineProperty(a,"NO_ICON","no-icon"),_defineProperty(a,"NO_LABEL","no-label"),_defineProperty(a,"NO_SCALE","no-scale"),_defineProperty(a,"FIXED_SIZE","fixed-size"),_defineProperty(a,"SIZE_XS","size-xs"),_defineProperty(a,"SIZE_S","size-s"),_defineProperty(a,"SIZE_M","size-m"),_defineProperty(a,"SIZE_L","size-l"),_defineProperty(a,"SIZE_XL","size-xl"),_defineProperty(a,"sizes",[a.SIZE_XS,a.SIZE_S,a.SIZE_M,a.SIZE_L,a.SIZE_XL]),_defineProperty(a,"CTA","cta"),_defineProperty(a,"flavors",[s.INFOS,s.WARNING,s.ERROR,a.CTA]),_defineProperty(a,"flavorsExtended",[s.INFOS,s.WARNING,s.ERROR,s.READY,s.DIRTY,s.LOADING,s.PROCESSING,s.WAITING,s.active,a.CTA]),_defineProperty(a,"MINIMAL","minimal"),_defineProperty(a,"FRAME","frame"),_defineProperty(a,"variants",[a.MINIMAL,a.FRAME]),e.exports=a},{"@nkmjs/common":27}],210:[function(t,e,n){var i,s=t("@nkmjs/common").COM_ID,a=function UI_ID(){_classCallCheck(this,UI_ID)};_defineProperty(a,"UID",s.UID),_defineProperty(a,"NAME",s.NAME),_defineProperty(a,"TITLE",s.TITLE),_defineProperty(a,"MESSAGE",s.MESSAGE),_defineProperty(a,"ICON",s.ICON),_defineProperty(a,"PATH",s.PATH),_defineProperty(a,"DATA",s.DATA),_defineProperty(a,"CMD_PRIMARY",s.CMD_PRIMARY),_defineProperty(a,"CMD_SECONDARY",s.CMD_SECONDARY),_defineProperty(a,"CMD_LIST",s.CMD_LIST),_defineProperty(a,"OWNER",s.OWNER),_defineProperty(a,"LABEL","label"),_defineProperty(a,"SUBTITLE","subtitle"),_defineProperty(a,"HEADER","header"),_defineProperty(a,"BODY","body"),_defineProperty(a,"FOOTER","footer"),_defineProperty(a,"VIEW","view"),_defineProperty(a,"CONTROLS","controls"),_defineProperty(a,"CSS_CL","csscl"),e.exports=a},{"@nkmjs/common":27}],211:[function(t,e,n){var i=function UI_SIGNAL(){_classCallCheck(this,UI_SIGNAL)};_defineProperty(i,"PAINTED",Symbol("painted")),_defineProperty(i,"UNPAINTED",Symbol("unpainted")),_defineProperty(i,"FIRST_PAINT",Symbol("first-paint")),_defineProperty(i,"CHILD_ADDED",Symbol("childAdded")),_defineProperty(i,"CHILD_MOVED",Symbol("childMoved")),_defineProperty(i,"CHILD_REMOVED",Symbol("childRemoved")),_defineProperty(i,"SELECTION_GAIN",Symbol("selectionGain")),_defineProperty(i,"SELECTION_LOST",Symbol("selectionLost")),_defineProperty(i,"FOCUS_GAIN",Symbol("focusGain")),_defineProperty(i,"FOCUS_LOST",Symbol("focusLost")),_defineProperty(i,"ACTIVATED",Symbol("activated")),_defineProperty(i,"ALT_ACTIVATED",Symbol("altActivated")),_defineProperty(i,"TRIGGERED",Symbol("triggered")),_defineProperty(i,"DEACTIVATED",Symbol("deactivated")),_defineProperty(i,"DATA_CHANGED",Symbol("dataChanged")),_defineProperty(i,"DISPLAY_REQUESTED",Symbol("focusRequested")),_defineProperty(i,"CLOSE_REQUESTED",Symbol("closeRequested")),_defineProperty(i,"EXPANDED",Symbol("expanded")),_defineProperty(i,"COLLAPSED",Symbol("collapsed")),_defineProperty(i,"DRAG_STARTED",Symbol("dragStarted")),_defineProperty(i,"DRAGGED",Symbol("dragged")),_defineProperty(i,"DRAG_ENDED",Symbol("dragEnded")),_defineProperty(i,"DROPPED",Symbol("dropped")),e.exports=i},{}],212:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/collections"),c=l.List,u=l.Dictionary,h=l.DictionaryList,d=t("@nkmjs/common"),p=d.SingletonEx,f=d.DelayedCall,g=t("./ui-signal"),m=t("./disposable-htmlelement"),y=function(t){_inherits(UI,t);var e=_createSuper(UI);function UI(){return _classCallCheck(this,UI),e.call(this)}return _createClass(UI,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(UI.prototype),"_Init",this).call(this),this._uiPool=new h,this._uiTypes=new u,this._dirtyElements=new c(0),this._Bind(this._Return),this._delayedUpdate=new f(this._Bind(this._UpdateDirty))}},{key:"_Register",value:function _Register(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"div";if(!s.isFunc(e))throw new Error("Register used with invalid constructor : ".concat(e));console.log(t),this._uiTypes.Set(e,t),customElements.define(t,e)}},{key:"_Return",value:function _Return(t){if(!s.isObject(t)||!s.isInstanceOf(t,m))throw new Error("Return used with invalid object : ".concat(t));var e=t.constructor;if(!this._uiTypes.Contains(e))throw new Error("Return used with a never-registered object type : ".concat(e));this._uiPool.Set(e,t)}},{key:"_Rent",value:function _Rent(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this._uiTypes.Contains(t))throw new Error("".concat(t," could not be found."));var n=this._uiPool.Pop(t);return n||((n=new t)._returnFn=this._Return),n.Wake(),e&&e.Add(n),n}},{key:"_AddDirty",value:function _AddDirty(t){this._dirtyElements.Add(t)&&this._delayedUpdate.Schedule()}},{key:"_UpdateDirty",value:function _UpdateDirty(t){this._dirtyElements.ForEach((function(t,e){t.ApplyTransforms()})),this._dirtyElements.Clear()}}],[{key:"Register",value:function Register(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"div";this.instance._Register(t,e,n)}},{key:"RegisterGroup",value:function RegisterGroup(t){for(var e in t)this.instance._Register(e,t[e])}},{key:"Rent",value:function Rent(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.instance._Rent(t,e)}},{key:"AddDirty",value:function AddDirty(t){t&&this.instance._AddDirty(t)}},{key:"DRAG_DATA",get:function get(){return this._dragData},set:function set(t){this._dragData=t}},{key:"DRAG_TARGET",get:function get(){return this._dragTarget},set:function set(t){this._dragTarget=t}},{key:"dragLength",get:function get(){return this._dragLength},set:function set(t){this._dragLength=t}},{key:"DragStarted",value:function DragStarted(t,e){var n=0;t&&Array.isArray(t)&&(n=t.length),this.dragLength=n,this.DRAG_DATA=t,this.DRAG_TARGET=e,this.instance._Broadcast(g.DRAG_STARTED,t)}},{key:"DragEnded",value:function DragEnded(){this.instance._Broadcast(g.DRAG_ENDED),this.DRAG_DATA=null,this.DRAG_TARGET=null,this.dragLength=0}}]),UI}(p);_defineProperty(y,"_dragLength",0),_defineProperty(y,"_dragData",null),_defineProperty(y,"_dragTarget",null),e.exports=y},{"./disposable-htmlelement":176,"./ui-signal":211,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],213:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").NFOS,u,h=t("@nkmjs/style").CSS,d,p=t("@nkmjs/collections").Dictionary,f=t("../ui"),g=t("../ui-id"),m=t("../ui-signal"),y=t("../ui-flag"),v=t("../dom-template"),k=t("../helpers/toolbar"),C=t("../templates/tpl-header-body-footer"),O=function(t){_inherits(DrawerNav,t);var e=_createSuper(DrawerNav);function DrawerNav(){return _classCallCheck(this,DrawerNav),e.call(this)}return _createClass(DrawerNav,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DrawerNav.prototype),"_Init",this).call(this),this._isHorizontalScrollEnabled=!0,this._handlesMap=new p,this._currentHandle=null,this._header=null,this._body=null,this._footer=null,this._toolbar=null}},{key:"currentHandle",get:function get(){return this._currentHandle}},{key:"_Style",value:function _Style(){return h.Extends({":host":{display:"grid","justify-content":"stretch","align-items":"stretch"},".body":{flex:"1 1 auto",display:"flex","justify-content":"flex-start","align-items":"stretch"},".header, .footer":{flex:"0 0 auto"},":host(.vertical)":{"grid-template-rows":"max-content auto max-content"},":host(.vertical) .header":{"grid-row":"1"},":host(.vertical) .footer":{"grid-row":"3"},":host(.vertical) .body":{"grid-row":"2","flex-flow":"column nowrap","overflow-x":"hidden","overflow-y":"overlay",width:"100%","min-height":"0"},":host(.horizontal)":{"grid-template-columns":"max-content auto max-content"},":host(.horizontal) .header":{"grid-column":"1"},":host(.horizontal) .footer":{"grid-column":"3"},":host(.horizontal) .body":{"grid-column":"2","flex-flow":"row nowrap","overflow-x":"overlay","overflow-y":"hidden",height:"100%","min-width":"0"}},_get(_getPrototypeOf(DrawerNav.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){v.Render(C,this,_defineProperty({},g.OWNER,this)),this._toolbar=this.Add(k,"toolbar",this._footer),this._orientation.AddManaged(this._toolbar._orientation),this._toolbar.orientation=this.constructor.__default_orientation,this._sizeEnum.AddManaged(this._toolbar._sizeEnum),this._toolbar.size=this.constructor.__default_size,this._wrapper=this._body,this.focusArea=this}},{key:"_OnSizeChanged",value:function _OnSizeChanged(t,e){_get(_getPrototypeOf(DrawerNav.prototype),"_OnSizeChanged",this).call(this,t,e),this._toolbar.size=t}},{key:"_OnOrientationChanged",value:function _OnOrientationChanged(t,e){_get(_getPrototypeOf(DrawerNav.prototype),"_OnOrientationChanged",this).call(this,t,e),this._orientation.Apply("orientation",this._handles)}},{key:"Get",value:function Get(t){return this._handlesMap.Get(t)}},{key:"CreateHandle",value:function CreateHandle(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=this._handlesMap.Get(t);return n||(n=_get(_getPrototypeOf(DrawerNav.prototype),"CreateHandle",this).call(this,t),this._handlesMap.Set(t,n),n.data=t,n.Watch(m.ACTIVATED,this._OnHandleActivated,this),"orientation"in n&&(n.orientation=this._orientation.currentFlag),n)}},{key:"Remove",value:function Remove(t){var e=this._handlesMap.Get(t);return e?(e.Release(),e):null}},{key:"_OnHandleActivated",value:function _OnHandleActivated(t){this._Broadcast(DrawerNav.HANDLE_ACTIVATED,this,t,this._optionsMap.Get(t))}},{key:"_CleanUp",value:function _CleanUp(){this._handlesMap.Clear(),_get(_getPrototypeOf(DrawerNav.prototype),"_CleanUp",this).call(this)}}]),DrawerNav}(k);_defineProperty(O,"__NFO__",c.Ext({css:["@/views/drawer-nav.css"]},k,["css"])),_defineProperty(O,"HANDLE_ACTIVATED",Symbol("controlActivated")),_defineProperty(O,"__default_orientation",y.VERTICAL),e.exports=O,f.Register("nkmjs-drawer-nav",O)},{"../dom-template":177,"../helpers/toolbar":190,"../templates/tpl-header-body-footer":205,"../ui":212,"../ui-flag":209,"../ui-id":210,"../ui-signal":211,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/utils":271}],214:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/common"),c=l.NFOS,u=l.SIGNAL,h,d=t("@nkmjs/data-core").CatalogItem,p=t("../ui-id"),f=t("../ui"),g=t("../ui-signal"),m=t("../ui-flag"),y=t("./view"),v=t("../helpers/catalog-view-builder"),k=t("./drawer-nav"),C=function(t){_inherits(Drawer,t);var e=_createSuper(Drawer);function Drawer(){return _classCallCheck(this,Drawer),e.call(this)}return _createClass(Drawer,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Drawer.prototype),"_Init",this).call(this),this._empty=!0,this._placholderViewClass=null,this._placeholderView=null,this._catalogViewBuilder=new v,this._catalogViewBuilder.Watch(u.ITEM_ADDED,this._OnCatalogItemAdded,this),this._catalogViewBuilder.Watch(u.ITEM_REMOVED,this._OnCatalogItemRemoved,this),this._navClass=k,this._nav=null,this._currentHandle=null,this._flags.Add(this,m.FIXED_SIZE),this._isCollapsable=!0}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(Drawer.prototype),"_PostInit",this).call(this),this._nav.Watch(k.HANDLE_ACTIVATED,this._OnHandleActivated,this),this._placholderViewClass&&(this._placeholderView=this.Add(this._placholderViewClass,"view"),this.currentView=this._placeholderView)}},{key:"isCollapsable",get:function get(){return this._isCollapsable},set:function set(t){this._isCollapsable=t}},{key:"_OnOrientationChanged",value:function _OnOrientationChanged(t,e){_get(_getPrototypeOf(Drawer.prototype),"_OnOrientationChanged",this).call(this,t,e),this._nav.orientation=t}},{key:"_Style",value:function _Style(){return{":host":{display:"grid","justify-content":"stretch"},".navigation":{},".view":{},":host(.vertical)":{"flex-flow":"row nowrap","grid-template-columns":"max-content auto"},":host(.vertical).navigation":{"grid-column":"1"},":host(.vertical).view":{"grid-column":"2","flex-flow":"column nowrap","overflow-x":"overlay","overflow-y":"overlay",width:"100%","min-height":"0"},":host(.horizontal)":{"grid-template-rows":"max-content auto"},":host(.horizontal).navigation":{"grid-row":"1"},":host(.horizontal).view":{"grid-row":"2","flex-flow":"row nowrap","overflow-x":"overlay","overflow-y":"overlay",height:"100%","min-width":"0"}}}},{key:"_Render",value:function _Render(){_get(_getPrototypeOf(Drawer.prototype),"_Render",this).call(this),this._nav=this.Add(this._navClass,"navigation"),this._orientation.AddManaged(this._nav._orientation),this._nav.orientation=this.constructor.__default_orientation}},{key:"catalog",get:function get(){return this._catalogViewBuilder.catalog},set:function set(t){this._catalogViewBuilder.catalog=t}},{key:"_OnCatalogItemAdded",value:function _OnCatalogItemAdded(t,e,n){var i=this._nav.CreateHandle(e);return i.Watch(g.CLOSE_REQUESTED,this._OnHandleCloseRequest,this),n.Watch(g.DISPLAY_REQUESTED,this._OnViewRequestDisplay,this),n.visible=!1,n.classList.add(p.VIEW),this.Add(n),this._Broadcast(Drawer.VIEW_ADDED,this,n,i),this._empty&&(this._OnDrawerNonEmpty(),this._OnViewRequestDisplay(n)),n}},{key:"_OnCatalogItemRemoved",value:function _OnCatalogItemRemoved(t,e,n){var i=this._nav.Remove(e);this.currentHandle===i&&(this.currentHandle=null),n===this.currentView&&(this.currentView=null,0===this._nav._handles.length?this._OnDrawerEmpty():this.currentHandle=this._nav._handles[0])}},{key:"_OnHandleActivated",value:function _OnHandleActivated(t,e){var n=this._catalogViewBuilder.Get(e.data);s.isInstanceOf(n,y)&&(this._isCollapsable&&this._currentView===n?this.currentView=null:n.RequestDisplay())}},{key:"_OnHandleCloseRequest",value:function _OnHandleCloseRequest(t){var e;t.data.Release()}},{key:"_OnViewRequestDisplay",value:function _OnViewRequestDisplay(t){this.currentView=t}},{key:"_OnDrawerEmpty",value:function _OnDrawerEmpty(){this._empty=!0,this._Broadcast(Drawer.EMPTY,this),console.log(this._placeholderView),this.currentView=this._placeholderView}},{key:"_OnDrawerNonEmpty",value:function _OnDrawerNonEmpty(t){this._empty=!1}},{key:"currentHandle",get:function get(){return this._currentHandle},set:function set(t){if(this._currentHandle!==t){var e=this._currentHandle;this._currentHandle=t,e&&e.Select(!1),this._currentHandle&&this._currentHandle.Select(!0),this._OnCurrentHandleChanged(e)}}},{key:"_OnCurrentHandleChanged",value:function _OnCurrentHandleChanged(t){var e=this._currentHandle?this._currentHandle.data:null,n=this._catalogViewBuilder.Get(e);n&&this.currentView!=n&&n.RequestDisplay()}},{key:"currentView",get:function get(){return this._currentView},set:function set(t){if(this._currentView!==t){var e=this._currentView;this._currentView=t,e&&(e.visible=!1),this._currentView&&(this._currentView.visible=!0),this._OnCurrentViewChanged(e)}}},{key:"_OnCurrentViewChanged",value:function _OnCurrentViewChanged(t){if(this._currentView){var e=this._catalogViewBuilder._reverseMap.get(this._currentView);e&&(this.currentHandle=this._nav.Get(e)),this._currentView.DisplayGranted()}else this.currentHandle=null}},{key:"_CleanUp",value:function _CleanUp(){this._nav.parentElement!=this._host&&a.AttachFirst(this._nav,this._host,!1),this._catalogViewBuilder.catalog=null,_get(_getPrototypeOf(Drawer.prototype),"_CleanUp",this).call(this)}}]),Drawer}(y);_defineProperty(C,"__NFO__",c.Ext({css:["@/views/drawer.css"]},y,["css"])),_defineProperty(C,"VIEW_ADDED",Symbol("viewCreated")),_defineProperty(C,"EMPTY",Symbol("empty")),_defineProperty(C,"__default_orientation",m.VERTICAL),e.exports=C,f.Register("nkmjs-drawer",C)},{"../helpers/catalog-view-builder":185,"../ui":212,"../ui-flag":209,"../ui-id":210,"../ui-signal":211,"./drawer-nav":213,"./view":217,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/utils":271}],215:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/style").CSS,c=t("../ui"),u,h=function(t){_inherits(LayerContainer,t);var e=_createSuper(LayerContainer);function LayerContainer(){return _classCallCheck(this,LayerContainer),e.call(this)}return _createClass(LayerContainer,[{key:"_Init",value:function _Init(){this._layerClassName="layer",_get(_getPrototypeOf(LayerContainer.prototype),"_Init",this).call(this)}},{key:"_Style",value:function _Style(){var t=l.Extends({":host":{}},_get(_getPrototypeOf(LayerContainer.prototype),"_Style",this).call(this));return t[".".concat(this._layerClassName)]={"@":["layer"]},t}},{key:"_OnChildAdded",value:function _OnChildAdded(t,e){_get(_getPrototypeOf(LayerContainer.prototype),"_OnChildAdded",this).call(this,t,e),t.classList.add(this._layerClassName)}},{key:"_OnChildRemoved",value:function _OnChildRemoved(t,e){_get(_getPrototypeOf(LayerContainer.prototype),"_OnChildRemoved",this).call(this,t,e),t.classList.remove(this._layerClassName)}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(LayerContainer.prototype),"_CleanUp",this).call(this)}}]),LayerContainer}(t("./layer"));e.exports=h,c.Register("nkmjs-layer-container",h)},{"../ui":212,"./layer":216,"@nkmjs/style":158,"@nkmjs/utils":271}],216:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("../ui"),l,c=function(t){_inherits(Layer,t);var e=_createSuper(Layer);function Layer(){return _classCallCheck(this,Layer),e.call(this)}return _createClass(Layer,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Layer.prototype),"_Init",this).call(this)}},{key:"_Style",value:function _Style(){return{":host":{"@":["layer"],overflow:"hidden"}}}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(Layer.prototype),"_CleanUp",this).call(this)}}]),Layer}(t("./view"));e.exports=c,a.Register("nkmjs-layer",c)},{"../ui":212,"./view":217,"@nkmjs/utils":271}],217:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").List,c,u=t("@nkmjs/actions").CommandBox,h=t("../ui"),d=t("../ui-signal"),p=t("../ui-flag"),f,g=function(t){_inherits(View,t);var e=_createSuper(View);function View(){return _classCallCheck(this,View),e.call(this)}return _createClass(View,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(View.prototype),"_Init",this).call(this),this._commands=new u(this._Bind(this._OnCmdRegister))}},{key:"RequestDisplay",value:function RequestDisplay(){this._Broadcast(d.DISPLAY_REQUESTED,this)}},{key:"DisplayGranted",value:function DisplayGranted(){}},{key:"_OnCmdRegister",value:function _OnCmdRegister(t){}}]),View}(t("../widget-orientable"));_defineProperty(g,"__default_iState",null),e.exports=g,h.Register("nkmjs-view",g)},{"../ui":212,"../ui-flag":209,"../ui-signal":211,"../widget-orientable":219,"@nkmjs/actions":1,"@nkmjs/collections":21,"@nkmjs/utils":271}],218:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.COM_ID,c=a.POOL,u=a.SIGNAL,h=a.COMMON_FLAG,d=a.Observer,p=t("@nkmjs/data-core"),f=p.DATA_SIGNAL,g=p.DataBlock,m=p.DataObserver,y=p.CATALOG_SIGNAL,v=p.CatalogItem,k=t("./mouse"),C=t("./ui-flag"),O=t("./widget"),E=t("./helpers/flag-enum"),S=t("./extensions/ext-drag"),I=function(t){_inherits(CatalogWidget,t);var e=_createSuper(CatalogWidget);function CatalogWidget(){return _classCallCheck(this,CatalogWidget),e.call(this)}return _createClass(CatalogWidget,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(CatalogWidget.prototype),"_Init",this).call(this),this._Bind(this._ExecuteCommand),this._dataObserver.Hook(y.ITEM_DATA_CHANGED,this._OnItemDataChanged,this),this._itemData=null,this._flavorEnum=new E(C.flavors),this._flavorEnum.Add(this),this._interactions.Hook(k.BTN_LEFT,k.RELEASE_TWICE,this._Bind(this.AltActivate)),this._extDrag=this._interactions.Add(S),this._extDrag.grabDataCallback=this._Bind(this._GrabDragData),this._dragActivator=null,this._dragFeedbackHost=this}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(CatalogWidget.prototype),"_PostInit",this).call(this),this._extDrag.Setup(this,this._dragActivator,this._dragFeedbackHost)}},{key:"_Wake",value:function _Wake(){_get(_getPrototypeOf(CatalogWidget.prototype),"_Wake",this).call(this),this._extDrag.owner=this}},{key:"flavor",get:function get(){return this._flavorEnum.currentFlag},set:function set(t){this._flavorEnum.Set(t)}},{key:"_OnDataChanged",value:function _OnDataChanged(t){_get(_getPrototypeOf(CatalogWidget.prototype),"_OnDataChanged",this).call(this,t),this.itemData=this._ExtractItemData(this._data),this._data&&this._UpdateInfos(),this._isFocused&&this._BuildCommandHandles()}},{key:"_OnDataUpdated",value:function _OnDataUpdated(t){_get(_getPrototypeOf(CatalogWidget.prototype),"_OnDataUpdated",this).call(this,t),this._itemData||this._UpdateInfos()}},{key:"_OnItemDataChanged",value:function _OnItemDataChanged(t,e,n){this.itemData=this._ExtractItemData(e)}},{key:"_ExtractItemData",value:function _ExtractItemData(t){return t&&s.isInstanceOf(t,v)?t.GetOption(l.DATA,null):null}},{key:"_HookItemDataSignals",value:function _HookItemDataSignals(t){t.Hook(f.DIRTY,this._OnItemDataDirty,this),t.Hook(f.DIRTY_CLEARED,this._OnItemDataCleaned,this),t.Hook(u.UPDATED,this._OnItemDataUpdated,this)}},{key:"itemData",set:function set(t){if(this._itemData!==t){var e=this._itemData;this._itemData=t,e&&this._itemDataObserver.Flush(),this._itemData?(this._itemDataObserver||(this._itemDataObserver=c.Rent(d),this._HookItemDataSignals(this._itemDataObserver)),this._itemDataObserver.ObserveOnly(this._itemData),this._OnItemDataUpdated(this._itemData)):this._itemDataObserver&&(this._itemDataObserver.Release(),this._itemDataObserver=null)}}},{key:"_OnItemDataDirty",value:function _OnItemDataDirty(t){this._flavorEnum.Set(h.WARNING)}},{key:"_OnItemDataCleaned",value:function _OnItemDataCleaned(t){this._flavorEnum.Set(null)}},{key:"_OnItemDataUpdated",value:function _OnItemDataUpdated(t){this._UpdateInfos()}},{key:"_UpdateInfos",value:function _UpdateInfos(){}},{key:"_GrabDragData",value:function _GrabDragData(){return this._data}},{key:"_FocusGain",value:function _FocusGain(){_get(_getPrototypeOf(CatalogWidget.prototype),"_FocusGain",this).call(this),this._data&&(this._BuildCommandHandles(),this._data.primaryCommand&&(this._data.primaryCommand.context=this),this._data.secondaryCommand&&(this._data.secondaryCommand.context=this))}},{key:"_FocusLost",value:function _FocusLost(){_get(_getPrototypeOf(CatalogWidget.prototype),"_FocusLost",this).call(this),this._data&&this._ClearCommandHandles()}},{key:"AltActivate",value:function AltActivate(t){return!this._data.primaryCommand||(this._data.primaryCommand.Execute(),!1)}},{key:"_BuildCommandHandles",value:function _BuildCommandHandles(){if(this._ClearCommandHandles(),this._data){var t=this._data.commandList;if(t)for(var e=0,n=t.length;e<n;e++){var i=t[e];i.context=this,this._BuildCommand(i)}}}},{key:"_BuildCommand",value:function _BuildCommand(t){}},{key:"_ClearCommandHandles",value:function _ClearCommandHandles(){}},{key:"_ExecuteCommand",value:function _ExecuteCommand(t){t.emitter=this,t.Execute(this._data)}}]),CatalogWidget}(O);e.exports=I},{"./extensions/ext-drag":179,"./helpers/flag-enum":187,"./mouse":198,"./ui-flag":209,"./widget":220,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/utils":271}],219:[function(t,e,n){var i=t("./ui"),s=t("./ui-flag"),a=t("./helpers/flag-enum"),l=t("./widget"),c,u=t("@nkmjs/utils").UDOM,h=function(t){_inherits(OrientableWidget,t);var e=_createSuper(OrientableWidget);function OrientableWidget(){return _classCallCheck(this,OrientableWidget),e.call(this)}return _createClass(OrientableWidget,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(OrientableWidget.prototype),"_Init",this).call(this),this._isHorizontalScrollEnabled=!1,this._orientation=new a(s.orientations),this._orientation.Add(this),this._orientation.onFlagChanged.Add(this._Bind(this._OnOrientationChanged)),this._Bind(this._HorizontalScroll)}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(OrientableWidget.prototype),"_PostInit",this).call(this),this._orientation.Set(this.constructor.__default_orientation)}},{key:"orientation",get:function get(){return this._orientation},set:function set(t){this._orientation.Set(t)}},{key:"_OnOrientationChanged",value:function _OnOrientationChanged(t,e){this._isHorizontalScrollEnabled&&(this._orientation.currentFlag===s.VERTICAL?this._interactions.wheelFn=null:this._interactions.wheelFn=this._HorizontalScroll)}},{key:"_HorizontalScroll",value:function _HorizontalScroll(t){if(u.OverflowsX(this._wrapper)){var e=Math.sign(t.deltaY);this._wrapper.scrollBy({top:0,left:50*e}),t.preventDefault()}}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(OrientableWidget.prototype),"_CleanUp",this).call(this),this._orientation.Set(this.constructor.__default_orientation)}}]),OrientableWidget}(l);_defineProperty(h,"CONTROL_ACTIVATED",Symbol("controlActivated")),_defineProperty(h,"__default_orientation",s.HORIZONTAL),e.exports=h},{"./helpers/flag-enum":187,"./ui":212,"./ui-flag":209,"./widget":220,"@nkmjs/utils":271}],220:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.Observer,u=t("./ui"),h=t("./ui-signal"),d=t("./ui-flag"),p=t("./input"),f=t("./mouse"),g=t("./display-object-container"),m=t("./helpers/widget-selection"),y=t("./helpers/flag-enum"),v=t("./extensions/ext-mouse"),k=function(t){_inherits(Widget,t);var e=_createSuper(Widget);function Widget(){return _classCallCheck(this,Widget),e.call(this)}return _createClass(Widget,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Widget.prototype),"_Init",this).call(this),this._data=null,this._notifiesSelectionStack=!1,this._isSelectable=!0,this._isSelected=!1,this._isFocusable=!0,this._isFocused=!1,this._isHighlighted=!1,this._isActivable=!0,this._interactions=new v,this._interactions.focusFn=this._Bind(this.Focus),this._interactions.Hook(f.BTN_LEFT,f.RELEASE,this._Bind(this.Activate)),this._focusArea=null,this._dataObserver=new c,this._dataObserver.Hook(l.UPDATED,this._OnDataUpdated,this),this._flags.Add(this,d.ACTIVATED,d.SELECTED),this._istateEnum=new y(d.istates),this._istateEnum.Add(this),this.default_SelectOnActivation=s.Default(this.default_SelectOnActivation,!1),this._selectOnActivation=this.default_SelectOnActivation}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(Widget.prototype),"_PostInit",this).call(this),this._istateEnum.Set(this.constructor.__default_iState)}},{key:"_OnPaintChange",value:function _OnPaintChange(){_get(_getPrototypeOf(Widget.prototype),"_OnPaintChange",this).call(this),this._interactions.enabled=this._isPainted}},{key:"notifiesSelectionStack",get:function get(){return this._notifiesSelectionStack},set:function set(t){this._notifiesSelectionStack=t}},{key:"htitle",get:function get(){this.getAttribute("title")},set:function set(t){this.setAttribute("title",t)}},{key:"focusArea",get:function get(){return this._focusArea},set:function set(t){this._focusArea!==t&&(this._focusArea=t,this._interactions.element=this._focusArea)}},{key:"selectOnActivation",get:function get(){return this._selectOnActivation},set:function set(t){this._selectOnActivation=t}},{key:"_InitSelectionStack",value:function _InitSelectionStack(){if(!this._selectionStack){var t=new m;t.Watch(l.ITEM_ADDED,this._OnSelectionStackAdd,this),t.Watch(l.ITEM_REMOVED,this._OnSelectionStackRemove,this),this._selectionStack=t}}},{key:"_OnSelectionStackAdd",value:function _OnSelectionStackAdd(t){}},{key:"_OnSelectionStackRemove",value:function _OnSelectionStackRemove(t){}},{key:"isSelectable",get:function get(){return this._isSelectable},set:function set(t){this._isSelectable!==t&&(this._isSelectable=t,t||this.Select(!1))}},{key:"isSelected",get:function get(){return this._isSelected}},{key:"selectionStack",get:function get(){return this._selectionStack?this._selectionStack:this._parent?this._parent.selectionStack:null}},{key:"Select",value:function Select(t){if(this._isSelectable&&this._isSelected!==t){this._isSelected=t,this._flags.Set(d.SELECTED,t);var e=this._notifiesSelectionStack&&this._parent?this._parent.selectionStack:null;t?(this._SelectionGain(),this._Broadcast(h.SELECTION_GAIN,this),e&&e.Add(this),this._Highlight(!0)):(this._SelectionLost(),this._Broadcast(h.SELECTION_LOST,this),e&&e.Remove(this),this._isFocused||this._Highlight(!1))}}},{key:"_SelectionGain",value:function _SelectionGain(){}},{key:"_SelectionLost",value:function _SelectionLost(){}},{key:"isFocusable",get:function get(){return this._isFocusable},set:function set(t){this._isFocusable!==t&&(this._isFocusable=t,t?(this._istateEnum.Set(d.IDLE),this.style.removeProperty("pointer-events")):(this.Focus(!1),this._istateEnum.Set(d.DISABLED),this.style["pointer-events"]="none"))}},{key:"isFocused",get:function get(){return this._isFocused}},{key:"Focus",value:function Focus(t){this._isFocusable&&(t&&!this._isFocusable&&(t=!1),this._isFocused!==t&&(this._isFocused=t,t?this._istateEnum.Set(d.FOCUSED):this._istateEnum.Set(d.IDLE),t?(this._FocusGain(),this._Highlight(!0)):(this._FocusLost(),this._isSelected||this._Highlight(!1))))}},{key:"_FocusGain",value:function _FocusGain(){}},{key:"_FocusLost",value:function _FocusLost(){}},{key:"_Highlight",value:function _Highlight(t){if(t){if(this._isHighlighted)return;this._isHighlighted=t,this._HighlightGain()}else{if(!this._isHighlighted)return;this._isHighlighted=t,this._HighlightLost()}}},{key:"_HighlightGain",value:function _HighlightGain(){}},{key:"_HighlightLost",value:function _HighlightLost(){}},{key:"isActivable",get:function get(){return this._isActivable},set:function set(t){this._isActivable!==t&&(this._isActivable=t)}},{key:"Activate",value:function Activate(t){return!!this._isActivable&&(this._Broadcast(h.ACTIVATED,this,t),this._selectOnActivation&&this._isSelectable&&this.Select(!p.ctrl||!this._isSelected),!0)}},{key:"data",get:function get(){return this._data},set:function set(t){if("_PreprocessData"in this&&(t=this._PreprocessData(t)),this._data!==t){var e=this._data;this._data=t,e&&this._dataObserver.Unobserve(e),this._OnDataChanged(e),this._PostDataChanged(e),t&&(this._dataObserver.Observe(t),this._OnDataUpdated(t)),this._Broadcast(h.DATA_CHANGED,this,t,e)}}},{key:"_OnDataChanged",value:function _OnDataChanged(t){}},{key:"_PostDataChanged",value:function _PostDataChanged(t){}},{key:"_OnDataUpdated",value:function _OnDataUpdated(t){}},{key:"_CleanUp",value:function _CleanUp(){this._istateEnum.Set(this.constructor.__default_iState),this._selectionStack&&this._selectionStack.Clear(),this.data=null,this._selectOnActivation=this.default_SelectOnActivation,this.removeAttribute("title"),this._mouseOver?(this._mOut(null),this._mouseDown&&this._mUp(null)):this._mouseDown&&this._mUpOutside(null),this.Select(!1),this.Focus(!1),_get(_getPrototypeOf(Widget.prototype),"_CleanUp",this).call(this)}},{key:"toString",value:function toString(){return this._data?"<".concat(this.constructor.name,"|").concat(this._uinc,":{").concat(this._data,"}>"):"<".concat(this.constructor.name,"|").concat(this._uinc,">")}}]),Widget}(g);_defineProperty(k,"__NFO__",{css:["@/common.css"]}),_defineProperty(k,"__usePaintCallback",!0),_defineProperty(k,"__default_iState",d.IDLE),e.exports=k},{"./display-object-container":174,"./extensions/ext-mouse":183,"./helpers/flag-enum":187,"./helpers/widget-selection":191,"./input":192,"./mouse":198,"./ui":212,"./ui-flag":209,"./ui-signal":211,"@nkmjs/common":27,"@nkmjs/utils":271}],221:[function(t,e,n){e.exports={INPUT_SIGNAL:t("./lib/input-signal"),InputBase:t("./lib/input-base"),InputField:t("./lib/input-field"),InputFormHandler:t("./lib/input-form-handler"),InputGroup:t("./lib/input-group"),InputText:t("./lib/inputs/input-text"),InputIdentifier:t("./lib/inputs/input-identifier"),InputTextarea:t("./lib/inputs/input-textarea"),InputBoolean:t("./lib/inputs/input-boolean"),InputNumber:t("./lib/inputs/input-number"),InputColor:t("./lib/inputs/input-color"),InputPath:t("./lib/inputs/input-path"),InputFile:t("./lib/inputs/input-file"),InputDirectory:t("./lib/inputs/input-directory"),InputList:t("./lib/inputs/input-list")}},{"./lib/input-base":222,"./lib/input-field":223,"./lib/input-form-handler":224,"./lib/input-group":225,"./lib/input-signal":226,"./lib/inputs/input-boolean":227,"./lib/inputs/input-color":228,"./lib/inputs/input-directory":229,"./lib/inputs/input-file":230,"./lib/inputs/input-identifier":231,"./lib/inputs/input-list":232,"./lib/inputs/input-number":233,"./lib/inputs/input-path":234,"./lib/inputs/input-text":235,"./lib/inputs/input-textarea":236}],222:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.NFOS,c=a.COMMON_FLAG,u=t("@nkmjs/ui-core"),h=u.UI,d=u.UI_FLAG,p=u.Widget,f=u.FlagEnum,g=t("./input-signal"),m=function(t){_inherits(BaseInput,t);var e=_createSuper(BaseInput);function BaseInput(){return _classCallCheck(this,BaseInput),e.call(this)}return _createClass(BaseInput,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(BaseInput.prototype),"_Init",this).call(this),this._currentValue=null,this._changedValue=null,this._invalidInput=!1,this._inputErrors=new Array(0),this._externalValidationStack=new Array(0),this._externalSanitizationStack=new Array(0),this._errorFeedbacks=new Array(0),this._updatePreviewOnChange=!0,this._submitOnChange=!0,this._inputId="",this._sizeEnum=new f(d.sizes),this._sizeEnum.Add(this),this._flavorEnum=new f(d.flavors),this._flavorEnum.Add(this)}},{key:"size",get:function get(){return this._sizeEnum.currentFlag},set:function set(t){this._sizeEnum.Set(t)}},{key:"submitOnChange",get:function get(){return this._submitOnChange},set:function set(t){this._submitOnChange=t}},{key:"currentValue",get:function get(){return this._currentValue},set:function set(t){if(this._currentValue!==t){var e=this._currentValue;this._currentValue=t,this._changedValue=t,this._OnCurrentValueChanged(e)}else this.changedValue=t}},{key:"invalidInput",get:function get(){return this._invalidInput}},{key:"inputId",get:function get(){return this._inputId},set:function set(t){this._inputId=t}},{key:"_OnCurrentValueChanged",value:function _OnCurrentValueChanged(t){this._UpdatePreview()}},{key:"changedValue",get:function get(){return this._changedValue},set:function set(t){if(this._changedValue!==t){var e=this._changedValue;this._changedValue=t,this._OnValueChanged(e)}}},{key:"_OnValueChanged",value:function _OnValueChanged(t){this._internalValidateChangedValue(),this._Broadcast(g.VALUE_CHANGED,this,this._changedValue),this._updatePreviewOnChange&&this._UpdatePreview(),this._submitOnChange&&this.SubmitValue()}},{key:"_IsValueChanged",value:function _IsValueChanged(){return this._currentValue!=this._changedValue}},{key:"_SelectionLost",value:function _SelectionLost(){_get(_getPrototypeOf(BaseInput.prototype),"_SelectionLost",this).call(this),this.SubmitValue(),this.SoftReset()}},{key:"_SanitizeValue",value:function _SanitizeValue(t){for(var e=null,n=0,i=this._externalSanitizationStack.length;n<i;n++)t=(e=this._externalSanitizationStack[n]).fn.call(e.thisArg,t);return t}},{key:"_ValidateChangedValue",value:function _ValidateChangedValue(t){}},{key:"_ClearErrors",value:function _ClearErrors(){this._ClearFeedbacks(),this._invalidInput=!1,this._inputErrors.length=0}},{key:"_internalValidateChangedValue",value:function _internalValidateChangedValue(){this._ClearErrors(),this._ValidateChangedValue(this._changedValue);for(var t=0,e=this._externalValidationStack.length;t<e;t++){var n=this._externalValidationStack[t],i=n.fn.call(n.thisArg,this._changedValue);i&&this._PushError(i)}return this._invalidInput=this._inputErrors.length>0,this._invalidInput&&this._internalOnInputError(),!this._invalidInput}},{key:"AddSanitization",value:function AddSanitization(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null;n=s.isObject(t)?t:{fn:t,thisArg:e},this._externalSanitizationStack.push(n)}},{key:"AddValidation",value:function AddValidation(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null;n=s.isObject(t)?t:{fn:t,thisArg:e},this._externalValidationStack.push(n)}},{key:"_PushError",value:function _PushError(t){s.isString(t)&&(t={type:c.ERROR,message:t}),this._inputErrors.includes(t)||(this._inputErrors.push(t),this._invalidInput=!0)}},{key:"_internalOnInputError",value:function _internalOnInputError(){this._OnInputErrors(),this._Broadcast(g.INPUT_ERROR,this,this._inputErrors)}},{key:"_OnInputErrors",value:function _OnInputErrors(){for(var t=0,e=this._inputErrors.length;t<e;t++){var n=this._inputErrors[t],i=this._AddFeedback(n);this._flavorEnum.Bump(n.type),i&&this._errorFeedbacks.push(i)}}},{key:"_UpdatePreview",value:function _UpdatePreview(){}},{key:"_AddFeedback",value:function _AddFeedback(t){return null}},{key:"_ConcatErrors",value:function _ConcatErrors(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"<br/>",n="",i=0,s=this._inputErrors.length,a=s-1;i<s;i++){var l=this._inputErrors[i];l.type==t&&(n+=l.message,i!=a&&(n+=e))}return n}},{key:"_ClearFeedbacks",value:function _ClearFeedbacks(){this._flavorEnum.Set(null);for(var t=0,e=this._errorFeedbacks.length;t<e;t++)this._errorFeedbacks[t].Release();this._errorFeedbacks.length=0}},{key:"SubmitValue",value:function SubmitValue(){this.changedValue=this._SanitizeValue(this._changedValue),this._IsValueChanged()&&(this._internalValidateChangedValue()?(this._Broadcast(g.VALUE_SUBMITTED,this,this._changedValue),this._UpdatePreview()):this.changedValue=this._currentValue)}},{key:"SoftReset",value:function SoftReset(){this.changedValue=this.currentValue,this._ClearErrors(),this._UpdatePreview()}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(BaseInput.prototype),"_CleanUp",this).call(this),this._flavorEnum.Set(null),this._ClearErrors(),this._externalValidationStack.length=0,this._inputId="",this._currentValue=null,this._changedValue=null}}]),BaseInput}(p);_defineProperty(m,"__NFO__",l.Ext({css:["@/inputs/shared.css"]},p,["css"])),e.exports=m},{"./input-signal":226,"@nkmjs/common":27,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],223:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=i.C,c=i.PATH,u=t("@nkmjs/common"),h=u.NFOS,d=u.COMMON_FLAG,p,f=t("@nkmjs/style").CSS,g=t("@nkmjs/ui-core"),m=g.UI,y=g.INPUT,v=g.KEYBOARD,k=t("./input-signal"),C=t("./input-base"),O=function(t){_inherits(InputField,t);var e=_createSuper(InputField);function InputField(){return _classCallCheck(this,InputField),e.call(this)}return _createClass(InputField,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputField.prototype),"_Init",this).call(this),this._inputField=null,this._Bind(this._onInput),this._Bind(this._onChange),this._Bind(this._onFocusIn),this._Bind(this._onFocusOut),this._Bind(this._FOut),this._Bind(this._FIn)}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(InputField.prototype),"_PostInit",this).call(this),this._inputField.addEventListener("focus",this._onFocusIn),this._inputField.addEventListener("focusout",this._onFocusOut),this._inputField.addEventListener("input",this._onInput),this._inputField.addEventListener("change",this._onChange)}},{key:"_Style",value:function _Style(){return f.Extends({":host":{position:"relative",display:"flex","align-content":"stretch","align-items":"stretch"},".field":{flex:"1 1 auto","min-width":0}},_get(_getPrototypeOf(InputField.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){this._inputField=a.New("input",{class:"field"},this._host)}},{key:"placeholderValue",set:function set(t){this._inputField.setAttribute("placeholder",t)}},{key:"_onInput",value:function _onInput(t){this.changedValue=this._GrabValue()}},{key:"_onChange",value:function _onChange(t){this.changedValue=this._GrabValue()}},{key:"_GrabValue",value:function _GrabValue(){return this._inputField.value}},{key:"_FIn",value:function _FIn(){this._inputField.focus()}},{key:"_FOut",value:function _FOut(t){y.shift||(t&&t.preventDefault(),this._inputField.blur())}},{key:"_onFocusIn",value:function _onFocusIn(t){y.ONKeyDown(v._enter,this._FOut)}},{key:"_onFocusOut",value:function _onFocusOut(t){y.OFFKeyDown(v._enter,this._FOut),this.SubmitValue()}},{key:"_UpdatePreview",value:function _UpdatePreview(){this._inputField.value=this._currentValue}}]),InputField}(C);_defineProperty(O,"__NFO__",h.Ext({css:["@/inputs/field.css"]},C,["css"])),e.exports=O,m.Register("nkmjs-input-field",O)},{"./input-base":222,"./input-signal":226,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],224:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").DisposableObjectEx,c=t("@nkmjs/collections"),u=c.Dictionary,h=c.List,d=t("./input-signal"),p=t("./input-base"),f=function(t){_inherits(InputFormHandler,t);var e=_createSuper(InputFormHandler);function InputFormHandler(){return _classCallCheck(this,InputFormHandler),e.call(this)}return _createClass(InputFormHandler,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputFormHandler.prototype),"_Init",this).call(this),this._inputList=new h,this._inputValues={},this._errorCount=0,this._invalidForm=!1}},{key:"inputValues",get:function get(){return this._inputValues}},{key:"invalidForm",get:function get(){return this._invalidForm}},{key:"Register",value:function Register(t){if(!s.isInstanceOf(t,p))throw new Error("InputFormHandler cannot register non-input items.");this._inputList.Add(t)&&(this._inputValues[t.inputId]=t.currentValue,t._internalValidateChangedValue(),t.invalidInput?(this._invalidForm=!0,this._Broadcast(d.FORM_INVALID,this)):this._invalidForm||this._Broadcast(d.FORM_READY,this),t.Watch(d.VALUE_SUBMITTED,this._OnInputSubmit,this),t.Watch(d.VALUE_CHANGED,this._OnInputChanged,this),t.Watch(d.INPUT_ERROR,this._OnInputError,this))}},{key:"Unregister",value:function Unregister(t){this._inputList.Remove(t)&&(delete this._inputValues[t.inputId],t.Unwatch(d.VALUE_SUBMITTED,this._OnInputSubmit,this),t.Unwatch(d.VALUE_CHANGED,this._OnInputChanged,this),t.Unwatch(d.INPUT_ERROR,this._OnInputError,this))}},{key:"ValidateForm",value:function ValidateForm(){var t=this._invalidForm;return this._invalidForm=!1,this._errorCount=0,this._inputList.ForEach(this._CheckInput,this),this._invalidForm!=t&&(this._invalidForm?this._Broadcast(d.FORM_INVALID,this):this._Broadcast(d.FORM_READY,this)),this._invalidForm}},{key:"_CheckInput",value:function _CheckInput(t){t.invalidInput&&(this._invalidForm=!0,this._errorCount+=t._inputErrors.length)}},{key:"Clear",value:function Clear(){for(var t=0,e=this._inputList.count;t<e;t++)this.Unregister(this._inputList.last)}},{key:"_OnInputSubmit",value:function _OnInputSubmit(t,e){this.ValidateForm(),this._inputValues[t.inputId]=e}},{key:"_OnInputChanged",value:function _OnInputChanged(t,e){this.ValidateForm(),this._inputValues[t.inputId]=e}},{key:"_OnInputError",value:function _OnInputError(t,e){this.ValidateForm()}}]),InputFormHandler}(l);e.exports=f},{"./input-base":222,"./input-signal":226,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/utils":271}],225:[function(t,e,n){var i,s=t("@nkmjs/ui-core").UI,a,l=function(t){_inherits(InputGroup,t);var e=_createSuper(InputGroup);function InputGroup(){return _classCallCheck(this,InputGroup),e.call(this)}return InputGroup}(t("./input-base"));e.exports=l,s.Register("nkmjs-input-group",l)},{"./input-base":222,"@nkmjs/ui-core":169}],226:[function(t,e,n){var i=function INPUT_SIGNAL(){_classCallCheck(this,INPUT_SIGNAL)};_defineProperty(i,"VALUE_CHANGED",Symbol("valueChanged")),_defineProperty(i,"VALUE_SUBMITTED",Symbol("valueCommitted")),_defineProperty(i,"INPUT_ERROR",Symbol("inputError")),_defineProperty(i,"FORM_READY",Symbol("formReady")),_defineProperty(i,"FORM_INVALID",Symbol("formInvalid")),e.exports=i},{}],227:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").NFOS,u,h=t("@nkmjs/style").CSS,d=t("@nkmjs/ui-core"),p=d.UI,f=d.TextManipulator,g=t("../input-field"),m="checked",y=function(t){_inherits(InputBoolean,t);var e=_createSuper(InputBoolean);function InputBoolean(){return _classCallCheck(this,InputBoolean),e.call(this)}return _createClass(InputBoolean,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputBoolean.prototype),"_Init",this).call(this),this._flags.Add(this,m),this._label=null}},{key:"label",get:function get(){return this._label},set:function set(t){this._label.Set(t)}},{key:"_Style",value:function _Style(){return h.Extends({".field":{"@":["invisible-fill"]}},_get(_getPrototypeOf(InputBoolean.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){this._label=new f(a.New("span",{class:"label"},this._host));var t=a.New("div",{class:"body"},this._host);this._handle=a.New("div",{class:"handle"},t),this._inputField=a.New("input",{class:"field",type:"checkbox"},this._host)}},{key:"_GrabValue",value:function _GrabValue(){return this._inputField.checked}},{key:"_UpdatePreview",value:function _UpdatePreview(){this._inputField.checked=this._changedValue,this._flags.Set(m,this._changedValue)}}]),InputBoolean}(g);_defineProperty(y,"__NFO__",c.Ext({css:["@/inputs/boolean.css"]},g,["css"])),e.exports=y,p.Register("nkmjs-input-boolean",y)},{"../input-field":223,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],228:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").NFOS,u,h=t("@nkmjs/style").CSS,d=t("@nkmjs/ui-core"),p=d.UI,f=d.TextManipulator,g=t("../input-field"),m=function(t){_inherits(InputColor,t);var e=_createSuper(InputColor);function InputColor(){return _classCallCheck(this,InputColor),e.call(this)}return _createClass(InputColor,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputColor.prototype),"_Init",this).call(this),this._label=null,this._body=null}},{key:"label",get:function get(){return this._label},set:function set(t){this._label.Set(t)}},{key:"_Style",value:function _Style(){return h.Extends({".field":{"@":["invisible-fill"]}},_get(_getPrototypeOf(InputColor.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){this._label=new f(a.New("span",{class:"label"},this._host)),this._inputField=a.New("input",{class:"field",type:"color"},this._host),this._body=a.New("div",{class:"body"},this._host)}},{key:"_UpdatePreview",value:function _UpdatePreview(){_get(_getPrototypeOf(InputColor.prototype),"_UpdatePreview",this).call(this),this._body.style["background-color"]=this._changedValue}}]),InputColor}(g);_defineProperty(m,"__NFO__",c.Ext({css:["@/inputs/color.css"]},g,["css"])),e.exports=m,p.Register("nkmjs-input-color",m)},{"../input-field":223,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],229:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/ui-core").UI,u,h=function(t){_inherits(InputDirectory,t);var e=_createSuper(InputDirectory);function InputDirectory(){return _classCallCheck(this,InputDirectory),e.call(this)}return _createClass(InputDirectory,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputDirectory.prototype),"_Init",this).call(this),this._openType="openDirectory"}}]),InputDirectory}(t("./input-file"));e.exports=h,c.Register("nkmjs-input-directory",h)},{"./input-file":230,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],230:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").COM_ID,u,h=t("@nkmjs/actions").RELAY,d,p=t("@nkmjs/environment").ENV,f,g=t("@nkmjs/style").CSS,m=t("@nkmjs/ui-core"),y=m.UI,v=m.ToolButton,k=m.UI_FLAG,C,O=function(t){_inherits(InputFile,t);var e=_createSuper(InputFile);function InputFile(){return _classCallCheck(this,InputFile),e.call(this)}return _createClass(InputFile,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputFile.prototype),"_Init",this).call(this),this._Bind(this._onPickerChange),this._Bind(this._Picked),this._openType="openFile",this._picker=null}},{key:"_Style",value:function _Style(){return g.Extends({".input-btn":{flex:"1 1 auto"}},_get(_getPrototypeOf(InputFile.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){var t;(_get(_getPrototypeOf(InputFile.prototype),"_Render",this).call(this),p.FEATURES.isNodeEnabled)?(this._picker=this.Add(v,"input-btn"),this._picker.options=(_defineProperty(t={},c.ICON,"%ICON%/icon_more.svg"),_defineProperty(t,"trigger",{fn:this._Pick,thisArg:this}),_defineProperty(t,"variant",k.FRAME),t),this._sizeEnum.Add(this._picker)):(this._picker=a.New("input",{class:"input-btn",type:"file"},this._host),this._picker.addEventListener("change",this._onPickerChange))}},{key:"_Pick",value:function _Pick(){p.FEATURES.isNodeEnabled&&h.ShowOpenDialog({defaultPath:this._currentValue?this._currentValue:"",properties:[this._openType]}).then(this._Picked)}},{key:"_Picked",value:function _Picked(t){var e;void 0!==t.filePaths[0]&&(this.changedValue=t.filePaths[0])}},{key:"_onPickerChange",value:function _onPickerChange(t){console.log(this._picker.value),console.log(t)}}]),InputFile}(t("./input-path"));e.exports=O,y.Register("nkmjs-input-file",O)},{"./input-path":234,"@nkmjs/actions":1,"@nkmjs/common":27,"@nkmjs/environment":95,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],231:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").COMMON_FLAG,u=t("@nkmjs/ui-core"),h=u.UI,d=u.ImageManipulator,p=t("../input-field"),f,g=t("@nkmjs/style").CSS,m={type:c.ERROR,message:"No space allowed."},y={type:c.ERROR,message:"Must starts with <strong>A-Z, a-z</strong> or <strong>_</strong>"},v={type:c.ERROR,message:"Cannot be empty"},k={type:c.ERROR,message:"Can only contains the following characters : <strong>A-Z, a-z, _, 0-9</strong>"},C=function(t){_inherits(InputIdentifier,t);var e=_createSuper(InputIdentifier);function InputIdentifier(){return _classCallCheck(this,InputIdentifier),e.call(this)}return _createClass(InputIdentifier,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputIdentifier.prototype),"_Init",this).call(this),this._issues=new Array(0),this._updatePreviewOnChange=!1,this._submitOnChange=!1,this._label=null}},{key:"label",get:function get(){return this._label},set:function set(t){this._label.Set(t)}},{key:"_Style",value:function _Style(){return g.Extends({":host":{display:"flex","flex-flow":"column nowrap","align-items":"stretch","align-content":"stretch"},".field":{flex:"1 1 auto",width:"auto"}},_get(_getPrototypeOf(InputIdentifier.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){this._inputField=a.New("input",{class:"field",type:"search"}),this._label=new d(a.New("p",{class:"error"},this))}},{key:"_OnInputErrors",value:function _OnInputErrors(){_get(_getPrototypeOf(InputIdentifier.prototype),"_OnInputErrors",this).call(this),this._label.Set(this._ConcatErrors(c.ERROR,"<br/>"))}},{key:"_ClearFeedbacks",value:function _ClearFeedbacks(){_get(_getPrototypeOf(InputIdentifier.prototype),"_ClearFeedbacks",this).call(this),this._label.Set(null)}},{key:"_ValidateChangedValue",value:function _ValidateChangedValue(t){_get(_getPrototypeOf(InputIdentifier.prototype),"_ValidateChangedValue",this).call(this,t);var e=!1;s.ValidIdentifier(t)||(s.Empty(t)?this._PushError(v):(s.StartWithNumber(t)&&(this._PushError(y),e=!0),s.ContainsAnySpace(t)&&(this._PushError(m),e=!0),e||this._PushError(k)))}}]),InputIdentifier}(p);e.exports=C,h.Register("nkmjs-input-identifier",C)},{"../input-field":223,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],232:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").COMMON_FLAG,u,h=t("@nkmjs/ui-core").UI,d=t("../input-base"),p,f=t("@nkmjs/style").CSS,g=function(t){_inherits(InputList,t);var e=_createSuper(InputList);function InputList(){return _classCallCheck(this,InputList),e.call(this)}return _createClass(InputList,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputList.prototype),"_Init",this).call(this)}},{key:"_Style",value:function _Style(){return f.Extends({".field":{}},_get(_getPrototypeOf(InputList.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){}}]),InputList}(d);e.exports=g,h.Register("nkmjs-input-list",g)},{"../input-base":222,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],233:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/common"),c=l.NFOS,u=l.COMMON_FLAG,h,d=t("@nkmjs/style").CSS,p,f=t("@nkmjs/ui-core").UI,g=t("../input-field"),m="slider",y=function(t){_inherits(InputNumber,t);var e=_createSuper(InputNumber);function InputNumber(){return _classCallCheck(this,InputNumber),e.call(this)}return _createClass(InputNumber,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputNumber.prototype),"_Init",this).call(this)}},{key:"SetSliderData",value:function SetSliderData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t!=e?(n||(n=(e-t)/100),this._inputField.setAttribute("type","range"),this._inputField.setAttribute("min",t),this._inputField.setAttribute("max",e),this._inputField.setAttribute("step",n),this._flags.Set(m,!0)):(this._inputField.setAttribute("type","number"),this._inputField.removeAttribute("min"),this._inputField.removeAttribute("max"),this._inputField.removeAttribute("step"),this._flags.Set(m,!1))}},{key:"_Render",value:function _Render(){this._inputField=a.New("input",{class:"field",type:"number"},this._host),this._flags.Add(this._inputField,m)}},{key:"_GrabValue",value:function _GrabValue(){var t=Number(this._inputField.value);return Number.isNaN(t)?0:t}},{key:"_CleanUp",value:function _CleanUp(){this.SetSliderData(),_get(_getPrototypeOf(InputNumber.prototype),"_CleanUp",this).call(this)}}]),InputNumber}(g);_defineProperty(y,"__NFO__",c.Ext({css:["@/inputs/number.css"]},g,["css"])),e.exports=y,f.Register("nkmjs-input-number",y)},{"../input-field":223,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],234:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=i.PATH,c,u=t("@nkmjs/common").COMMON_FLAG,h,d=t("@nkmjs/ui-core").UI,p,f=function(t){_inherits(InputPath,t);var e=_createSuper(InputPath);function InputPath(){return _classCallCheck(this,InputPath),e.call(this)}return _createClass(InputPath,[{key:"_SanitizeValue",value:function _SanitizeValue(t){return l.Sanitize(_get(_getPrototypeOf(InputPath.prototype),"_SanitizeValue",this).call(this,t))}}]),InputPath}(t("../input-field"));e.exports=f,d.Register("nkmjs-input-path",f)},{"../input-field":223,"@nkmjs/common":27,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],235:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").COMMON_FLAG,u,h=t("@nkmjs/style").CSS,d,p=t("@nkmjs/ui-core").UI,f,g=function(t){_inherits(InputText,t);var e=_createSuper(InputText);function InputText(){return _classCallCheck(this,InputText),e.call(this)}return _createClass(InputText,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputText.prototype),"_Init",this).call(this),this._updatePreviewOnChange=!1,this._submitOnChange=!1}},{key:"_Render",value:function _Render(){this._inputField=a.New("input",{class:"field",type:"search"},this._host)}}]),InputText}(t("../input-field"));e.exports=g,p.Register("nkmjs-input-text",g)},{"../input-field":223,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],236:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/common"),c=l.NFOS,u=l.COMMON_FLAG,h,d=t("@nkmjs/style").CSS,p,f=t("@nkmjs/ui-core").UI,g=t("../input-field"),m=function(t){_inherits(InputTextarea,t);var e=_createSuper(InputTextarea);function InputTextarea(){var t;return _classCallCheck(this,InputTextarea),_defineProperty(_assertThisInitialized(t=e.call(this)),"expandable",void 0),t}return _createClass(InputTextarea,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InputTextarea.prototype),"_Init",this).call(this),this._updatePreviewOnChange=!1,this._submitOnChange=!1}},{key:"_Render",value:function _Render(){this._inputField=a.New("textarea",{class:"field",rows:3},this._host)}}]),InputTextarea}(g);_defineProperty(m,"__NFO__",c.Ext({css:["@/inputs/expandable.css"]},g,["css"])),e.exports=m,f.Register("nkmjs-input-textarea",m)},{"../input-field":223,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],237:[function(t,e,n){e.exports={CONTROL_SIGNAL:t("./lib/control-signal"),Control:t("./lib/control"),ControlGroup:t("./lib/control-group"),Shell:t("./lib/shell"),Explorer:t("./lib/explorer"),WORKSPACE_CONTEXT:t("./lib/workspace-context"),DialogBox:t("./lib/dialogs/dialog-box"),DialogInput:t("./lib/dialogs/dialog-input"),DialogLayer:t("./lib/dialogs/dialog-layer"),DialogHandler:t("./lib/dialogs/dialog-handler"),Editor:t("./lib/editor"),EditorEx:t("./lib/editors/editor-ex"),EditorSlate:t("./lib/editors/editor-slate"),EditorDrawerNav:t("./lib/editors/editor-drawer-nav"),EditorDrawer:t("./lib/editors/editor-drawer"),Group:t("./lib/helpers/group"),Inspector:t("./lib/inspector"),InspectorGroup:t("./lib/inspectors/inspector-group"),InspectorItem:t("./lib/inspectors/inspector-item"),InspectorShell:t("./lib/inspectors/inspector-shell"),MetaControlGroup:t("./lib/inspectors/meta-control-group"),MetaControlItem:t("./lib/inspectors/meta-control-item"),HistoryInspectorShell:t("./lib/inspectors/history-inspector-shell"),Tab:t("./lib/items/tab"),StatusBar:t("./lib/items/status-bar"),Tag:t("./lib/items/tag"),Breadcrumb:t("./lib/items/breadcrumb"),BreadcrumbItem:t("./lib/items/breadcrumb-item"),Workspace:t("./lib/workspace/workspace"),WorkspaceCellNav:t("./lib/workspace/workspace-cell-nav"),WorkspaceCell:t("./lib/workspace/workspace-cell"),WorkspaceRoot:t("./lib/workspace/workspace-root")}},{"./lib/control":240,"./lib/control-group":238,"./lib/control-signal":239,"./lib/dialogs/dialog-box":241,"./lib/dialogs/dialog-handler":242,"./lib/dialogs/dialog-input":243,"./lib/dialogs/dialog-layer":244,"./lib/editor":245,"./lib/editors/editor-drawer":247,"./lib/editors/editor-drawer-nav":246,"./lib/editors/editor-ex":248,"./lib/editors/editor-slate":249,"./lib/explorer":250,"./lib/helpers/group":251,"./lib/inspector":252,"./lib/inspectors/history-inspector-shell":253,"./lib/inspectors/inspector-group":254,"./lib/inspectors/inspector-item":255,"./lib/inspectors/inspector-shell":256,"./lib/inspectors/meta-control-group":257,"./lib/inspectors/meta-control-item":258,"./lib/items/breadcrumb":260,"./lib/items/breadcrumb-item":259,"./lib/items/status-bar":261,"./lib/items/tab":262,"./lib/items/tag":263,"./lib/shell":264,"./lib/workspace-context":266,"./lib/workspace/workspace":270,"./lib/workspace/workspace-cell":268,"./lib/workspace/workspace-cell-nav":267,"./lib/workspace/workspace-root":269}],238:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").POOL,u=t("@nkmjs/ui-core"),h=u.UI,d=u.UI_SIGNAL,p=u.ExtExpand,f=u.ToolButton,g=u.Toolbar,m=u.ImageManipulator,y=u.TextManipulator,v,k=function(t){_inherits(ControlGroup,t);var e=_createSuper(ControlGroup);function ControlGroup(){return _classCallCheck(this,ControlGroup),e.call(this)}return _createClass(ControlGroup,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(ControlGroup.prototype),"_Init",this).call(this),this._extExpand=new p,this._extExpand._isExpanded=!1,this._extExpand.Watch(d.EXPANDED,this._Expand,this),this._extExpand.Watch(d.COLLAPSED,this._Collapse,this),this._header=null,this._expandBtn=null,this._icon=null,this._label=null,this._toolbarClass=g,this._toolbar=null,this._itemWrapper=null}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(ControlGroup.prototype),"_PostInit",this).call(this),this._extExpand.Setup(this,this._itemWrapper,this._expandBtn)}},{key:"_Style",value:function _Style(){return s.Merge(_get(_getPrototypeOf(ControlGroup.prototype),"_Style",this).call(this),{":host":{},".header":{position:"relative",display:"flex","flex-direction":"row","align-items":"center","align-content":"stretch",padding:"4px","box-sizing":"border-box",flex:"0 1 auto"},".toggle":{flex:"0 0 auto"},".facade":{flex:"1 1 auto"},".toolbar":{flex:"0 0 auto"},".content":{},".content.expanded":{display:"flex"},".content.collapsed":{display:"none"}})}},{key:"_Render",value:function _Render(){this._header=a.New("div",{class:"header"},this._host),this._expandBtn=this.Add(f,"toggle",this._header),this._icon=new m(a.New("span",{class:"icon"},this._header)),this._label=new y(a.New("span",{class:"label"},this._header)),this._toolbar=this.Add(this._toolbarClass,"toolbar",this._header),this._expandBtn.icon="%ICON%/icon_expand_arrow.svg",this._expandBtn.scale=.75,this._itemWrapper=a.New("div",{class:"content"},this._host),this.focusArea=this._header}},{key:"Expand",value:function Expand(){this._extExpand.Expand()}},{key:"_Expand",value:function _Expand(){this._data&&(this._data.expanded=!0),this._expandBtn.rotation=90}},{key:"Collapse",value:function Collapse(){this._extExpand.Collapse()}},{key:"_Collapse",value:function _Collapse(){this._data&&(this._data.expanded=!1),this._expandBtn.rotation=0}},{key:"Activate",value:function Activate(t){return!this._expandBtn.focused&&_get(_getPrototypeOf(ControlGroup.prototype),"Activate",this).call(this,t)}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(ControlGroup.prototype),"_CleanUp",this).call(this)}}]),ControlGroup}(t("./control.js"));e.exports=k,h.Register("nkmjs-control-group",k)},{"./control.js":240,"@nkmjs/common":27,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],239:[function(t,e,n){var i=function CONTROL_SIGNAL(){_classCallCheck(this,CONTROL_SIGNAL)};_defineProperty(i,"VALUE_CHANGED",Symbol("valueChanged")),_defineProperty(i,"VALUE_COMMITTED",Symbol("valueCommitted")),e.exports=i},{}],240:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").SIGNAL,c,u=t("@nkmjs/style").CSS,h=t("@nkmjs/data-core"),d=h.DATA_SIGNAL,p=h.DataBlock,f=h.MetadataObserver,g=t("@nkmjs/ui-core"),m=g.UI,y=g.OrientableWidget,v,k=t("@nkmjs/actions").CommandAction,C=t("./editor"),O=function(t){_inherits(Control,t);var e=_createSuper(Control);function Control(){return _classCallCheck(this,Control),e.call(this)}return _createClass(Control,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Control.prototype),"_Init",this).call(this),this._metadataObserver=new f,this._dataObserver.Hook(d.DIRTY,this._OnDataDirty,this),this._dataObserver.Hook(l.UPDATED,this._OnDataUpdated,this)}},{key:"context",get:function get(){return this._context},set:function set(t){if(this._context!==t){var e=this._context;this._context=t,this._OnContextChanged(e)}}},{key:"_OnContextChanged",value:function _OnContextChanged(t){}},{key:"editor",get:function get(){for(var t=this._parent;null!=t;){if(s.isInstanceOf(t,C))return t;t=t._parent}return null}},{key:"_Style",value:function _Style(){return u.Extends({":host":{position:"relative",display:"flex",flex:"0 1 auto","min-width":0}},_get(_getPrototypeOf(Control.prototype),"_Style",this).call(this))}},{key:"_OnDataChanged",value:function _OnDataChanged(t){_get(_getPrototypeOf(Control.prototype),"_OnDataChanged",this).call(this,t),s.isInstanceOf(this._data,p)?this._metadataObserver.target=this._data.metadata:this._metadataObserver.target=null}},{key:"_OnDataDirty",value:function _OnDataDirty(t){this._OnDataUpdated(t)}},{key:"_CleanUp",value:function _CleanUp(){this.context=null,_get(_getPrototypeOf(Control.prototype),"_CleanUp",this).call(this)}},{key:"_Do",value:function _Do(t,e){k.Do(this,t,e)}}]),Control}(y);e.exports=O,m.Register("nkmjs-control",O)},{"./editor":245,"@nkmjs/actions":1,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],241:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/collections"),c=l.Dictionary,u=l.List,h=t("@nkmjs/common"),d=h.NFOS,p=h.OptionsHandler,f=t("@nkmjs/style"),g=f.CSS,m=f.FONT_FLAG,y=t("@nkmjs/ui-core"),v=y.UI,k=y.UI_SIGNAL,C=y.Widget,O=y.TextManipulator,E=y.ImageManipulator,S=y.Frame,I=y.Toolbar,b=y.ButtonEx,D=y.UI_FLAG,A=t("@nkmjs/ui-inputs"),P=A.INPUT_SIGNAL,R=A.InputBase,T=A.InputFormHandler,x,w=t("@nkmjs/dialog").DialogInfos,L=function(t){_inherits(DialogBox,t);var e=_createSuper(DialogBox);function DialogBox(){return _classCallCheck(this,DialogBox),e.call(this)}return _createClass(DialogBox,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DialogBox.prototype),"_Init",this).call(this),this._formHandler=new T,this._formHandler.Watch(P.FORM_INVALID,this._OnFormInvalid,this),this._formHandler.Watch(P.FORM_READY,this._OnFormReady,this),this._header=null,this._body=null,this._footer=null,this._title=null,this._icon=null,this._hasInput=!1,this._handles=new Array(0),this._contents=new Array(0),this._submitMap=new c,this._submitList=new u,this._toolbarClass=I,this._toolbarDefaultButtonClass=b,this._toolbar=null,this._optionsHandler=new p(this._Bind(this._OnOptionsUpdated),this._Bind(this._OnOptionsWillUpdate)),this._optionsHandler.Hook("_title","title","!!! MISSING TITLE !!!"),this._optionsHandler.Hook("_icon","icon",null),this._optionsHandler.Hook("_message","message",null),this._optionsHandler.Hook("_actions",this._Bind(this.SetActions),null),this._optionsHandler.Hook("_content",this._Bind(this.SetContent)),this._Bind(this._Close),this._Bind(this._Submit)}},{key:"_Style",value:function _Style(){return g.Extends({":host":{display:"flex","flex-flow":"column","align-content":"stretch","align-items":"stretch","justify-content":"center",overflow:"hidden"},".header":{},".footer":{display:"flex","flex-flow":"column","align-content":"flex-end","align-items":"flex-end",flex:"0 0 auto"},".toolbar":{flex:"0 0 auto"},".body":{flex:"1 1 auto"}},_get(_getPrototypeOf(DialogBox.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){this._icon=new E(a.New("div",{class:"icon"},this._host),!1,!0),this._header=a.New("div",{class:"group header"},this._host),this._body=a.New("div",{class:"group body"},this._host),this._footer=a.New("div",{class:"group footer"},this._host),this._toolbar=this.Add(this._toolbarClass,"toolbar",this._footer),this._toolbar._defaultButtonClass=this._toolbarDefaultButtonClass,this._toolbar.size=D.SIZE_M,this._title=new O(a.New("span",{class:"title ".concat(m.MEDIUM)},this._header),!1),this._messageElement=null}},{key:"_OnOptionsWillUpdate",value:function _OnOptionsWillUpdate(t){if(!s.isInstanceOf(t,w))throw new Error("DialogLayer expect data of type DialogInfos, got ".concat(t.constructor.name," instead."))}},{key:"_OnOptionsUpdated",value:function _OnOptionsUpdated(t){this._hasInput=this._formHandler._inputList.count>0,this._hasInput&&this._formHandler.ValidateForm()}},{key:"title",get:function get(){return this._title},set:function set(t){this._title.Set(t)}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._icon.Set(t)}},{key:"message",set:function set(t){this._messageElement||(this._messageElement=a.New("span",{class:"item message"},this._body)),this._messageElement.innerHTML=t,this._contents.push(this._messageElement)}},{key:"SetActions",value:function SetActions(t){if(t)for(var e=0,n=t.length;e<n;e++){var i=t[e];this.CreateHandle(i,s.Get(i,"cl",null))}else this.CreateHandle({text:"Close"})}},{key:"SetContent",value:function SetContent(t){if(!Array.isArray(t))throw new Error("Cannot build dialog content list out of ".concat(t));for(var e=0,n=t.length;e<n;e++){var i=t[e],a=i.cl,l=i.data;if(!a)throw new Error("Cannot create item with unspecified class.");var c=this.Add(a,"item",this._body);if(s.isInstanceOf(a,R)){c.inputId=i.inputId,i.value&&(c.currentValue=i.value);var u=i.validations;if(u)for(var h=0,d=u.length;h<d;h++)c.AddValidation(u[h]);this._formHandler.Register(c)}l&&(c.data=l),this._contents.push(c)}}},{key:"_OnDataUpdated",value:function _OnDataUpdated(t){this._Clear(),this._optionsHandler.Process(this,t)}},{key:"_ClearHandles",value:function _ClearHandles(){for(var t=this._handles;0!=t.length;)t.pop().Release()}},{key:"CreateHandle",value:function CreateHandle(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._toolbar.CreateHandle(t,e);return this._handles.push(n),s.Get(t,"submit",!1)&&(this._submitMap.Set(n,t.submit),this._submitList.Add(n),n.Watch(k.TRIGGERED,this._Submit)),s.Get(t,"close",!0)&&n.Watch(k.TRIGGERED,this._Close),n}},{key:"_OnFormInvalid",value:function _OnFormInvalid(t){this._submitList.ForEach((function(t){t.activable=!1}))}},{key:"_OnFormReady",value:function _OnFormReady(t){this._submitList.ForEach((function(t){t.activable=!0}))}},{key:"_Close",value:function _Close(){this._data.Consume()}},{key:"_Submit",value:function _Submit(t){var e=this._submitMap.Get(t);e.fn.call(e.thisArg,this._formHandler.inputValues)}},{key:"_Clear",value:function _Clear(){this._submitMap.Clear(),this._submitList.Clear(),this._formHandler.Clear(),this._ClearHandles();for(var t=0,e=this._contents.length;t<e;t++){var n=this._contents[t];"Release"in n?this._contents[t].Release():a.Remove(n)}this._hasInput=!1,this._contents.length=0}},{key:"_CleanUp",value:function _CleanUp(){this._Clear(),_get(_getPrototypeOf(DialogBox.prototype),"_CleanUp",this).call(this)}}]),DialogBox}(C);_defineProperty(L,"__NFO__",d.Ext({css:["@/dialogs/dialog-box.css"]},C,["css"])),e.exports=L,v.Register("nkmjs-dialog-box",L)},{"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/dialog":84,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/ui-inputs":221,"@nkmjs/utils":271}],242:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").Dictionary,c=t("@nkmjs/ui-core"),u=c.UI,h=c.LayerContainer,d,p=t("@nkmjs/actions").ACTION_REQUEST,f=t("@nkmjs/dialog"),g=f.DIALOG_SIGNAL,m=f.DialogInfos,y=t("./dialog-layer.js"),v,k=t("@nkmjs/style").CSS,C=function(t){_inherits(DialogHandler,t);var e=_createSuper(DialogHandler);function DialogHandler(){return _classCallCheck(this,DialogHandler),e.call(this)}return _createClass(DialogHandler,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DialogHandler.prototype),"_Init",this).call(this),this._RegisterLocalRequestHandler(p.DIALOG,this.HandleDialogRequest),this._layerMap=new l}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(DialogHandler.prototype),"_PostInit",this).call(this),this.visible=!1}},{key:"_Style",value:function _Style(){var t=k.Extends({":host":{"pointer-events":"none"},".layer":{"pointer-events":"auto"}},_get(_getPrototypeOf(DialogHandler.prototype),"_Style",this).call(this));return t[".".concat(this._layerClassName)]["pointer-events"]="auto",t}},{key:"HandleDialogRequest",value:function HandleDialogRequest(t){this.BringToFront(),this.visible=!0;var e=t.GetOption("data",null);if(!e)throw new Error("Cannot build dialog from empty DialogInfos");var n=this.Add(y);n.data=e,e.Watch(g.CONSUMED,this._OnDialogConsumed,this),this._layerMap.Set(e,n),t.HandleSuccess(this)}},{key:"_OnDialogConsumed",value:function _OnDialogConsumed(t){var e=this._layerMap.Get(t);this._layerMap.Remove(t),e.Release()}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(DialogHandler.prototype),"_CleanUp",this).call(this),this.visible=!1}}]),DialogHandler}(h);e.exports=C,u.Register("nkmjs-dialog-handler",C)},{"./dialog-layer.js":244,"@nkmjs/actions":1,"@nkmjs/collections":21,"@nkmjs/dialog":84,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],243:[function(t,e,n){var i=t("@nkmjs/ui-core"),s=i.UI,a,l=function(t){_inherits(DialogInput,t);var e=_createSuper(DialogInput);function DialogInput(){return _classCallCheck(this,DialogInput),e.call(this)}return _createClass(DialogInput,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DialogInput.prototype),"_Init",this).call(this)}},{key:"dialogBox",set:function set(t){this._dialogBox=t}},{key:"GetDialogData",value:function GetDialogData(){return null}}]),DialogInput}(i.Widget);e.exports=l,s.Register("nkmjs-dialog-input",l)},{"@nkmjs/ui-core":169}],244:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/style").CSS,u=t("@nkmjs/ui-core"),h=u.UI,d=u.Layer,p,f=t("@nkmjs/dialog").DialogInfos,g=t("./dialog-box.js"),m=function(t){_inherits(DialogLayer,t);var e=_createSuper(DialogLayer);function DialogLayer(){return _classCallCheck(this,DialogLayer),e.call(this)}return _createClass(DialogLayer,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(DialogLayer.prototype),"_Init",this).call(this),this._background=null,this._msgBox=null}},{key:"_Style",value:function _Style(){return c.Extends({":host":{display:"flex","flex-flow":"row","align-content":"center","align-items":"center","justify-content":"center"},".bg":{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"rgba(23,23,23,0.3)","backdrop-filter":"blur(5px)"},".box":{flex:"1 1 auto","max-width":"500px"}},_get(_getPrototypeOf(DialogLayer.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){this._background=a.New("div",{class:"bg"},this._host)}},{key:"_OnDataChanged",value:function _OnDataChanged(t){if(_get(_getPrototypeOf(DialogLayer.prototype),"_OnDataChanged",this).call(this,t),this._msgBox&&(this._msgBox.Release(),this._msgBox=null),this._data){var e=this._data;if(!s.isInstanceOf(e,f))throw new Error("DialogLayer expect data of type DialogInfos, got ".concat(this._data.constructor.name," instead."));var n=s.Default(e.dialogClass,g);this._msgBox=this.Add(n,"box"),this._msgBox.data=e}}}]),DialogLayer}(d);e.exports=m,h.Register("nkmjs-dialog-view",m)},{"./dialog-box.js":241,"@nkmjs/dialog":84,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],245:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.SIGNAL,c=a.COMMON_FLAG,u=a.Observer,h=t("@nkmjs/actions"),d=h.ActionStack,p=h.Command,f,g=t("@nkmjs/data-core").DATA_SIGNAL,m=t("@nkmjs/ui-core"),y=m.UI,v=m.MOUSE,k,C=function(t){_inherits(Editor,t);var e=_createSuper(Editor);function Editor(){return _classCallCheck(this,Editor),e.call(this)}return _createClass(Editor,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Editor.prototype),"_Init",this).call(this),this._actionStack=new d,this._dataObserver.Hook(g.DIRTY,this._OnDataDirty,this),this._dataObserver.Hook(g.DIRTY_CLEARED,this._OnDataCleaned,this),this._inspectedData=null,this._inspectedObserver=new u,this._inspectedObserver.Hook(l.RELEASED,this._OnInspectedDataReleased,this),this._flags.Add(this,c.WARNING),this._Bind(this.Inspect)}},{key:"_OnDataChanged",value:function _OnDataChanged(t){this._actionStack.Clear(),this._commands.context=this._data,_get(_getPrototypeOf(Editor.prototype),"_OnDataChanged",this).call(this,t),this.inspectedData=null}},{key:"_PostDataChanged",value:function _PostDataChanged(t){_get(_getPrototypeOf(Editor.prototype),"_PostDataChanged",this).call(this,t),this._data&&(this._data.isDirty?this._OnDataDirty(this._data):this._OnDataCleaned(this._data))}},{key:"_OnDataDirty",value:function _OnDataDirty(t){}},{key:"_OnDataCleaned",value:function _OnDataCleaned(t){}},{key:"inspectedData",get:function get(){return this._inspectedData},set:function set(t){if(this._inspectedData!==t){var e=this._inspectedData;this._inspectedData=t,e&&this._inspectedObserver.Unobserve(e),t&&this._inspectedObserver.Observe(t),this._OnInspectedDataChanged(e)}}},{key:"_OnInspectedDataChanged",value:function _OnInspectedDataChanged(t){}},{key:"_OnInspectedDataReleased",value:function _OnInspectedDataReleased(){this.inspectedData=null}},{key:"Inspect",value:function Inspect(t){this.inspectedData=t}},{key:"Do",value:function Do(t,e){this._actionStack.ToggleGrouping(y.dragLength>1),this._actionStack.Do(t,e)}},{key:"Undo",value:function Undo(){this._actionStack.Undo()}},{key:"Redo",value:function Redo(){this._actionStack.Redo()}}]),Editor}(m.View);e.exports=C,y.Register("nkmjs-editor",C)},{"@nkmjs/actions":1,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],246:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/style").CSS,c=t("@nkmjs/ui-core"),u=c.UI,h=c.Widget,d,p=function(t){_inherits(EditorDrawerNav,t);var e=_createSuper(EditorDrawerNav);function EditorDrawerNav(){return _classCallCheck(this,EditorDrawerNav),e.call(this)}return _createClass(EditorDrawerNav,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(EditorDrawerNav.prototype),"_Init",this).call(this)}},{key:"_Style",value:function _Style(){return l.Extends({},_get(_getPrototypeOf(EditorDrawerNav.prototype),"_Style",this).call(this))}},{key:"_OpenSettings",value:function _OpenSettings(){console.log("Open Settings")}}]),EditorDrawerNav}(c.DrawerNav);e.exports=p,u.Register("nkmjs-editor-drawer-nav",p)},{"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],247:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/style").CSS,c=t("@nkmjs/ui-core"),u=c.UI,h=c.Widget,d=c.Drawer,p=t("./editor-drawer-nav"),f=function(t){_inherits(EditorDrawer,t);var e=_createSuper(EditorDrawer);function EditorDrawer(){return _classCallCheck(this,EditorDrawer),e.call(this)}return _createClass(EditorDrawer,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(EditorDrawer.prototype),"_Init",this).call(this),this._navClass=p}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(EditorDrawer.prototype),"_PostInit",this).call(this)}},{key:"_Style",value:function _Style(){return l.Extends({":host":{width:"354px",flex:"0 0 auto","background-color":"rgba(127,127,127,0.1)"},".controls":{"background-color":"rgba(127,127,127,0.0)"}},_get(_getPrototypeOf(EditorDrawer.prototype),"_Style",this).call(this))}}]),EditorDrawer}(d);e.exports=f,u.Register("nkmjs-editor-drawer",f)},{"./editor-drawer-nav":246,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],248:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/common").COMMON_FLAG,u,h=t("@nkmjs/style").CSS,d,p=t("@nkmjs/data-core").Catalog,f=t("@nkmjs/ui-core"),g=f.UI_ID,m=f.UI,y=f.UI_FLAG,v=f.View,k=f.DOMTemplate,C=f.TPLHeaderBodyFooter,O=t("../inspectors/inspector-shell"),E=t("../inspectors/history-inspector-shell"),S=t("./editor-drawer"),I=t("../editor"),b=t("../items/status-bar"),D=function(t){_inherits(EditorEx,t);var e=_createSuper(EditorEx);function EditorEx(){return _classCallCheck(this,EditorEx),e.call(this)}return _createClass(EditorEx,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(EditorEx.prototype),"_Init",this).call(this),this._drawerCatalog=new p(!1),this._drawer=null,this._inspectorShell=null,this._historyInspector=null,this._viewport=null,this._header=null,this._body=null,this._footer=null,this._topStatus=null,this._bottomStatus=null}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(EditorEx.prototype),"_PostInit",this).call(this);var t=new Array(0);this._InitDrawerCatalog(t),this._drawer.catalog=this._drawerCatalog;for(var e=null,n=null,i=null,a=null,l=0,c=t.length;l<c;l++)e=t[l],i=(n=this._drawerCatalog.Register(e)).GetOption("view",null),a=s.Get(e,"assign",null),console.log("".concat(a," >> ").concat(i)),i&&a&&(this[a]=i)}},{key:"_InitDrawerCatalog",value:function _InitDrawerCatalog(t){var e;t.push((_defineProperty(e={},g.NAME,"Inspector"),_defineProperty(e,g.ICON,"%ICON%/icon_parameters.svg"),_defineProperty(e,"viewType",this.constructor.__default_inspectorShellClass),_defineProperty(e,"assign","_inspector"),e))}},{key:"_Style",value:function _Style(){return h.Extends({":host":{position:"relative",display:"flex","align-items":"stretch","align-content":"stretch","min-width":0},":host(.vertical)":{"flex-flow":"row"},":host(.horizontal)":{"flex-flow":"column"},":host(.vertical).fs":{},":host(.horizontal).fs":{},".fs":{flex:"0 0 auto"},".body":{position:"relative",display:"flex","align-items":"stretch","align-content":"stretch",flex:"1 1 auto"},".viewport":{position:"relative",display:"flex",flex:"1 1 auto"},".drawer":{position:"relative",display:"flex",flex:"0 0 auto"},".topstatus":{position:"absolute",width:"100%"}},_get(_getPrototypeOf(EditorEx.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){k.Render(C,this,_defineProperty({},g.OWNER,this)),this._drawer=this.Add(this.constructor.__default_drawerClass,"drawer",this._body),this._viewport=this.Add(this.constructor.__default_viewportClass,"viewport",this._body),this._inspectorShell=this.Add(this.constructor.__default_inspectorShellClass,"inspector",this._body),this._inspectorShell.orientation=y.HORIZONTAL,this._drawer.orientation=y.HORIZONTAL}},{key:"_OnDataChanged",value:function _OnDataChanged(t){_get(_getPrototypeOf(EditorEx.prototype),"_OnDataChanged",this).call(this,t),this._inspectorShell.data=this._data,this._inspectorShell.context=this._data}},{key:"_OnDataDirty",value:function _OnDataDirty(t){_get(_getPrototypeOf(EditorEx.prototype),"_OnDataDirty",this).call(this,t),this._ToggleWarning(!0)}},{key:"_OnDataCleaned",value:function _OnDataCleaned(t){_get(_getPrototypeOf(EditorEx.prototype),"_OnDataCleaned",this).call(this,t),this._ToggleWarning(!1)}},{key:"_ToggleWarning",value:function _ToggleWarning(t){var e}},{key:"Inspect",value:function Inspect(t){_get(_getPrototypeOf(EditorEx.prototype),"Inspect",this).call(this,t),this._inspectorShell.RequestDisplay()}},{key:"_OnInspectedDataChanged",value:function _OnInspectedDataChanged(t){_get(_getPrototypeOf(EditorEx.prototype),"_OnInspectedDataChanged",this).call(this,t),this._inspectedData?this._inspectorShell.data=this._inspectedData:this._inspectorShell.data=this._data}}]),EditorEx}(I);_defineProperty(D,"__default_drawerClass",S),_defineProperty(D,"__default_inspectorShellClass",O),_defineProperty(D,"__default_historyInspectorClass",E),_defineProperty(D,"__default_viewportClass",v),e.exports=D,m.Register("nkmjs-editor-ex",D)},{"../editor":245,"../inspectors/history-inspector-shell":253,"../inspectors/inspector-shell":256,"../items/status-bar":261,"./editor-drawer":247,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],249:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/ui-core").UI,c,u=function(t){_inherits(SlateEditor,t);var e=_createSuper(SlateEditor);function SlateEditor(){return _classCallCheck(this,SlateEditor),e.call(this)}return _createClass(SlateEditor,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(SlateEditor.prototype),"_Init",this).call(this)}},{key:"_Render",value:function _Render(){_get(_getPrototypeOf(SlateEditor.prototype),"_Render",this).call(this)}}]),SlateEditor}(t("./editor-ex"));e.exports=u,l.Register("nkmjs-editor-slate",u)},{"./editor-ex":248,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],250:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/ui-core"),c=l.UI,u,h=function(t){_inherits(Explorer,t);var e=_createSuper(Explorer);function Explorer(){return _classCallCheck(this,Explorer),e.call(this)}return _createClass(Explorer,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Explorer.prototype),"_Init",this).call(this)}},{key:"header",get:function get(){return this._header}},{key:"body",get:function get(){return this._body}},{key:"footer",get:function get(){return this._footer}},{key:"_Style",value:function _Style(){var t=5,e="rgba(0,0,0,0.5)";return{":host":{position:"relative",flex:"1 1 auto","min-width":0,display:"flex","flex-flow":"column nowrap","align-content":"stretch","align-items":"stretch","background-color":"rgba(1,1,1,0.1)"},".group":{position:"relative",flex:"1 0 auto"},".header":{flex:"0 0 auto"},".footer":{flex:"0 0 auto"},".highlight":{"background-color":"#ff0000"},".body":{"overflow-y":"overlay","min-width":0,flex:"1 1 1px","box-shadow":"inset 0px 11px ".concat(5,"px -10px ").concat(e,", inset 0px -11px ").concat(5,"px -10px ").concat(e)},".body::-webkit-scrollbar-track":{"background-color":"rgba(127,127,127,0.05)"},".body::-webkit-scrollbar":{width:"2px",height:"2px","background-color":"rgba(127,127,127,0.05)"},".body::-webkit-scrollbar-thumb":{"background-color":"rgba(255,255,255,0.05)"},".body:hover::-webkit-scrollbar":{width:"4px",height:"4px"},".body:hover::-webkit-scrollbar-thumb":{"background-color":"rgba(255,255,255,0.15)"}}}},{key:"_Render",value:function _Render(){this._header=a.New("div",{class:"header group"},this._host),this._body=a.New("div",{class:"body group"},this._host),this._footer=a.New("div",{class:"footer group"},this._host),this._wrapper=this._body}}]),Explorer}(l.View);e.exports=h,c.Register("nkmjs-explorer",h)},{"@nkmjs/ui-core":169,"@nkmjs/utils":271}],251:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l,c=t("@nkmjs/collections").Dictionary,u=t("@nkmjs/ui-core"),h=u.UI,d,p=function(t){_inherits(Group,t);var e=_createSuper(Group);function Group(){return _classCallCheck(this,Group),e.call(this)}return _createClass(Group,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Group.prototype),"_Init",this).call(this),this._header=null,this._footer=null,this._groupMap=new c,this._groupList=new Array(0)}},{key:"header",get:function get(){return this._header}},{key:"body",get:function get(){return this._wrapper}},{key:"footer",get:function get(){return this._footer}},{key:"_Style",value:function _Style(){return{":host":{position:"relative",display:"flex",flex:"1 1 auto","margin-bottom":"20px"},".header":{position:"relative",flex:"0 0 auto"},".footer":{position:"relative",flex:"0 0 auto"},".body":{position:"relative",display:"flex",flex:"1 1 auto"},":host(.horizontal) .body":{"flex-flow":"row wrap","align-content":"flex-start","align-items":"flex-start"},":host(.vertical) .body":{"flex-flow":"column nowrap","align-content":"stretch","align-items":"stretch"}}}},{key:"_Render",value:function _Render(){this._header=a.New("div",{class:"header"},this._host),this._wrapper=a.New("div",{class:"body"},this._host),this._footer=a.New("div",{class:"footer"},this._host)}},{key:"_GetOrCreateGroup",value:function _GetOrCreateGroup(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n=s.Default(n,Group);var i=this._groupMap.Get(t);if(!i){if(i=this.Add(n,"group tile-ctnr",this._viewport.wrapper),this._groupMap.Set(t,i),this._groupList.push(i),e)for(var a in e)i._flags.Set(a,e[a]);this._OnGroupCreated(t,i),this._Broadcast(Group.GROUP_CREATED,this,i)}return i}},{key:"_OnGroupCreated",value:function _OnGroupCreated(t,e){}},{key:"_ClearGroup",value:function _ClearGroup(t){var e=this._groupMap.Get(t);if(e){var n=this._groupList.indexOf(e);this._groupList.splice(n,1),this._groupMap.Remove(t),e.Release()}}},{key:"_ClearAllGroups",value:function _ClearAllGroups(){this._groupMap.Clear();for(var t=this._groupList,e=0,n=t.length;e<n;e++)t[e].Release();t.length=0}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(Group.prototype),"_CleanUp",this).call(this),this._ClearAllGroups()}}]),Group}(u.OrientableWidget);_defineProperty(p,"GROUP_CREATED",Symbol("groupCreated")),e.exports=p,h.Register("nkmjs-group",p)},{"@nkmjs/collections":21,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],252:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").SIGNAL,c,u=t("@nkmjs/ui-core").UI,h,d=function(t){_inherits(Inspector,t);var e=_createSuper(Inspector);function Inspector(){return _classCallCheck(this,Inspector),e.call(this)}return _createClass(Inspector,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Inspector.prototype),"_Init",this).call(this),this._inspectors=new Array(0)}},{key:"_Style",value:function _Style(){return s.Merge(_get(_getPrototypeOf(Inspector.prototype),"_Style",this).call(this),{":host":{position:"relative",display:"flex","flex-flow":"column","align-content":"stretch","align-items":"stretch","background-color":"rgba(0,0,0,0.0)"}})}},{key:"AddInspector",value:function AddInspector(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._RegisterInspector(this.Add(t,e?"group ".concat(e):"group"))}},{key:"_RegisterInspector",value:function _RegisterInspector(t){if(!this._inspectors.includes(t))return this._inspectors.push(t),t}},{key:"_OnDataChanged",value:function _OnDataChanged(t){_get(_getPrototypeOf(Inspector.prototype),"_OnDataChanged",this).call(this,t);for(var e=0,n=this._inspectors.length;e<n;e++){var i=this._inspectors[e];i.context=this._context,i.data=this._data}this._data||s.Void(this._context)||(this.data=this._context)}}]),Inspector}(t("./control"));e.exports=d,u.Register("nkmjs-inspector",d)},{"./control":240,"@nkmjs/common":27,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],253:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/ui-core").UI,c,u=function(t){_inherits(HistoryInspectorShell,t);var e=_createSuper(HistoryInspectorShell);function HistoryInspectorShell(){return _classCallCheck(this,HistoryInspectorShell),e.call(this)}return _createClass(HistoryInspectorShell,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(HistoryInspectorShell.prototype),"_Init",this).call(this)}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(HistoryInspectorShell.prototype),"_PostInit",this).call(this),this._icon.Set(null),this._title.Set("HISTORY"),this._subtitle.Set("Editor")}},{key:"_Style",value:function _Style(){return s.Merge(_get(_getPrototypeOf(HistoryInspectorShell.prototype),"_Style",this).call(this),{":host":{},".facade":{},".navigation":{}})}},{key:"_Render",value:function _Render(){_get(_getPrototypeOf(HistoryInspectorShell.prototype),"_Render",this).call(this)}}]),HistoryInspectorShell}(t("./inspector-shell"));e.exports=u,l.Register("nkmjs-history-inspector-shell",u)},{"./inspector-shell":256,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],254:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/ui-core"),c=l.UI_ID,u=l.UI,h=l.UI_SIGNAL,d=l.ExtExpand,p=l.Toolbar,f=l.ToolButton,g=l.DOMTemplate,m=l.TPLHeaderBodyFooter,y=l.ExtMouse,v=l.UI_FLAG,k=l.MOUSE,C=l.TPLFacadeExpandTitle,O,E=function(t){_inherits(InspectorGroup,t);var e=_createSuper(InspectorGroup);function InspectorGroup(){var t;return _classCallCheck(this,InspectorGroup),(t=e.call(this))._staticContentDefault=t._staticContent,t}return _createClass(InspectorGroup,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InspectorGroup.prototype),"_Init",this).call(this),this._extExpand=new d,this._extExpand._isExpanded=!1,this._extExpand.Watch(h.EXPANDED,this._Expand,this),this._extExpand.Watch(h.COLLAPSED,this._Collapse,this),this._header=null,this._expandOnHeaderAltActivation=s.Default(this._expandOnHeaderAltActivation,!0),this._useGroupExpand=!1,this._expandBtnClass=f,this._expandBtn=null,this._toolbarClass=p,this._toolbar=null,this._footer=null,this._staticContent=!0,this._alwaysExpanded=!1,this._interactions.Hook(k.BTN_LEFT,k.RELEASE_TWICE,this._Bind(this.AltActivate))}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(InspectorGroup.prototype),"_PostInit",this).call(this),this._extExpand.Setup(this,this._wrapper,this._expandIcon.element)}},{key:"staticContent",get:function get(){return this._staticContent},set:function set(t){this._staticContent=t}},{key:"header",get:function get(){return this._header}},{key:"body",get:function get(){return this._body}},{key:"footer",get:function get(){return this._footer}},{key:"_Style",value:function _Style(){return s.Merge(_get(_getPrototypeOf(InspectorGroup.prototype),"_Style",this).call(this),{":host":{position:"relative",display:"flex","flex-flow":"column nowrap","align-content":"stretch","align-items":"stretch",margin:"5px","min-width":0},".header":{position:"relative",display:"flex","flex-flow":"row nowrap","align-content":"stretch","align-items":"stretch","justify-content":"space-between",flex:"1 1 auto",padding:"12px"},".expandIcon":{flex:"0 0 auto"},".facade":{flex:"0 1 auto"},".toolbar":{transition:"all 0.3s ease",flex:"0 0 auto",opacity:0},":host(.focused) .toolbar":{opacity:1},".body":{position:"relative",display:"flex","flex-flow":"column nowrap","align-content":"stretch","align-items":"stretch",flex:"1 1 auto"},".group":{"min-width":0},":host(.collapsed) .body":{display:"none"},":host(.expanded) .body":{display:"flex"}})}},{key:"_Render",value:function _Render(){var t,e,n;(g.Render(m,this,_defineProperty({},c.OWNER,this)),g.Render(C,this._header,(_defineProperty(t={},c.OWNER,this),_defineProperty(t,"expandIcon",{url:"%ICON%/icon_expand_arrow.svg",htitle:"Expand"}),t)),this._toolbar=this.Add(this._toolbarClass,"toolbar",this._header),this._wrapper=this._body,this._useGroupExpand)&&(this._expandAllBtn=this._toolbar.CreateHandle((_defineProperty(e={},c.ICON,"%ICON%/icon_expand_all.svg"),_defineProperty(e,"text","Expand All"),_defineProperty(e,"trigger",{thisArg:this,fn:this.ExpandAll}),e)),this._collapseAllBtn=this._toolbar.CreateHandle((_defineProperty(n={},c.ICON,"%ICON%/icon_collapse_all.svg"),_defineProperty(n,"text","Collapse All"),_defineProperty(n,"trigger",{thisArg:this,fn:this.CollapseAll}),n)));this.focusArea=this._header}},{key:"Activate",value:function Activate(t){return!this._toolbar.focused&&_get(_getPrototypeOf(InspectorGroup.prototype),"Activate",this).call(this,t)}},{key:"AltActivate",value:function AltActivate(t){this._toolbar.focused||this._expandOnHeaderAltActivation&&this._extExpand.Toggle()}},{key:"Expand",value:function Expand(){this._extExpand.Expand()}},{key:"_Expand",value:function _Expand(){this._data&&!this._staticContent&&this._BuildContent(),this._expandIcon.element.classList.remove(v.EXPANDED),this._toolbar.hidden=!1}},{key:"Collapse",value:function Collapse(){this._extExpand.Collapse()}},{key:"_Collapse",value:function _Collapse(){this._data&&!this._staticContent&&this._ClearContent(),this._expandIcon.element.classList.add(v.EXPANDED),this._toolbar.hidden=!0}},{key:"ExpandAll",value:function ExpandAll(){this.Expand();for(var t=this._displayObjects,e=null,n=0,i=t.length;n<i;n++)"Expand"in(e=t[n])&&e.Expand()}},{key:"CollapseAll",value:function CollapseAll(){for(var t=this._displayObjects,e=null,n=0,i=t.length;n<i;n++)"Collapse"in(e=t[n])&&e.Collapse()}},{key:"_OnContextChanged",value:function _OnContextChanged(){for(var t=this._context,e=this._displayObjects,n=null,i=0,s=e.length;i<s;i++)"context"in(n=e[i])&&(n.context=t)}},{key:"_OnDataChanged",value:function _OnDataChanged(t){_get(_getPrototypeOf(InspectorGroup.prototype),"_OnDataChanged",this).call(this,t),this._ClearContent(),this._data?(this._staticContent||this._extExpand.isExpanded?this._BuildContent():this._data.expanded&&this._extExpand.Expand(),this._alwaysExpanded&&this._extExpand.Expand(!1)):this._alwaysExpanded||this._extExpand.Collapse()}},{key:"_BuildContent",value:function _BuildContent(){}},{key:"_ClearContent",value:function _ClearContent(){}},{key:"_CleanUp",value:function _CleanUp(){this._toolbar.Focus(!1),_get(_getPrototypeOf(InspectorGroup.prototype),"_CleanUp",this).call(this),this._alwaysExpanded||this._extExpand.Collapse(),this._extExpand.activator=this._expandBtn,this._staticContent=this._staticContentDefault}}]),InspectorGroup}(t("./inspector-item"));e.exports=E,u.Register("nkmjs-inspector-group",E)},{"./inspector-item":255,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],255:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/ui-core").UI,c,u=t("@nkmjs/data-core").DATA_SIGNAL,h,d=function(t){_inherits(InspectorItem,t);var e=_createSuper(InspectorItem);function InspectorItem(){return _classCallCheck(this,InspectorItem),e.call(this)}return _createClass(InspectorItem,[{key:"_Init",value:function _Init(){this._ignoreMetaStyle=s.Default(this._ignoreMetaStyle,!1),this.default_SelectOnActivation=s.Default(this.default_SelectOnActivation,!0),_get(_getPrototypeOf(InspectorItem.prototype),"_Init",this).call(this),this._ignoreMetaStyle||this._metadataObserver.Hook(u.META_MID_UPDATE,"presentation",this._OnMetaPresentationChanged,this)}},{key:"_OnDataChanged",value:function _OnDataChanged(t){_get(_getPrototypeOf(InspectorItem.prototype),"_OnDataChanged",this).call(this,t),this._data&&this._data.metadata&&!this._ignoreMetaStyle&&this._UpdateMetaPresentation()}},{key:"_OnMetaPresentationChanged",value:function _OnMetaPresentationChanged(t,e){this._UpdateMetaPresentation()}},{key:"_UpdateMetaPresentation",value:function _UpdateMetaPresentation(){var t=s.HexToRGBAString(this._data.metadata.Get("presentation.color","#000000"),this._data.metadata.Get("presentation.weight",.1));this.style["box-shadow"]="inset 1px 0px 0px ".concat(t)}}]),InspectorItem}(t("../control"));e.exports=d,l.Register("nkmjs-inspector-item",d)},{"../control":240,"@nkmjs/data-core":55,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],256:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.NFOS,c=a.BINDINGS,u=t("@nkmjs/style"),h=u.CSS,d=u.FONT_FLAG,p=t("@nkmjs/ui-core"),f=p.UI_ID,g=p.UI,m=p.UI_FLAG,y=p.View,v=p.DOMTemplate,k=p.TPLBodyHeaderTitles,C=t("../workspace-context"),O=function(t){_inherits(InspectorShell,t);var e=_createSuper(InspectorShell);function InspectorShell(){return _classCallCheck(this,InspectorShell),e.call(this)}return _createClass(InspectorShell,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(InspectorShell.prototype),"_Init",this).call(this),this._context=null,this._inspector=null,this._flags.Add(this,m.FIXED_SIZE),this._flags.Set(m.FIXED_SIZE,!0),this._icon=null,this._title=null,this._subtitle=null,this._header=null,this._body=null}},{key:"context",get:function get(){return this._context},set:function set(t){if(this._context!==t){var e=this._context;this._context=t,this._OnContextDataChanged(e)}}},{key:"_OnContextDataChanged",value:function _OnContextDataChanged(t){this._inspector&&(this._inspector.context=this._context)}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._flags.Set(m.NO_ICON,!this._icon.Set(t))}},{key:"title",get:function get(){return this._title},set:function set(t){this._flags.Set(m.NO_LABEL,!this._title.Set(t))}},{key:"subtitle",get:function get(){return this._subtitle},set:function set(t){this._subtitle.Set(t)}},{key:"header",get:function get(){return this._header}},{key:"body",get:function get(){return this._body}},{key:"_Style",value:function _Style(){return h.Extends({":host":{display:"flex","flex-flow":"column nowrap","justify-content":"flex-start","align-items":"stretch","align-content":"stretch"},":host(.fixed-size)":{width:"350px"},".header":{flex:"0 0 auto"},".body":{flex:"1 1 auto","min-width":"0",display:"flex","flex-flow":"column nowrap","justify-content":"flex-start","align-items":"stretch"},".inspector":{flex:"1 1 auto"}},_get(_getPrototypeOf(InspectorShell.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){var t;v.Render(k,this,(_defineProperty(t={},f.OWNER,this),_defineProperty(t,f.ICON,_defineProperty({},f.CSS_CL,m.SIZE_S)),_defineProperty(t,f.SUBTITLE,_defineProperty({},f.CSS_CL,d.SMALL)),t))}},{key:"_OnDataChanged",value:function _OnDataChanged(t){if(_get(_getPrototypeOf(InspectorShell.prototype),"_OnDataChanged",this).call(this,t),this._inspector&&(this._inspector.Release(),this._inspector=null),!this._data)return this._title.Set("(NO_DATA)"),void this._subtitle.Set("---");this._title.Set(this._data.id);var e=this._data.constructor,n=l.Get(this._data);n?(this._subtitle.Set(n),this._icon.Set(n)):(this._subtitle.Set(e.name),this._icon.Set(null));var i=c.Get(C.DEFAULT_INSPECTOR,e);i&&(this._inspector=this.Add(i,"inspector",this._body),this._inspector.context=this._context,this._inspector.data=this._data)}}]),InspectorShell}(y);_defineProperty(O,"__NFO__",l.Ext({css:["@/views/inspector-shell.css"]},y,["css"])),e.exports=O,g.Register("nkmjs-inspector-shell",O)},{"../workspace-context":266,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],257:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").Dictionary,c=t("@nkmjs/common"),u=c.BINDINGS,h=c.COM_ID,d,p=t("@nkmjs/ui-core").UI,f=t("./inspector-group"),g=t("./meta-control-item"),m=new l,y=function(t){_inherits(MetaControlGroup,t);var e=_createSuper(MetaControlGroup);function MetaControlGroup(){return _classCallCheck(this,MetaControlGroup),e.call(this)}return _createClass(MetaControlGroup,[{key:"_Init",value:function _Init(){this._ignoreMetaStyle=!0,this.default_SelectOnActivation=!1,_get(_getPrototypeOf(MetaControlGroup.prototype),"_Init",this).call(this),this._staticContent=!1,this._metaPath="",this._metaID="",this._subCtrls=new Array(0)}},{key:"_Style",value:function _Style(){return s.Merge(_get(_getPrototypeOf(MetaControlGroup.prototype),"_Style",this).call(this),{":host":{margin:"5px"},".header":{"justify-content":"center",padding:"6px"},".facade":{flex:"1 1 auto"}})}},{key:"metaPath",get:function get(){return this._metaPath},set:function set(t){this._metaPath=t}},{key:"_metaKey",get:function get(){return this._data?"@".concat(this._data.constructor).concat(this._metaPath):"@".concat(this._metaPath)}},{key:"metaID",get:function get(){return this._metaID},set:function set(t){this._metaID=t,this._facade.text=t}},{key:"_Expand",value:function _Expand(){_get(_getPrototypeOf(MetaControlGroup.prototype),"_Expand",this).call(this),MetaControlGroup.TogglePathExpansion(this._metaKey,!0)}},{key:"_Collapse",value:function _Collapse(){this._data&&MetaControlGroup.TogglePathExpansion(this._metaKey,!1),_get(_getPrototypeOf(MetaControlGroup.prototype),"_Collapse",this).call(this)}},{key:"_OnDataChanged",value:function _OnDataChanged(t){var e;(_get(_getPrototypeOf(MetaControlGroup.prototype),"_OnDataChanged",this).call(this,t),this._data)&&(MetaControlGroup.IsPathExpanded(this._metaKey)&&this.Expand())}},{key:"_BuildContent",value:function _BuildContent(){_get(_getPrototypeOf(MetaControlGroup.prototype),"_BuildContent",this).call(this);var t=this._data.metadata,e=s.Empty(this._metaPath)?t._data:t.Get(this._metaPath,null);if(e&&s.isObject(e))for(var n in e){var i=s.Empty(this._metaPath)?"".concat(n):"".concat(this._metaPath,".").concat(n),a=e[n],l=u.Get("".concat(h.METAPREFIX).concat(i),this._data.constructor,s.isObject(a)?MetaControlGroup:g),c=this.Add(l,"group");c.metaID=n,c.metaPath=i,c.context=this._context,c.data=this._data,this._subCtrls.push(c)}}},{key:"_ClearContent",value:function _ClearContent(){for(;0!=this._subCtrls.length;)this._subCtrls.pop().Release()}},{key:"_CleanUp",value:function _CleanUp(){this._metaPath="",_get(_getPrototypeOf(MetaControlGroup.prototype),"_CleanUp",this).call(this)}}],[{key:"TogglePathExpansion",value:function TogglePathExpansion(t,e){e?m.Set(t,!0):m.Remove(t)}},{key:"IsPathExpanded",value:function IsPathExpanded(t){return m.Get(t)}}]),MetaControlGroup}(f);e.exports=y,p.Register("nkmjs-meta-control-group",y)},{"./inspector-group":254,"./meta-control-item":258,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],258:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/ui-core"),c=l.UI_ID,u=l.UI,h=l.TextManipulator,d=t("@nkmjs/data-core"),p=d.Metadata,f=d.ActionMetadataSet,g=t("@nkmjs/ui-inputs"),m=g.INPUT_SIGNAL,y=g.InputField,v,k=function(t){_inherits(MetaControlItem,t);var e=_createSuper(MetaControlItem);function MetaControlItem(){return _classCallCheck(this,MetaControlItem),e.call(this)}return _createClass(MetaControlItem,[{key:"_Init",value:function _Init(){this.default_SelectOnActivation=!1,this._ignoreMetaStyle=!0,_get(_getPrototypeOf(MetaControlItem.prototype),"_Init",this).call(this),this._metaPath="",this._metaID="",this._inputClass=y,this._input=null,this._label=null}},{key:"_Style",value:function _Style(){return s.Merge(_get(_getPrototypeOf(MetaControlItem.prototype),"_Style",this).call(this),{":host":{margin:"5px",padding:"6px",display:"flex","flex-flow":"column","align-items":"stretch","align-content":"stretch"},".facade":{flex:"1 1 auto","margin-top":"-5px","margin-bottom":"0px"},".control":{flex:"1 1 auto"}})}},{key:"_Render",value:function _Render(){_get(_getPrototypeOf(MetaControlItem.prototype),"_Render",this).call(this),this._label=new h(a.New("span",{class:c.LABEL},this._host))}},{key:"metaPath",get:function get(){return this._metaPath},set:function set(t){this._metaPath=t}},{key:"metaID",get:function get(){return this._metaID},set:function set(t){this._metaID=t,this._facade.text=t}},{key:"_OnDataChanged",value:function _OnDataChanged(t){if(_get(_getPrototypeOf(MetaControlItem.prototype),"_OnDataChanged",this).call(this,t),this._input&&(this._input.Release(),this._input=null),this._data){var e,n=(s.isInstanceOf(this._data,p)?this._data:this._data.metadata).Get(this._metaPath,null);s.Void(n)||(this._input=this.Add(this._inputClass,"control"),this._OnInputCreated(this._input),this._input.Watch(m.VALUE_SUBMITTED,this._OnInputValueCommited,this),this._input.currentValue=n)}}},{key:"_OnInputCreated",value:function _OnInputCreated(t){}},{key:"_OnInputValueCommited",value:function _OnInputValueCommited(t,e){var n=s.isInstanceOf(this._data,p)?this._data:this._data.metadata,i=this._metaPath;this._Do(f,{target:n,path:i,value:e}),this._input.currentValue=n.Get(i,void 0)}},{key:"_CleanUp",value:function _CleanUp(){this._metaPath="",_get(_getPrototypeOf(MetaControlItem.prototype),"_CleanUp",this).call(this)}}]),MetaControlItem}(t("./inspector-item"));e.exports=k,u.Register("nkmjs-meta-control-item",k)},{"./inspector-item":255,"@nkmjs/data-core":55,"@nkmjs/ui-core":169,"@nkmjs/ui-inputs":221,"@nkmjs/utils":271}],259:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.PATH,l,c=t("@nkmjs/common").NFOS,u=t("@nkmjs/data-core"),h=u.DataBlock,d=u.CatalogItem,p=t("@nkmjs/style"),f=p.CSS,g=p.FONT_FLAG,m=t("@nkmjs/ui-core"),y=m.UI_ID,v=m.UI,k=m.UI_FLAG,C=m.ButtonBase,O=m.DOMTemplate,E=m.TPLFacadeLabel,S=function(t){_inherits(BreadcrumbItem,t);var e=_createSuper(BreadcrumbItem);function BreadcrumbItem(){return _classCallCheck(this,BreadcrumbItem),e.call(this)}return _createClass(BreadcrumbItem,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(BreadcrumbItem.prototype),"_Init",this).call(this),this._optionsHandler.Hook(y.ICON,null,""),this._optionsHandler.Hook(y.LABEL,null,""),this._alwaysDisplayCommand=!0,this._icon=null,this._label=null}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._flags.Set(k.NO_ICON,!this._icon.Set(t))}},{key:"label",get:function get(){return this._label},set:function set(t){this._flags.Set(k.NO_LABEL,!this._label.Set(t))}},{key:"_Render",value:function _Render(){var t;O.Render(E,this,(_defineProperty(t={},y.OWNER,this),_defineProperty(t,y.LABEL,_defineProperty({},y.CSS_CL,g.REGULAR)),t)),this.focusArea=this}},{key:"_OnDataUpdated",value:function _OnDataUpdated(t){_get(_getPrototypeOf(BreadcrumbItem.prototype),"_OnDataUpdated",this).call(this,t)}}]),BreadcrumbItem}(C);_defineProperty(S,"__NFO__",c.Ext({css:["@/items/breadcrum-item.css"]},C,["css"])),e.exports=S,v.Register("nkmjs-breadcrum-item",S)},{"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],260:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").NFOS,c,u=t("@nkmjs/style").CSS,h=t("@nkmjs/ui-core"),d=h.UI,p=h.Toolbar,f=t("./breadcrumb-item"),g=function(t){_inherits(Breadcrumb,t);var e=_createSuper(Breadcrumb);function Breadcrumb(){return _classCallCheck(this,Breadcrumb),e.call(this)}return _createClass(Breadcrumb,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Breadcrumb.prototype),"_Init",this).call(this),this._defaultButtonClass=f}},{key:"_Style",value:function _Style(){return u.Extends({":host":{},":host(.vertical)":{"align-content":"flex-end"},":host(.horizontal)":{"align-content":"flex-end"}},_get(_getPrototypeOf(Breadcrumb.prototype),"_Style",this).call(this))}}]),Breadcrumb}(p);_defineProperty(g,"__NFO__",l.Ext({css:["@/items/breadcrum.css"]},p,["css"])),e.exports=g,d.Register("nkmjs-breadcrum",g)},{"./breadcrumb-item":259,"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],261:[function(t,e,n){var i=t("@nkmjs/ui-core"),s=i.UI,a,l=function(t){_inherits(StatusBar,t);var e=_createSuper(StatusBar);function StatusBar(){return _classCallCheck(this,StatusBar),e.call(this)}return StatusBar}(i.Widget);e.exports=l,s.Register("nkmjs-status-bar",l)},{"@nkmjs/ui-core":169}],262:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/common"),l=a.NFOS,c=a.SIGNAL,u=a.COMMON_FLAG,h,d=t("@nkmjs/environment").ENV,p,f=t("@nkmjs/style").CSS,g=t("@nkmjs/data-core"),m=g.DATA_SIGNAL,y=g.DataObserver,v=g.CATALOG_SIGNAL,k=t("@nkmjs/ui-core"),C=k.UI_ID,O=k.UI,E=k.MOUSE,S=k.UI_SIGNAL,I=k.Widget,b=k.DOMTemplate,D=k.ExtMouse,A=k.UI_FLAG,P=k.FlagEnum,R=k.ImageManipulator,T=k.TextManipulator,x=k.CatalogWidget,w=t("../templates/tpl-facade-tab"),L=function(t){_inherits(Tab,t);var e=_createSuper(Tab);function Tab(){return _classCallCheck(this,Tab),e.call(this)}return _createClass(Tab,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Tab.prototype),"_Init",this).call(this),this._Bind(this._CloseRequest),this._closeBtn=this._interactions.Add(D),this._closeBtn.Hook(E.BTN_LEFT,E.RELEASE,this._CloseRequest),this._interactions.Hook(E.BTN_MIDDLE,E.RELEASE,this._CloseRequest)}},{key:"icon",get:function get(){return this._icon},set:function set(t){this._icon.Set(t)}},{key:"label",get:function get(){return this._label},set:function set(t){this._label.Set(t)}},{key:"closeIcon",get:function get(){return this._closeIcon},set:function set(t){this._closeIcon.Set(t)}},{key:"_Style",value:function _Style(){return f.Extends({":host":{position:"relative",display:"flex","flex-flow":"row nowrap","align-items":"center","align-content":"stretch"}},_get(_getPrototypeOf(Tab.prototype),"_Style",this).call(this))}},{key:"_Render",value:function _Render(){var t;b.Render(w,this,(_defineProperty(t={},C.OWNER,this),_defineProperty(t,"closeIcon",{htitle:"Close"}),t)),d.FEATURES.isTouchEnabled||(this._closeIcon.element.style.opacity=0),this.focusArea=this,this._closeBtn.element=this._closeIcon.element}},{key:"Activate",value:function Activate(t){return!this._closeBtn.isMouseOver&&_get(_getPrototypeOf(Tab.prototype),"Activate",this).call(this,t)}},{key:"_HighlightGain",value:function _HighlightGain(){d.FEATURES.isTouchEnabled||this._closeIcon.element.style.removeProperty("opacity")}},{key:"_HighlightLost",value:function _HighlightLost(){d.FEATURES.isTouchEnabled||(this._closeIcon.element.style.opacity=0)}},{key:"_CloseRequest",value:function _CloseRequest(){this._isActivable&&this._Broadcast(S.CLOSE_REQUESTED,this)}},{key:"_UpdateInfos",value:function _UpdateInfos(){this._itemData?(this._flavorEnum.Set(this._itemData.isDirty?u.WARNING:null),this._label.Set(this._itemData)||this._label.Set(this._data.options),this._icon.Set(this._itemData)||this._icon.Set(this._data.options)):(this._flavorEnum.Set(null),this._label.Set(this._data.options),this._icon.Set(this._data.options))}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(Tab.prototype),"_CleanUp",this).call(this)}}]),Tab}(x);_defineProperty(L,"__NFO__",l.Ext({css:["@/items/tab.css"]},I,["css"])),e.exports=L,O.Register("nkmjs-tab",L)},{"../templates/tpl-facade-tab":265,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/environment":95,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],263:[function(t,e,n){var i,s=t("@nkmjs/common").NFOS,a,l=t("@nkmjs/style").FONT_FLAG,c=t("@nkmjs/ui-core"),u=c.UI,h=c.UI_FLAG,d=c.FlagEnum,p=c.Widget,f=c.TextManipulator,g=c.UI_ID,m,y=t("@nkmjs/utils").UDOM,v=function(t){_inherits(Tag,t);var e=_createSuper(Tag);function Tag(){return _classCallCheck(this,Tag),e.call(this)}return _createClass(Tag,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Tag.prototype),"_Init",this).call(this),this._sizeEnum=new d(h.sizes),this._sizeEnum.Add(this),this._flavorEnum=new d(h.flavorsExtended),this._flavorEnum.Add(this)}},{key:"size",get:function get(){return this._sizeEnum.currentFlag},set:function set(t){this._sizeEnum.Set(t)}},{key:"flavor",get:function get(){return this._flavorEnum.currentFlag},set:function set(t){this._flavorEnum.Set(t)}},{key:"label",get:function get(){return this._label},set:function set(t){this._label.Set(t)}},{key:"_Render",value:function _Render(){this._label=new f(y.New("span",{class:"".concat(g.LABEL," ").concat(l.TAG)},this),!1)}}]),Tag}(p);_defineProperty(v,"__NFO__",s.Ext({css:["@/items/tag.css"]},p,["css"])),e.exports=v,u.Register("nkmjs-tag",v)},{"@nkmjs/common":27,"@nkmjs/style":158,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],264:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a=t("@nkmjs/ui-core"),l=a.UI,c,u=function(t){_inherits(Shell,t);var e=_createSuper(Shell);function Shell(){return _classCallCheck(this,Shell),e.call(this)}return _createClass(Shell,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Shell.prototype),"_Init",this).call(this)}}]),Shell}(a.LayerContainer);e.exports=u,l.Register("nkmjs-shell",u)},{"@nkmjs/ui-core":169,"@nkmjs/utils":271}],265:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.UDOM,l=t("@nkmjs/ui-core"),c=l.UI_ID,u=l.DOMTemplate,h=l.ImageManipulator,d=l.TextManipulator,p="_closeIcon",f="_".concat(c.ICON),g="_".concat(c.LABEL),m=function(t){_inherits(TPLFacadeTab,t);var e=_createSuper(TPLFacadeTab);function TPLFacadeTab(){var t;return _classCallCheck(this,TPLFacadeTab),t=e.call(this)}return _createClass(TPLFacadeTab,[{key:"Render",value:function Render(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=_get(_getPrototypeOf(TPLFacadeTab.prototype),"Render",this).call(this,t,e),i=s.Get(e,c.ICON,null),a=s.Get(e,c.TITLE,null),l=s.Get(e,"closeIcon",null),u=n[f]=new h(n[f],!i||!("autoHide"in i)||i.autoHide),p=n[g]=new d(n[g],!(!a||!("autoHide"in a))&&a.autoHide),m=n._closeIcon=new h(n._closeIcon,!(!l||!("autoHide"in l))&&l.autoHide);return i&&(u.Set(i),i[c.CSS_CL]&&u.element.classList.add(i[c.CSS_CL])),a&&(p.Set(a),a[c.CSS_CL]&&p.element.classList.add(a[c.CSS_CL])),l&&(m.Set(l.url),l.htitle&&(m.element.title=l.htitle),l[c.CSS_CL]&&m.element.classList.add(l[c.CSS_CL])),n}}],[{key:"_CreateTemplate",value:function _CreateTemplate(){_get(_getPrototypeOf(TPLFacadeTab),"_CreateTemplate",this).call(this),this._Add(a.New("span",{class:c.ICON}),f),this._Add(a.New("span",{class:c.LABEL}),g),this._Add(a.New("span",{class:"".concat(c.ICON," close")}),p)}}]),TPLFacadeTab}(u);e.exports=m},{"@nkmjs/ui-core":169,"@nkmjs/utils":271}],266:[function(t,e,n){var i,s=t("@nkmjs/common").CSYMBOL,a=function(t){_inherits(EDITOR,t);var e=_createSuper(EDITOR);function EDITOR(){return _classCallCheck(this,EDITOR),e.call(this)}return EDITOR}(s),l=function(t){_inherits(DEFAULT_EDITOR,t);var e=_createSuper(DEFAULT_EDITOR);function DEFAULT_EDITOR(){return _classCallCheck(this,DEFAULT_EDITOR),e.call(this)}return DEFAULT_EDITOR}(a),c=function(t){_inherits(INSPECTOR,t);var e=_createSuper(INSPECTOR);function INSPECTOR(){return _classCallCheck(this,INSPECTOR),e.call(this)}return INSPECTOR}(s),u=function(t){_inherits(DEFAULT_INSPECTOR,t);var e=_createSuper(DEFAULT_INSPECTOR);function DEFAULT_INSPECTOR(){return _classCallCheck(this,DEFAULT_INSPECTOR),e.call(this)}return DEFAULT_INSPECTOR}(c),h=function(t){_inherits(EDITOR_IN_PLACE,t);var e=_createSuper(EDITOR_IN_PLACE);function EDITOR_IN_PLACE(){return _classCallCheck(this,EDITOR_IN_PLACE),e.call(this)}return EDITOR_IN_PLACE}(s);e.exports={EDITOR:a,DEFAULT_EDITOR:l,INSPECTOR:c,DEFAULT_INSPECTOR:u,EDITOR_IN_PLACE:h}},{"@nkmjs/common":27}],267:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").NFOS,c=t("@nkmjs/ui-core"),u=c.UI_ID,h=c.UI,d=c.DrawerNav,p=t("../items/tab"),f=function(t){_inherits(WorkspaceCellNav,t);var e=_createSuper(WorkspaceCellNav);function WorkspaceCellNav(){return _classCallCheck(this,WorkspaceCellNav),e.call(this)}return _createClass(WorkspaceCellNav,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(WorkspaceCellNav.prototype),"_Init",this).call(this),this._defaultButtonClass=p,this._cellOptionsBtn=null}},{key:"_Render",value:function _Render(){var t;_get(_getPrototypeOf(WorkspaceCellNav.prototype),"_Render",this).call(this),this._cellOptionsBtn=this._toolbar.CreateHandle((_defineProperty(t={},u.ICON,"%ICON%/icon_more.svg"),_defineProperty(t,"text","More Actions..."),_defineProperty(t,"trigger",{thisArg:this,fn:this._OpenSettings}),t))}},{key:"_OpenSettings",value:function _OpenSettings(){}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(WorkspaceCellNav.prototype),"_CleanUp",this).call(this)}}]),WorkspaceCellNav}(d);_defineProperty(f,"__NFO__",l.Ext({css:["@/views/workspace-cell-nav.css"]},d,["css"])),e.exports=f,h.Register("nkmjs-workspace-cell-nav",f)},{"../items/tab":262,"@nkmjs/common":27,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],268:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/common").NFOS,c=t("@nkmjs/data-core"),u=c.Catalog,h=c.CatalogItem,d=t("@nkmjs/ui-core"),p=d.UI,f=d.UI_FLAG,g=d.Drawer,m=t("./workspace-cell-nav"),y=function(t){_inherits(WorkspaceCell,t);var e=_createSuper(WorkspaceCell);function WorkspaceCell(){return _classCallCheck(this,WorkspaceCell),e.call(this)}return _createClass(WorkspaceCell,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(WorkspaceCell.prototype),"_Init",this).call(this),this._navClass=m,this._isCollapsable=!1}},{key:"_OnCatalogItemAdded",value:function _OnCatalogItemAdded(t,e,n){if(!s.isInstanceOf(e,h))throw new Error("non-catalog item added to workspace cell catalog.");if(s.isInstanceOf(e,u))throw new Error("Full catalog item added to workspace cell catalog.");return _get(_getPrototypeOf(WorkspaceCell.prototype),"_OnCatalogItemAdded",this).call(this,t,e,n)}},{key:"_OnViewAdded",value:function _OnViewAdded(t,e,n){_get(_getPrototypeOf(WorkspaceCell.prototype),"_OnViewAdded",this).call(this,t,e,n),n.RequestDisplay()}}]),WorkspaceCell}(g);_defineProperty(y,"__NFO__",l.Ext({css:["@/views/workspace-cell.css"]},g,["css"])),_defineProperty(y,"__default_orientation",f.HORIZONTAL),e.exports=y,p.Register("nkmjs-workspace-cell",y)},{"./workspace-cell-nav":267,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],269:[function(t,e,n){var i=t("@nkmjs/utils"),s=i.U,a=i.LOG,l=t("@nkmjs/actions"),c=l.RELAY,u=l.ACTION_REQUEST,h,d=t("@nkmjs/common").BINDINGS,p,f=t("@nkmjs/data-core").Catalog,g,m=t("@nkmjs/ui-core").UI,y=t("../workspace-context"),v,k=function(t){_inherits(RootWorkspace,t);var e=_createSuper(RootWorkspace);function RootWorkspace(){return _classCallCheck(this,RootWorkspace),e.call(this)}return _createClass(RootWorkspace,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(RootWorkspace.prototype),"_Init",this).call(this),this._rootCatalog=new f,this._rootCatalog.GetOrCreateCatalog({name:"RootCell"})}},{key:"_PostInit",value:function _PostInit(){_get(_getPrototypeOf(RootWorkspace.prototype),"_PostInit",this).call(this),c.Watch(u.EDIT,this._HandleEditRequest,this),c.Watch(u.OPEN,this._HandleOpenRequest,this),c.Watch(u.CREATE,this._HandleCreateRequest,this),this.catalog=this._rootCatalog}},{key:"rootCatalog",get:function get(){return this._rootCatalog}},{key:"_Style",value:function _Style(){return s.Merge(_get(_getPrototypeOf(RootWorkspace.prototype),"_Style",this).call(this),{":host":{position:"relative",width:"1px",flex:"1 1 auto",display:"flex"}})}},{key:"_HandleEditRequest",value:function _HandleEditRequest(t){if(!t.handled){var e=t.GetOption("data",null),n=t.GetOption("editor",null);e?(n=n?d.Get(n,e,n):d.Get(y.DEFAULT_EDITOR,e))?(a._("Editing request for ".concat(e," will be handled using ").concat(n.name)),this.Host({data:e,viewType:n,name:e.id.name}),t.HandleSuccess(this)):t.HandleFail("Could not find editor association for ".concat(e,".")):t.HandleFail("Editing request has no data.")}}},{key:"_HandleOpenRequest",value:function _HandleOpenRequest(t){}},{key:"_HandleCreateRequest",value:function _HandleCreateRequest(t){}}]),RootWorkspace}(t("./workspace.js"));e.exports=k,m.Register("nkmjs-root-workspace",k)},{"../workspace-context":266,"./workspace.js":270,"@nkmjs/actions":1,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],270:[function(t,e,n){var i,s=t("@nkmjs/utils").U,a,l=t("@nkmjs/collections").List,c=t("@nkmjs/common"),u=c.NFOS,h=c.POOL,d=c.SIGNAL,p=t("@nkmjs/data-core"),f=p.CatalogItem,g=p.Catalog,m=p.CatalogHandler,y=t("@nkmjs/ui-core"),v=y.UI,k=y.UI_SIGNAL,C=y.View,O=t("./workspace-cell"),E=function(t){_inherits(Workspace,t);var e=_createSuper(Workspace);function Workspace(){return _classCallCheck(this,Workspace),e.call(this)}return _createClass(Workspace,[{key:"_Init",value:function _Init(){_get(_getPrototypeOf(Workspace.prototype),"_Init",this).call(this),this._cellDefaultClass=O,this._cells=new l,this._catalogHandler=new m,this._catalogHandler.Watch(d.ITEM_ADDED,this._OnCatalogItemAdded,this),this._catalogHandler.Watch(d.ITEM_REMOVED,this._OnCatalogItemRemoved,this)}},{key:"catalog",get:function get(){return this._catalogHandler.catalog},set:function set(t){this._catalogHandler.catalog=t}},{key:"_Style",value:function _Style(){return{":host":{position:"relative",display:"flex"},".navigation":{position:"relative",flex:"1 1 auto",outline:"1px rgba(0,255,0,0.5) solid","outline-offset":"-1px"},".cell":{position:"relative"}}}},{key:"_OnCatalogItemAdded",value:function _OnCatalogItemAdded(t,e){if(!s.isInstanceOf(e,g))throw new Error("non-catalog item added to workspace catalog : ".concat(e,"."));var n=e.GetOption("cellClass",this._cellDefaultClass),i=this.Add(n,"cell");t.Set(e,i),e.data&&e.data.Watch(d.RELEASED,this._OnItemDataReleased,this),this._OnCellCreated(e,i)}},{key:"_OnCellCreated",value:function _OnCellCreated(t,e){this._cells.Add(t),e.Watch(k.FOCUS_REQUESTED,this._OnCellRequestFocus,this),e.catalog=t}},{key:"_OnItemDataReleased",value:function _OnItemDataReleased(t){var e=this.catalog;if(e)for(var n=e.FindDataHolders(p_item.data),i=0,s=n.length;i<s;i++)n[i].Release()}},{key:"_OnCatalogItemRemoved",value:function _OnCatalogItemRemoved(t,e,n){e.data&&e.data.Unwatch(d.RELEASED,this._OnItemDataReleased,this),n&&(this._OnCellRemoved(e,n),n.parent===this&&n.Release())}},{key:"_OnCellRemoved",value:function _OnCellRemoved(t,e){this._cells.Remove(t),e.Unwatch(k.FOCUS_REQUESTED,this._OnCellRequestFocus,this)}},{key:"_OnCellRequestFocus",value:function _OnCellRequestFocus(t){}},{key:"Host",value:function Host(t){var e=this._FetchCatalog();if(s.isInstanceOf(t,f))e.Add(t);else{for(var n=null,i=t.GetOption("viewType",null),a=e.FindDataHolders(t.data),l=0,c=a.length;l<c;l++){var u=a[l].GetOption("viewType",null);if(u&&s.isInstanceOf(u,i))return void u.RequestDisplay()}var h=e.Register(t)}}},{key:"_FetchCatalog",value:function _FetchCatalog(){var t=this.catalog;if(t){for(var e=null,n=t.count,i=0;null===e||i<n;)e=t.At(i),s.isInstanceOf(e,g)||(e=null),i++;t=e||t.GetOrCreateCatalog({name:"RootCell"})}else{var a=h.Rent(g);t=a.GetOrCreateCatalog({name:"RootCell"}),this.catalog=a}return t}},{key:"_CleanUp",value:function _CleanUp(){_get(_getPrototypeOf(Workspace.prototype),"_CleanUp",this).call(this)}}]),Workspace}(C);_defineProperty(E,"__NFO__",u.Ext({css:["@/views/workspace.css"]},C,["css"])),e.exports=E,v.Register("nkmjs-workspace",E)},{"./workspace-cell":268,"@nkmjs/collections":21,"@nkmjs/common":27,"@nkmjs/data-core":55,"@nkmjs/ui-core":169,"@nkmjs/utils":271}],271:[function(t,e,n){e.exports={U:t("./lib/utils"),UDOM:t("./lib/utils-dom"),PATH:t("./lib/path"),MIME:t("./lib/mime"),LOG:t("./lib/logger")}},{"./lib/logger":272,"./lib/mime":273,"./lib/path":274,"./lib/utils":276,"./lib/utils-dom":275}],272:[function(t,e,n){var i=function(){function LOG(){_classCallCheck(this,LOG)}return _createClass(LOG,null,[{key:"toggle",value:function toggle(t){this._enabled=t}},{key:"_",value:function _(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#818181",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._enabled&&(n?console.log("%c ".concat(t," "),"background: ".concat(n,"; color: ").concat(e,"; border-radius: 5px;")):console.log("%c".concat(t," "),"color: ".concat(e)))}},{key:"_U",value:function _U(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#818181",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._enabled&&(s?console.log("%c ⭮ ".concat(t," 🠚 '").concat(e,"' %c(was '").concat(n,"') "),"background: ".concat(s,"; color: ").concat(i,"; border-radius: 5px;"),"background: ".concat(s,"; color: ").concat(i,"; font-style: italic; border-radius: 5px;")):console.log("%c⭮ ".concat(t," 🠚 '").concat(e,"' %c(was '").concat(n,"')"),"color: ".concat(i),"color: ".concat(i,"; font-style: italic")))}}]),LOG}();e.exports=i},{}],273:[function(t,e,n){var i=[{ext:".localStorage",desc:"A local storage object in string form",type:"text/plain"},{ext:".aac",desc:"AAC audio",type:"audio/aac"},{ext:".abw",desc:"AbiWord document",type:"application/x-abiword"},{ext:".arc",desc:"Archive document (multiple files embedded)",type:"application/x-freearc"},{ext:".avi",desc:"AVI: Audio Video Interleave",type:"video/x-msvideo"},{ext:".azw",desc:"Amazon Kindle eBook format",type:"application/vnd.amazon.ebook"},{ext:".bin",desc:"Any kind of binary data",type:"application/octet-stream"},{ext:".bmp",desc:"Windows OS/2 Bitmap Graphics",type:"image/bmp"},{ext:".bz",desc:"BZip archive",type:"application/x-bzip"},{ext:".bz2",desc:"BZip2 archive",type:"application/x-bzip2"},{ext:".csh",desc:"C-Shell script",type:"application/x-csh"},{ext:".css",desc:"Cascading Style Sheets (CSS)",type:"text/css"},{ext:".csv",desc:"Comma-separated values (CSV)",type:"text/csv"},{ext:".doc",desc:"Microsoft Word",type:"application/msword"},{ext:".docx",desc:"Microsoft Word (OpenXML)",type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"},{ext:".eot",desc:"MS Embedded OpenType fonts",type:"application/vnd.ms-fontobject"},{ext:".epub",desc:"Electronic publication (EPUB)",type:"application/epub+zip"},{ext:".gz",desc:"GZip Compressed Archive",type:"application/gzip"},{ext:".gif",desc:"Graphics Interchange Format (GIF)",type:"image/gif"},{ext:".htm",desc:"HyperText Markup Language (HTML)",type:"text/html"},{ext:".html",desc:"HyperText Markup Language (HTML)",type:"text/html"},{ext:".ico",desc:"Icon format",type:"image/vnd.microsoft.icon"},{ext:".ics",desc:"iCalendar format",type:"text/calendar"},{ext:".jar",desc:"Java Archive (JAR)",type:"application/java-archive"},{ext:".jpeg",desc:"JPEG images",type:"image/jpeg"},{ext:".jpg",desc:"JPEG images",type:"image/jpeg"},{ext:".js",desc:"JavaScript",type:"text/javascript"},{ext:".json",desc:"JSON format",type:"application/json"},{ext:".jsonld",desc:"JSON-LD format",type:"application/ld+json"},{ext:".mid",desc:"Musical Instrument Digital Interface (MIDI)",type:"audio/midi audio/x-midi"},{ext:".midi",desc:"Musical Instrument Digital Interface (MIDI)",type:"audio/midi audio/x-midi"},{ext:".mjs",desc:"JavaScript module",type:"text/javascript"},{ext:".mp3",desc:"MP3 audio",type:"audio/mpeg"},{ext:".mpeg",desc:"MPEG Video",type:"video/mpeg"},{ext:".mpkg",desc:"Apple Installer Package",type:"application/vnd.apple.installer+xml"},{ext:".odp",desc:"OpenDocument presentation document",type:"application/vnd.oasis.opendocument.presentation"},{ext:".ods",desc:"OpenDocument spreadsheet document",type:"application/vnd.oasis.opendocument.spreadsheet"},{ext:".odt",desc:"OpenDocument text document",type:"application/vnd.oasis.opendocument.text"},{ext:".oga",desc:"OGG audio",type:"audio/ogg"},{ext:".ogv",desc:"OGG video",type:"video/ogg"},{ext:".ogx",desc:"OGG",type:"application/ogg"},{ext:".opus",desc:"Opus audio",type:"audio/opus"},{ext:".otf",desc:"OpenType font",type:"font/otf"},{ext:".png",desc:"Portable Network Graphics",type:"image/png"},{ext:".pdf",desc:"Adobe Portable Document Format (PDF)",type:"application/pdf"},{ext:".php",desc:"Hypertext Preprocessor (Personal Home Page)",type:"application/x-httpd-php"},{ext:".ppt",desc:"Microsoft PowerPoint",type:"application/vnd.ms-powerpoint"},{ext:".pptx",desc:"Microsoft PowerPoint (OpenXML)",type:"application/vnd.openxmlformats-officedocument.presentationml.presentation"},{ext:".rar",desc:"RAR archive",type:"application/vnd.rar"},{ext:".rtf",desc:"Rich Text Format (RTF)",type:"application/rtf"},{ext:".sh",desc:"Bourne shell script",type:"application/x-sh"},{ext:".svg",desc:"Scalable Vector Graphics (SVG)",type:"image/svg+xml"},{ext:".swf",desc:"Small web format (SWF) or Adobe Flash document",type:"application/x-shockwave-flash"},{ext:".tar",desc:"Tape Archive (TAR)",type:"application/x-tar"},{ext:".tif",desc:"Tagged Image File Format (TIFF)",type:"image/tiff"},{ext:".tiff",desc:"Tagged Image File Format (TIFF)",type:"image/tiff"},{ext:".ts",desc:"MPEG transport stream",type:"video/mp2t"},{ext:".ttf",desc:"TrueType Font",type:"font/ttf"},{ext:".txt",desc:"Text, (generally ASCII or ISO 8859-n)",type:"text/plain"},{ext:".vsd",desc:"Microsoft Visio",type:"application/vnd.visio"},{ext:".wav",desc:"Waveform Audio Format",type:"audio/wav"},{ext:".weba",desc:"WEBM audio",type:"audio/webm"},{ext:".webm",desc:"WEBM video",type:"video/webm"},{ext:".webp",desc:"WEBP image",type:"image/webp"},{ext:".woff",desc:"Web Open Font Format (WOFF)",type:"font/woff"},{ext:".woff2",desc:"Web Open Font Format (WOFF)",type:"font/woff2"},{ext:".xhtml",desc:"XHTML",type:"application/xhtml+xml"},{ext:".xls",desc:"Microsoft Excel",type:"application/vnd.ms-excel"},{ext:".xlsx",desc:"Microsoft Excel (OpenXML)",type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},{ext:".xml",desc:"XML",type:"text/xml"},{ext:".xul",desc:"XUL",type:"application/vnd.mozilla.xul+xml"},{ext:".zip",desc:"ZIP archive",type:"application/zip"},{ext:".3gp",desc:"3GPP audio/video container",type:"video/3gpp audio/3gpp"},{ext:".3g2",desc:"3GPP2 audio/video container",type:"video/3gpp2 audio/3gpp2"},{ext:".7z",desc:"7-zip archive",type:"application/x-7z-compressed"}],s=function(){function MIME(){_classCallCheck(this,MIME)}return _createClass(MIME,null,[{key:"_GenerateMap",value:function _GenerateMap(){this._map={};for(var t=0,e=i.length;t<e;t++){var n=i[t];this._map[n.ext]={mime:n.type,desc:n.desc}}}},{key:"mimes",get:function get(){return this._map||this._GenerateMap(),this._map}},{key:"Get",value:function Get(t){return this._map||this._GenerateMap(),this._map[t]}},{key:"Set",value:function Set(t){this._map[m.ext]=t}}]),MIME}();e.exports=s},{}],274:[function(t,e,n){var i=t("./logger"),s=function(){function PATH(){_classCallCheck(this,PATH)}return _createClass(PATH,null,[{key:"SET",value:function SET(t,e){if(this.SYSTEM_MAP.includes(t)&&this.MAP.hasOwnProperty(t))throw new Error("Cannot override system path (".concat(t,")"));t.length<3||"%"!=t.substr(0,1)||"%"!=t.substr(t.length-1,1)||(this.MAP[t]=e,i._("⮥ ".concat(t," ⮧ ").concat(e),"#7f7f7f"))}},{key:"UNSET",value:function UNSET(t){delete this.MAP[t]}},{key:"Sanitize",value:function Sanitize(t){return t.split("\\").join("/")}},{key:"SHORT",value:function SHORT(t){for(var e in t=this.Sanitize(t),this.MAP)""!==this.MAP[e]&&(t=t.replace(this.MAP[e],e));return t}},{key:"FULL",value:function FULL(t){for(var e in this.MAP)t=t.replace(e,this.MAP[e]);return this.Sanitize(t)}},{key:"dir",value:function dir(t){var e=this.Sanitize(t).split("/");return e.pop(),e.join("/")}},{key:"name",value:function name(t){var e=t.split("/");if(e.length<=1)return this.stripExt(t);for(var n=e.pop();""===n&&e.length>=1;)n=e.pop();return this.stripExt(n)}},{key:"ext",value:function ext(t){if(t.includes("?")){var e=t.split("?");t=e[0]}var n=t.split(".");return n.length<=1?t:".".concat(n[n.length-1])}},{key:"stripExt",value:function stripExt(t){var e=t.split(".");return e.length<=1?t:(e.pop(),e.join("."))}},{key:"extras",get:function get(){var t={};for(var e in this.MAP)this.SYSTEM_MAP.includes(e)||(t[e]=this.MAP[e]);return t}}]),PATH}();_defineProperty(s,"APP","%APP%"),_defineProperty(s,"APP_DATA","%APP_DATA%"),_defineProperty(s,"USER_DATA","%USER_DATA%"),_defineProperty(s,"HOME","%HOME%"),_defineProperty(s,"TEMP","%TEMP%"),_defineProperty(s,"DOCUMENTS","%DOCUMENTS%"),_defineProperty(s,"DESKTOP","%DESKTOP%"),_defineProperty(s,"LOGS","%LOGS%"),_defineProperty(s,"DOWNLOADS","%DOWNLOADS%"),_defineProperty(s,"VIDEOS","%VIDEOS%"),_defineProperty(s,"PICTURES","%PICTURES%"),_defineProperty(s,"MUSIC","%MUSIC%"),_defineProperty(s,"STYLE","%STYLE%"),_defineProperty(s,"SYSTEM_MAP",[s.APP_DATA,s.USER_DATA,s.HOME,s.TEMP,s.DOCUMENTS,s.DESKTOP,s.LOGS,s.DOWNLOADS,s.VIDEOS,s.PICTURES,s.MUSIC,s.STYLE]),_defineProperty(s,"MAP",{}),e.exports=s},{"./logger":272}],275:[function(t,e,n){var i=t("./utils"),s=function(){function UTILS_DOM(){_classCallCheck(this,UTILS_DOM)}return _createClass(UTILS_DOM,null,[{key:"New",value:function New(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=document.createElement(t);if(!i.isVoid(e))for(var a in e)s.setAttribute(a,e[a]);return i.isVoid(n)||UTILS_DOM.Attach(s,n),s}},{key:"NewClone",value:function NewClone(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t.cloneNode(!0);return i.isVoid(e)||UTILS_DOM.Attach(n,e),n}},{key:"Attach",value:function Attach(t,e){"_wrapper"in e?e._wrapper.appendChild(t):e.appendChild(t)}},{key:"AttachFirst",value:function AttachFirst(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n&&e.firstChild?e.insertBefore(t,e.firstChild):!n&&e.firstChildElement?e.insertBefore(t,e.firstChildElement):e.appendChild(t)}},{key:"Detach",value:function Detach(t){i.isVoid(t.parentNode)||t.parentNode.removeChild(t)}},{key:"ToFront",value:function ToFront(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i.isVoid(t.parentNode))throw new Error("Node has no parent.");e?t.parentNode.lastChild?t.parentNode.insertAfter(t.parentNode.lastChild):t.parentNode.appendChild(t):t.parentNode.lastChildElement?t.parentNode.insertAfter(t.parentNode.lastChildElement):t.parentNode.lastChild?t.parentNode.insertAfter(t.parentNode.lastChild):t.parentNode.appendChild(t)}},{key:"ToBack",value:function ToBack(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i.isVoid(t.parentNode))throw new Error("Node has no parent.");e?t.parentNode.firstChild?t.parentNode.insertBefore(t.parentNode.firstChild):t.parentNode.appendChild(t):t.parentNode.firstChildElement?t.parentNode.insertBefore(t.parentNode.firstChildElement):t.parentNode.firstChild?t.parentNode.insertBefore(t.parentNode.firstChild):t.parentNode.appendChild(t)}},{key:"Rect",value:function Rect(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t.getBoundingClientRect();if(!e)return n;var i=e.getBoundingClientRect();return DOMRectReadOnly.fromRect({x:n.x-i.x,y:n.y-i.y,width:n.width,height:n.height})}},{key:"OverflowsY",value:function OverflowsY(t){return t.scrollHeight>t.clientHeight}},{key:"OverflowsX",value:function OverflowsX(t){return t.scrollWidth>t.clientWidth}}]),UTILS_DOM}();e.exports=s},{"./utils":276}],276:[function(t,e,n){var i=Object.prototype.toString,s=function(){function UTILS(){_classCallCheck(this,UTILS)}return _createClass(UTILS,null,[{key:"isArray",value:function isArray(t){return Array.isArray(t)}},{key:"isArrayBuffer",value:function isArrayBuffer(t){return"[object ArrayBuffer]"===i.call(t)}},{key:"isSymbol",value:function isSymbol(t){return"symbol"===_typeof(t)}},{key:"isObject",value:function isObject(t){return null!==t&&"object"===_typeof(t)}},{key:"isFunc",value:function isFunc(t){return"function"==typeof t}},{key:"isString",value:function isString(t){return"string"==typeof t}},{key:"isNumber",value:function isNumber(t){return"number"==typeof t}},{key:"isBool",value:function isBool(t){return"boolean"==typeof t}},{key:"isUndefined",value:function isUndefined(t){return void 0===t}},{key:"isVoid",value:function isVoid(t){return null==t}},{key:"isInstanceOf",value:function isInstanceOf(t,e){if(UTILS.isVoid(t)||UTILS.isVoid(e))return!1;var n="function"==typeof t,i="function"==typeof e,s,a;return!(!n||!i||t!==e)||(n?t.prototype:t)instanceof(i?e:e.constructor)}},{key:"isEmpty",value:function isEmpty(t){if(UTILS.isVoid(t)||""===t)return!0;if(UTILS.isArray(t))return 0===t.length;if(UTILS.isObject(t)){for(var e in t)return!1;return!0}return!1}},{key:"JSONStripEmpty",value:function JSONStripEmpty(t,e){if(!UTILS.isEmpty(e)){if(!UTILS.isObject(e))return e;for(var n in e)if(e.hasOwnProperty(n))return e}}},{key:"Default",value:function Default(){for(var t=0,e=arguments.length;t<e;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(!UTILS.isVoid(n))return n}return null}},{key:"Get",value:function Get(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(UTILS.isVoid(t))return n;var i=t[e];return UTILS.isVoid(i)?n:i}},{key:"Ensure",value:function Ensure(t,e,n){return e in t||(t[e]=n),t}},{key:"EnsureMultiple",value:function EnsureMultiple(t,e){for(var n in e)n in t||(t[n]=e[n]);return t}},{key:"ParsePath",value:function ParsePath(t){if(UTILS.isVoid(t))return null;var e={},n,i;if(t.includes(UTILS.DELIM_PROTOCOL)){var s=t.split(UTILS.DELIM_PROTOCOL);if(2!=s.length)throw new Error("Path '".concat(t,"' cannot be parsed (protocol malformed)."));e.protocol=s[0]+UTILS.DELIM_PROTOCOL,t=s[1]}if(t.includes(UTILS.DELIM_DRIVE)){var a=t.split(UTILS.DELIM_DRIVE);if(a.length>2)throw new Error("Path '".concat(t,"' cannot be parsed (drive malformed)."));e.drive=a[0]+UTILS.DELIM_PROTOCOL,t=a[1]}var l=t.split(UTILS.DELIM_DIR),c=l.length-1,u,h=l[c].split(UTILS.DELIM_EXT);l.splice(c,1);for(var d=0,p=l.length;d<p;d++)""===l[d]&&(l.splice(d,1),d--);return e.path=l.join(UTILS.DELIM_DIR)+UTILS.DELIM_DIR,e.pathArray=l,e.name=h[0],e.ext=UTILS.DELIM_EXT+h[h.length-1],e}},{key:"FixSlash",value:function FixSlash(t){return t.split("\\").join("/")}},{key:"isNot",value:function isNot(t){for(var e=0,n=arguments.length<=1?0:arguments.length-1;e<n;e++)if((e+1<1||arguments.length<=e+1?void 0:arguments[e+1])===t)return!1;return!0}},{key:"Append",value:function Append(t,e){if(UTILS.isVoid(t)&&(t={}),UTILS.isVoid(e))return t;for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);return t}},{key:"Merge",value:function Merge(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(UTILS.isVoid(t))return e;for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];if(t.hasOwnProperty(i)&&!n){var a=t[i];!UTILS.isArray(a)&&UTILS.isObject(a)&&!UTILS.isArray(s)&&UTILS.isObject(s)?UTILS.Merge(a,s):t[i]=s}else t[i]=s}return t}},{key:"SetMissing",value:function SetMissing(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var i in e){var s=e[i];if(t.hasOwnProperty(i)){var a=t[i];if(UTILS.isArray(a)){if(UTILS.isArray(s)&&n)for(var l=0,c=s.length;l<c;l++)a.includes(s[l])||a.unshift(s[l])}else UTILS.isObject(a)&&UTILS.isObject(s)&&UTILS.SetMissing(a,s)}else UTILS.isArray(s)?t[i]=_toConsumableArray(s):UTILS.isObject()?t[i]=UTILS.SetMissing({},s):t[i]=s}return t}},{key:"SetOverwrite",value:function SetOverwrite(t,e){for(var n in e){var i=e[n];if(t.hasOwnProperty(n)){var s=t[n];UTILS.isArray(s)?t[n]=i:UTILS.isObject(i)&&UTILS.isObject(s)?UTILS.SetOverwrite(s,i):t[n]=i}else UTILS.isArray(i)||UTILS.isObject(),t[n]=i}return t}},{key:"MergeArray",value:function MergeArray(t,e){if(!t)return t=new Array(0),e?t=_toConsumableArray(e):t;if(!e)return t;for(var n=0,i=e.length;n<i;n++)t.includes(e[n])||t.push(e[n]);return t}},{key:"Clone",value:function Clone(t){if(!UTILS.isObject(t))throw new Error("Cannot Clone the non-object '".concat(t,"'"));var e={};for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];null!=i&&(UTILS.isArray(i)?i=UTILS.CloneArray(i):UTILS.isObject(i)&&(i=UTILS.Clone(i))),e[n]=i}return e}},{key:"CloneArray",value:function CloneArray(t){if(!UTILS.isArray(t))throw new Error("Cannot CloneArray the non-array '".concat(t,"'"));for(var e=new Array(0),n=0,i=t.length;n<i;n++){var s=t[n];null!=s&&(UTILS.isArray(s)?s=UTILS.CloneArray(s):UTILS.isObject(s)&&(s=UTILS.Clone(s))),e.push(s)}return e}},{key:"CamelSplit",value:function CamelSplit(t){return t.replace(/([a-z0-9])([A-Z#])/g,"$1 $2")}},{key:"ArrayDiff",value:function ArrayDiff(t,e,n,i){if(UTILS.isVoid(t)){if(UTILS.isVoid(e))return;for(var s=0,a=e.length;s<a;s++)i.push(e[s])}else if(UTILS.isVoid(e)){if(UTILS.isVoid(t))return;for(var l=0,c=t.length;l<c;l++)n.push(t[l])}else{for(var u=0,h=t.length;u<h;u++){var d=t[u];e.includes(d)||n.push(d)}for(var p=0,f=e.length;p<f;p++){var g=t[p];e.includes(g)||i.push(g)}}}},{key:"ArrayDiffCallbacks",value:function ArrayDiffCallbacks(t,e,n,i){if(UTILS.isVoid(t)){if(UTILS.isVoid(e))return;for(var s=0,a=e.length;s<a;s++)i(e[s],s)}else if(UTILS.isVoid(e)){if(UTILS.isVoid(t))return;for(var l=0,c=t.length;l<c;l++)n(t[l],l)}else{for(var u=0,h=t.length;u<h;u++){var d=t[u];e.includes(d)||n(d,u)}for(var p=0,f=e.length;p<f;p++){var g=e[p];t.includes(g)||i(g,p)}}}},{key:"InheritanceDistance",value:function InheritanceDistance(t,e){var n=0;if(!UTILS.isInstanceOf(t,e))return-1;for(var i=Object.getPrototypeOf(t);null!=i&&n<100;){if(i===e)return n;i=Object.getPrototypeOf(i),n++}return 100===n&&console.warn("InheritanceDistance reached 100 iterations. Stopping."),-1}},{key:"Clear",value:function Clear(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var n in t)delete t[n];if(e)return{}}},{key:"DeepClear",value:function DeepClear(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;for(var i in t)n=t[i],UTILS.isArray(n)?UTILS.DeepClearArray(n):UTILS.isObject(n)&&UTILS.DeepClear(n),t[i]=null;if(e)return{}}},{key:"DeepClearArray",value:function DeepClearArray(t){for(var e=null;0!=t.length;)e=t.pop(),UTILS.isArray(e)?UTILS.DeepClearArray(e):UTILS.isObject(e)&&UTILS.DeepClear(e)}},{key:"isSame",value:function isSame(t,e){if(t===e)return!0;var n=0;for(var i in t){if(n++,!(i in e))return!1;var s=t[i],a=e[i];if(s!==a){var l=_typeof(s),c;if(l!==_typeof(a))return!1;if(UTILS.isArray(s)){if(!UTILS.isSameArray(s,a))return!1}else{if("object"!==l)return!1;if(!UTILS.isSame(s,a))return!1}}}var u=0;for(var h in e)u++;return n==u}},{key:"isSameArray",value:function isSameArray(t,e){if(t===e)return!0;var n=t.length;if(n!=e.length)return!1;for(var i=0;i<n;i++){var s=t[i],a=e[i];if(s!==a){var l=_typeof(s),c;if(l!==_typeof(a))return!1;if(UTILS.isArray(s)){if(!UTILS.isSameArray(s,a))return!1}else{if("object"!==l)return!1;if(!UTILS.isSame(s,a))return!1}}}return!0}},{key:"Join",value:function Join(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;-1===i&&(i=t.length-1);for(var s="".concat(t[n]),a=++n;a<=i;a++)s+="".concat(p_join).concat(t[a]);return s}},{key:"Resolve",value:function Resolve(t,e){for(var n=e.split("."),i=t,s=0,a=n.length;s<a;s++){if(void 0===i[n[s]])return;i=i[n[s]]}return i}},{key:"ValidIdentifier",value:function ValidIdentifier(t){return/^[A-Za-z_][A-Za-z0-9_]*$/.test(t)}},{key:"StartWithNumber",value:function StartWithNumber(t){return/^\d/.test(t)}},{key:"ContainsAnySpace",value:function ContainsAnySpace(t){return t.includes(" "," "," ","᠎"," "," "," "," "," "," "," "," "," "," "," ","​"," "," ","　","\ufeff")}},{key:"unsafeUID",get:function get(){return"_".concat(Math.random().toString(36).substr(2,9))}},{key:"Move",value:function Move(t,e,n){if(e!==n){if(-1===e)throw new Error("Item is not in array");t.splice(n,0,t.splice(e,1)[0])}}}]),UTILS}();_defineProperty(s,"DELIM_PROTOCOL","://"),_defineProperty(s,"DELIM_DRIVE",":/"),_defineProperty(s,"DELIM_DIR","/"),_defineProperty(s,"DELIM_EXT","."),_defineProperty(s,"DELIM_COLON",":"),_defineProperty(s,"DELIM_SEMI",";"),_defineProperty(s,"DELIM_COMMA",","),_defineProperty(s,"DELIM_PIPE","|"),e.exports=s},{}]},{},[52]);